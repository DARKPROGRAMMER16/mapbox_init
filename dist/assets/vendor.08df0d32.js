var Cb=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},bd={exports:{}},Ut={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Yy=Object.getOwnPropertySymbols,Ib=Object.prototype.hasOwnProperty,Ab=Object.prototype.propertyIsEnumerable;function Mb(o){if(o==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(o)}function kb(){try{if(!Object.assign)return!1;var o=new String("abc");if(o[5]="de",Object.getOwnPropertyNames(o)[0]==="5")return!1;for(var l={},f=0;f<10;f++)l["_"+String.fromCharCode(f)]=f;var v=Object.getOwnPropertyNames(l).map(function(k){return l[k]});if(v.join("")!=="0123456789")return!1;var E={};return"abcdefghijklmnopqrst".split("").forEach(function(k){E[k]=k}),Object.keys(Object.assign({},E)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var Ky=kb()?Object.assign:function(o,l){for(var f,v=Mb(o),E,k=1;k<arguments.length;k++){f=Object(arguments[k]);for(var B in f)Ib.call(f,B)&&(v[B]=f[B]);if(Yy){E=Yy(f);for(var a=0;a<E.length;a++)Ab.call(f,E[a])&&(v[E[a]]=f[E[a]])}}return v};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gf=Ky,Tl=60103,Jy=60106;Ut.Fragment=60107;Ut.StrictMode=60108;Ut.Profiler=60114;var Qy=60109,e0=60110,t0=60112;Ut.Suspense=60113;var i0=60115,n0=60116;if(typeof Symbol=="function"&&Symbol.for){var cr=Symbol.for;Tl=cr("react.element"),Jy=cr("react.portal"),Ut.Fragment=cr("react.fragment"),Ut.StrictMode=cr("react.strict_mode"),Ut.Profiler=cr("react.profiler"),Qy=cr("react.provider"),e0=cr("react.context"),t0=cr("react.forward_ref"),Ut.Suspense=cr("react.suspense"),i0=cr("react.memo"),n0=cr("react.lazy")}var r0=typeof Symbol=="function"&&Symbol.iterator;function zb(o){return o===null||typeof o!="object"?null:(o=r0&&o[r0]||o["@@iterator"],typeof o=="function"?o:null)}function iu(o){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+o,f=1;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f]);return"Minified React error #"+o+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},s0={};function El(o,l,f){this.props=o,this.context=l,this.refs=s0,this.updater=f||o0}El.prototype.isReactComponent={};El.prototype.setState=function(o,l){if(typeof o!="object"&&typeof o!="function"&&o!=null)throw Error(iu(85));this.updater.enqueueSetState(this,o,l,"setState")};El.prototype.forceUpdate=function(o){this.updater.enqueueForceUpdate(this,o,"forceUpdate")};function a0(){}a0.prototype=El.prototype;function Zf(o,l,f){this.props=o,this.context=l,this.refs=s0,this.updater=f||o0}var qf=Zf.prototype=new a0;qf.constructor=Zf;Gf(qf,El.prototype);qf.isPureReactComponent=!0;var Wf={current:null},l0=Object.prototype.hasOwnProperty,c0={key:!0,ref:!0,__self:!0,__source:!0};function u0(o,l,f){var v,E={},k=null,B=null;if(l!=null)for(v in l.ref!==void 0&&(B=l.ref),l.key!==void 0&&(k=""+l.key),l)l0.call(l,v)&&!c0.hasOwnProperty(v)&&(E[v]=l[v]);var a=arguments.length-2;if(a===1)E.children=f;else if(1<a){for(var Q=Array(a),ge=0;ge<a;ge++)Q[ge]=arguments[ge+2];E.children=Q}if(o&&o.defaultProps)for(v in a=o.defaultProps,a)E[v]===void 0&&(E[v]=a[v]);return{$$typeof:Tl,type:o,key:k,ref:B,props:E,_owner:Wf.current}}function Pb(o,l){return{$$typeof:Tl,type:o.type,key:l,ref:o.ref,props:o.props,_owner:o._owner}}function Xf(o){return typeof o=="object"&&o!==null&&o.$$typeof===Tl}function Db(o){var l={"=":"=0",":":"=2"};return"$"+o.replace(/[=:]/g,function(f){return l[f]})}var h0=/\/+/g;function Hf(o,l){return typeof o=="object"&&o!==null&&o.key!=null?Db(""+o.key):l.toString(36)}function Td(o,l,f,v,E){var k=typeof o;(k==="undefined"||k==="boolean")&&(o=null);var B=!1;if(o===null)B=!0;else switch(k){case"string":case"number":B=!0;break;case"object":switch(o.$$typeof){case Tl:case Jy:B=!0}}if(B)return B=o,E=E(B),o=v===""?"."+Hf(B,0):v,Array.isArray(E)?(f="",o!=null&&(f=o.replace(h0,"$&/")+"/"),Td(E,l,f,"",function(ge){return ge})):E!=null&&(Xf(E)&&(E=Pb(E,f+(!E.key||B&&B.key===E.key?"":(""+E.key).replace(h0,"$&/")+"/")+o)),l.push(E)),1;if(B=0,v=v===""?".":v+":",Array.isArray(o))for(var a=0;a<o.length;a++){k=o[a];var Q=v+Hf(k,a);B+=Td(k,l,f,Q,E)}else if(Q=zb(o),typeof Q=="function")for(o=Q.call(o),a=0;!(k=o.next()).done;)k=k.value,Q=v+Hf(k,a++),B+=Td(k,l,f,Q,E);else if(k==="object")throw l=""+o,Error(iu(31,l==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":l));return B}function Ed(o,l,f){if(o==null)return o;var v=[],E=0;return Td(o,v,"","",function(k){return l.call(f,k,E++)}),v}function Lb(o){if(o._status===-1){var l=o._result;l=l(),o._status=0,o._result=l,l.then(function(f){o._status===0&&(f=f.default,o._status=1,o._result=f)},function(f){o._status===0&&(o._status=2,o._result=f)})}if(o._status===1)return o._result;throw o._result}var d0={current:null};function lo(){var o=d0.current;if(o===null)throw Error(iu(321));return o}var Rb={ReactCurrentDispatcher:d0,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:Wf,IsSomeRendererActing:{current:!1},assign:Gf};Ut.Children={map:Ed,forEach:function(o,l,f){Ed(o,function(){l.apply(this,arguments)},f)},count:function(o){var l=0;return Ed(o,function(){l++}),l},toArray:function(o){return Ed(o,function(l){return l})||[]},only:function(o){if(!Xf(o))throw Error(iu(143));return o}};Ut.Component=El;Ut.PureComponent=Zf;Ut.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rb;Ut.cloneElement=function(o,l,f){if(o==null)throw Error(iu(267,o));var v=Gf({},o.props),E=o.key,k=o.ref,B=o._owner;if(l!=null){if(l.ref!==void 0&&(k=l.ref,B=Wf.current),l.key!==void 0&&(E=""+l.key),o.type&&o.type.defaultProps)var a=o.type.defaultProps;for(Q in l)l0.call(l,Q)&&!c0.hasOwnProperty(Q)&&(v[Q]=l[Q]===void 0&&a!==void 0?a[Q]:l[Q])}var Q=arguments.length-2;if(Q===1)v.children=f;else if(1<Q){a=Array(Q);for(var ge=0;ge<Q;ge++)a[ge]=arguments[ge+2];v.children=a}return{$$typeof:Tl,type:o.type,key:E,ref:k,props:v,_owner:B}};Ut.createContext=function(o,l){return l===void 0&&(l=null),o={$$typeof:e0,_calculateChangedBits:l,_currentValue:o,_currentValue2:o,_threadCount:0,Provider:null,Consumer:null},o.Provider={$$typeof:Qy,_context:o},o.Consumer=o};Ut.createElement=u0;Ut.createFactory=function(o){var l=u0.bind(null,o);return l.type=o,l};Ut.createRef=function(){return{current:null}};Ut.forwardRef=function(o){return{$$typeof:t0,render:o}};Ut.isValidElement=Xf;Ut.lazy=function(o){return{$$typeof:n0,_payload:{_status:-1,_result:o},_init:Lb}};Ut.memo=function(o,l){return{$$typeof:i0,type:o,compare:l===void 0?null:l}};Ut.useCallback=function(o,l){return lo().useCallback(o,l)};Ut.useContext=function(o,l){return lo().useContext(o,l)};Ut.useDebugValue=function(){};Ut.useEffect=function(o,l){return lo().useEffect(o,l)};Ut.useImperativeHandle=function(o,l,f){return lo().useImperativeHandle(o,l,f)};Ut.useLayoutEffect=function(o,l){return lo().useLayoutEffect(o,l)};Ut.useMemo=function(o,l){return lo().useMemo(o,l)};Ut.useReducer=function(o,l,f){return lo().useReducer(o,l,f)};Ut.useRef=function(o){return lo().useRef(o)};Ut.useState=function(o){return lo().useState(o)};Ut.version="17.0.2";bd.exports=Ut;var RT=bd.exports,p0={exports:{}},Yn={},f0={exports:{}},m0={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(o){var l,f,v,E;if(typeof performance=="object"&&typeof performance.now=="function"){var k=performance;o.unstable_now=function(){return k.now()}}else{var B=Date,a=B.now();o.unstable_now=function(){return B.now()-a}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var Q=null,ge=null,qe=function(){if(Q!==null)try{var Ve=o.unstable_now();Q(!0,Ve),Q=null}catch(ct){throw setTimeout(qe,0),ct}};l=function(Ve){Q!==null?setTimeout(l,0,Ve):(Q=Ve,setTimeout(qe,0))},f=function(Ve,ct){ge=setTimeout(Ve,ct)},v=function(){clearTimeout(ge)},o.unstable_shouldYield=function(){return!1},E=o.unstable_forceFrameRate=function(){}}else{var _e=window.setTimeout,oe=window.clearTimeout;if(typeof console!="undefined"){var ze=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof ze!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var it=!1,rt=null,me=-1,te=5,ue=0;o.unstable_shouldYield=function(){return o.unstable_now()>=ue},E=function(){},o.unstable_forceFrameRate=function(Ve){0>Ve||125<Ve?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):te=0<Ve?Math.floor(1e3/Ve):5};var ke=new MessageChannel,Pe=ke.port2;ke.port1.onmessage=function(){if(rt!==null){var Ve=o.unstable_now();ue=Ve+te;try{rt(!0,Ve)?Pe.postMessage(null):(it=!1,rt=null)}catch(ct){throw Pe.postMessage(null),ct}}else it=!1},l=function(Ve){rt=Ve,it||(it=!0,Pe.postMessage(null))},f=function(Ve,ct){me=_e(function(){Ve(o.unstable_now())},ct)},v=function(){oe(me),me=-1}}function at(Ve,ct){var nt=Ve.length;Ve.push(ct);e:for(;;){var zt=nt-1>>>1,oi=Ve[zt];if(oi!==void 0&&0<dt(oi,ct))Ve[zt]=ct,Ve[nt]=oi,nt=zt;else break e}}function Xe(Ve){return Ve=Ve[0],Ve===void 0?null:Ve}function Ye(Ve){var ct=Ve[0];if(ct!==void 0){var nt=Ve.pop();if(nt!==ct){Ve[0]=nt;e:for(var zt=0,oi=Ve.length;zt<oi;){var Ti=2*(zt+1)-1,$i=Ve[Ti],_n=Ti+1,xt=Ve[_n];if($i!==void 0&&0>dt($i,nt))xt!==void 0&&0>dt(xt,$i)?(Ve[zt]=xt,Ve[_n]=nt,zt=_n):(Ve[zt]=$i,Ve[Ti]=nt,zt=Ti);else if(xt!==void 0&&0>dt(xt,nt))Ve[zt]=xt,Ve[_n]=nt,zt=_n;else break e}}return ct}return null}function dt(Ve,ct){var nt=Ve.sortIndex-ct.sortIndex;return nt!==0?nt:Ve.id-ct.id}var ot=[],Qt=[],Yt=1,Di=null,ei=3,$n=!1,on=!1,Mn=!1;function kn(Ve){for(var ct=Xe(Qt);ct!==null;){if(ct.callback===null)Ye(Qt);else if(ct.startTime<=Ve)Ye(Qt),ct.sortIndex=ct.expirationTime,at(ot,ct);else break;ct=Xe(Qt)}}function zn(Ve){if(Mn=!1,kn(Ve),!on)if(Xe(ot)!==null)on=!0,l(sn);else{var ct=Xe(Qt);ct!==null&&f(zn,ct.startTime-Ve)}}function sn(Ve,ct){on=!1,Mn&&(Mn=!1,v()),$n=!0;var nt=ei;try{for(kn(ct),Di=Xe(ot);Di!==null&&(!(Di.expirationTime>ct)||Ve&&!o.unstable_shouldYield());){var zt=Di.callback;if(typeof zt=="function"){Di.callback=null,ei=Di.priorityLevel;var oi=zt(Di.expirationTime<=ct);ct=o.unstable_now(),typeof oi=="function"?Di.callback=oi:Di===Xe(ot)&&Ye(ot),kn(ct)}else Ye(ot);Di=Xe(ot)}if(Di!==null)var Ti=!0;else{var $i=Xe(Qt);$i!==null&&f(zn,$i.startTime-ct),Ti=!1}return Ti}finally{Di=null,ei=nt,$n=!1}}var mn=E;o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(Ve){Ve.callback=null},o.unstable_continueExecution=function(){on||$n||(on=!0,l(sn))},o.unstable_getCurrentPriorityLevel=function(){return ei},o.unstable_getFirstCallbackNode=function(){return Xe(ot)},o.unstable_next=function(Ve){switch(ei){case 1:case 2:case 3:var ct=3;break;default:ct=ei}var nt=ei;ei=ct;try{return Ve()}finally{ei=nt}},o.unstable_pauseExecution=function(){},o.unstable_requestPaint=mn,o.unstable_runWithPriority=function(Ve,ct){switch(Ve){case 1:case 2:case 3:case 4:case 5:break;default:Ve=3}var nt=ei;ei=Ve;try{return ct()}finally{ei=nt}},o.unstable_scheduleCallback=function(Ve,ct,nt){var zt=o.unstable_now();switch(typeof nt=="object"&&nt!==null?(nt=nt.delay,nt=typeof nt=="number"&&0<nt?zt+nt:zt):nt=zt,Ve){case 1:var oi=-1;break;case 2:oi=250;break;case 5:oi=1073741823;break;case 4:oi=1e4;break;default:oi=5e3}return oi=nt+oi,Ve={id:Yt++,callback:ct,priorityLevel:Ve,startTime:nt,expirationTime:oi,sortIndex:-1},nt>zt?(Ve.sortIndex=nt,at(Qt,Ve),Xe(ot)===null&&Ve===Xe(Qt)&&(Mn?v():Mn=!0,f(zn,nt-zt))):(Ve.sortIndex=oi,at(ot,Ve),on||$n||(on=!0,l(sn))),Ve},o.unstable_wrapCallback=function(Ve){var ct=ei;return function(){var nt=ei;ei=ct;try{return Ve.apply(this,arguments)}finally{ei=nt}}}})(m0);f0.exports=m0;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sd=bd.exports,li=Ky,Vi=f0.exports;function He(o){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+o,f=1;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f]);return"Minified React error #"+o+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!Sd)throw Error(He(227));var _0=new Set,nu={};function ta(o,l){Sl(o,l),Sl(o+"Capture",l)}function Sl(o,l){for(nu[o]=l,o=0;o<l.length;o++)_0.add(l[o])}var co=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),Bb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g0=Object.prototype.hasOwnProperty,y0={},x0={};function Fb(o){return g0.call(x0,o)?!0:g0.call(y0,o)?!1:Bb.test(o)?x0[o]=!0:(y0[o]=!0,!1)}function Ob(o,l,f,v){if(f!==null&&f.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return v?!1:f!==null?!f.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function Ub(o,l,f,v){if(l===null||typeof l=="undefined"||Ob(o,l,f,v))return!0;if(v)return!1;if(f!==null)switch(f.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function pn(o,l,f,v,E,k,B){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=v,this.attributeNamespace=E,this.mustUseProperty=f,this.propertyName=o,this.type=l,this.sanitizeURL=k,this.removeEmptyString=B}var Xi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){Xi[o]=new pn(o,0,!1,o,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var l=o[0];Xi[l]=new pn(l,1,!1,o[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(o){Xi[o]=new pn(o,2,!1,o.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){Xi[o]=new pn(o,2,!1,o,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){Xi[o]=new pn(o,3,!1,o.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(o){Xi[o]=new pn(o,3,!0,o,null,!1,!1)});["capture","download"].forEach(function(o){Xi[o]=new pn(o,4,!1,o,null,!1,!1)});["cols","rows","size","span"].forEach(function(o){Xi[o]=new pn(o,6,!1,o,null,!1,!1)});["rowSpan","start"].forEach(function(o){Xi[o]=new pn(o,5,!1,o.toLowerCase(),null,!1,!1)});var Yf=/[\-:]([a-z])/g;function Kf(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var l=o.replace(Yf,Kf);Xi[l]=new pn(l,1,!1,o,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var l=o.replace(Yf,Kf);Xi[l]=new pn(l,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(o){var l=o.replace(Yf,Kf);Xi[l]=new pn(l,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(o){Xi[o]=new pn(o,1,!1,o.toLowerCase(),null,!1,!1)});Xi.xlinkHref=new pn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(o){Xi[o]=new pn(o,1,!1,o.toLowerCase(),null,!0,!0)});function Jf(o,l,f,v){var E=Xi.hasOwnProperty(l)?Xi[l]:null,k=E!==null?E.type===0:v?!1:!(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N");k||(Ub(l,f,E,v)&&(f=null),v||E===null?Fb(l)&&(f===null?o.removeAttribute(l):o.setAttribute(l,""+f)):E.mustUseProperty?o[E.propertyName]=f===null?E.type===3?!1:"":f:(l=E.attributeName,v=E.attributeNamespace,f===null?o.removeAttribute(l):(E=E.type,f=E===3||E===4&&f===!0?"":""+f,v?o.setAttributeNS(v,l,f):o.setAttribute(l,f))))}var ia=Sd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ru=60103,na=60106,es=60107,Qf=60108,ou=60114,em=60109,tm=60110,Cd=60112,su=60113,Id=60120,Ad=60115,im=60116,nm=60121,rm=60128,v0=60129,om=60130,sm=60131;if(typeof Symbol=="function"&&Symbol.for){var ji=Symbol.for;ru=ji("react.element"),na=ji("react.portal"),es=ji("react.fragment"),Qf=ji("react.strict_mode"),ou=ji("react.profiler"),em=ji("react.provider"),tm=ji("react.context"),Cd=ji("react.forward_ref"),su=ji("react.suspense"),Id=ji("react.suspense_list"),Ad=ji("react.memo"),im=ji("react.lazy"),nm=ji("react.block"),ji("react.scope"),rm=ji("react.opaque.id"),v0=ji("react.debug_trace_mode"),om=ji("react.offscreen"),sm=ji("react.legacy_hidden")}var w0=typeof Symbol=="function"&&Symbol.iterator;function au(o){return o===null||typeof o!="object"?null:(o=w0&&o[w0]||o["@@iterator"],typeof o=="function"?o:null)}var am;function lu(o){if(am===void 0)try{throw Error()}catch(f){var l=f.stack.trim().match(/\n( *(at )?)/);am=l&&l[1]||""}return`
`+am+o}var lm=!1;function Md(o,l){if(!o||lm)return"";lm=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(Q){var v=Q}Reflect.construct(o,[],l)}else{try{l.call()}catch(Q){v=Q}o.call(l.prototype)}else{try{throw Error()}catch(Q){v=Q}o()}}catch(Q){if(Q&&v&&typeof Q.stack=="string"){for(var E=Q.stack.split(`
`),k=v.stack.split(`
`),B=E.length-1,a=k.length-1;1<=B&&0<=a&&E[B]!==k[a];)a--;for(;1<=B&&0<=a;B--,a--)if(E[B]!==k[a]){if(B!==1||a!==1)do if(B--,a--,0>a||E[B]!==k[a])return`
`+E[B].replace(" at new "," at ");while(1<=B&&0<=a);break}}}finally{lm=!1,Error.prepareStackTrace=f}return(o=o?o.displayName||o.name:"")?lu(o):""}function Nb(o){switch(o.tag){case 5:return lu(o.type);case 16:return lu("Lazy");case 13:return lu("Suspense");case 19:return lu("SuspenseList");case 0:case 2:case 15:return o=Md(o.type,!1),o;case 11:return o=Md(o.type.render,!1),o;case 22:return o=Md(o.type._render,!1),o;case 1:return o=Md(o.type,!0),o;default:return""}}function Cl(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case es:return"Fragment";case na:return"Portal";case ou:return"Profiler";case Qf:return"StrictMode";case su:return"Suspense";case Id:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case tm:return(o.displayName||"Context")+".Consumer";case em:return(o._context.displayName||"Context")+".Provider";case Cd:var l=o.render;return l=l.displayName||l.name||"",o.displayName||(l!==""?"ForwardRef("+l+")":"ForwardRef");case Ad:return Cl(o.type);case nm:return Cl(o._render);case im:l=o._payload,o=o._init;try{return Cl(o(l))}catch{}}return null}function ts(o){switch(typeof o){case"boolean":case"number":case"object":case"string":case"undefined":return o;default:return""}}function b0(o){var l=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function Vb(o){var l=b0(o)?"checked":"value",f=Object.getOwnPropertyDescriptor(o.constructor.prototype,l),v=""+o[l];if(!o.hasOwnProperty(l)&&typeof f!="undefined"&&typeof f.get=="function"&&typeof f.set=="function"){var E=f.get,k=f.set;return Object.defineProperty(o,l,{configurable:!0,get:function(){return E.call(this)},set:function(B){v=""+B,k.call(this,B)}}),Object.defineProperty(o,l,{enumerable:f.enumerable}),{getValue:function(){return v},setValue:function(B){v=""+B},stopTracking:function(){o._valueTracker=null,delete o[l]}}}}function kd(o){o._valueTracker||(o._valueTracker=Vb(o))}function T0(o){if(!o)return!1;var l=o._valueTracker;if(!l)return!0;var f=l.getValue(),v="";return o&&(v=b0(o)?o.checked?"true":"false":o.value),o=v,o!==f?(l.setValue(o),!0):!1}function zd(o){if(o=o||(typeof document!="undefined"?document:void 0),typeof o=="undefined")return null;try{return o.activeElement||o.body}catch{return o.body}}function cm(o,l){var f=l.checked;return li({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:f!=null?f:o._wrapperState.initialChecked})}function E0(o,l){var f=l.defaultValue==null?"":l.defaultValue,v=l.checked!=null?l.checked:l.defaultChecked;f=ts(l.value!=null?l.value:f),o._wrapperState={initialChecked:v,initialValue:f,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function S0(o,l){l=l.checked,l!=null&&Jf(o,"checked",l,!1)}function um(o,l){S0(o,l);var f=ts(l.value),v=l.type;if(f!=null)v==="number"?(f===0&&o.value===""||o.value!=f)&&(o.value=""+f):o.value!==""+f&&(o.value=""+f);else if(v==="submit"||v==="reset"){o.removeAttribute("value");return}l.hasOwnProperty("value")?hm(o,l.type,f):l.hasOwnProperty("defaultValue")&&hm(o,l.type,ts(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(o.defaultChecked=!!l.defaultChecked)}function C0(o,l,f){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var v=l.type;if(!(v!=="submit"&&v!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+o._wrapperState.initialValue,f||l===o.value||(o.value=l),o.defaultValue=l}f=o.name,f!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,f!==""&&(o.name=f)}function hm(o,l,f){(l!=="number"||zd(o.ownerDocument)!==o)&&(f==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+f&&(o.defaultValue=""+f))}function jb(o){var l="";return Sd.Children.forEach(o,function(f){f!=null&&(l+=f)}),l}function dm(o,l){return o=li({children:void 0},l),(l=jb(l.children))&&(o.children=l),o}function Il(o,l,f,v){if(o=o.options,l){l={};for(var E=0;E<f.length;E++)l["$"+f[E]]=!0;for(f=0;f<o.length;f++)E=l.hasOwnProperty("$"+o[f].value),o[f].selected!==E&&(o[f].selected=E),E&&v&&(o[f].defaultSelected=!0)}else{for(f=""+ts(f),l=null,E=0;E<o.length;E++){if(o[E].value===f){o[E].selected=!0,v&&(o[E].defaultSelected=!0);return}l!==null||o[E].disabled||(l=o[E])}l!==null&&(l.selected=!0)}}function pm(o,l){if(l.dangerouslySetInnerHTML!=null)throw Error(He(91));return li({},l,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function I0(o,l){var f=l.value;if(f==null){if(f=l.children,l=l.defaultValue,f!=null){if(l!=null)throw Error(He(92));if(Array.isArray(f)){if(!(1>=f.length))throw Error(He(93));f=f[0]}l=f}l==null&&(l=""),f=l}o._wrapperState={initialValue:ts(f)}}function A0(o,l){var f=ts(l.value),v=ts(l.defaultValue);f!=null&&(f=""+f,f!==o.value&&(o.value=f),l.defaultValue==null&&o.defaultValue!==f&&(o.defaultValue=f)),v!=null&&(o.defaultValue=""+v)}function M0(o){var l=o.textContent;l===o._wrapperState.initialValue&&l!==""&&l!==null&&(o.value=l)}var fm={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function k0(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function mm(o,l){return o==null||o==="http://www.w3.org/1999/xhtml"?k0(l):o==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var Pd,z0=function(o){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(l,f,v,E){MSApp.execUnsafeLocalFunction(function(){return o(l,f,v,E)})}:o}(function(o,l){if(o.namespaceURI!==fm.svg||"innerHTML"in o)o.innerHTML=l;else{for(Pd=Pd||document.createElement("div"),Pd.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=Pd.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;l.firstChild;)o.appendChild(l.firstChild)}});function cu(o,l){if(l){var f=o.firstChild;if(f&&f===o.lastChild&&f.nodeType===3){f.nodeValue=l;return}}o.textContent=l}var uu={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$b=["Webkit","ms","Moz","O"];Object.keys(uu).forEach(function(o){$b.forEach(function(l){l=l+o.charAt(0).toUpperCase()+o.substring(1),uu[l]=uu[o]})});function P0(o,l,f){return l==null||typeof l=="boolean"||l===""?"":f||typeof l!="number"||l===0||uu.hasOwnProperty(o)&&uu[o]?(""+l).trim():l+"px"}function D0(o,l){o=o.style;for(var f in l)if(l.hasOwnProperty(f)){var v=f.indexOf("--")===0,E=P0(f,l[f],v);f==="float"&&(f="cssFloat"),v?o.setProperty(f,E):o[f]=E}}var Gb=li({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _m(o,l){if(l){if(Gb[o]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(He(137,o));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(He(60));if(!(typeof l.dangerouslySetInnerHTML=="object"&&"__html"in l.dangerouslySetInnerHTML))throw Error(He(61))}if(l.style!=null&&typeof l.style!="object")throw Error(He(62))}}function gm(o,l){if(o.indexOf("-")===-1)return typeof l.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function ym(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var xm=null,Al=null,Ml=null;function L0(o){if(o=Mu(o)){if(typeof xm!="function")throw Error(He(280));var l=o.stateNode;l&&(l=Yd(l),xm(o.stateNode,o.type,l))}}function R0(o){Al?Ml?Ml.push(o):Ml=[o]:Al=o}function B0(){if(Al){var o=Al,l=Ml;if(Ml=Al=null,L0(o),l)for(o=0;o<l.length;o++)L0(l[o])}}function vm(o,l){return o(l)}function F0(o,l,f,v,E){return o(l,f,v,E)}function wm(){}var O0=vm,ra=!1,bm=!1;function Tm(){(Al!==null||Ml!==null)&&(wm(),B0())}function Zb(o,l,f){if(bm)return o(l,f);bm=!0;try{return O0(o,l,f)}finally{bm=!1,Tm()}}function hu(o,l){var f=o.stateNode;if(f===null)return null;var v=Yd(f);if(v===null)return null;f=v[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(v=!v.disabled)||(o=o.type,v=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!v;break e;default:o=!1}if(o)return null;if(f&&typeof f!="function")throw Error(He(231,l,typeof f));return f}var Em=!1;if(co)try{var du={};Object.defineProperty(du,"passive",{get:function(){Em=!0}}),window.addEventListener("test",du,du),window.removeEventListener("test",du,du)}catch{Em=!1}function qb(o,l,f,v,E,k,B,a,Q){var ge=Array.prototype.slice.call(arguments,3);try{l.apply(f,ge)}catch(qe){this.onError(qe)}}var pu=!1,Dd=null,Ld=!1,Sm=null,Wb={onError:function(o){pu=!0,Dd=o}};function Xb(o,l,f,v,E,k,B,a,Q){pu=!1,Dd=null,qb.apply(Wb,arguments)}function Hb(o,l,f,v,E,k,B,a,Q){if(Xb.apply(this,arguments),pu){if(pu){var ge=Dd;pu=!1,Dd=null}else throw Error(He(198));Ld||(Ld=!0,Sm=ge)}}function oa(o){var l=o,f=o;if(o.alternate)for(;l.return;)l=l.return;else{o=l;do l=o,(l.flags&1026)!=0&&(f=l.return),o=l.return;while(o)}return l.tag===3?f:null}function U0(o){if(o.tag===13){var l=o.memoizedState;if(l===null&&(o=o.alternate,o!==null&&(l=o.memoizedState)),l!==null)return l.dehydrated}return null}function N0(o){if(oa(o)!==o)throw Error(He(188))}function Yb(o){var l=o.alternate;if(!l){if(l=oa(o),l===null)throw Error(He(188));return l!==o?null:o}for(var f=o,v=l;;){var E=f.return;if(E===null)break;var k=E.alternate;if(k===null){if(v=E.return,v!==null){f=v;continue}break}if(E.child===k.child){for(k=E.child;k;){if(k===f)return N0(E),o;if(k===v)return N0(E),l;k=k.sibling}throw Error(He(188))}if(f.return!==v.return)f=E,v=k;else{for(var B=!1,a=E.child;a;){if(a===f){B=!0,f=E,v=k;break}if(a===v){B=!0,v=E,f=k;break}a=a.sibling}if(!B){for(a=k.child;a;){if(a===f){B=!0,f=k,v=E;break}if(a===v){B=!0,v=k,f=E;break}a=a.sibling}if(!B)throw Error(He(189))}}if(f.alternate!==v)throw Error(He(190))}if(f.tag!==3)throw Error(He(188));return f.stateNode.current===f?o:l}function V0(o){if(o=Yb(o),!o)return null;for(var l=o;;){if(l.tag===5||l.tag===6)return l;if(l.child)l.child.return=l,l=l.child;else{if(l===o)break;for(;!l.sibling;){if(!l.return||l.return===o)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}}return null}function j0(o,l){for(var f=o.alternate;l!==null;){if(l===o||l===f)return!0;l=l.return}return!1}var $0,Cm,G0,Z0,Im=!1,Lr=[],is=null,ns=null,rs=null,fu=new Map,mu=new Map,_u=[],q0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Am(o,l,f,v,E){return{blockedOn:o,domEventName:l,eventSystemFlags:f|16,nativeEvent:E,targetContainers:[v]}}function W0(o,l){switch(o){case"focusin":case"focusout":is=null;break;case"dragenter":case"dragleave":ns=null;break;case"mouseover":case"mouseout":rs=null;break;case"pointerover":case"pointerout":fu.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":mu.delete(l.pointerId)}}function gu(o,l,f,v,E,k){return o===null||o.nativeEvent!==k?(o=Am(l,f,v,E,k),l!==null&&(l=Mu(l),l!==null&&Cm(l)),o):(o.eventSystemFlags|=v,l=o.targetContainers,E!==null&&l.indexOf(E)===-1&&l.push(E),o)}function Kb(o,l,f,v,E){switch(l){case"focusin":return is=gu(is,o,l,f,v,E),!0;case"dragenter":return ns=gu(ns,o,l,f,v,E),!0;case"mouseover":return rs=gu(rs,o,l,f,v,E),!0;case"pointerover":var k=E.pointerId;return fu.set(k,gu(fu.get(k)||null,o,l,f,v,E)),!0;case"gotpointercapture":return k=E.pointerId,mu.set(k,gu(mu.get(k)||null,o,l,f,v,E)),!0}return!1}function Jb(o){var l=sa(o.target);if(l!==null){var f=oa(l);if(f!==null){if(l=f.tag,l===13){if(l=U0(f),l!==null){o.blockedOn=l,Z0(o.lanePriority,function(){Vi.unstable_runWithPriority(o.priority,function(){G0(f)})});return}}else if(l===3&&f.stateNode.hydrate){o.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Rd(o){if(o.blockedOn!==null)return!1;for(var l=o.targetContainers;0<l.length;){var f=Lm(o.domEventName,o.eventSystemFlags,l[0],o.nativeEvent);if(f!==null)return l=Mu(f),l!==null&&Cm(l),o.blockedOn=f,!1;l.shift()}return!0}function X0(o,l,f){Rd(o)&&f.delete(l)}function Qb(){for(Im=!1;0<Lr.length;){var o=Lr[0];if(o.blockedOn!==null){o=Mu(o.blockedOn),o!==null&&$0(o);break}for(var l=o.targetContainers;0<l.length;){var f=Lm(o.domEventName,o.eventSystemFlags,l[0],o.nativeEvent);if(f!==null){o.blockedOn=f;break}l.shift()}o.blockedOn===null&&Lr.shift()}is!==null&&Rd(is)&&(is=null),ns!==null&&Rd(ns)&&(ns=null),rs!==null&&Rd(rs)&&(rs=null),fu.forEach(X0),mu.forEach(X0)}function yu(o,l){o.blockedOn===l&&(o.blockedOn=null,Im||(Im=!0,Vi.unstable_scheduleCallback(Vi.unstable_NormalPriority,Qb)))}function H0(o){function l(E){return yu(E,o)}if(0<Lr.length){yu(Lr[0],o);for(var f=1;f<Lr.length;f++){var v=Lr[f];v.blockedOn===o&&(v.blockedOn=null)}}for(is!==null&&yu(is,o),ns!==null&&yu(ns,o),rs!==null&&yu(rs,o),fu.forEach(l),mu.forEach(l),f=0;f<_u.length;f++)v=_u[f],v.blockedOn===o&&(v.blockedOn=null);for(;0<_u.length&&(f=_u[0],f.blockedOn===null);)Jb(f),f.blockedOn===null&&_u.shift()}function Bd(o,l){var f={};return f[o.toLowerCase()]=l.toLowerCase(),f["Webkit"+o]="webkit"+l,f["Moz"+o]="moz"+l,f}var kl={animationend:Bd("Animation","AnimationEnd"),animationiteration:Bd("Animation","AnimationIteration"),animationstart:Bd("Animation","AnimationStart"),transitionend:Bd("Transition","TransitionEnd")},Mm={},Y0={};co&&(Y0=document.createElement("div").style,"AnimationEvent"in window||(delete kl.animationend.animation,delete kl.animationiteration.animation,delete kl.animationstart.animation),"TransitionEvent"in window||delete kl.transitionend.transition);function Fd(o){if(Mm[o])return Mm[o];if(!kl[o])return o;var l=kl[o],f;for(f in l)if(l.hasOwnProperty(f)&&f in Y0)return Mm[o]=l[f];return o}var K0=Fd("animationend"),J0=Fd("animationiteration"),Q0=Fd("animationstart"),ex=Fd("transitionend"),tx=new Map,km=new Map,e2=["abort","abort",K0,"animationEnd",J0,"animationIteration",Q0,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ex,"transitionEnd","waiting","waiting"];function zm(o,l){for(var f=0;f<o.length;f+=2){var v=o[f],E=o[f+1];E="on"+(E[0].toUpperCase()+E.slice(1)),km.set(v,l),tx.set(v,E),ta(E,[v])}}var t2=Vi.unstable_now;t2();var ti=8;function zl(o){if((1&o)!=0)return ti=15,1;if((2&o)!=0)return ti=14,2;if((4&o)!=0)return ti=13,4;var l=24&o;return l!==0?(ti=12,l):(o&32)!=0?(ti=11,32):(l=192&o,l!==0?(ti=10,l):(o&256)!=0?(ti=9,256):(l=3584&o,l!==0?(ti=8,l):(o&4096)!=0?(ti=7,4096):(l=4186112&o,l!==0?(ti=6,l):(l=62914560&o,l!==0?(ti=5,l):o&67108864?(ti=4,67108864):(o&134217728)!=0?(ti=3,134217728):(l=805306368&o,l!==0?(ti=2,l):(1073741824&o)!=0?(ti=1,1073741824):(ti=8,o))))))}function i2(o){switch(o){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function n2(o){switch(o){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(He(358,o))}}function xu(o,l){var f=o.pendingLanes;if(f===0)return ti=0;var v=0,E=0,k=o.expiredLanes,B=o.suspendedLanes,a=o.pingedLanes;if(k!==0)v=k,E=ti=15;else if(k=f&134217727,k!==0){var Q=k&~B;Q!==0?(v=zl(Q),E=ti):(a&=k,a!==0&&(v=zl(a),E=ti))}else k=f&~B,k!==0?(v=zl(k),E=ti):a!==0&&(v=zl(a),E=ti);if(v===0)return 0;if(v=31-os(v),v=f&((0>v?0:1<<v)<<1)-1,l!==0&&l!==v&&(l&B)==0){if(zl(l),E<=ti)return l;ti=E}if(l=o.entangledLanes,l!==0)for(o=o.entanglements,l&=v;0<l;)f=31-os(l),E=1<<f,v|=o[f],l&=~E;return v}function ix(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function Od(o,l){switch(o){case 15:return 1;case 14:return 2;case 12:return o=Pl(24&~l),o===0?Od(10,l):o;case 10:return o=Pl(192&~l),o===0?Od(8,l):o;case 8:return o=Pl(3584&~l),o===0&&(o=Pl(4186112&~l),o===0&&(o=512)),o;case 2:return l=Pl(805306368&~l),l===0&&(l=268435456),l}throw Error(He(358,o))}function Pl(o){return o&-o}function Pm(o){for(var l=[],f=0;31>f;f++)l.push(o);return l}function Ud(o,l,f){o.pendingLanes|=l;var v=l-1;o.suspendedLanes&=v,o.pingedLanes&=v,o=o.eventTimes,l=31-os(l),o[l]=f}var os=Math.clz32?Math.clz32:s2,r2=Math.log,o2=Math.LN2;function s2(o){return o===0?32:31-(r2(o)/o2|0)|0}var a2=Vi.unstable_UserBlockingPriority,l2=Vi.unstable_runWithPriority,Nd=!0;function c2(o,l,f,v){ra||wm();var E=Dm,k=ra;ra=!0;try{F0(E,o,l,f,v)}finally{(ra=k)||Tm()}}function u2(o,l,f,v){l2(a2,Dm.bind(null,o,l,f,v))}function Dm(o,l,f,v){if(Nd){var E;if((E=(l&4)==0)&&0<Lr.length&&-1<q0.indexOf(o))o=Am(null,o,l,f,v),Lr.push(o);else{var k=Lm(o,l,f,v);if(k===null)E&&W0(o,v);else{if(E){if(-1<q0.indexOf(o)){o=Am(k,o,l,f,v),Lr.push(o);return}if(Kb(k,o,l,f,v))return;W0(o,v)}Px(o,l,v,null,f)}}}}function Lm(o,l,f,v){var E=ym(v);if(E=sa(E),E!==null){var k=oa(E);if(k===null)E=null;else{var B=k.tag;if(B===13){if(E=U0(k),E!==null)return E;E=null}else if(B===3){if(k.stateNode.hydrate)return k.tag===3?k.stateNode.containerInfo:null;E=null}else k!==E&&(E=null)}}return Px(o,l,v,E,f),null}var ss=null,Rm=null,Vd=null;function nx(){if(Vd)return Vd;var o,l=Rm,f=l.length,v,E="value"in ss?ss.value:ss.textContent,k=E.length;for(o=0;o<f&&l[o]===E[o];o++);var B=f-o;for(v=1;v<=B&&l[f-v]===E[k-v];v++);return Vd=E.slice(o,1<v?1-v:void 0)}function jd(o){var l=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&l===13&&(o=13)):o=l,o===10&&(o=13),32<=o||o===13?o:0}function $d(){return!0}function rx(){return!1}function Vn(o){function l(f,v,E,k,B){this._reactName=f,this._targetInst=E,this.type=v,this.nativeEvent=k,this.target=B,this.currentTarget=null;for(var a in o)o.hasOwnProperty(a)&&(f=o[a],this[a]=f?f(k):k[a]);return this.isDefaultPrevented=(k.defaultPrevented!=null?k.defaultPrevented:k.returnValue===!1)?$d:rx,this.isPropagationStopped=rx,this}return li(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=$d)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=$d)},persist:function(){},isPersistent:$d}),l}var Dl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Bm=Vn(Dl),vu=li({},Dl,{view:0,detail:0}),h2=Vn(vu),Fm,Om,wu,Gd=li({},vu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nm,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==wu&&(wu&&o.type==="mousemove"?(Fm=o.screenX-wu.screenX,Om=o.screenY-wu.screenY):Om=Fm=0,wu=o),Fm)},movementY:function(o){return"movementY"in o?o.movementY:Om}}),ox=Vn(Gd),d2=li({},Gd,{dataTransfer:0}),p2=Vn(d2),f2=li({},vu,{relatedTarget:0}),Um=Vn(f2),m2=li({},Dl,{animationName:0,elapsedTime:0,pseudoElement:0}),_2=Vn(m2),g2=li({},Dl,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),y2=Vn(g2),x2=li({},Dl,{data:0}),sx=Vn(x2),v2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},w2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},b2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function T2(o){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(o):(o=b2[o])?!!l[o]:!1}function Nm(){return T2}var E2=li({},vu,{key:function(o){if(o.key){var l=v2[o.key]||o.key;if(l!=="Unidentified")return l}return o.type==="keypress"?(o=jd(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?w2[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nm,charCode:function(o){return o.type==="keypress"?jd(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?jd(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),S2=Vn(E2),C2=li({},Gd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ax=Vn(C2),I2=li({},vu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nm}),A2=Vn(I2),M2=li({},Dl,{propertyName:0,elapsedTime:0,pseudoElement:0}),k2=Vn(M2),z2=li({},Gd,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),P2=Vn(z2),D2=[9,13,27,32],Vm=co&&"CompositionEvent"in window,bu=null;co&&"documentMode"in document&&(bu=document.documentMode);var L2=co&&"TextEvent"in window&&!bu,lx=co&&(!Vm||bu&&8<bu&&11>=bu),cx=String.fromCharCode(32),ux=!1;function hx(o,l){switch(o){case"keyup":return D2.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dx(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Ll=!1;function R2(o,l){switch(o){case"compositionend":return dx(l);case"keypress":return l.which!==32?null:(ux=!0,cx);case"textInput":return o=l.data,o===cx&&ux?null:o;default:return null}}function B2(o,l){if(Ll)return o==="compositionend"||!Vm&&hx(o,l)?(o=nx(),Vd=Rm=ss=null,Ll=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return lx&&l.locale!=="ko"?null:l.data;default:return null}}var F2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function px(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l==="input"?!!F2[o.type]:l==="textarea"}function fx(o,l,f,v){R0(v),l=qd(l,"onChange"),0<l.length&&(f=new Bm("onChange","change",null,f,v),o.push({event:f,listeners:l}))}var Tu=null,Eu=null;function O2(o){Ix(o,0)}function Zd(o){var l=Ul(o);if(T0(l))return o}function U2(o,l){if(o==="change")return l}var mx=!1;if(co){var jm;if(co){var $m="oninput"in document;if(!$m){var _x=document.createElement("div");_x.setAttribute("oninput","return;"),$m=typeof _x.oninput=="function"}jm=$m}else jm=!1;mx=jm&&(!document.documentMode||9<document.documentMode)}function gx(){Tu&&(Tu.detachEvent("onpropertychange",yx),Eu=Tu=null)}function yx(o){if(o.propertyName==="value"&&Zd(Eu)){var l=[];if(fx(l,Eu,o,ym(o)),o=O2,ra)o(l);else{ra=!0;try{vm(o,l)}finally{ra=!1,Tm()}}}}function N2(o,l,f){o==="focusin"?(gx(),Tu=l,Eu=f,Tu.attachEvent("onpropertychange",yx)):o==="focusout"&&gx()}function V2(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Zd(Eu)}function j2(o,l){if(o==="click")return Zd(l)}function $2(o,l){if(o==="input"||o==="change")return Zd(l)}function G2(o,l){return o===l&&(o!==0||1/o==1/l)||o!==o&&l!==l}var Kn=typeof Object.is=="function"?Object.is:G2,Z2=Object.prototype.hasOwnProperty;function Su(o,l){if(Kn(o,l))return!0;if(typeof o!="object"||o===null||typeof l!="object"||l===null)return!1;var f=Object.keys(o),v=Object.keys(l);if(f.length!==v.length)return!1;for(v=0;v<f.length;v++)if(!Z2.call(l,f[v])||!Kn(o[f[v]],l[f[v]]))return!1;return!0}function xx(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function vx(o,l){var f=xx(o);o=0;for(var v;f;){if(f.nodeType===3){if(v=o+f.textContent.length,o<=l&&v>=l)return{node:f,offset:l-o};o=v}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=xx(f)}}function wx(o,l){return o&&l?o===l?!0:o&&o.nodeType===3?!1:l&&l.nodeType===3?wx(o,l.parentNode):"contains"in o?o.contains(l):o.compareDocumentPosition?!!(o.compareDocumentPosition(l)&16):!1:!1}function bx(){for(var o=window,l=zd();l instanceof o.HTMLIFrameElement;){try{var f=typeof l.contentWindow.location.href=="string"}catch{f=!1}if(f)o=l.contentWindow;else break;l=zd(o.document)}return l}function Gm(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l&&(l==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||l==="textarea"||o.contentEditable==="true")}var q2=co&&"documentMode"in document&&11>=document.documentMode,Rl=null,Zm=null,Cu=null,qm=!1;function Tx(o,l,f){var v=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;qm||Rl==null||Rl!==zd(v)||(v=Rl,"selectionStart"in v&&Gm(v)?v={start:v.selectionStart,end:v.selectionEnd}:(v=(v.ownerDocument&&v.ownerDocument.defaultView||window).getSelection(),v={anchorNode:v.anchorNode,anchorOffset:v.anchorOffset,focusNode:v.focusNode,focusOffset:v.focusOffset}),Cu&&Su(Cu,v)||(Cu=v,v=qd(Zm,"onSelect"),0<v.length&&(l=new Bm("onSelect","select",null,l,f),o.push({event:l,listeners:v}),l.target=Rl)))}zm("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);zm("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);zm(e2,2);for(var Ex="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Wm=0;Wm<Ex.length;Wm++)km.set(Ex[Wm],0);Sl("onMouseEnter",["mouseout","mouseover"]);Sl("onMouseLeave",["mouseout","mouseover"]);Sl("onPointerEnter",["pointerout","pointerover"]);Sl("onPointerLeave",["pointerout","pointerover"]);ta("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ta("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ta("onBeforeInput",["compositionend","keypress","textInput","paste"]);ta("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ta("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ta("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Iu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Sx=new Set("cancel close invalid load scroll toggle".split(" ").concat(Iu));function Cx(o,l,f){var v=o.type||"unknown-event";o.currentTarget=f,Hb(v,l,void 0,o),o.currentTarget=null}function Ix(o,l){l=(l&4)!=0;for(var f=0;f<o.length;f++){var v=o[f],E=v.event;v=v.listeners;e:{var k=void 0;if(l)for(var B=v.length-1;0<=B;B--){var a=v[B],Q=a.instance,ge=a.currentTarget;if(a=a.listener,Q!==k&&E.isPropagationStopped())break e;Cx(E,a,ge),k=Q}else for(B=0;B<v.length;B++){if(a=v[B],Q=a.instance,ge=a.currentTarget,a=a.listener,Q!==k&&E.isPropagationStopped())break e;Cx(E,a,ge),k=Q}}}if(Ld)throw o=Sm,Ld=!1,Sm=null,o}function ni(o,l){var f=Ox(l),v=o+"__bubble";f.has(v)||(zx(l,o,2,!1),f.add(v))}var Ax="_reactListening"+Math.random().toString(36).slice(2);function Mx(o){o[Ax]||(o[Ax]=!0,_0.forEach(function(l){Sx.has(l)||kx(l,!1,o,null),kx(l,!0,o,null)}))}function kx(o,l,f,v){var E=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,k=f;if(o==="selectionchange"&&f.nodeType!==9&&(k=f.ownerDocument),v!==null&&!l&&Sx.has(o)){if(o!=="scroll")return;E|=2,k=v}var B=Ox(k),a=o+"__"+(l?"capture":"bubble");B.has(a)||(l&&(E|=4),zx(k,o,E,l),B.add(a))}function zx(o,l,f,v){var E=km.get(l);switch(E===void 0?2:E){case 0:E=c2;break;case 1:E=u2;break;default:E=Dm}f=E.bind(null,l,f,o),E=void 0,!Em||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(E=!0),v?E!==void 0?o.addEventListener(l,f,{capture:!0,passive:E}):o.addEventListener(l,f,!0):E!==void 0?o.addEventListener(l,f,{passive:E}):o.addEventListener(l,f,!1)}function Px(o,l,f,v,E){var k=v;if((l&1)==0&&(l&2)==0&&v!==null)e:for(;;){if(v===null)return;var B=v.tag;if(B===3||B===4){var a=v.stateNode.containerInfo;if(a===E||a.nodeType===8&&a.parentNode===E)break;if(B===4)for(B=v.return;B!==null;){var Q=B.tag;if((Q===3||Q===4)&&(Q=B.stateNode.containerInfo,Q===E||Q.nodeType===8&&Q.parentNode===E))return;B=B.return}for(;a!==null;){if(B=sa(a),B===null)return;if(Q=B.tag,Q===5||Q===6){v=k=B;continue e}a=a.parentNode}}v=v.return}Zb(function(){var ge=k,qe=ym(f),_e=[];e:{var oe=tx.get(o);if(oe!==void 0){var ze=Bm,it=o;switch(o){case"keypress":if(jd(f)===0)break e;case"keydown":case"keyup":ze=S2;break;case"focusin":it="focus",ze=Um;break;case"focusout":it="blur",ze=Um;break;case"beforeblur":case"afterblur":ze=Um;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ze=ox;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ze=p2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ze=A2;break;case K0:case J0:case Q0:ze=_2;break;case ex:ze=k2;break;case"scroll":ze=h2;break;case"wheel":ze=P2;break;case"copy":case"cut":case"paste":ze=y2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ze=ax}var rt=(l&4)!=0,me=!rt&&o==="scroll",te=rt?oe!==null?oe+"Capture":null:oe;rt=[];for(var ue=ge,ke;ue!==null;){ke=ue;var Pe=ke.stateNode;if(ke.tag===5&&Pe!==null&&(ke=Pe,te!==null&&(Pe=hu(ue,te),Pe!=null&&rt.push(Au(ue,Pe,ke)))),me)break;ue=ue.return}0<rt.length&&(oe=new ze(oe,it,null,f,qe),_e.push({event:oe,listeners:rt}))}}if((l&7)==0){e:{if(oe=o==="mouseover"||o==="pointerover",ze=o==="mouseout"||o==="pointerout",oe&&(l&16)==0&&(it=f.relatedTarget||f.fromElement)&&(sa(it)||it[Ol]))break e;if((ze||oe)&&(oe=qe.window===qe?qe:(oe=qe.ownerDocument)?oe.defaultView||oe.parentWindow:window,ze?(it=f.relatedTarget||f.toElement,ze=ge,it=it?sa(it):null,it!==null&&(me=oa(it),it!==me||it.tag!==5&&it.tag!==6)&&(it=null)):(ze=null,it=ge),ze!==it)){if(rt=ox,Pe="onMouseLeave",te="onMouseEnter",ue="mouse",(o==="pointerout"||o==="pointerover")&&(rt=ax,Pe="onPointerLeave",te="onPointerEnter",ue="pointer"),me=ze==null?oe:Ul(ze),ke=it==null?oe:Ul(it),oe=new rt(Pe,ue+"leave",ze,f,qe),oe.target=me,oe.relatedTarget=ke,Pe=null,sa(qe)===ge&&(rt=new rt(te,ue+"enter",it,f,qe),rt.target=ke,rt.relatedTarget=me,Pe=rt),me=Pe,ze&&it)t:{for(rt=ze,te=it,ue=0,ke=rt;ke;ke=Bl(ke))ue++;for(ke=0,Pe=te;Pe;Pe=Bl(Pe))ke++;for(;0<ue-ke;)rt=Bl(rt),ue--;for(;0<ke-ue;)te=Bl(te),ke--;for(;ue--;){if(rt===te||te!==null&&rt===te.alternate)break t;rt=Bl(rt),te=Bl(te)}rt=null}else rt=null;ze!==null&&Dx(_e,oe,ze,rt,!1),it!==null&&me!==null&&Dx(_e,me,it,rt,!0)}}e:{if(oe=ge?Ul(ge):window,ze=oe.nodeName&&oe.nodeName.toLowerCase(),ze==="select"||ze==="input"&&oe.type==="file")var at=U2;else if(px(oe))if(mx)at=$2;else{at=V2;var Xe=N2}else(ze=oe.nodeName)&&ze.toLowerCase()==="input"&&(oe.type==="checkbox"||oe.type==="radio")&&(at=j2);if(at&&(at=at(o,ge))){fx(_e,at,f,qe);break e}Xe&&Xe(o,oe,ge),o==="focusout"&&(Xe=oe._wrapperState)&&Xe.controlled&&oe.type==="number"&&hm(oe,"number",oe.value)}switch(Xe=ge?Ul(ge):window,o){case"focusin":(px(Xe)||Xe.contentEditable==="true")&&(Rl=Xe,Zm=ge,Cu=null);break;case"focusout":Cu=Zm=Rl=null;break;case"mousedown":qm=!0;break;case"contextmenu":case"mouseup":case"dragend":qm=!1,Tx(_e,f,qe);break;case"selectionchange":if(q2)break;case"keydown":case"keyup":Tx(_e,f,qe)}var Ye;if(Vm)e:{switch(o){case"compositionstart":var dt="onCompositionStart";break e;case"compositionend":dt="onCompositionEnd";break e;case"compositionupdate":dt="onCompositionUpdate";break e}dt=void 0}else Ll?hx(o,f)&&(dt="onCompositionEnd"):o==="keydown"&&f.keyCode===229&&(dt="onCompositionStart");dt&&(lx&&f.locale!=="ko"&&(Ll||dt!=="onCompositionStart"?dt==="onCompositionEnd"&&Ll&&(Ye=nx()):(ss=qe,Rm="value"in ss?ss.value:ss.textContent,Ll=!0)),Xe=qd(ge,dt),0<Xe.length&&(dt=new sx(dt,o,null,f,qe),_e.push({event:dt,listeners:Xe}),Ye?dt.data=Ye:(Ye=dx(f),Ye!==null&&(dt.data=Ye)))),(Ye=L2?R2(o,f):B2(o,f))&&(ge=qd(ge,"onBeforeInput"),0<ge.length&&(qe=new sx("onBeforeInput","beforeinput",null,f,qe),_e.push({event:qe,listeners:ge}),qe.data=Ye))}Ix(_e,l)})}function Au(o,l,f){return{instance:o,listener:l,currentTarget:f}}function qd(o,l){for(var f=l+"Capture",v=[];o!==null;){var E=o,k=E.stateNode;E.tag===5&&k!==null&&(E=k,k=hu(o,f),k!=null&&v.unshift(Au(o,k,E)),k=hu(o,l),k!=null&&v.push(Au(o,k,E))),o=o.return}return v}function Bl(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function Dx(o,l,f,v,E){for(var k=l._reactName,B=[];f!==null&&f!==v;){var a=f,Q=a.alternate,ge=a.stateNode;if(Q!==null&&Q===v)break;a.tag===5&&ge!==null&&(a=ge,E?(Q=hu(f,k),Q!=null&&B.unshift(Au(f,Q,a))):E||(Q=hu(f,k),Q!=null&&B.push(Au(f,Q,a)))),f=f.return}B.length!==0&&o.push({event:l,listeners:B})}function Wd(){}var Xm=null,Hm=null;function Lx(o,l){switch(o){case"button":case"input":case"select":case"textarea":return!!l.autoFocus}return!1}function Ym(o,l){return o==="textarea"||o==="option"||o==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Rx=typeof setTimeout=="function"?setTimeout:void 0,W2=typeof clearTimeout=="function"?clearTimeout:void 0;function Km(o){o.nodeType===1?o.textContent="":o.nodeType===9&&(o=o.body,o!=null&&(o.textContent=""))}function Fl(o){for(;o!=null;o=o.nextSibling){var l=o.nodeType;if(l===1||l===3)break}return o}function Bx(o){o=o.previousSibling;for(var l=0;o;){if(o.nodeType===8){var f=o.data;if(f==="$"||f==="$!"||f==="$?"){if(l===0)return o;l--}else f==="/$"&&l++}o=o.previousSibling}return null}var Jm=0;function X2(o){return{$$typeof:rm,toString:o,valueOf:o}}var Xd=Math.random().toString(36).slice(2),as="__reactFiber$"+Xd,Hd="__reactProps$"+Xd,Ol="__reactContainer$"+Xd,Fx="__reactEvents$"+Xd;function sa(o){var l=o[as];if(l)return l;for(var f=o.parentNode;f;){if(l=f[Ol]||f[as]){if(f=l.alternate,l.child!==null||f!==null&&f.child!==null)for(o=Bx(o);o!==null;){if(f=o[as])return f;o=Bx(o)}return l}o=f,f=o.parentNode}return null}function Mu(o){return o=o[as]||o[Ol],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function Ul(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(He(33))}function Yd(o){return o[Hd]||null}function Ox(o){var l=o[Fx];return l===void 0&&(l=o[Fx]=new Set),l}var Qm=[],Nl=-1;function ls(o){return{current:o}}function ri(o){0>Nl||(o.current=Qm[Nl],Qm[Nl]=null,Nl--)}function wi(o,l){Nl++,Qm[Nl]=o.current,o.current=l}var cs={},en=ls(cs),Sn=ls(!1),aa=cs;function Vl(o,l){var f=o.type.contextTypes;if(!f)return cs;var v=o.stateNode;if(v&&v.__reactInternalMemoizedUnmaskedChildContext===l)return v.__reactInternalMemoizedMaskedChildContext;var E={},k;for(k in f)E[k]=l[k];return v&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=l,o.__reactInternalMemoizedMaskedChildContext=E),E}function Cn(o){return o=o.childContextTypes,o!=null}function Kd(){ri(Sn),ri(en)}function Ux(o,l,f){if(en.current!==cs)throw Error(He(168));wi(en,l),wi(Sn,f)}function Nx(o,l,f){var v=o.stateNode;if(o=l.childContextTypes,typeof v.getChildContext!="function")return f;v=v.getChildContext();for(var E in v)if(!(E in o))throw Error(He(108,Cl(l)||"Unknown",E));return li({},f,v)}function Jd(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||cs,aa=en.current,wi(en,o),wi(Sn,Sn.current),!0}function Vx(o,l,f){var v=o.stateNode;if(!v)throw Error(He(169));f?(o=Nx(o,l,aa),v.__reactInternalMemoizedMergedChildContext=o,ri(Sn),ri(en),wi(en,o)):ri(Sn),wi(Sn,f)}var e_=null,la=null,H2=Vi.unstable_runWithPriority,t_=Vi.unstable_scheduleCallback,i_=Vi.unstable_cancelCallback,Y2=Vi.unstable_shouldYield,jx=Vi.unstable_requestPaint,n_=Vi.unstable_now,K2=Vi.unstable_getCurrentPriorityLevel,Qd=Vi.unstable_ImmediatePriority,$x=Vi.unstable_UserBlockingPriority,Gx=Vi.unstable_NormalPriority,Zx=Vi.unstable_LowPriority,qx=Vi.unstable_IdlePriority,r_={},J2=jx!==void 0?jx:function(){},uo=null,ep=null,o_=!1,Wx=n_(),tn=1e4>Wx?n_:function(){return n_()-Wx};function jl(){switch(K2()){case Qd:return 99;case $x:return 98;case Gx:return 97;case Zx:return 96;case qx:return 95;default:throw Error(He(332))}}function Xx(o){switch(o){case 99:return Qd;case 98:return $x;case 97:return Gx;case 96:return Zx;case 95:return qx;default:throw Error(He(332))}}function ca(o,l){return o=Xx(o),H2(o,l)}function ku(o,l,f){return o=Xx(o),t_(o,l,f)}function Rr(){if(ep!==null){var o=ep;ep=null,i_(o)}Hx()}function Hx(){if(!o_&&uo!==null){o_=!0;var o=0;try{var l=uo;ca(99,function(){for(;o<l.length;o++){var f=l[o];do f=f(!0);while(f!==null)}}),uo=null}catch(f){throw uo!==null&&(uo=uo.slice(o+1)),t_(Qd,Rr),f}finally{o_=!1}}}var Q2=ia.ReactCurrentBatchConfig;function ur(o,l){if(o&&o.defaultProps){l=li({},l),o=o.defaultProps;for(var f in o)l[f]===void 0&&(l[f]=o[f]);return l}return l}var tp=ls(null),ip=null,$l=null,np=null;function s_(){np=$l=ip=null}function a_(o){var l=tp.current;ri(tp),o.type._context._currentValue=l}function Yx(o,l){for(;o!==null;){var f=o.alternate;if((o.childLanes&l)===l){if(f===null||(f.childLanes&l)===l)break;f.childLanes|=l}else o.childLanes|=l,f!==null&&(f.childLanes|=l);o=o.return}}function Gl(o,l){ip=o,np=$l=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&l)!=0&&(hr=!0),o.firstContext=null)}function Jn(o,l){if(np!==o&&l!==!1&&l!==0)if((typeof l!="number"||l===1073741823)&&(np=o,l=1073741823),l={context:o,observedBits:l,next:null},$l===null){if(ip===null)throw Error(He(308));$l=l,ip.dependencies={lanes:0,firstContext:l,responders:null}}else $l=$l.next=l;return o._currentValue}var us=!1;function l_(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function Kx(o,l){o=o.updateQueue,l.updateQueue===o&&(l.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function hs(o,l){return{eventTime:o,lane:l,tag:0,payload:null,callback:null,next:null}}function ds(o,l){if(o=o.updateQueue,o!==null){o=o.shared;var f=o.pending;f===null?l.next=l:(l.next=f.next,f.next=l),o.pending=l}}function Jx(o,l){var f=o.updateQueue,v=o.alternate;if(v!==null&&(v=v.updateQueue,f===v)){var E=null,k=null;if(f=f.firstBaseUpdate,f!==null){do{var B={eventTime:f.eventTime,lane:f.lane,tag:f.tag,payload:f.payload,callback:f.callback,next:null};k===null?E=k=B:k=k.next=B,f=f.next}while(f!==null);k===null?E=k=l:k=k.next=l}else E=k=l;f={baseState:v.baseState,firstBaseUpdate:E,lastBaseUpdate:k,shared:v.shared,effects:v.effects},o.updateQueue=f;return}o=f.lastBaseUpdate,o===null?f.firstBaseUpdate=l:o.next=l,f.lastBaseUpdate=l}function zu(o,l,f,v){var E=o.updateQueue;us=!1;var k=E.firstBaseUpdate,B=E.lastBaseUpdate,a=E.shared.pending;if(a!==null){E.shared.pending=null;var Q=a,ge=Q.next;Q.next=null,B===null?k=ge:B.next=ge,B=Q;var qe=o.alternate;if(qe!==null){qe=qe.updateQueue;var _e=qe.lastBaseUpdate;_e!==B&&(_e===null?qe.firstBaseUpdate=ge:_e.next=ge,qe.lastBaseUpdate=Q)}}if(k!==null){_e=E.baseState,B=0,qe=ge=Q=null;do{a=k.lane;var oe=k.eventTime;if((v&a)===a){qe!==null&&(qe=qe.next={eventTime:oe,lane:0,tag:k.tag,payload:k.payload,callback:k.callback,next:null});e:{var ze=o,it=k;switch(a=l,oe=f,it.tag){case 1:if(ze=it.payload,typeof ze=="function"){_e=ze.call(oe,_e,a);break e}_e=ze;break e;case 3:ze.flags=ze.flags&-4097|64;case 0:if(ze=it.payload,a=typeof ze=="function"?ze.call(oe,_e,a):ze,a==null)break e;_e=li({},_e,a);break e;case 2:us=!0}}k.callback!==null&&(o.flags|=32,a=E.effects,a===null?E.effects=[k]:a.push(k))}else oe={eventTime:oe,lane:a,tag:k.tag,payload:k.payload,callback:k.callback,next:null},qe===null?(ge=qe=oe,Q=_e):qe=qe.next=oe,B|=a;if(k=k.next,k===null){if(a=E.shared.pending,a===null)break;k=a.next,a.next=null,E.lastBaseUpdate=a,E.shared.pending=null}}while(1);qe===null&&(Q=_e),E.baseState=Q,E.firstBaseUpdate=ge,E.lastBaseUpdate=qe,$u|=B,o.lanes=B,o.memoizedState=_e}}function Qx(o,l,f){if(o=l.effects,l.effects=null,o!==null)for(l=0;l<o.length;l++){var v=o[l],E=v.callback;if(E!==null){if(v.callback=null,v=f,typeof E!="function")throw Error(He(191,E));E.call(v)}}}var ev=new Sd.Component().refs;function rp(o,l,f,v){l=o.memoizedState,f=f(v,l),f=f==null?l:li({},l,f),o.memoizedState=f,o.lanes===0&&(o.updateQueue.baseState=f)}var op={isMounted:function(o){return(o=o._reactInternals)?oa(o)===o:!1},enqueueSetState:function(o,l,f){o=o._reactInternals;var v=jn(),E=ms(o),k=hs(v,E);k.payload=l,f!=null&&(k.callback=f),ds(o,k),_s(o,E,v)},enqueueReplaceState:function(o,l,f){o=o._reactInternals;var v=jn(),E=ms(o),k=hs(v,E);k.tag=1,k.payload=l,f!=null&&(k.callback=f),ds(o,k),_s(o,E,v)},enqueueForceUpdate:function(o,l){o=o._reactInternals;var f=jn(),v=ms(o),E=hs(f,v);E.tag=2,l!=null&&(E.callback=l),ds(o,E),_s(o,v,f)}};function tv(o,l,f,v,E,k,B){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(v,k,B):l.prototype&&l.prototype.isPureReactComponent?!Su(f,v)||!Su(E,k):!0}function iv(o,l,f){var v=!1,E=cs,k=l.contextType;return typeof k=="object"&&k!==null?k=Jn(k):(E=Cn(l)?aa:en.current,v=l.contextTypes,k=(v=v!=null)?Vl(o,E):cs),l=new l(f,k),o.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=op,o.stateNode=l,l._reactInternals=o,v&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=E,o.__reactInternalMemoizedMaskedChildContext=k),l}function nv(o,l,f,v){o=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(f,v),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(f,v),l.state!==o&&op.enqueueReplaceState(l,l.state,null)}function c_(o,l,f,v){var E=o.stateNode;E.props=f,E.state=o.memoizedState,E.refs=ev,l_(o);var k=l.contextType;typeof k=="object"&&k!==null?E.context=Jn(k):(k=Cn(l)?aa:en.current,E.context=Vl(o,k)),zu(o,f,E,v),E.state=o.memoizedState,k=l.getDerivedStateFromProps,typeof k=="function"&&(rp(o,l,k,f),E.state=o.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(l=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),l!==E.state&&op.enqueueReplaceState(E,E.state,null),zu(o,f,E,v),E.state=o.memoizedState),typeof E.componentDidMount=="function"&&(o.flags|=4)}var sp=Array.isArray;function Pu(o,l,f){if(o=f.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(f._owner){if(f=f._owner,f){if(f.tag!==1)throw Error(He(309));var v=f.stateNode}if(!v)throw Error(He(147,o));var E=""+o;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===E?l.ref:(l=function(k){var B=v.refs;B===ev&&(B=v.refs={}),k===null?delete B[E]:B[E]=k},l._stringRef=E,l)}if(typeof o!="string")throw Error(He(284));if(!f._owner)throw Error(He(290,o))}return o}function ap(o,l){if(o.type!=="textarea")throw Error(He(31,Object.prototype.toString.call(l)==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":l))}function rv(o){function l(me,te){if(o){var ue=me.lastEffect;ue!==null?(ue.nextEffect=te,me.lastEffect=te):me.firstEffect=me.lastEffect=te,te.nextEffect=null,te.flags=8}}function f(me,te){if(!o)return null;for(;te!==null;)l(me,te),te=te.sibling;return null}function v(me,te){for(me=new Map;te!==null;)te.key!==null?me.set(te.key,te):me.set(te.index,te),te=te.sibling;return me}function E(me,te){return me=xs(me,te),me.index=0,me.sibling=null,me}function k(me,te,ue){return me.index=ue,o?(ue=me.alternate,ue!==null?(ue=ue.index,ue<te?(me.flags=2,te):ue):(me.flags=2,te)):te}function B(me){return o&&me.alternate===null&&(me.flags=2),me}function a(me,te,ue,ke){return te===null||te.tag!==6?(te=Z_(ue,me.mode,ke),te.return=me,te):(te=E(te,ue),te.return=me,te)}function Q(me,te,ue,ke){return te!==null&&te.elementType===ue.type?(ke=E(te,ue.props),ke.ref=Pu(me,te,ue),ke.return=me,ke):(ke=Sp(ue.type,ue.key,ue.props,null,me.mode,ke),ke.ref=Pu(me,te,ue),ke.return=me,ke)}function ge(me,te,ue,ke){return te===null||te.tag!==4||te.stateNode.containerInfo!==ue.containerInfo||te.stateNode.implementation!==ue.implementation?(te=q_(ue,me.mode,ke),te.return=me,te):(te=E(te,ue.children||[]),te.return=me,te)}function qe(me,te,ue,ke,Pe){return te===null||te.tag!==7?(te=Jl(ue,me.mode,ke,Pe),te.return=me,te):(te=E(te,ue),te.return=me,te)}function _e(me,te,ue){if(typeof te=="string"||typeof te=="number")return te=Z_(""+te,me.mode,ue),te.return=me,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case ru:return ue=Sp(te.type,te.key,te.props,null,me.mode,ue),ue.ref=Pu(me,null,te),ue.return=me,ue;case na:return te=q_(te,me.mode,ue),te.return=me,te}if(sp(te)||au(te))return te=Jl(te,me.mode,ue,null),te.return=me,te;ap(me,te)}return null}function oe(me,te,ue,ke){var Pe=te!==null?te.key:null;if(typeof ue=="string"||typeof ue=="number")return Pe!==null?null:a(me,te,""+ue,ke);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case ru:return ue.key===Pe?ue.type===es?qe(me,te,ue.props.children,ke,Pe):Q(me,te,ue,ke):null;case na:return ue.key===Pe?ge(me,te,ue,ke):null}if(sp(ue)||au(ue))return Pe!==null?null:qe(me,te,ue,ke,null);ap(me,ue)}return null}function ze(me,te,ue,ke,Pe){if(typeof ke=="string"||typeof ke=="number")return me=me.get(ue)||null,a(te,me,""+ke,Pe);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case ru:return me=me.get(ke.key===null?ue:ke.key)||null,ke.type===es?qe(te,me,ke.props.children,Pe,ke.key):Q(te,me,ke,Pe);case na:return me=me.get(ke.key===null?ue:ke.key)||null,ge(te,me,ke,Pe)}if(sp(ke)||au(ke))return me=me.get(ue)||null,qe(te,me,ke,Pe,null);ap(te,ke)}return null}function it(me,te,ue,ke){for(var Pe=null,at=null,Xe=te,Ye=te=0,dt=null;Xe!==null&&Ye<ue.length;Ye++){Xe.index>Ye?(dt=Xe,Xe=null):dt=Xe.sibling;var ot=oe(me,Xe,ue[Ye],ke);if(ot===null){Xe===null&&(Xe=dt);break}o&&Xe&&ot.alternate===null&&l(me,Xe),te=k(ot,te,Ye),at===null?Pe=ot:at.sibling=ot,at=ot,Xe=dt}if(Ye===ue.length)return f(me,Xe),Pe;if(Xe===null){for(;Ye<ue.length;Ye++)Xe=_e(me,ue[Ye],ke),Xe!==null&&(te=k(Xe,te,Ye),at===null?Pe=Xe:at.sibling=Xe,at=Xe);return Pe}for(Xe=v(me,Xe);Ye<ue.length;Ye++)dt=ze(Xe,me,Ye,ue[Ye],ke),dt!==null&&(o&&dt.alternate!==null&&Xe.delete(dt.key===null?Ye:dt.key),te=k(dt,te,Ye),at===null?Pe=dt:at.sibling=dt,at=dt);return o&&Xe.forEach(function(Qt){return l(me,Qt)}),Pe}function rt(me,te,ue,ke){var Pe=au(ue);if(typeof Pe!="function")throw Error(He(150));if(ue=Pe.call(ue),ue==null)throw Error(He(151));for(var at=Pe=null,Xe=te,Ye=te=0,dt=null,ot=ue.next();Xe!==null&&!ot.done;Ye++,ot=ue.next()){Xe.index>Ye?(dt=Xe,Xe=null):dt=Xe.sibling;var Qt=oe(me,Xe,ot.value,ke);if(Qt===null){Xe===null&&(Xe=dt);break}o&&Xe&&Qt.alternate===null&&l(me,Xe),te=k(Qt,te,Ye),at===null?Pe=Qt:at.sibling=Qt,at=Qt,Xe=dt}if(ot.done)return f(me,Xe),Pe;if(Xe===null){for(;!ot.done;Ye++,ot=ue.next())ot=_e(me,ot.value,ke),ot!==null&&(te=k(ot,te,Ye),at===null?Pe=ot:at.sibling=ot,at=ot);return Pe}for(Xe=v(me,Xe);!ot.done;Ye++,ot=ue.next())ot=ze(Xe,me,Ye,ot.value,ke),ot!==null&&(o&&ot.alternate!==null&&Xe.delete(ot.key===null?Ye:ot.key),te=k(ot,te,Ye),at===null?Pe=ot:at.sibling=ot,at=ot);return o&&Xe.forEach(function(Yt){return l(me,Yt)}),Pe}return function(me,te,ue,ke){var Pe=typeof ue=="object"&&ue!==null&&ue.type===es&&ue.key===null;Pe&&(ue=ue.props.children);var at=typeof ue=="object"&&ue!==null;if(at)switch(ue.$$typeof){case ru:e:{for(at=ue.key,Pe=te;Pe!==null;){if(Pe.key===at){switch(Pe.tag){case 7:if(ue.type===es){f(me,Pe.sibling),te=E(Pe,ue.props.children),te.return=me,me=te;break e}break;default:if(Pe.elementType===ue.type){f(me,Pe.sibling),te=E(Pe,ue.props),te.ref=Pu(me,Pe,ue),te.return=me,me=te;break e}}f(me,Pe);break}else l(me,Pe);Pe=Pe.sibling}ue.type===es?(te=Jl(ue.props.children,me.mode,ke,ue.key),te.return=me,me=te):(ke=Sp(ue.type,ue.key,ue.props,null,me.mode,ke),ke.ref=Pu(me,te,ue),ke.return=me,me=ke)}return B(me);case na:e:{for(Pe=ue.key;te!==null;){if(te.key===Pe)if(te.tag===4&&te.stateNode.containerInfo===ue.containerInfo&&te.stateNode.implementation===ue.implementation){f(me,te.sibling),te=E(te,ue.children||[]),te.return=me,me=te;break e}else{f(me,te);break}else l(me,te);te=te.sibling}te=q_(ue,me.mode,ke),te.return=me,me=te}return B(me)}if(typeof ue=="string"||typeof ue=="number")return ue=""+ue,te!==null&&te.tag===6?(f(me,te.sibling),te=E(te,ue),te.return=me,me=te):(f(me,te),te=Z_(ue,me.mode,ke),te.return=me,me=te),B(me);if(sp(ue))return it(me,te,ue,ke);if(au(ue))return rt(me,te,ue,ke);if(at&&ap(me,ue),typeof ue=="undefined"&&!Pe)switch(me.tag){case 1:case 22:case 0:case 11:case 15:throw Error(He(152,Cl(me.type)||"Component"))}return f(me,te)}}var lp=rv(!0),ov=rv(!1),Du={},Br=ls(Du),Lu=ls(Du),Ru=ls(Du);function ua(o){if(o===Du)throw Error(He(174));return o}function u_(o,l){switch(wi(Ru,l),wi(Lu,o),wi(Br,Du),o=l.nodeType,o){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:mm(null,"");break;default:o=o===8?l.parentNode:l,l=o.namespaceURI||null,o=o.tagName,l=mm(l,o)}ri(Br),wi(Br,l)}function Zl(){ri(Br),ri(Lu),ri(Ru)}function sv(o){ua(Ru.current);var l=ua(Br.current),f=mm(l,o.type);l!==f&&(wi(Lu,o),wi(Br,f))}function h_(o){Lu.current===o&&(ri(Br),ri(Lu))}var bi=ls(0);function cp(o){for(var l=o;l!==null;){if(l.tag===13){var f=l.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||f.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&64)!=0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var ho=null,ps=null,Fr=!1;function av(o,l){var f=tr(5,null,null,0);f.elementType="DELETED",f.type="DELETED",f.stateNode=l,f.return=o,f.flags=8,o.lastEffect!==null?(o.lastEffect.nextEffect=f,o.lastEffect=f):o.firstEffect=o.lastEffect=f}function lv(o,l){switch(o.tag){case 5:var f=o.type;return l=l.nodeType!==1||f.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(o.stateNode=l,!0):!1;case 6:return l=o.pendingProps===""||l.nodeType!==3?null:l,l!==null?(o.stateNode=l,!0):!1;case 13:return!1;default:return!1}}function d_(o){if(Fr){var l=ps;if(l){var f=l;if(!lv(o,l)){if(l=Fl(f.nextSibling),!l||!lv(o,l)){o.flags=o.flags&-1025|2,Fr=!1,ho=o;return}av(ho,f)}ho=o,ps=Fl(l.firstChild)}else o.flags=o.flags&-1025|2,Fr=!1,ho=o}}function cv(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;ho=o}function up(o){if(o!==ho)return!1;if(!Fr)return cv(o),Fr=!0,!1;var l=o.type;if(o.tag!==5||l!=="head"&&l!=="body"&&!Ym(l,o.memoizedProps))for(l=ps;l;)av(o,l),l=Fl(l.nextSibling);if(cv(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(He(317));e:{for(o=o.nextSibling,l=0;o;){if(o.nodeType===8){var f=o.data;if(f==="/$"){if(l===0){ps=Fl(o.nextSibling);break e}l--}else f!=="$"&&f!=="$!"&&f!=="$?"||l++}o=o.nextSibling}ps=null}}else ps=ho?Fl(o.stateNode.nextSibling):null;return!0}function p_(){ps=ho=null,Fr=!1}var ql=[];function f_(){for(var o=0;o<ql.length;o++)ql[o]._workInProgressVersionPrimary=null;ql.length=0}var Bu=ia.ReactCurrentDispatcher,Qn=ia.ReactCurrentBatchConfig,Fu=0,Ci=null,nn=null,Hi=null,hp=!1,Ou=!1;function In(){throw Error(He(321))}function m_(o,l){if(l===null)return!1;for(var f=0;f<l.length&&f<o.length;f++)if(!Kn(o[f],l[f]))return!1;return!0}function __(o,l,f,v,E,k){if(Fu=k,Ci=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,Bu.current=o===null||o.memoizedState===null?tT:iT,o=f(v,E),Ou){k=0;do{if(Ou=!1,!(25>k))throw Error(He(301));k+=1,Hi=nn=null,l.updateQueue=null,Bu.current=nT,o=f(v,E)}while(Ou)}if(Bu.current=mp,l=nn!==null&&nn.next!==null,Fu=0,Hi=nn=Ci=null,hp=!1,l)throw Error(He(300));return o}function ha(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Hi===null?Ci.memoizedState=Hi=o:Hi=Hi.next=o,Hi}function da(){if(nn===null){var o=Ci.alternate;o=o!==null?o.memoizedState:null}else o=nn.next;var l=Hi===null?Ci.memoizedState:Hi.next;if(l!==null)Hi=l,nn=o;else{if(o===null)throw Error(He(310));nn=o,o={memoizedState:nn.memoizedState,baseState:nn.baseState,baseQueue:nn.baseQueue,queue:nn.queue,next:null},Hi===null?Ci.memoizedState=Hi=o:Hi=Hi.next=o}return Hi}function Or(o,l){return typeof l=="function"?l(o):l}function Uu(o){var l=da(),f=l.queue;if(f===null)throw Error(He(311));f.lastRenderedReducer=o;var v=nn,E=v.baseQueue,k=f.pending;if(k!==null){if(E!==null){var B=E.next;E.next=k.next,k.next=B}v.baseQueue=E=k,f.pending=null}if(E!==null){E=E.next,v=v.baseState;var a=B=k=null,Q=E;do{var ge=Q.lane;if((Fu&ge)===ge)a!==null&&(a=a.next={lane:0,action:Q.action,eagerReducer:Q.eagerReducer,eagerState:Q.eagerState,next:null}),v=Q.eagerReducer===o?Q.eagerState:o(v,Q.action);else{var qe={lane:ge,action:Q.action,eagerReducer:Q.eagerReducer,eagerState:Q.eagerState,next:null};a===null?(B=a=qe,k=v):a=a.next=qe,Ci.lanes|=ge,$u|=ge}Q=Q.next}while(Q!==null&&Q!==E);a===null?k=v:a.next=B,Kn(v,l.memoizedState)||(hr=!0),l.memoizedState=v,l.baseState=k,l.baseQueue=a,f.lastRenderedState=v}return[l.memoizedState,f.dispatch]}function Nu(o){var l=da(),f=l.queue;if(f===null)throw Error(He(311));f.lastRenderedReducer=o;var v=f.dispatch,E=f.pending,k=l.memoizedState;if(E!==null){f.pending=null;var B=E=E.next;do k=o(k,B.action),B=B.next;while(B!==E);Kn(k,l.memoizedState)||(hr=!0),l.memoizedState=k,l.baseQueue===null&&(l.baseState=k),f.lastRenderedState=k}return[k,v]}function uv(o,l,f){var v=l._getVersion;v=v(l._source);var E=l._workInProgressVersionPrimary;if(E!==null?o=E===v:(o=o.mutableReadLanes,(o=(Fu&o)===o)&&(l._workInProgressVersionPrimary=v,ql.push(l))),o)return f(l._source);throw ql.push(l),Error(He(350))}function hv(o,l,f,v){var E=fn;if(E===null)throw Error(He(349));var k=l._getVersion,B=k(l._source),a=Bu.current,Q=a.useState(function(){return uv(E,l,f)}),ge=Q[1],qe=Q[0];Q=Hi;var _e=o.memoizedState,oe=_e.refs,ze=oe.getSnapshot,it=_e.source;_e=_e.subscribe;var rt=Ci;return o.memoizedState={refs:oe,source:l,subscribe:v},a.useEffect(function(){oe.getSnapshot=f,oe.setSnapshot=ge;var me=k(l._source);if(!Kn(B,me)){me=f(l._source),Kn(qe,me)||(ge(me),me=ms(rt),E.mutableReadLanes|=me&E.pendingLanes),me=E.mutableReadLanes,E.entangledLanes|=me;for(var te=E.entanglements,ue=me;0<ue;){var ke=31-os(ue),Pe=1<<ke;te[ke]|=me,ue&=~Pe}}},[f,l,v]),a.useEffect(function(){return v(l._source,function(){var me=oe.getSnapshot,te=oe.setSnapshot;try{te(me(l._source));var ue=ms(rt);E.mutableReadLanes|=ue&E.pendingLanes}catch(ke){te(function(){throw ke})}})},[l,v]),Kn(ze,f)&&Kn(it,l)&&Kn(_e,v)||(o={pending:null,dispatch:null,lastRenderedReducer:Or,lastRenderedState:qe},o.dispatch=ge=v_.bind(null,Ci,o),Q.queue=o,Q.baseQueue=null,qe=uv(E,l,f),Q.memoizedState=Q.baseState=qe),qe}function dv(o,l,f){var v=da();return hv(v,o,l,f)}function Vu(o){var l=ha();return typeof o=="function"&&(o=o()),l.memoizedState=l.baseState=o,o=l.queue={pending:null,dispatch:null,lastRenderedReducer:Or,lastRenderedState:o},o=o.dispatch=v_.bind(null,Ci,o),[l.memoizedState,o]}function dp(o,l,f,v){return o={tag:o,create:l,destroy:f,deps:v,next:null},l=Ci.updateQueue,l===null?(l={lastEffect:null},Ci.updateQueue=l,l.lastEffect=o.next=o):(f=l.lastEffect,f===null?l.lastEffect=o.next=o:(v=f.next,f.next=o,o.next=v,l.lastEffect=o)),o}function pv(o){var l=ha();return o={current:o},l.memoizedState=o}function pp(){return da().memoizedState}function g_(o,l,f,v){var E=ha();Ci.flags|=o,E.memoizedState=dp(1|l,f,void 0,v===void 0?null:v)}function y_(o,l,f,v){var E=da();v=v===void 0?null:v;var k=void 0;if(nn!==null){var B=nn.memoizedState;if(k=B.destroy,v!==null&&m_(v,B.deps)){dp(l,f,k,v);return}}Ci.flags|=o,E.memoizedState=dp(1|l,f,k,v)}function fv(o,l){return g_(516,4,o,l)}function fp(o,l){return y_(516,4,o,l)}function mv(o,l){return y_(4,2,o,l)}function _v(o,l){if(typeof l=="function")return o=o(),l(o),function(){l(null)};if(l!=null)return o=o(),l.current=o,function(){l.current=null}}function gv(o,l,f){return f=f!=null?f.concat([o]):null,y_(4,2,_v.bind(null,l,o),f)}function x_(){}function yv(o,l){var f=da();l=l===void 0?null:l;var v=f.memoizedState;return v!==null&&l!==null&&m_(l,v[1])?v[0]:(f.memoizedState=[o,l],o)}function xv(o,l){var f=da();l=l===void 0?null:l;var v=f.memoizedState;return v!==null&&l!==null&&m_(l,v[1])?v[0]:(o=o(),f.memoizedState=[o,l],o)}function eT(o,l){var f=jl();ca(98>f?98:f,function(){o(!0)}),ca(97<f?97:f,function(){var v=Qn.transition;Qn.transition=1;try{o(!1),l()}finally{Qn.transition=v}})}function v_(o,l,f){var v=jn(),E=ms(o),k={lane:E,action:f,eagerReducer:null,eagerState:null,next:null},B=l.pending;if(B===null?k.next=k:(k.next=B.next,B.next=k),l.pending=k,B=o.alternate,o===Ci||B!==null&&B===Ci)Ou=hp=!0;else{if(o.lanes===0&&(B===null||B.lanes===0)&&(B=l.lastRenderedReducer,B!==null))try{var a=l.lastRenderedState,Q=B(a,f);if(k.eagerReducer=B,k.eagerState=Q,Kn(Q,a))return}catch{}finally{}_s(o,E,v)}}var mp={readContext:Jn,useCallback:In,useContext:In,useEffect:In,useImperativeHandle:In,useLayoutEffect:In,useMemo:In,useReducer:In,useRef:In,useState:In,useDebugValue:In,useDeferredValue:In,useTransition:In,useMutableSource:In,useOpaqueIdentifier:In,unstable_isNewReconciler:!1},tT={readContext:Jn,useCallback:function(o,l){return ha().memoizedState=[o,l===void 0?null:l],o},useContext:Jn,useEffect:fv,useImperativeHandle:function(o,l,f){return f=f!=null?f.concat([o]):null,g_(4,2,_v.bind(null,l,o),f)},useLayoutEffect:function(o,l){return g_(4,2,o,l)},useMemo:function(o,l){var f=ha();return l=l===void 0?null:l,o=o(),f.memoizedState=[o,l],o},useReducer:function(o,l,f){var v=ha();return l=f!==void 0?f(l):l,v.memoizedState=v.baseState=l,o=v.queue={pending:null,dispatch:null,lastRenderedReducer:o,lastRenderedState:l},o=o.dispatch=v_.bind(null,Ci,o),[v.memoizedState,o]},useRef:pv,useState:Vu,useDebugValue:x_,useDeferredValue:function(o){var l=Vu(o),f=l[0],v=l[1];return fv(function(){var E=Qn.transition;Qn.transition=1;try{v(o)}finally{Qn.transition=E}},[o]),f},useTransition:function(){var o=Vu(!1),l=o[0];return o=eT.bind(null,o[1]),pv(o),[o,l]},useMutableSource:function(o,l,f){var v=ha();return v.memoizedState={refs:{getSnapshot:l,setSnapshot:null},source:o,subscribe:f},hv(v,o,l,f)},useOpaqueIdentifier:function(){if(Fr){var o=!1,l=X2(function(){throw o||(o=!0,f("r:"+(Jm++).toString(36))),Error(He(355))}),f=Vu(l)[1];return(Ci.mode&2)==0&&(Ci.flags|=516,dp(5,function(){f("r:"+(Jm++).toString(36))},void 0,null)),l}return l="r:"+(Jm++).toString(36),Vu(l),l},unstable_isNewReconciler:!1},iT={readContext:Jn,useCallback:yv,useContext:Jn,useEffect:fp,useImperativeHandle:gv,useLayoutEffect:mv,useMemo:xv,useReducer:Uu,useRef:pp,useState:function(){return Uu(Or)},useDebugValue:x_,useDeferredValue:function(o){var l=Uu(Or),f=l[0],v=l[1];return fp(function(){var E=Qn.transition;Qn.transition=1;try{v(o)}finally{Qn.transition=E}},[o]),f},useTransition:function(){var o=Uu(Or)[0];return[pp().current,o]},useMutableSource:dv,useOpaqueIdentifier:function(){return Uu(Or)[0]},unstable_isNewReconciler:!1},nT={readContext:Jn,useCallback:yv,useContext:Jn,useEffect:fp,useImperativeHandle:gv,useLayoutEffect:mv,useMemo:xv,useReducer:Nu,useRef:pp,useState:function(){return Nu(Or)},useDebugValue:x_,useDeferredValue:function(o){var l=Nu(Or),f=l[0],v=l[1];return fp(function(){var E=Qn.transition;Qn.transition=1;try{v(o)}finally{Qn.transition=E}},[o]),f},useTransition:function(){var o=Nu(Or)[0];return[pp().current,o]},useMutableSource:dv,useOpaqueIdentifier:function(){return Nu(Or)[0]},unstable_isNewReconciler:!1},rT=ia.ReactCurrentOwner,hr=!1;function An(o,l,f,v){l.child=o===null?ov(l,null,f,v):lp(l,o.child,f,v)}function vv(o,l,f,v,E){f=f.render;var k=l.ref;return Gl(l,E),v=__(o,l,f,v,k,E),o!==null&&!hr?(l.updateQueue=o.updateQueue,l.flags&=-517,o.lanes&=~E,po(o,l,E)):(l.flags|=1,An(o,l,v,E),l.child)}function wv(o,l,f,v,E,k){if(o===null){var B=f.type;return typeof B=="function"&&!$_(B)&&B.defaultProps===void 0&&f.compare===null&&f.defaultProps===void 0?(l.tag=15,l.type=B,bv(o,l,B,v,E,k)):(o=Sp(f.type,null,v,l,l.mode,k),o.ref=l.ref,o.return=l,l.child=o)}return B=o.child,(E&k)==0&&(E=B.memoizedProps,f=f.compare,f=f!==null?f:Su,f(E,v)&&o.ref===l.ref)?po(o,l,k):(l.flags|=1,o=xs(B,v),o.ref=l.ref,o.return=l,l.child=o)}function bv(o,l,f,v,E,k){if(o!==null&&Su(o.memoizedProps,v)&&o.ref===l.ref)if(hr=!1,(k&E)!=0)(o.flags&16384)!=0&&(hr=!0);else return l.lanes=o.lanes,po(o,l,k);return b_(o,l,f,v,k)}function w_(o,l,f){var v=l.pendingProps,E=v.children,k=o!==null?o.memoizedState:null;if(v.mode==="hidden"||v.mode==="unstable-defer-without-hiding")if((l.mode&4)==0)l.memoizedState={baseLanes:0},Ep(l,f);else if((f&1073741824)!=0)l.memoizedState={baseLanes:0},Ep(l,k!==null?k.baseLanes:f);else return o=k!==null?k.baseLanes|f:f,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:o},Ep(l,o),null;else k!==null?(v=k.baseLanes|f,l.memoizedState=null):v=f,Ep(l,v);return An(o,l,E,f),l.child}function Tv(o,l){var f=l.ref;(o===null&&f!==null||o!==null&&o.ref!==f)&&(l.flags|=128)}function b_(o,l,f,v,E){var k=Cn(f)?aa:en.current;return k=Vl(l,k),Gl(l,E),f=__(o,l,f,v,k,E),o!==null&&!hr?(l.updateQueue=o.updateQueue,l.flags&=-517,o.lanes&=~E,po(o,l,E)):(l.flags|=1,An(o,l,f,E),l.child)}function Ev(o,l,f,v,E){if(Cn(f)){var k=!0;Jd(l)}else k=!1;if(Gl(l,E),l.stateNode===null)o!==null&&(o.alternate=null,l.alternate=null,l.flags|=2),iv(l,f,v),c_(l,f,v,E),v=!0;else if(o===null){var B=l.stateNode,a=l.memoizedProps;B.props=a;var Q=B.context,ge=f.contextType;typeof ge=="object"&&ge!==null?ge=Jn(ge):(ge=Cn(f)?aa:en.current,ge=Vl(l,ge));var qe=f.getDerivedStateFromProps,_e=typeof qe=="function"||typeof B.getSnapshotBeforeUpdate=="function";_e||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(a!==v||Q!==ge)&&nv(l,B,v,ge),us=!1;var oe=l.memoizedState;B.state=oe,zu(l,v,B,E),Q=l.memoizedState,a!==v||oe!==Q||Sn.current||us?(typeof qe=="function"&&(rp(l,f,qe,v),Q=l.memoizedState),(a=us||tv(l,f,a,v,oe,Q,ge))?(_e||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount()),typeof B.componentDidMount=="function"&&(l.flags|=4)):(typeof B.componentDidMount=="function"&&(l.flags|=4),l.memoizedProps=v,l.memoizedState=Q),B.props=v,B.state=Q,B.context=ge,v=a):(typeof B.componentDidMount=="function"&&(l.flags|=4),v=!1)}else{B=l.stateNode,Kx(o,l),a=l.memoizedProps,ge=l.type===l.elementType?a:ur(l.type,a),B.props=ge,_e=l.pendingProps,oe=B.context,Q=f.contextType,typeof Q=="object"&&Q!==null?Q=Jn(Q):(Q=Cn(f)?aa:en.current,Q=Vl(l,Q));var ze=f.getDerivedStateFromProps;(qe=typeof ze=="function"||typeof B.getSnapshotBeforeUpdate=="function")||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(a!==_e||oe!==Q)&&nv(l,B,v,Q),us=!1,oe=l.memoizedState,B.state=oe,zu(l,v,B,E);var it=l.memoizedState;a!==_e||oe!==it||Sn.current||us?(typeof ze=="function"&&(rp(l,f,ze,v),it=l.memoizedState),(ge=us||tv(l,f,ge,v,oe,it,Q))?(qe||typeof B.UNSAFE_componentWillUpdate!="function"&&typeof B.componentWillUpdate!="function"||(typeof B.componentWillUpdate=="function"&&B.componentWillUpdate(v,it,Q),typeof B.UNSAFE_componentWillUpdate=="function"&&B.UNSAFE_componentWillUpdate(v,it,Q)),typeof B.componentDidUpdate=="function"&&(l.flags|=4),typeof B.getSnapshotBeforeUpdate=="function"&&(l.flags|=256)):(typeof B.componentDidUpdate!="function"||a===o.memoizedProps&&oe===o.memoizedState||(l.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||a===o.memoizedProps&&oe===o.memoizedState||(l.flags|=256),l.memoizedProps=v,l.memoizedState=it),B.props=v,B.state=it,B.context=Q,v=ge):(typeof B.componentDidUpdate!="function"||a===o.memoizedProps&&oe===o.memoizedState||(l.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||a===o.memoizedProps&&oe===o.memoizedState||(l.flags|=256),v=!1)}return T_(o,l,f,v,k,E)}function T_(o,l,f,v,E,k){Tv(o,l);var B=(l.flags&64)!=0;if(!v&&!B)return E&&Vx(l,f,!1),po(o,l,k);v=l.stateNode,rT.current=l;var a=B&&typeof f.getDerivedStateFromError!="function"?null:v.render();return l.flags|=1,o!==null&&B?(l.child=lp(l,o.child,null,k),l.child=lp(l,null,a,k)):An(o,l,a,k),l.memoizedState=v.state,E&&Vx(l,f,!0),l.child}function Sv(o){var l=o.stateNode;l.pendingContext?Ux(o,l.pendingContext,l.pendingContext!==l.context):l.context&&Ux(o,l.context,!1),u_(o,l.containerInfo)}var _p={dehydrated:null,retryLane:0};function Cv(o,l,f){var v=l.pendingProps,E=bi.current,k=!1,B;return(B=(l.flags&64)!=0)||(B=o!==null&&o.memoizedState===null?!1:(E&2)!=0),B?(k=!0,l.flags&=-65):o!==null&&o.memoizedState===null||v.fallback===void 0||v.unstable_avoidThisFallback===!0||(E|=1),wi(bi,E&1),o===null?(v.fallback!==void 0&&d_(l),o=v.children,E=v.fallback,k?(o=Iv(l,o,E,f),l.child.memoizedState={baseLanes:f},l.memoizedState=_p,o):typeof v.unstable_expectedLoadTime=="number"?(o=Iv(l,o,E,f),l.child.memoizedState={baseLanes:f},l.memoizedState=_p,l.lanes=33554432,o):(f=G_({mode:"visible",children:o},l.mode,f,null),f.return=l,l.child=f)):o.memoizedState!==null?k?(v=Mv(o,l,v.children,v.fallback,f),k=l.child,E=o.child.memoizedState,k.memoizedState=E===null?{baseLanes:f}:{baseLanes:E.baseLanes|f},k.childLanes=o.childLanes&~f,l.memoizedState=_p,v):(f=Av(o,l,v.children,f),l.memoizedState=null,f):k?(v=Mv(o,l,v.children,v.fallback,f),k=l.child,E=o.child.memoizedState,k.memoizedState=E===null?{baseLanes:f}:{baseLanes:E.baseLanes|f},k.childLanes=o.childLanes&~f,l.memoizedState=_p,v):(f=Av(o,l,v.children,f),l.memoizedState=null,f)}function Iv(o,l,f,v){var E=o.mode,k=o.child;return l={mode:"hidden",children:l},(E&2)==0&&k!==null?(k.childLanes=0,k.pendingProps=l):k=G_(l,E,0,null),f=Jl(f,E,v,null),k.return=o,f.return=o,k.sibling=f,o.child=k,f}function Av(o,l,f,v){var E=o.child;return o=E.sibling,f=xs(E,{mode:"visible",children:f}),(l.mode&2)==0&&(f.lanes=v),f.return=l,f.sibling=null,o!==null&&(o.nextEffect=null,o.flags=8,l.firstEffect=l.lastEffect=o),l.child=f}function Mv(o,l,f,v,E){var k=l.mode,B=o.child;o=B.sibling;var a={mode:"hidden",children:f};return(k&2)==0&&l.child!==B?(f=l.child,f.childLanes=0,f.pendingProps=a,B=f.lastEffect,B!==null?(l.firstEffect=f.firstEffect,l.lastEffect=B,B.nextEffect=null):l.firstEffect=l.lastEffect=null):f=xs(B,a),o!==null?v=xs(o,v):(v=Jl(v,k,E,null),v.flags|=2),v.return=l,f.return=l,f.sibling=v,l.child=f,v}function kv(o,l){o.lanes|=l;var f=o.alternate;f!==null&&(f.lanes|=l),Yx(o.return,l)}function E_(o,l,f,v,E,k){var B=o.memoizedState;B===null?o.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:v,tail:f,tailMode:E,lastEffect:k}:(B.isBackwards=l,B.rendering=null,B.renderingStartTime=0,B.last=v,B.tail=f,B.tailMode=E,B.lastEffect=k)}function zv(o,l,f){var v=l.pendingProps,E=v.revealOrder,k=v.tail;if(An(o,l,v.children,f),v=bi.current,(v&2)!=0)v=v&1|2,l.flags|=64;else{if(o!==null&&(o.flags&64)!=0)e:for(o=l.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&kv(o,f);else if(o.tag===19)kv(o,f);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===l)break e;for(;o.sibling===null;){if(o.return===null||o.return===l)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}v&=1}if(wi(bi,v),(l.mode&2)==0)l.memoizedState=null;else switch(E){case"forwards":for(f=l.child,E=null;f!==null;)o=f.alternate,o!==null&&cp(o)===null&&(E=f),f=f.sibling;f=E,f===null?(E=l.child,l.child=null):(E=f.sibling,f.sibling=null),E_(l,!1,E,f,k,l.lastEffect);break;case"backwards":for(f=null,E=l.child,l.child=null;E!==null;){if(o=E.alternate,o!==null&&cp(o)===null){l.child=E;break}o=E.sibling,E.sibling=f,f=E,E=o}E_(l,!0,f,null,k,l.lastEffect);break;case"together":E_(l,!1,null,null,void 0,l.lastEffect);break;default:l.memoizedState=null}return l.child}function po(o,l,f){if(o!==null&&(l.dependencies=o.dependencies),$u|=l.lanes,(f&l.childLanes)!=0){if(o!==null&&l.child!==o.child)throw Error(He(153));if(l.child!==null){for(o=l.child,f=xs(o,o.pendingProps),l.child=f,f.return=l;o.sibling!==null;)o=o.sibling,f=f.sibling=xs(o,o.pendingProps),f.return=l;f.sibling=null}return l.child}return null}var Pv,S_,Dv,Lv;Pv=function(o,l){for(var f=l.child;f!==null;){if(f.tag===5||f.tag===6)o.appendChild(f.stateNode);else if(f.tag!==4&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return;f=f.return}f.sibling.return=f.return,f=f.sibling}};S_=function(){};Dv=function(o,l,f,v){var E=o.memoizedProps;if(E!==v){o=l.stateNode,ua(Br.current);var k=null;switch(f){case"input":E=cm(o,E),v=cm(o,v),k=[];break;case"option":E=dm(o,E),v=dm(o,v),k=[];break;case"select":E=li({},E,{value:void 0}),v=li({},v,{value:void 0}),k=[];break;case"textarea":E=pm(o,E),v=pm(o,v),k=[];break;default:typeof E.onClick!="function"&&typeof v.onClick=="function"&&(o.onclick=Wd)}_m(f,v);var B;f=null;for(ge in E)if(!v.hasOwnProperty(ge)&&E.hasOwnProperty(ge)&&E[ge]!=null)if(ge==="style"){var a=E[ge];for(B in a)a.hasOwnProperty(B)&&(f||(f={}),f[B]="")}else ge!=="dangerouslySetInnerHTML"&&ge!=="children"&&ge!=="suppressContentEditableWarning"&&ge!=="suppressHydrationWarning"&&ge!=="autoFocus"&&(nu.hasOwnProperty(ge)?k||(k=[]):(k=k||[]).push(ge,null));for(ge in v){var Q=v[ge];if(a=E!=null?E[ge]:void 0,v.hasOwnProperty(ge)&&Q!==a&&(Q!=null||a!=null))if(ge==="style")if(a){for(B in a)!a.hasOwnProperty(B)||Q&&Q.hasOwnProperty(B)||(f||(f={}),f[B]="");for(B in Q)Q.hasOwnProperty(B)&&a[B]!==Q[B]&&(f||(f={}),f[B]=Q[B])}else f||(k||(k=[]),k.push(ge,f)),f=Q;else ge==="dangerouslySetInnerHTML"?(Q=Q?Q.__html:void 0,a=a?a.__html:void 0,Q!=null&&a!==Q&&(k=k||[]).push(ge,Q)):ge==="children"?typeof Q!="string"&&typeof Q!="number"||(k=k||[]).push(ge,""+Q):ge!=="suppressContentEditableWarning"&&ge!=="suppressHydrationWarning"&&(nu.hasOwnProperty(ge)?(Q!=null&&ge==="onScroll"&&ni("scroll",o),k||a===Q||(k=[])):typeof Q=="object"&&Q!==null&&Q.$$typeof===rm?Q.toString():(k=k||[]).push(ge,Q))}f&&(k=k||[]).push("style",f);var ge=k;(l.updateQueue=ge)&&(l.flags|=4)}};Lv=function(o,l,f,v){f!==v&&(l.flags|=4)};function ju(o,l){if(!Fr)switch(o.tailMode){case"hidden":l=o.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?o.tail=null:f.sibling=null;break;case"collapsed":f=o.tail;for(var v=null;f!==null;)f.alternate!==null&&(v=f),f=f.sibling;v===null?l||o.tail===null?o.tail=null:o.tail.sibling=null:v.sibling=null}}function oT(o,l,f){var v=l.pendingProps;switch(l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Cn(l.type)&&Kd(),null;case 3:return Zl(),ri(Sn),ri(en),f_(),v=l.stateNode,v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(o===null||o.child===null)&&(up(l)?l.flags|=4:v.hydrate||(l.flags|=256)),S_(l),null;case 5:h_(l);var E=ua(Ru.current);if(f=l.type,o!==null&&l.stateNode!=null)Dv(o,l,f,v,E),o.ref!==l.ref&&(l.flags|=128);else{if(!v){if(l.stateNode===null)throw Error(He(166));return null}if(o=ua(Br.current),up(l)){v=l.stateNode,f=l.type;var k=l.memoizedProps;switch(v[as]=l,v[Hd]=k,f){case"dialog":ni("cancel",v),ni("close",v);break;case"iframe":case"object":case"embed":ni("load",v);break;case"video":case"audio":for(o=0;o<Iu.length;o++)ni(Iu[o],v);break;case"source":ni("error",v);break;case"img":case"image":case"link":ni("error",v),ni("load",v);break;case"details":ni("toggle",v);break;case"input":E0(v,k),ni("invalid",v);break;case"select":v._wrapperState={wasMultiple:!!k.multiple},ni("invalid",v);break;case"textarea":I0(v,k),ni("invalid",v)}_m(f,k),o=null;for(var B in k)k.hasOwnProperty(B)&&(E=k[B],B==="children"?typeof E=="string"?v.textContent!==E&&(o=["children",E]):typeof E=="number"&&v.textContent!==""+E&&(o=["children",""+E]):nu.hasOwnProperty(B)&&E!=null&&B==="onScroll"&&ni("scroll",v));switch(f){case"input":kd(v),C0(v,k,!0);break;case"textarea":kd(v),M0(v);break;case"select":case"option":break;default:typeof k.onClick=="function"&&(v.onclick=Wd)}v=o,l.updateQueue=v,v!==null&&(l.flags|=4)}else{switch(B=E.nodeType===9?E:E.ownerDocument,o===fm.html&&(o=k0(f)),o===fm.html?f==="script"?(o=B.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof v.is=="string"?o=B.createElement(f,{is:v.is}):(o=B.createElement(f),f==="select"&&(B=o,v.multiple?B.multiple=!0:v.size&&(B.size=v.size))):o=B.createElementNS(o,f),o[as]=l,o[Hd]=v,Pv(o,l,!1,!1),l.stateNode=o,B=gm(f,v),f){case"dialog":ni("cancel",o),ni("close",o),E=v;break;case"iframe":case"object":case"embed":ni("load",o),E=v;break;case"video":case"audio":for(E=0;E<Iu.length;E++)ni(Iu[E],o);E=v;break;case"source":ni("error",o),E=v;break;case"img":case"image":case"link":ni("error",o),ni("load",o),E=v;break;case"details":ni("toggle",o),E=v;break;case"input":E0(o,v),E=cm(o,v),ni("invalid",o);break;case"option":E=dm(o,v);break;case"select":o._wrapperState={wasMultiple:!!v.multiple},E=li({},v,{value:void 0}),ni("invalid",o);break;case"textarea":I0(o,v),E=pm(o,v),ni("invalid",o);break;default:E=v}_m(f,E);var a=E;for(k in a)if(a.hasOwnProperty(k)){var Q=a[k];k==="style"?D0(o,Q):k==="dangerouslySetInnerHTML"?(Q=Q?Q.__html:void 0,Q!=null&&z0(o,Q)):k==="children"?typeof Q=="string"?(f!=="textarea"||Q!=="")&&cu(o,Q):typeof Q=="number"&&cu(o,""+Q):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(nu.hasOwnProperty(k)?Q!=null&&k==="onScroll"&&ni("scroll",o):Q!=null&&Jf(o,k,Q,B))}switch(f){case"input":kd(o),C0(o,v,!1);break;case"textarea":kd(o),M0(o);break;case"option":v.value!=null&&o.setAttribute("value",""+ts(v.value));break;case"select":o.multiple=!!v.multiple,k=v.value,k!=null?Il(o,!!v.multiple,k,!1):v.defaultValue!=null&&Il(o,!!v.multiple,v.defaultValue,!0);break;default:typeof E.onClick=="function"&&(o.onclick=Wd)}Lx(f,v)&&(l.flags|=4)}l.ref!==null&&(l.flags|=128)}return null;case 6:if(o&&l.stateNode!=null)Lv(o,l,o.memoizedProps,v);else{if(typeof v!="string"&&l.stateNode===null)throw Error(He(166));f=ua(Ru.current),ua(Br.current),up(l)?(v=l.stateNode,f=l.memoizedProps,v[as]=l,v.nodeValue!==f&&(l.flags|=4)):(v=(f.nodeType===9?f:f.ownerDocument).createTextNode(v),v[as]=l,l.stateNode=v)}return null;case 13:return ri(bi),v=l.memoizedState,(l.flags&64)!=0?(l.lanes=f,l):(v=v!==null,f=!1,o===null?l.memoizedProps.fallback!==void 0&&up(l):f=o.memoizedState!==null,v&&!f&&(l.mode&2)!=0&&(o===null&&l.memoizedProps.unstable_avoidThisFallback!==!0||(bi.current&1)!=0?Yi===0&&(Yi=3):((Yi===0||Yi===3)&&(Yi=4),fn===null||($u&134217727)==0&&(Xl&134217727)==0||Yl(fn,rn))),(v||f)&&(l.flags|=4),null);case 4:return Zl(),S_(l),o===null&&Mx(l.stateNode.containerInfo),null;case 10:return a_(l),null;case 17:return Cn(l.type)&&Kd(),null;case 19:if(ri(bi),v=l.memoizedState,v===null)return null;if(k=(l.flags&64)!=0,B=v.rendering,B===null)if(k)ju(v,!1);else{if(Yi!==0||o!==null&&(o.flags&64)!=0)for(o=l.child;o!==null;){if(B=cp(o),B!==null){for(l.flags|=64,ju(v,!1),k=B.updateQueue,k!==null&&(l.updateQueue=k,l.flags|=4),v.lastEffect===null&&(l.firstEffect=null),l.lastEffect=v.lastEffect,v=f,f=l.child;f!==null;)k=f,o=v,k.flags&=2,k.nextEffect=null,k.firstEffect=null,k.lastEffect=null,B=k.alternate,B===null?(k.childLanes=0,k.lanes=o,k.child=null,k.memoizedProps=null,k.memoizedState=null,k.updateQueue=null,k.dependencies=null,k.stateNode=null):(k.childLanes=B.childLanes,k.lanes=B.lanes,k.child=B.child,k.memoizedProps=B.memoizedProps,k.memoizedState=B.memoizedState,k.updateQueue=B.updateQueue,k.type=B.type,o=B.dependencies,k.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),f=f.sibling;return wi(bi,bi.current&1|2),l.child}o=o.sibling}v.tail!==null&&tn()>B_&&(l.flags|=64,k=!0,ju(v,!1),l.lanes=33554432)}else{if(!k)if(o=cp(B),o!==null){if(l.flags|=64,k=!0,f=o.updateQueue,f!==null&&(l.updateQueue=f,l.flags|=4),ju(v,!0),v.tail===null&&v.tailMode==="hidden"&&!B.alternate&&!Fr)return l=l.lastEffect=v.lastEffect,l!==null&&(l.nextEffect=null),null}else 2*tn()-v.renderingStartTime>B_&&f!==1073741824&&(l.flags|=64,k=!0,ju(v,!1),l.lanes=33554432);v.isBackwards?(B.sibling=l.child,l.child=B):(f=v.last,f!==null?f.sibling=B:l.child=B,v.last=B)}return v.tail!==null?(f=v.tail,v.rendering=f,v.tail=f.sibling,v.lastEffect=l.lastEffect,v.renderingStartTime=tn(),f.sibling=null,l=bi.current,wi(bi,k?l&1|2:l&1),f):null;case 23:case 24:return j_(),o!==null&&o.memoizedState!==null!=(l.memoizedState!==null)&&v.mode!=="unstable-defer-without-hiding"&&(l.flags|=4),null}throw Error(He(156,l.tag))}function sT(o){switch(o.tag){case 1:Cn(o.type)&&Kd();var l=o.flags;return l&4096?(o.flags=l&-4097|64,o):null;case 3:if(Zl(),ri(Sn),ri(en),f_(),l=o.flags,(l&64)!=0)throw Error(He(285));return o.flags=l&-4097|64,o;case 5:return h_(o),null;case 13:return ri(bi),l=o.flags,l&4096?(o.flags=l&-4097|64,o):null;case 19:return ri(bi),null;case 4:return Zl(),null;case 10:return a_(o),null;case 23:case 24:return j_(),null;default:return null}}function C_(o,l){try{var f="",v=l;do f+=Nb(v),v=v.return;while(v);var E=f}catch(k){E=`
Error generating stack: `+k.message+`
`+k.stack}return{value:o,source:l,stack:E}}function I_(o,l){try{console.error(l.value)}catch(f){setTimeout(function(){throw f})}}var aT=typeof WeakMap=="function"?WeakMap:Map;function Rv(o,l,f){f=hs(-1,f),f.tag=3,f.payload={element:null};var v=l.value;return f.callback=function(){xp||(xp=!0,F_=v),I_(o,l)},f}function Bv(o,l,f){f=hs(-1,f),f.tag=3;var v=o.type.getDerivedStateFromError;if(typeof v=="function"){var E=l.value;f.payload=function(){return I_(o,l),v(E)}}var k=o.stateNode;return k!==null&&typeof k.componentDidCatch=="function"&&(f.callback=function(){typeof v!="function"&&(Ur===null?Ur=new Set([this]):Ur.add(this),I_(o,l));var B=l.stack;this.componentDidCatch(l.value,{componentStack:B!==null?B:""})}),f}var lT=typeof WeakSet=="function"?WeakSet:Set;function Fv(o){var l=o.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(f){ys(o,f)}else l.current=null}function cT(o,l){switch(l.tag){case 0:case 11:case 15:case 22:return;case 1:if(l.flags&256&&o!==null){var f=o.memoizedProps,v=o.memoizedState;o=l.stateNode,l=o.getSnapshotBeforeUpdate(l.elementType===l.type?f:ur(l.type,f),v),o.__reactInternalSnapshotBeforeUpdate=l}return;case 3:l.flags&256&&Km(l.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(He(163))}function uT(o,l,f){switch(f.tag){case 0:case 11:case 15:case 22:if(l=f.updateQueue,l=l!==null?l.lastEffect:null,l!==null){o=l=l.next;do{if((o.tag&3)==3){var v=o.create;o.destroy=v()}o=o.next}while(o!==l)}if(l=f.updateQueue,l=l!==null?l.lastEffect:null,l!==null){o=l=l.next;do{var E=o;v=E.next,E=E.tag,(E&4)!=0&&(E&1)!=0&&(Jv(f,o),yT(f,o)),o=v}while(o!==l)}return;case 1:o=f.stateNode,f.flags&4&&(l===null?o.componentDidMount():(v=f.elementType===f.type?l.memoizedProps:ur(f.type,l.memoizedProps),o.componentDidUpdate(v,l.memoizedState,o.__reactInternalSnapshotBeforeUpdate))),l=f.updateQueue,l!==null&&Qx(f,l,o);return;case 3:if(l=f.updateQueue,l!==null){if(o=null,f.child!==null)switch(f.child.tag){case 5:o=f.child.stateNode;break;case 1:o=f.child.stateNode}Qx(f,l,o)}return;case 5:o=f.stateNode,l===null&&f.flags&4&&Lx(f.type,f.memoizedProps)&&o.focus();return;case 6:return;case 4:return;case 12:return;case 13:f.memoizedState===null&&(f=f.alternate,f!==null&&(f=f.memoizedState,f!==null&&(f=f.dehydrated,f!==null&&H0(f))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(He(163))}function Ov(o,l){for(var f=o;;){if(f.tag===5){var v=f.stateNode;if(l)v=v.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{v=f.stateNode;var E=f.memoizedProps.style;E=E!=null&&E.hasOwnProperty("display")?E.display:null,v.style.display=P0("display",E)}}else if(f.tag===6)f.stateNode.nodeValue=l?"":f.memoizedProps;else if((f.tag!==23&&f.tag!==24||f.memoizedState===null||f===o)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===o)break;for(;f.sibling===null;){if(f.return===null||f.return===o)return;f=f.return}f.sibling.return=f.return,f=f.sibling}}function Uv(o,l){if(la&&typeof la.onCommitFiberUnmount=="function")try{la.onCommitFiberUnmount(e_,l)}catch{}switch(l.tag){case 0:case 11:case 14:case 15:case 22:if(o=l.updateQueue,o!==null&&(o=o.lastEffect,o!==null)){var f=o=o.next;do{var v=f,E=v.destroy;if(v=v.tag,E!==void 0)if((v&4)!=0)Jv(l,f);else{v=l;try{E()}catch(k){ys(v,k)}}f=f.next}while(f!==o)}break;case 1:if(Fv(l),o=l.stateNode,typeof o.componentWillUnmount=="function")try{o.props=l.memoizedProps,o.state=l.memoizedState,o.componentWillUnmount()}catch(k){ys(l,k)}break;case 5:Fv(l);break;case 4:$v(o,l)}}function Nv(o){o.alternate=null,o.child=null,o.dependencies=null,o.firstEffect=null,o.lastEffect=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.return=null,o.updateQueue=null}function Vv(o){return o.tag===5||o.tag===3||o.tag===4}function jv(o){e:{for(var l=o.return;l!==null;){if(Vv(l))break e;l=l.return}throw Error(He(160))}var f=l;switch(l=f.stateNode,f.tag){case 5:var v=!1;break;case 3:l=l.containerInfo,v=!0;break;case 4:l=l.containerInfo,v=!0;break;default:throw Error(He(161))}f.flags&16&&(cu(l,""),f.flags&=-17);e:t:for(f=o;;){for(;f.sibling===null;){if(f.return===null||Vv(f.return)){f=null;break e}f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue t;f.child.return=f,f=f.child}if(!(f.flags&2)){f=f.stateNode;break e}}v?A_(o,f,l):M_(o,f,l)}function A_(o,l,f){var v=o.tag,E=v===5||v===6;if(E)o=E?o.stateNode:o.stateNode.instance,l?f.nodeType===8?f.parentNode.insertBefore(o,l):f.insertBefore(o,l):(f.nodeType===8?(l=f.parentNode,l.insertBefore(o,f)):(l=f,l.appendChild(o)),f=f._reactRootContainer,f!=null||l.onclick!==null||(l.onclick=Wd));else if(v!==4&&(o=o.child,o!==null))for(A_(o,l,f),o=o.sibling;o!==null;)A_(o,l,f),o=o.sibling}function M_(o,l,f){var v=o.tag,E=v===5||v===6;if(E)o=E?o.stateNode:o.stateNode.instance,l?f.insertBefore(o,l):f.appendChild(o);else if(v!==4&&(o=o.child,o!==null))for(M_(o,l,f),o=o.sibling;o!==null;)M_(o,l,f),o=o.sibling}function $v(o,l){for(var f=l,v=!1,E,k;;){if(!v){v=f.return;e:for(;;){if(v===null)throw Error(He(160));switch(E=v.stateNode,v.tag){case 5:k=!1;break e;case 3:E=E.containerInfo,k=!0;break e;case 4:E=E.containerInfo,k=!0;break e}v=v.return}v=!0}if(f.tag===5||f.tag===6){e:for(var B=o,a=f,Q=a;;)if(Uv(B,Q),Q.child!==null&&Q.tag!==4)Q.child.return=Q,Q=Q.child;else{if(Q===a)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===a)break e;Q=Q.return}Q.sibling.return=Q.return,Q=Q.sibling}k?(B=E,a=f.stateNode,B.nodeType===8?B.parentNode.removeChild(a):B.removeChild(a)):E.removeChild(f.stateNode)}else if(f.tag===4){if(f.child!==null){E=f.stateNode.containerInfo,k=!0,f.child.return=f,f=f.child;continue}}else if(Uv(o,f),f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return;f=f.return,f.tag===4&&(v=!1)}f.sibling.return=f.return,f=f.sibling}}function k_(o,l){switch(l.tag){case 0:case 11:case 14:case 15:case 22:var f=l.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var v=f=f.next;do(v.tag&3)==3&&(o=v.destroy,v.destroy=void 0,o!==void 0&&o()),v=v.next;while(v!==f)}return;case 1:return;case 5:if(f=l.stateNode,f!=null){v=l.memoizedProps;var E=o!==null?o.memoizedProps:v;o=l.type;var k=l.updateQueue;if(l.updateQueue=null,k!==null){for(f[Hd]=v,o==="input"&&v.type==="radio"&&v.name!=null&&S0(f,v),gm(o,E),l=gm(o,v),E=0;E<k.length;E+=2){var B=k[E],a=k[E+1];B==="style"?D0(f,a):B==="dangerouslySetInnerHTML"?z0(f,a):B==="children"?cu(f,a):Jf(f,B,a,l)}switch(o){case"input":um(f,v);break;case"textarea":A0(f,v);break;case"select":o=f._wrapperState.wasMultiple,f._wrapperState.wasMultiple=!!v.multiple,k=v.value,k!=null?Il(f,!!v.multiple,k,!1):o!==!!v.multiple&&(v.defaultValue!=null?Il(f,!!v.multiple,v.defaultValue,!0):Il(f,!!v.multiple,v.multiple?[]:"",!1))}}}return;case 6:if(l.stateNode===null)throw Error(He(162));l.stateNode.nodeValue=l.memoizedProps;return;case 3:f=l.stateNode,f.hydrate&&(f.hydrate=!1,H0(f.containerInfo));return;case 12:return;case 13:l.memoizedState!==null&&(R_=tn(),Ov(l.child,!0)),Gv(l);return;case 19:Gv(l);return;case 17:return;case 23:case 24:Ov(l,l.memoizedState!==null);return}throw Error(He(163))}function Gv(o){var l=o.updateQueue;if(l!==null){o.updateQueue=null;var f=o.stateNode;f===null&&(f=o.stateNode=new lT),l.forEach(function(v){var E=wT.bind(null,o,v);f.has(v)||(f.add(v),v.then(E,E))})}}function hT(o,l){return o!==null&&(o=o.memoizedState,o===null||o.dehydrated!==null)?(l=l.memoizedState,l!==null&&l.dehydrated===null):!1}var dT=Math.ceil,gp=ia.ReactCurrentDispatcher,z_=ia.ReactCurrentOwner,yt=0,fn=null,Pi=null,rn=0,pa=0,P_=ls(0),Yi=0,yp=null,Wl=0,$u=0,Xl=0,D_=0,L_=null,R_=0,B_=1/0;function Hl(){B_=tn()+500}var tt=null,xp=!1,F_=null,Ur=null,fs=!1,Gu=null,Zu=90,O_=[],U_=[],fo=null,qu=0,N_=null,vp=-1,mo=0,wp=0,Wu=null,bp=!1;function jn(){return(yt&48)!=0?tn():vp!==-1?vp:vp=tn()}function ms(o){if(o=o.mode,(o&2)==0)return 1;if((o&4)==0)return jl()===99?1:2;if(mo===0&&(mo=Wl),Q2.transition!==0){wp!==0&&(wp=L_!==null?L_.pendingLanes:0),o=mo;var l=4186112&~wp;return l&=-l,l===0&&(o=4186112&~o,l=o&-o,l===0&&(l=8192)),l}return o=jl(),(yt&4)!=0&&o===98?o=Od(12,mo):(o=i2(o),o=Od(o,mo)),o}function _s(o,l,f){if(50<qu)throw qu=0,N_=null,Error(He(185));if(o=Tp(o,l),o===null)return null;Ud(o,l,f),o===fn&&(Xl|=l,Yi===4&&Yl(o,rn));var v=jl();l===1?(yt&8)!=0&&(yt&48)==0?V_(o):(er(o,f),yt===0&&(Hl(),Rr())):((yt&4)==0||v!==98&&v!==99||(fo===null?fo=new Set([o]):fo.add(o)),er(o,f)),L_=o}function Tp(o,l){o.lanes|=l;var f=o.alternate;for(f!==null&&(f.lanes|=l),f=o,o=o.return;o!==null;)o.childLanes|=l,f=o.alternate,f!==null&&(f.childLanes|=l),f=o,o=o.return;return f.tag===3?f.stateNode:null}function er(o,l){for(var f=o.callbackNode,v=o.suspendedLanes,E=o.pingedLanes,k=o.expirationTimes,B=o.pendingLanes;0<B;){var a=31-os(B),Q=1<<a,ge=k[a];if(ge===-1){if((Q&v)==0||(Q&E)!=0){ge=l,zl(Q);var qe=ti;k[a]=10<=qe?ge+250:6<=qe?ge+5e3:-1}}else ge<=l&&(o.expiredLanes|=Q);B&=~Q}if(v=xu(o,o===fn?rn:0),l=ti,v===0)f!==null&&(f!==r_&&i_(f),o.callbackNode=null,o.callbackPriority=0);else{if(f!==null){if(o.callbackPriority===l)return;f!==r_&&i_(f)}l===15?(f=V_.bind(null,o),uo===null?(uo=[f],ep=t_(Qd,Hx)):uo.push(f),f=r_):l===14?f=ku(99,V_.bind(null,o)):(f=n2(l),f=ku(f,Zv.bind(null,o))),o.callbackPriority=l,o.callbackNode=f}}function Zv(o){if(vp=-1,wp=mo=0,(yt&48)!=0)throw Error(He(327));var l=o.callbackNode;if(gs()&&o.callbackNode!==l)return null;var f=xu(o,o===fn?rn:0);if(f===0)return null;var v=f,E=yt;yt|=16;var k=Hv();(fn!==o||rn!==v)&&(Hl(),Kl(o,v));do try{mT();break}catch(a){Xv(o,a)}while(1);if(s_(),gp.current=k,yt=E,Pi!==null?v=0:(fn=null,rn=0,v=Yi),(Wl&Xl)!=0)Kl(o,0);else if(v!==0){if(v===2&&(yt|=64,o.hydrate&&(o.hydrate=!1,Km(o.containerInfo)),f=ix(o),f!==0&&(v=Xu(o,f))),v===1)throw l=yp,Kl(o,0),Yl(o,f),er(o,tn()),l;switch(o.finishedWork=o.current.alternate,o.finishedLanes=f,v){case 0:case 1:throw Error(He(345));case 2:fa(o);break;case 3:if(Yl(o,f),(f&62914560)===f&&(v=R_+500-tn(),10<v)){if(xu(o,0)!==0)break;if(E=o.suspendedLanes,(E&f)!==f){jn(),o.pingedLanes|=o.suspendedLanes&E;break}o.timeoutHandle=Rx(fa.bind(null,o),v);break}fa(o);break;case 4:if(Yl(o,f),(f&4186112)===f)break;for(v=o.eventTimes,E=-1;0<f;){var B=31-os(f);k=1<<B,B=v[B],B>E&&(E=B),f&=~k}if(f=E,f=tn()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*dT(f/1960))-f,10<f){o.timeoutHandle=Rx(fa.bind(null,o),f);break}fa(o);break;case 5:fa(o);break;default:throw Error(He(329))}}return er(o,tn()),o.callbackNode===l?Zv.bind(null,o):null}function Yl(o,l){for(l&=~D_,l&=~Xl,o.suspendedLanes|=l,o.pingedLanes&=~l,o=o.expirationTimes;0<l;){var f=31-os(l),v=1<<f;o[f]=-1,l&=~v}}function V_(o){if((yt&48)!=0)throw Error(He(327));if(gs(),o===fn&&(o.expiredLanes&rn)!=0){var l=rn,f=Xu(o,l);(Wl&Xl)!=0&&(l=xu(o,l),f=Xu(o,l))}else l=xu(o,0),f=Xu(o,l);if(o.tag!==0&&f===2&&(yt|=64,o.hydrate&&(o.hydrate=!1,Km(o.containerInfo)),l=ix(o),l!==0&&(f=Xu(o,l))),f===1)throw f=yp,Kl(o,0),Yl(o,l),er(o,tn()),f;return o.finishedWork=o.current.alternate,o.finishedLanes=l,fa(o),er(o,tn()),null}function pT(){if(fo!==null){var o=fo;fo=null,o.forEach(function(l){l.expiredLanes|=24&l.pendingLanes,er(l,tn())})}Rr()}function qv(o,l){var f=yt;yt|=1;try{return o(l)}finally{yt=f,yt===0&&(Hl(),Rr())}}function Wv(o,l){var f=yt;yt&=-2,yt|=8;try{return o(l)}finally{yt=f,yt===0&&(Hl(),Rr())}}function Ep(o,l){wi(P_,pa),pa|=l,Wl|=l}function j_(){pa=P_.current,ri(P_)}function Kl(o,l){o.finishedWork=null,o.finishedLanes=0;var f=o.timeoutHandle;if(f!==-1&&(o.timeoutHandle=-1,W2(f)),Pi!==null)for(f=Pi.return;f!==null;){var v=f;switch(v.tag){case 1:v=v.type.childContextTypes,v!=null&&Kd();break;case 3:Zl(),ri(Sn),ri(en),f_();break;case 5:h_(v);break;case 4:Zl();break;case 13:ri(bi);break;case 19:ri(bi);break;case 10:a_(v);break;case 23:case 24:j_()}f=f.return}fn=o,Pi=xs(o.current,null),rn=pa=Wl=l,Yi=0,yp=null,D_=Xl=$u=0}function Xv(o,l){do{var f=Pi;try{if(s_(),Bu.current=mp,hp){for(var v=Ci.memoizedState;v!==null;){var E=v.queue;E!==null&&(E.pending=null),v=v.next}hp=!1}if(Fu=0,Hi=nn=Ci=null,Ou=!1,z_.current=null,f===null||f.return===null){Yi=1,yp=l,Pi=null;break}e:{var k=o,B=f.return,a=f,Q=l;if(l=rn,a.flags|=2048,a.firstEffect=a.lastEffect=null,Q!==null&&typeof Q=="object"&&typeof Q.then=="function"){var ge=Q;if((a.mode&2)==0){var qe=a.alternate;qe?(a.updateQueue=qe.updateQueue,a.memoizedState=qe.memoizedState,a.lanes=qe.lanes):(a.updateQueue=null,a.memoizedState=null)}var _e=(bi.current&1)!=0,oe=B;do{var ze;if(ze=oe.tag===13){var it=oe.memoizedState;if(it!==null)ze=it.dehydrated!==null;else{var rt=oe.memoizedProps;ze=rt.fallback===void 0?!1:rt.unstable_avoidThisFallback!==!0?!0:!_e}}if(ze){var me=oe.updateQueue;if(me===null){var te=new Set;te.add(ge),oe.updateQueue=te}else me.add(ge);if((oe.mode&2)==0){if(oe.flags|=64,a.flags|=16384,a.flags&=-2981,a.tag===1)if(a.alternate===null)a.tag=17;else{var ue=hs(-1,1);ue.tag=2,ds(a,ue)}a.lanes|=1;break e}Q=void 0,a=l;var ke=k.pingCache;if(ke===null?(ke=k.pingCache=new aT,Q=new Set,ke.set(ge,Q)):(Q=ke.get(ge),Q===void 0&&(Q=new Set,ke.set(ge,Q))),!Q.has(a)){Q.add(a);var Pe=vT.bind(null,k,ge,a);ge.then(Pe,Pe)}oe.flags|=4096,oe.lanes=l;break e}oe=oe.return}while(oe!==null);Q=Error((Cl(a.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}Yi!==5&&(Yi=2),Q=C_(Q,a),oe=B;do{switch(oe.tag){case 3:k=Q,oe.flags|=4096,l&=-l,oe.lanes|=l;var at=Rv(oe,k,l);Jx(oe,at);break e;case 1:k=Q;var Xe=oe.type,Ye=oe.stateNode;if((oe.flags&64)==0&&(typeof Xe.getDerivedStateFromError=="function"||Ye!==null&&typeof Ye.componentDidCatch=="function"&&(Ur===null||!Ur.has(Ye)))){oe.flags|=4096,l&=-l,oe.lanes|=l;var dt=Bv(oe,k,l);Jx(oe,dt);break e}}oe=oe.return}while(oe!==null)}Kv(f)}catch(ot){l=ot,Pi===f&&f!==null&&(Pi=f=f.return);continue}break}while(1)}function Hv(){var o=gp.current;return gp.current=mp,o===null?mp:o}function Xu(o,l){var f=yt;yt|=16;var v=Hv();fn===o&&rn===l||Kl(o,l);do try{fT();break}catch(E){Xv(o,E)}while(1);if(s_(),yt=f,gp.current=v,Pi!==null)throw Error(He(261));return fn=null,rn=0,Yi}function fT(){for(;Pi!==null;)Yv(Pi)}function mT(){for(;Pi!==null&&!Y2();)Yv(Pi)}function Yv(o){var l=e1(o.alternate,o,pa);o.memoizedProps=o.pendingProps,l===null?Kv(o):Pi=l,z_.current=null}function Kv(o){var l=o;do{var f=l.alternate;if(o=l.return,(l.flags&2048)==0){if(f=oT(f,l,pa),f!==null){Pi=f;return}if(f=l,f.tag!==24&&f.tag!==23||f.memoizedState===null||(pa&1073741824)!=0||(f.mode&4)==0){for(var v=0,E=f.child;E!==null;)v|=E.lanes|E.childLanes,E=E.sibling;f.childLanes=v}o!==null&&(o.flags&2048)==0&&(o.firstEffect===null&&(o.firstEffect=l.firstEffect),l.lastEffect!==null&&(o.lastEffect!==null&&(o.lastEffect.nextEffect=l.firstEffect),o.lastEffect=l.lastEffect),1<l.flags&&(o.lastEffect!==null?o.lastEffect.nextEffect=l:o.firstEffect=l,o.lastEffect=l))}else{if(f=sT(l),f!==null){f.flags&=2047,Pi=f;return}o!==null&&(o.firstEffect=o.lastEffect=null,o.flags|=2048)}if(l=l.sibling,l!==null){Pi=l;return}Pi=l=o}while(l!==null);Yi===0&&(Yi=5)}function fa(o){var l=jl();return ca(99,_T.bind(null,o,l)),null}function _T(o,l){do gs();while(Gu!==null);if((yt&48)!=0)throw Error(He(327));var f=o.finishedWork;if(f===null)return null;if(o.finishedWork=null,o.finishedLanes=0,f===o.current)throw Error(He(177));o.callbackNode=null;var v=f.lanes|f.childLanes,E=v,k=o.pendingLanes&~E;o.pendingLanes=E,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=E,o.mutableReadLanes&=E,o.entangledLanes&=E,E=o.entanglements;for(var B=o.eventTimes,a=o.expirationTimes;0<k;){var Q=31-os(k),ge=1<<Q;E[Q]=0,B[Q]=-1,a[Q]=-1,k&=~ge}if(fo!==null&&(v&24)==0&&fo.has(o)&&fo.delete(o),o===fn&&(Pi=fn=null,rn=0),1<f.flags?f.lastEffect!==null?(f.lastEffect.nextEffect=f,v=f.firstEffect):v=f:v=f.firstEffect,v!==null){if(E=yt,yt|=32,z_.current=null,Xm=Nd,B=bx(),Gm(B)){if("selectionStart"in B)a={start:B.selectionStart,end:B.selectionEnd};else e:if(a=(a=B.ownerDocument)&&a.defaultView||window,(ge=a.getSelection&&a.getSelection())&&ge.rangeCount!==0){a=ge.anchorNode,k=ge.anchorOffset,Q=ge.focusNode,ge=ge.focusOffset;try{a.nodeType,Q.nodeType}catch{a=null;break e}var qe=0,_e=-1,oe=-1,ze=0,it=0,rt=B,me=null;t:for(;;){for(var te;rt!==a||k!==0&&rt.nodeType!==3||(_e=qe+k),rt!==Q||ge!==0&&rt.nodeType!==3||(oe=qe+ge),rt.nodeType===3&&(qe+=rt.nodeValue.length),(te=rt.firstChild)!==null;)me=rt,rt=te;for(;;){if(rt===B)break t;if(me===a&&++ze===k&&(_e=qe),me===Q&&++it===ge&&(oe=qe),(te=rt.nextSibling)!==null)break;rt=me,me=rt.parentNode}rt=te}a=_e===-1||oe===-1?null:{start:_e,end:oe}}else a=null;a=a||{start:0,end:0}}else a=null;Hm={focusedElem:B,selectionRange:a},Nd=!1,Wu=null,bp=!1,tt=v;do try{gT()}catch(ot){if(tt===null)throw Error(He(330));ys(tt,ot),tt=tt.nextEffect}while(tt!==null);Wu=null,tt=v;do try{for(B=o;tt!==null;){var ue=tt.flags;if(ue&16&&cu(tt.stateNode,""),ue&128){var ke=tt.alternate;if(ke!==null){var Pe=ke.ref;Pe!==null&&(typeof Pe=="function"?Pe(null):Pe.current=null)}}switch(ue&1038){case 2:jv(tt),tt.flags&=-3;break;case 6:jv(tt),tt.flags&=-3,k_(tt.alternate,tt);break;case 1024:tt.flags&=-1025;break;case 1028:tt.flags&=-1025,k_(tt.alternate,tt);break;case 4:k_(tt.alternate,tt);break;case 8:a=tt,$v(B,a);var at=a.alternate;Nv(a),at!==null&&Nv(at)}tt=tt.nextEffect}}catch(ot){if(tt===null)throw Error(He(330));ys(tt,ot),tt=tt.nextEffect}while(tt!==null);if(Pe=Hm,ke=bx(),ue=Pe.focusedElem,B=Pe.selectionRange,ke!==ue&&ue&&ue.ownerDocument&&wx(ue.ownerDocument.documentElement,ue)){for(B!==null&&Gm(ue)&&(ke=B.start,Pe=B.end,Pe===void 0&&(Pe=ke),"selectionStart"in ue?(ue.selectionStart=ke,ue.selectionEnd=Math.min(Pe,ue.value.length)):(Pe=(ke=ue.ownerDocument||document)&&ke.defaultView||window,Pe.getSelection&&(Pe=Pe.getSelection(),a=ue.textContent.length,at=Math.min(B.start,a),B=B.end===void 0?at:Math.min(B.end,a),!Pe.extend&&at>B&&(a=B,B=at,at=a),a=vx(ue,at),k=vx(ue,B),a&&k&&(Pe.rangeCount!==1||Pe.anchorNode!==a.node||Pe.anchorOffset!==a.offset||Pe.focusNode!==k.node||Pe.focusOffset!==k.offset)&&(ke=ke.createRange(),ke.setStart(a.node,a.offset),Pe.removeAllRanges(),at>B?(Pe.addRange(ke),Pe.extend(k.node,k.offset)):(ke.setEnd(k.node,k.offset),Pe.addRange(ke)))))),ke=[],Pe=ue;Pe=Pe.parentNode;)Pe.nodeType===1&&ke.push({element:Pe,left:Pe.scrollLeft,top:Pe.scrollTop});for(typeof ue.focus=="function"&&ue.focus(),ue=0;ue<ke.length;ue++)Pe=ke[ue],Pe.element.scrollLeft=Pe.left,Pe.element.scrollTop=Pe.top}Nd=!!Xm,Hm=Xm=null,o.current=f,tt=v;do try{for(ue=o;tt!==null;){var Xe=tt.flags;if(Xe&36&&uT(ue,tt.alternate,tt),Xe&128){ke=void 0;var Ye=tt.ref;if(Ye!==null){var dt=tt.stateNode;switch(tt.tag){case 5:ke=dt;break;default:ke=dt}typeof Ye=="function"?Ye(ke):Ye.current=ke}}tt=tt.nextEffect}}catch(ot){if(tt===null)throw Error(He(330));ys(tt,ot),tt=tt.nextEffect}while(tt!==null);tt=null,J2(),yt=E}else o.current=f;if(fs)fs=!1,Gu=o,Zu=l;else for(tt=v;tt!==null;)l=tt.nextEffect,tt.nextEffect=null,tt.flags&8&&(Xe=tt,Xe.sibling=null,Xe.stateNode=null),tt=l;if(v=o.pendingLanes,v===0&&(Ur=null),v===1?o===N_?qu++:(qu=0,N_=o):qu=0,f=f.stateNode,la&&typeof la.onCommitFiberRoot=="function")try{la.onCommitFiberRoot(e_,f,void 0,(f.current.flags&64)==64)}catch{}if(er(o,tn()),xp)throw xp=!1,o=F_,F_=null,o;return(yt&8)!=0||Rr(),null}function gT(){for(;tt!==null;){var o=tt.alternate;bp||Wu===null||((tt.flags&8)!=0?j0(tt,Wu)&&(bp=!0):tt.tag===13&&hT(o,tt)&&j0(tt,Wu)&&(bp=!0));var l=tt.flags;(l&256)!=0&&cT(o,tt),(l&512)==0||fs||(fs=!0,ku(97,function(){return gs(),null})),tt=tt.nextEffect}}function gs(){if(Zu!==90){var o=97<Zu?97:Zu;return Zu=90,ca(o,xT)}return!1}function yT(o,l){O_.push(l,o),fs||(fs=!0,ku(97,function(){return gs(),null}))}function Jv(o,l){U_.push(l,o),fs||(fs=!0,ku(97,function(){return gs(),null}))}function xT(){if(Gu===null)return!1;var o=Gu;if(Gu=null,(yt&48)!=0)throw Error(He(331));var l=yt;yt|=32;var f=U_;U_=[];for(var v=0;v<f.length;v+=2){var E=f[v],k=f[v+1],B=E.destroy;if(E.destroy=void 0,typeof B=="function")try{B()}catch(Q){if(k===null)throw Error(He(330));ys(k,Q)}}for(f=O_,O_=[],v=0;v<f.length;v+=2){E=f[v],k=f[v+1];try{var a=E.create;E.destroy=a()}catch(Q){if(k===null)throw Error(He(330));ys(k,Q)}}for(a=o.current.firstEffect;a!==null;)o=a.nextEffect,a.nextEffect=null,a.flags&8&&(a.sibling=null,a.stateNode=null),a=o;return yt=l,Rr(),!0}function Qv(o,l,f){l=C_(f,l),l=Rv(o,l,1),ds(o,l),l=jn(),o=Tp(o,1),o!==null&&(Ud(o,1,l),er(o,l))}function ys(o,l){if(o.tag===3)Qv(o,o,l);else for(var f=o.return;f!==null;){if(f.tag===3){Qv(f,o,l);break}else if(f.tag===1){var v=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(Ur===null||!Ur.has(v))){o=C_(l,o);var E=Bv(f,o,1);if(ds(f,E),E=jn(),f=Tp(f,1),f!==null)Ud(f,1,E),er(f,E);else if(typeof v.componentDidCatch=="function"&&(Ur===null||!Ur.has(v)))try{v.componentDidCatch(l,o)}catch{}break}}f=f.return}}function vT(o,l,f){var v=o.pingCache;v!==null&&v.delete(l),l=jn(),o.pingedLanes|=o.suspendedLanes&f,fn===o&&(rn&f)===f&&(Yi===4||Yi===3&&(rn&62914560)===rn&&500>tn()-R_?Kl(o,0):D_|=f),er(o,l)}function wT(o,l){var f=o.stateNode;f!==null&&f.delete(l),l=0,l===0&&(l=o.mode,(l&2)==0?l=1:(l&4)==0?l=jl()===99?1:2:(mo===0&&(mo=Wl),l=Pl(62914560&~mo),l===0&&(l=4194304))),f=jn(),o=Tp(o,l),o!==null&&(Ud(o,l,f),er(o,f))}var e1;e1=function(o,l,f){var v=l.lanes;if(o!==null)if(o.memoizedProps!==l.pendingProps||Sn.current)hr=!0;else if((f&v)!=0)hr=(o.flags&16384)!=0;else{switch(hr=!1,l.tag){case 3:Sv(l),p_();break;case 5:sv(l);break;case 1:Cn(l.type)&&Jd(l);break;case 4:u_(l,l.stateNode.containerInfo);break;case 10:v=l.memoizedProps.value;var E=l.type._context;wi(tp,E._currentValue),E._currentValue=v;break;case 13:if(l.memoizedState!==null)return(f&l.child.childLanes)!=0?Cv(o,l,f):(wi(bi,bi.current&1),l=po(o,l,f),l!==null?l.sibling:null);wi(bi,bi.current&1);break;case 19:if(v=(f&l.childLanes)!=0,(o.flags&64)!=0){if(v)return zv(o,l,f);l.flags|=64}if(E=l.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),wi(bi,bi.current),v)break;return null;case 23:case 24:return l.lanes=0,w_(o,l,f)}return po(o,l,f)}else hr=!1;switch(l.lanes=0,l.tag){case 2:if(v=l.type,o!==null&&(o.alternate=null,l.alternate=null,l.flags|=2),o=l.pendingProps,E=Vl(l,en.current),Gl(l,f),E=__(null,l,v,o,E,f),l.flags|=1,typeof E=="object"&&E!==null&&typeof E.render=="function"&&E.$$typeof===void 0){if(l.tag=1,l.memoizedState=null,l.updateQueue=null,Cn(v)){var k=!0;Jd(l)}else k=!1;l.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,l_(l);var B=v.getDerivedStateFromProps;typeof B=="function"&&rp(l,v,B,o),E.updater=op,l.stateNode=E,E._reactInternals=l,c_(l,v,o,f),l=T_(null,l,v,!0,k,f)}else l.tag=0,An(null,l,E,f),l=l.child;return l;case 16:E=l.elementType;e:{switch(o!==null&&(o.alternate=null,l.alternate=null,l.flags|=2),o=l.pendingProps,k=E._init,E=k(E._payload),l.type=E,k=l.tag=TT(E),o=ur(E,o),k){case 0:l=b_(null,l,E,o,f);break e;case 1:l=Ev(null,l,E,o,f);break e;case 11:l=vv(null,l,E,o,f);break e;case 14:l=wv(null,l,E,ur(E.type,o),v,f);break e}throw Error(He(306,E,""))}return l;case 0:return v=l.type,E=l.pendingProps,E=l.elementType===v?E:ur(v,E),b_(o,l,v,E,f);case 1:return v=l.type,E=l.pendingProps,E=l.elementType===v?E:ur(v,E),Ev(o,l,v,E,f);case 3:if(Sv(l),v=l.updateQueue,o===null||v===null)throw Error(He(282));if(v=l.pendingProps,E=l.memoizedState,E=E!==null?E.element:null,Kx(o,l),zu(l,v,null,f),v=l.memoizedState.element,v===E)p_(),l=po(o,l,f);else{if(E=l.stateNode,(k=E.hydrate)&&(ps=Fl(l.stateNode.containerInfo.firstChild),ho=l,k=Fr=!0),k){if(o=E.mutableSourceEagerHydrationData,o!=null)for(E=0;E<o.length;E+=2)k=o[E],k._workInProgressVersionPrimary=o[E+1],ql.push(k);for(f=ov(l,null,v,f),l.child=f;f;)f.flags=f.flags&-3|1024,f=f.sibling}else An(o,l,v,f),p_();l=l.child}return l;case 5:return sv(l),o===null&&d_(l),v=l.type,E=l.pendingProps,k=o!==null?o.memoizedProps:null,B=E.children,Ym(v,E)?B=null:k!==null&&Ym(v,k)&&(l.flags|=16),Tv(o,l),An(o,l,B,f),l.child;case 6:return o===null&&d_(l),null;case 13:return Cv(o,l,f);case 4:return u_(l,l.stateNode.containerInfo),v=l.pendingProps,o===null?l.child=lp(l,null,v,f):An(o,l,v,f),l.child;case 11:return v=l.type,E=l.pendingProps,E=l.elementType===v?E:ur(v,E),vv(o,l,v,E,f);case 7:return An(o,l,l.pendingProps,f),l.child;case 8:return An(o,l,l.pendingProps.children,f),l.child;case 12:return An(o,l,l.pendingProps.children,f),l.child;case 10:e:{v=l.type._context,E=l.pendingProps,B=l.memoizedProps,k=E.value;var a=l.type._context;if(wi(tp,a._currentValue),a._currentValue=k,B!==null)if(a=B.value,k=Kn(a,k)?0:(typeof v._calculateChangedBits=="function"?v._calculateChangedBits(a,k):1073741823)|0,k===0){if(B.children===E.children&&!Sn.current){l=po(o,l,f);break e}}else for(a=l.child,a!==null&&(a.return=l);a!==null;){var Q=a.dependencies;if(Q!==null){B=a.child;for(var ge=Q.firstContext;ge!==null;){if(ge.context===v&&(ge.observedBits&k)!=0){a.tag===1&&(ge=hs(-1,f&-f),ge.tag=2,ds(a,ge)),a.lanes|=f,ge=a.alternate,ge!==null&&(ge.lanes|=f),Yx(a.return,f),Q.lanes|=f;break}ge=ge.next}}else B=a.tag===10&&a.type===l.type?null:a.child;if(B!==null)B.return=a;else for(B=a;B!==null;){if(B===l){B=null;break}if(a=B.sibling,a!==null){a.return=B.return,B=a;break}B=B.return}a=B}An(o,l,E.children,f),l=l.child}return l;case 9:return E=l.type,k=l.pendingProps,v=k.children,Gl(l,f),E=Jn(E,k.unstable_observedBits),v=v(E),l.flags|=1,An(o,l,v,f),l.child;case 14:return E=l.type,k=ur(E,l.pendingProps),k=ur(E.type,k),wv(o,l,E,k,v,f);case 15:return bv(o,l,l.type,l.pendingProps,v,f);case 17:return v=l.type,E=l.pendingProps,E=l.elementType===v?E:ur(v,E),o!==null&&(o.alternate=null,l.alternate=null,l.flags|=2),l.tag=1,Cn(v)?(o=!0,Jd(l)):o=!1,Gl(l,f),iv(l,v,E),c_(l,v,E,f),T_(null,l,v,!0,o,f);case 19:return zv(o,l,f);case 23:return w_(o,l,f);case 24:return w_(o,l,f)}throw Error(He(156,l.tag))};function bT(o,l,f,v){this.tag=o,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function tr(o,l,f,v){return new bT(o,l,f,v)}function $_(o){return o=o.prototype,!(!o||!o.isReactComponent)}function TT(o){if(typeof o=="function")return $_(o)?1:0;if(o!=null){if(o=o.$$typeof,o===Cd)return 11;if(o===Ad)return 14}return 2}function xs(o,l){var f=o.alternate;return f===null?(f=tr(o.tag,l,o.key,o.mode),f.elementType=o.elementType,f.type=o.type,f.stateNode=o.stateNode,f.alternate=o,o.alternate=f):(f.pendingProps=l,f.type=o.type,f.flags=0,f.nextEffect=null,f.firstEffect=null,f.lastEffect=null),f.childLanes=o.childLanes,f.lanes=o.lanes,f.child=o.child,f.memoizedProps=o.memoizedProps,f.memoizedState=o.memoizedState,f.updateQueue=o.updateQueue,l=o.dependencies,f.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},f.sibling=o.sibling,f.index=o.index,f.ref=o.ref,f}function Sp(o,l,f,v,E,k){var B=2;if(v=o,typeof o=="function")$_(o)&&(B=1);else if(typeof o=="string")B=5;else e:switch(o){case es:return Jl(f.children,E,k,l);case v0:B=8,E|=16;break;case Qf:B=8,E|=1;break;case ou:return o=tr(12,f,l,E|8),o.elementType=ou,o.type=ou,o.lanes=k,o;case su:return o=tr(13,f,l,E),o.type=su,o.elementType=su,o.lanes=k,o;case Id:return o=tr(19,f,l,E),o.elementType=Id,o.lanes=k,o;case om:return G_(f,E,k,l);case sm:return o=tr(24,f,l,E),o.elementType=sm,o.lanes=k,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case em:B=10;break e;case tm:B=9;break e;case Cd:B=11;break e;case Ad:B=14;break e;case im:B=16,v=null;break e;case nm:B=22;break e}throw Error(He(130,o==null?o:typeof o,""))}return l=tr(B,f,l,E),l.elementType=o,l.type=v,l.lanes=k,l}function Jl(o,l,f,v){return o=tr(7,o,v,l),o.lanes=f,o}function G_(o,l,f,v){return o=tr(23,o,v,l),o.elementType=om,o.lanes=f,o}function Z_(o,l,f){return o=tr(6,o,null,l),o.lanes=f,o}function q_(o,l,f){return l=tr(4,o.children!==null?o.children:[],o.key,l),l.lanes=f,l.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},l}function ET(o,l,f){this.tag=l,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=f,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Pm(0),this.expirationTimes=Pm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Pm(0),this.mutableSourceEagerHydrationData=null}function ST(o,l,f){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:na,key:v==null?null:""+v,children:o,containerInfo:l,implementation:f}}function Cp(o,l,f,v){var E=l.current,k=jn(),B=ms(E);e:if(f){f=f._reactInternals;t:{if(oa(f)!==f||f.tag!==1)throw Error(He(170));var a=f;do{switch(a.tag){case 3:a=a.stateNode.context;break t;case 1:if(Cn(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break t}}a=a.return}while(a!==null);throw Error(He(171))}if(f.tag===1){var Q=f.type;if(Cn(Q)){f=Nx(f,Q,a);break e}}f=a}else f=cs;return l.context===null?l.context=f:l.pendingContext=f,l=hs(k,B),l.payload={element:o},v=v===void 0?null:v,v!==null&&(l.callback=v),ds(E,l),_s(E,B,k),B}function W_(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function t1(o,l){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var f=o.retryLane;o.retryLane=f!==0&&f<l?f:l}}function X_(o,l){t1(o,l),(o=o.alternate)&&t1(o,l)}function CT(){return null}function H_(o,l,f){var v=f!=null&&f.hydrationOptions!=null&&f.hydrationOptions.mutableSources||null;if(f=new ET(o,l,f!=null&&f.hydrate===!0),l=tr(3,null,null,l===2?7:l===1?3:0),f.current=l,l.stateNode=f,l_(l),o[Ol]=f.current,Mx(o.nodeType===8?o.parentNode:o),v)for(o=0;o<v.length;o++){l=v[o];var E=l._getVersion;E=E(l._source),f.mutableSourceEagerHydrationData==null?f.mutableSourceEagerHydrationData=[l,E]:f.mutableSourceEagerHydrationData.push(l,E)}this._internalRoot=f}H_.prototype.render=function(o){Cp(o,this._internalRoot,null,null)};H_.prototype.unmount=function(){var o=this._internalRoot,l=o.containerInfo;Cp(null,o,null,function(){l[Ol]=null})};function Hu(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function IT(o,l){if(l||(l=o?o.nodeType===9?o.documentElement:o.firstChild:null,l=!(!l||l.nodeType!==1||!l.hasAttribute("data-reactroot"))),!l)for(var f;f=o.lastChild;)o.removeChild(f);return new H_(o,0,l?{hydrate:!0}:void 0)}function Ip(o,l,f,v,E){var k=f._reactRootContainer;if(k){var B=k._internalRoot;if(typeof E=="function"){var a=E;E=function(){var ge=W_(B);a.call(ge)}}Cp(l,B,o,E)}else{if(k=f._reactRootContainer=IT(f,v),B=k._internalRoot,typeof E=="function"){var Q=E;E=function(){var ge=W_(B);Q.call(ge)}}Wv(function(){Cp(l,B,o,E)})}return W_(B)}$0=function(o){if(o.tag===13){var l=jn();_s(o,4,l),X_(o,4)}};Cm=function(o){if(o.tag===13){var l=jn();_s(o,67108864,l),X_(o,67108864)}};G0=function(o){if(o.tag===13){var l=jn(),f=ms(o);_s(o,f,l),X_(o,f)}};Z0=function(o,l){return l()};xm=function(o,l,f){switch(l){case"input":if(um(o,f),l=f.name,f.type==="radio"&&l!=null){for(f=o;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<f.length;l++){var v=f[l];if(v!==o&&v.form===o.form){var E=Yd(v);if(!E)throw Error(He(90));T0(v),um(v,E)}}}break;case"textarea":A0(o,f);break;case"select":l=f.value,l!=null&&Il(o,!!f.multiple,l,!1)}};vm=qv;F0=function(o,l,f,v,E){var k=yt;yt|=4;try{return ca(98,o.bind(null,l,f,v,E))}finally{yt=k,yt===0&&(Hl(),Rr())}};wm=function(){(yt&49)==0&&(pT(),gs())};O0=function(o,l){var f=yt;yt|=2;try{return o(l)}finally{yt=f,yt===0&&(Hl(),Rr())}};function i1(o,l){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Hu(l))throw Error(He(200));return ST(o,l,null,f)}var AT={Events:[Mu,Ul,Yd,R0,B0,gs,{current:!1}]},Yu={findFiberByHostInstance:sa,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},MT={bundleType:Yu.bundleType,version:Yu.version,rendererPackageName:Yu.rendererPackageName,rendererConfig:Yu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ia.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=V0(o),o===null?null:o.stateNode},findFiberByHostInstance:Yu.findFiberByHostInstance||CT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var Ap=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ap.isDisabled&&Ap.supportsFiber)try{e_=Ap.inject(MT),la=Ap}catch{}}Yn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=AT;Yn.createPortal=i1;Yn.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var l=o._reactInternals;if(l===void 0)throw typeof o.render=="function"?Error(He(188)):Error(He(268,Object.keys(o)));return o=V0(l),o=o===null?null:o.stateNode,o};Yn.flushSync=function(o,l){var f=yt;if((f&48)!=0)return o(l);yt|=1;try{if(o)return ca(99,o.bind(null,l))}finally{yt=f,Rr()}};Yn.hydrate=function(o,l,f){if(!Hu(l))throw Error(He(200));return Ip(null,o,l,!0,f)};Yn.render=function(o,l,f){if(!Hu(l))throw Error(He(200));return Ip(null,o,l,!1,f)};Yn.unmountComponentAtNode=function(o){if(!Hu(o))throw Error(He(40));return o._reactRootContainer?(Wv(function(){Ip(null,null,o,!1,function(){o._reactRootContainer=null,o[Ol]=null})}),!0):!1};Yn.unstable_batchedUpdates=qv;Yn.unstable_createPortal=function(o,l){return i1(o,l,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};Yn.unstable_renderSubtreeIntoContainer=function(o,l,f,v){if(!Hu(f))throw Error(He(200));if(o==null||o._reactInternals===void 0)throw Error(He(38));return Ip(o,l,f,!1,v)};Yn.version="17.0.2";function n1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n1)}catch(o){console.error(o)}}n1(),p0.exports=Yn;var BT=p0.exports,r1={exports:{}};(function(o,l){(function(f,v){o.exports=v()})(Cb,function(){var f,v,E;function k(a,Q){if(!f)f=Q;else if(!v)v=Q;else{var ge="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+f+")(sharedChunk); ("+v+")(sharedChunk); self.onerror = null;",qe={};f(qe),E=Q(qe),typeof window!="undefined"&&(E.workerUrl=window.URL.createObjectURL(new Blob([ge],{type:"text/javascript"})))}}k(["exports"],function(a){var Q="2.6.1",ge=qe;function qe(i,e,n,r){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=r,this.p2x=n,this.p2y=r}qe.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},qe.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},qe.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},qe.prototype.solveCurveX=function(i,e){var n,r,c,h,p;for(e===void 0&&(e=1e-6),c=i,p=0;p<8;p++){if(h=this.sampleCurveX(c)-i,Math.abs(h)<e)return c;var g=this.sampleCurveDerivativeX(c);if(Math.abs(g)<1e-6)break;c-=h/g}if((c=i)<(n=0))return n;if(c>(r=1))return r;for(;n<r;){if(h=this.sampleCurveX(c),Math.abs(h-i)<e)return c;i>h?n=c:r=c,c=.5*(r-n)+n}return c},qe.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var _e=oe;function oe(i,e){this.x=i,this.y=e}oe.prototype={clone:function(){return new oe(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},_rotateAround:function(i,e){var n=Math.cos(i),r=Math.sin(i),c=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-r*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},oe.convert=function(i){return i instanceof oe?i:Array.isArray(i)?new oe(i[0],i[1]):i};var ze=typeof self!="undefined"?self:{};const it=Math.pow(2,53)-1,rt=Math.PI/180,me=180/Math.PI;function te(i){return i*rt}function ue(i){return i*me}const ke=[[0,0],[1,0],[1,1],[0,1]];function Pe(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function at(i,e,n,r){const c=new ge(i,e,n,r);return function(h){return c.solve(h)}}const Xe=at(.25,.1,.25,1);function Ye(i,e,n){return Math.min(n,Math.max(e,i))}function dt(i,e,n){const r=n-e,c=((i-e)%r+r)%r+e;return c===e?n:c}function ot(i,e,n){if(!i.length)return n(null,[]);let r=i.length;const c=new Array(i.length);let h=null;i.forEach((p,g)=>{e(p,(y,w)=>{y&&(h=y),c[g]=w,--r==0&&n(h,c)})})}function Qt(i){const e=[];for(const n in i)e.push(i[n]);return e}function Yt(i,...e){for(const n of e)for(const r in n)i[r]=n[r];return i}let Di=1;function ei(){return Di++}function $n(){return function i(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function on(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Mn(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function kn(i,e){i.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function zn(i,e){return i.indexOf(e,i.length-e.length)!==-1}function sn(i,e,n){const r={};for(const c in i)r[c]=e.call(n||this,i[c],c,i);return r}function mn(i,e,n){const r={};for(const c in i)e.call(n||this,i[c],c,i)&&(r[c]=i[c]);return r}function Ve(i){return Array.isArray(i)?i.map(Ve):typeof i=="object"&&i?sn(i,Ve):i}const ct={};function nt(i){ct[i]||(typeof console!="undefined"&&console.warn(i),ct[i]=!0)}function zt(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function oi(i){let e=0;for(let n,r,c=0,h=i.length,p=h-1;c<h;p=c++)n=i[c],r=i[p],e+=(r.x-n.x)*(n.y+r.y);return e}function Ti(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function $i(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,r,c,h)=>{const p=c||h;return e[r]=!p||p.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let _n,xt,_o,go=null;function vs(i){if(go==null){const e=i.navigator?i.navigator.userAgent:null;go=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return go}function Nr(i){try{const e=ze[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const an={now:()=>_o!==void 0?_o:ze.performance.now(),setNow(i){_o=i},restoreNow(){_o=void 0},frame(i){const e=ze.requestAnimationFrame(i);return{cancel:()=>ze.cancelAnimationFrame(e)}},getImageData(i,e=0){const n=ze.document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return n.width=i.width,n.height=i.height,r.drawImage(i,0,0,i.width,i.height),r.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(_n||(_n=ze.document.createElement("a")),_n.href=i,_n.href),get devicePixelRatio(){return ze.devicePixelRatio},get prefersReducedMotion(){return!!ze.matchMedia&&(xt==null&&(xt=ze.matchMedia("(prefers-reduced-motion: reduce)")),xt.matches)}};let yo;const Et={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(yo==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{yo={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{yo=i}}return yo},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Vr={supported:!1,testSupport:function(i){!ws&&Gn&&(pr?xo(i):dr=i)}};let dr,Gn,ws=!1,pr=!1;function xo(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Gn),i.isContextLost())return;Vr.supported=!0}catch{}i.deleteTexture(e),ws=!0}ze.document&&(Gn=ze.document.createElement("img"),Gn.onload=function(){dr&&xo(dr),dr=null,pr=!0},Gn.onerror=function(){ws=!0,dr=null},Gn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const vo="01",wo="NO_ACCESS_TOKEN";function gn(i){return i.indexOf("mapbox:")===0}function fr(i){return Et.API_URL_REGEX.test(i)}const ma=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yn(i){const e=i.match(ma);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Gi(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function _a(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(ze.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class bo{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=_a(Et.ACCESS_TOKEN);let r="";return r=n&&n.u?ze.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,h)=>String.fromCharCode(Number("0x"+h)))):Et.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${r}`:`mapbox.eventData:${r}`}fetchEventData(){const e=Nr("localStorage"),n=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const c=ze.localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));const h=ze.localStorage.getItem(r);h&&(this.anonId=h)}catch{nt("Unable to read from LocalStorage")}}saveEventData(){const e=Nr("localStorage"),n=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{ze.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&ze.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{nt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,r,c){if(!Et.EVENTS_URL)return;const h=yn(Et.EVENTS_URL);h.params.push(`access_token=${c||Et.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:Q,skuId:vo,userId:this.anonId},g=n?Yt(p,n):p,y={url:Gi(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=G(y,w=>{this.pendingRequest=null,r(w),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const bs=new class extends bo{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){Et.EVENTS_URL&&Et.ACCESS_TOKEN&&Array.isArray(i)&&i.some(n=>gn(n)||fr(n))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=_a(Et.ACCESS_TOKEN),n=e?e.u:Et.ACCESS_TOKEN;let r=n!==this.eventData.tokenU;Mn(this.anonId)||(this.anonId=$n(),r=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const h=new Date(this.eventData.lastSuccess),p=new Date(c),g=(c-this.eventData.lastSuccess)/864e5;r=r||g>=1||g<-1||h.getDate()!==p.getDate()}else r=!0;if(!r)return this.processRequests();this.postEvent(c,{"enabled.telemetry":!1},h=>{h||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},i)}},Ts=bs.postTurnstileEvent.bind(bs),To=new class extends bo{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,n,r){this.skuToken=e,this.errorCb=r,Et.EVENTS_URL&&(n||Et.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(wo)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Mn(this.anonId)||(this.anonId=$n()),this.postEvent(n,{skuToken:this.skuToken},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},i))}},Ql=To.postMapLoadEvent.bind(To),ga=new class extends bo{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,n,r){if(!Et.API_URL||!Et.SESSION_PATH)return;const c=yn(Et.API_URL+Et.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${r||Et.ACCESS_TOKEN||""}`);const h={url:Gi(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=H(h,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(r)})}getSessionAPI(i,e,n,r){this.skuToken=e,this.errorCb=r,Et.SESSION_PATH&&Et.API_URL&&(n||Et.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(wo)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},i)}},ya=ga.getSessionAPI.bind(ga),mr=new Set,Es="mapbox-tiles";let xn,jr,xa=500,$r=50;function ir(){ze.caches&&!xn&&(xn=ze.caches.open(Es))}function Eo(i){const e=i.indexOf("?");return e<0?i:i.slice(0,e)}let Ss=1/0;const Gr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Gr);class Zr extends Error{constructor(e,n,r){n===401&&fr(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const q=Ti()?()=>self.worker&&self.worker.referrer:()=>(ze.location.protocol==="blob:"?ze.parent:ze).location.href,P=function(i,e){if(!(/^file:/.test(n=i.url)||/^file:/.test(q())&&!/^\w+:/.test(n))){if(ze.fetch&&ze.Request&&ze.AbortController&&ze.Request.prototype.hasOwnProperty("signal"))return function(r,c){const h=new ze.AbortController,p=new ze.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:q(),signal:h.signal});let g=!1,y=!1;const w=(T=p.url).indexOf("sku=")>0&&fr(T);var T;r.type==="json"&&p.headers.set("Accept","application/json");const S=(D,L,O)=>{if(y)return;if(D&&D.message!=="SecurityError"&&nt(D),L&&O)return I(L);const Z=Date.now();ze.fetch(p).then(Y=>{if(Y.ok){const ee=w?Y.clone():null;return I(Y,ee,Z)}return c(new Zr(Y.statusText,Y.status,r.url))}).catch(Y=>{Y.code!==20&&c(new Error(Y.message))})},I=(D,L,O)=>{(r.type==="arrayBuffer"?D.arrayBuffer():r.type==="json"?D.json():D.text()).then(Z=>{y||(L&&O&&function(Y,ee,se){if(ir(),!xn)return;const ce={status:ee.status,statusText:ee.statusText,headers:new ze.Headers};ee.headers.forEach((he,Ce)=>ce.headers.set(Ce,he));const ae=$i(ee.headers.get("Cache-Control")||"");ae["no-store"]||(ae["max-age"]&&ce.headers.set("Expires",new Date(se+1e3*ae["max-age"]).toUTCString()),new Date(ce.headers.get("Expires")).getTime()-se<42e4||function(he,Ce){if(jr===void 0)try{new Response(new ReadableStream),jr=!0}catch{jr=!1}jr?Ce(he.body):he.blob().then(Ce)}(ee,he=>{const Ce=new ze.Response(he,ce);ir(),xn&&xn.then(we=>we.put(Eo(Y.url),Ce)).catch(we=>nt(we.message))}))}(p,L,O),g=!0,c(null,Z,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(Z=>{y||c(new Error(Z.message))})};return w?function(D,L){if(ir(),!xn)return L(null);const O=Eo(D.url);xn.then(Z=>{Z.match(O).then(Y=>{const ee=function(se){if(!se)return!1;const ce=new Date(se.headers.get("Expires")||0),ae=$i(se.headers.get("Cache-Control")||"");return ce>Date.now()&&!ae["no-cache"]}(Y);Z.delete(O),ee&&Z.put(O,Y.clone()),L(null,Y,ee)}).catch(L)}).catch(L)}(p,S):S(null,null),{cancel:()=>{y=!0,g||h.abort()}}}(i,e);if(Ti()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(r,c){const h=new ze.XMLHttpRequest;h.open(r.method||"GET",r.url,!0),r.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const p in r.headers)h.setRequestHeader(p,r.headers[p]);return r.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=r.credentials==="include",h.onerror=()=>{c(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let p=h.response;if(r.type==="json")try{p=JSON.parse(h.response)}catch(g){return c(g)}c(null,p,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else c(new Zr(h.statusText,h.status,r.url))},h.send(r.body),{cancel:()=>h.abort()}}(i,e)},R=function(i,e){return P(Yt(i,{type:"arrayBuffer"}),e)},G=function(i,e){return P(Yt(i,{method:"POST"}),e)},H=function(i,e){return P(Yt(i,{method:"GET"}),e)};function ie(i){const e=ze.document.createElement("a");return e.href=i,e.protocol===ze.document.location.protocol&&e.host===ze.document.location.host}const pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let de,re;de=[],re=0;const fe=function(i,e){if(Vr.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),re>=Et.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return de.push(h),h}re++;let n=!1;const r=()=>{if(!n)for(n=!0,re--;de.length&&re<Et.MAX_PARALLEL_IMAGE_REQUESTS;){const h=de.shift(),{requestParameters:p,callback:g,cancelled:y}=h;y||(h.cancel=fe(p,g).cancel)}},c=R(i,(h,p,g,y)=>{r(),h?e(h):p&&(ze.createImageBitmap?function(w,T){const S=new ze.Blob([new Uint8Array(w)],{type:"image/png"});ze.createImageBitmap(S).then(I=>{T(null,I)}).catch(I=>{T(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(w,T)=>e(w,T,g,y)):function(w,T){const S=new ze.Image,I=ze.URL;S.onload=()=>{T(null,S),I.revokeObjectURL(S.src),S.onload=null,ze.requestAnimationFrame(()=>{S.src=pe})},S.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new ze.Blob([new Uint8Array(w)],{type:"image/png"});S.src=w.byteLength?I.createObjectURL(D):pe}(p,(w,T)=>e(w,T,g,y)))});return{cancel:()=>{c.cancel(),r()}}};function Ae(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function je(i,e,n){if(n&&n[i]){const r=n[i].indexOf(e);r!==-1&&n[i].splice(r,1)}}class De{constructor(e,n={}){Yt(this,n),this.type=e}}class et extends De{constructor(e,n={}){super("error",Yt({error:e},n))}}class Ne{on(e,n){return this._listeners=this._listeners||{},Ae(e,n,this._listeners),this}off(e,n){return je(e,n,this._listeners),je(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Ae(e,n,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,n){typeof e=="string"&&(e=new De(e,n||{}));const r=e.type;if(this.listens(r)){e.target=this;const c=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const g of c)g.call(this,e);const h=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const g of h)je(r,g,this._oneTimeListeners),g.call(this,e);const p=this._eventedParent;p&&(Yt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof et&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var le=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class be{constructor(e,n,r,c){this.message=(e?`${e}: `:"")+r,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function Tt(i){const e=i.value;return e?[new be(i.key,e,"constants have been deprecated as of v8")]:[]}function Rt(i,...e){for(const n of e)for(const r in n)i[r]=n[r];return i}function mt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function St(i){if(Array.isArray(i))return i.map(St);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=St(i[n]);return e}return mt(i)}class Mt extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class qr{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[r,c]of n)this.bindings[r]=c}concat(e){return new qr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Zn={kind:"null"},$e={kind:"number"},bt={kind:"string"},vt={kind:"boolean"},ci={kind:"color"},Wr={kind:"object"},wt={kind:"value"},va={kind:"collator"},So={kind:"formatted"},Co={kind:"resolvedImage"};function ln(i,e){return{kind:"array",itemType:i,N:e}}function Kt(i){if(i.kind==="array"){const e=Kt(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Ju=[Zn,$e,bt,vt,ci,So,Wr,ln(wt),Co];function _r(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!_r(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of Ju)if(!_r(n,e))return null}}return`Expected ${Kt(i)} but found ${Kt(e)} instead.`}function ec(i,e){return e.some(n=>n.kind===i.kind)}function Pn(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function wa(i){var e={exports:{}};return i(e,e.exports),e.exports}var Dn=wa(function(i,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(g){return(g=Math.round(g))<0?0:g>255?255:g}function c(g){return r(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function h(g){return(y=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:y>1?1:y;var y}function p(g,y,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?g+(y-g)*w*6:2*w<1?y:3*w<2?g+(y-g)*(2/3-w)*6:g}try{e.parseCSSColor=function(g){var y,w=g.replace(/ /g,"").toLowerCase();if(w in n)return n[w].slice();if(w[0]==="#")return w.length===4?(y=parseInt(w.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:w.length===7&&(y=parseInt(w.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var T=w.indexOf("("),S=w.indexOf(")");if(T!==-1&&S+1===w.length){var I=w.substr(0,T),D=w.substr(T+1,S-(T+1)).split(","),L=1;switch(I){case"rgba":if(D.length!==4)return null;L=h(D.pop());case"rgb":return D.length!==3?null:[c(D[0]),c(D[1]),c(D[2]),L];case"hsla":if(D.length!==4)return null;L=h(D.pop());case"hsl":if(D.length!==3)return null;var O=(parseFloat(D[0])%360+360)%360/360,Z=h(D[1]),Y=h(D[2]),ee=Y<=.5?Y*(Z+1):Y+Z-Y*Z,se=2*Y-ee;return[r(255*p(se,ee,O+1/3)),r(255*p(se,ee,O)),r(255*p(se,ee,O-1/3)),L];default:return null}}return null}}catch{}});class kt{constructor(e,n,r,c=1){this.r=e,this.g=n,this.b=r,this.a=c}static parse(e){if(!e)return;if(e instanceof kt)return e;if(typeof e!="string")return;const n=Dn.parseCSSColor(e);return n?new kt(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,r,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(r)},${c})`}toArray(){const{r:e,g:n,b:r,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*r/c,c]}}kt.black=new kt(0,0,0,1),kt.white=new kt(1,1,1,1),kt.transparent=new kt(0,0,0,0),kt.red=new kt(1,0,0,1),kt.blue=new kt(0,0,1,1);class ba{constructor(e,n,r){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xr{constructor(e,n,r,c,h){this.text=e,this.image=n,this.scale=r,this.fontStack=c,this.textColor=h}}class Li{constructor(e){this.sections=e}static fromString(e){return new Li([new Xr(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Li?e:Li.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const r={};n.fontStack&&(r["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(r["font-scale"]=n.scale),n.textColor&&(r["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(r)}return e}}class vn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new vn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Qu(i,e,n,r){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?r===void 0||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[i,e,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[i,e,n,r]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ta(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof kt||i instanceof ba||i instanceof Li||i instanceof vn)return!0;if(Array.isArray(i)){for(const e of i)if(!Ta(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Ta(i[e]))return!1;return!0}return!1}function ui(i){if(i===null)return Zn;if(typeof i=="string")return bt;if(typeof i=="boolean")return vt;if(typeof i=="number")return $e;if(i instanceof kt)return ci;if(i instanceof ba)return va;if(i instanceof Li)return So;if(i instanceof vn)return Co;if(Array.isArray(i)){const e=i.length;let n;for(const r of i){const c=ui(r);if(n){if(n===c)continue;n=wt;break}n=c}return ln(n||wt,e)}return Wr}function Hr(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof kt||i instanceof Li||i instanceof vn?i.toString():JSON.stringify(i)}class Yr{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ta(e[1]))return n.error("invalid value");const r=e[1];let c=ui(r);const h=n.expectedType;return c.kind!=="array"||c.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(c=h),new Yr(c,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof kt?["rgba"].concat(this.value.toArray()):this.value instanceof Li?this.value.serialize():this.value}}class pi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const tc={string:bt,number:$e,boolean:vt,object:Wr};class Ln{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let r,c=1;const h=e[0];if(h==="array"){let g,y;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in tc)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);g=tc[w],c++}else g=wt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],c++}r=ln(g,y)}else r=tc[h];const p=[];for(;c<e.length;c++){const g=n.parse(e[c],c,wt);if(!g)return null;p.push(g)}return new Ln(r,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const r=this.args[n].evaluate(e);if(!_r(this.type,ui(r)))return r;if(n===this.args.length-1)throw new pi(`Expected value to be of type ${Kt(this.type)}, but found ${Kt(ui(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){n.push(r.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(r=>r.serialize()))}}class Cs{constructor(e){this.type=So,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return n.error("First argument must be an image or text section.");const c=[];let h=!1;for(let p=1;p<=e.length-1;++p){const g=e[p];if(h&&typeof g=="object"&&!Array.isArray(g)){h=!1;let y=null;if(g["font-scale"]&&(y=n.parse(g["font-scale"],1,$e),!y))return null;let w=null;if(g["text-font"]&&(w=n.parse(g["text-font"],1,ln(bt)),!w))return null;let T=null;if(g["text-color"]&&(T=n.parse(g["text-color"],1,ci),!T))return null;const S=c[c.length-1];S.scale=y,S.font=w,S.textColor=T}else{const y=n.parse(e[p],1,wt);if(!y)return null;const w=y.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,c.push({content:y,scale:null,font:null,textColor:null})}}return new Cs(c)}evaluate(e){return new Li(this.sections.map(n=>{const r=n.content.evaluate(e);return ui(r)===Co?new Xr("",r,null,null,null):new Xr(Hr(r),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const r={};n.scale&&(r["font-scale"]=n.scale.serialize()),n.font&&(r["text-font"]=n.font.serialize()),n.textColor&&(r["text-color"]=n.textColor.serialize()),e.push(r)}return e}}class Ea{constructor(e){this.type=Co,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const r=n.parse(e[1],1,bt);return r?new Ea(r):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),r=vn.fromString(n);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(n)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Mp={"to-boolean":vt,"to-color":ci,"to-number":$e,"to-string":bt};class gr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return n.error("Expected one argument.");const c=Mp[r],h=[];for(let p=1;p<e.length;p++){const g=n.parse(e[p],p,wt);if(!g)return null;h.push(g)}return new gr(c,h)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let n,r;for(const c of this.args){if(n=c.evaluate(e),r=null,n instanceof kt)return n;if(typeof n=="string"){const h=e.parseColor(n);if(h)return h}else if(Array.isArray(n)&&(r=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Qu(n[0],n[1],n[2],n[3]),!r))return new kt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new pi(r||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const r of this.args){if(n=r.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new pi(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Li.fromString(Hr(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?vn.fromString(Hr(this.args[0].evaluate(e))):Hr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Cs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ea(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const kp=["Unknown","Point","LineString","Polygon"];class ic{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?kp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:r,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*n-e[0])+this.featureDistanceData.bearing[1]*(c*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=kt.parse(e)),n}}class Ri{constructor(e,n,r,c){this.name=e,this.type=n,this._evaluate=r,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const r=e[0],c=Ri.definitions[r];if(!c)return n.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,g=p.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let y=null;for(const[w,T]of g){y=new za(n.registry,n.path,null,n.scope);const S=[];let I=!1;for(let D=1;D<e.length;D++){const L=e[D],O=Array.isArray(w)?w[D-1]:w.type,Z=y.parse(L,1+S.length,O);if(!Z){I=!0;break}S.push(Z)}if(!I)if(Array.isArray(w)&&w.length!==S.length)y.error(`Expected ${w.length} arguments, but found ${S.length} instead.`);else{for(let D=0;D<S.length;D++){const L=Array.isArray(w)?w[D]:w.type,O=S[D];y.concat(D+1).checkSubtype(L,O.type)}if(y.errors.length===0)return new Ri(r,h,T,S)}}if(g.length===1)n.errors.push(...y.errors);else{const w=(g.length?g:p).map(([S])=>{return I=S,Array.isArray(I)?`(${I.map(Kt).join(", ")})`:`(${Kt(I.type)}...)`;var I}).join(" | "),T=[];for(let S=1;S<e.length;S++){const I=n.parse(e[S],1+T.length);if(!I)return null;T.push(Kt(I.type))}n.error(`Expected arguments of type ${w}, but found (${T.join(", ")}) instead.`)}return null}static register(e,n){Ri.definitions=n;for(const r in n)e[r]=Ri}}class Sa{constructor(e,n,r){this.type=va,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return n.error("Collator options argument must be an object.");const c=n.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,vt);if(!c)return null;const h=n.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,vt);if(!h)return null;let p=null;return r.locale&&(p=n.parse(r.locale,1,bt),!p)?null:new Sa(c,h,p)}evaluate(e){return new ba(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const yr=8192;function nc(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ca(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function zp(i,e){const n=(180+i[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*yr),Math.round(r*c*yr)]}function Pp(i,e,n){const r=i[0]-e[0],c=i[1]-e[1],h=i[0]-n[0],p=i[1]-n[1];return r*p-h*c==0&&r*h<=0&&c*p<=0}function Ia(i,e){let n=!1;for(let p=0,g=e.length;p<g;p++){const y=e[p];for(let w=0,T=y.length;w<T-1;w++){if(Pp(i,y[w],y[w+1]))return!1;(c=y[w])[1]>(r=i)[1]!=(h=y[w+1])[1]>r[1]&&r[0]<(h[0]-c[0])*(r[1]-c[1])/(h[1]-c[1])+c[0]&&(n=!n)}}var r,c,h;return n}function Aa(i,e){for(let n=0;n<e.length;n++)if(Ia(i,e[n]))return!0;return!1}function eh(i,e,n,r){const c=r[0]-n[0],h=r[1]-n[1],p=(i[0]-n[0])*h-c*(i[1]-n[1]),g=(e[0]-n[0])*h-c*(e[1]-n[1]);return p>0&&g<0||p<0&&g>0}function Dp(i,e,n){for(const w of n)for(let T=0;T<w.length-1;++T)if((g=[(p=w[T+1])[0]-(h=w[T])[0],p[1]-h[1]])[0]*(y=[(c=e)[0]-(r=i)[0],c[1]-r[1]])[1]-g[1]*y[0]!=0&&eh(r,c,h,p)&&eh(h,p,r,c))return!0;var r,c,h,p,g,y;return!1}function th(i,e){for(let n=0;n<i.length;++n)if(!Ia(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(Dp(i[n],i[n+1],e))return!1;return!0}function Lp(i,e){for(let n=0;n<e.length;n++)if(th(i,e[n]))return!0;return!1}function wn(i,e,n){const r=[];for(let c=0;c<i.length;c++){const h=[];for(let p=0;p<i[c].length;p++){const g=zp(i[c][p],n);nc(e,g),h.push(g)}r.push(h)}return r}function rc(i,e,n){const r=[];for(let c=0;c<i.length;c++){const h=wn(i[c],e,n);r.push(h)}return r}function oc(i,e,n,r){if(i[0]<n[0]||i[0]>n[2]){const c=.5*r;let h=i[0]-n[0]>c?-r:n[0]-i[0]>c?r:0;h===0&&(h=i[0]-n[2]>c?-r:n[2]-i[0]>c?r:0),i[0]+=h}nc(e,i)}function Is(i,e,n,r){const c=Math.pow(2,r.z)*yr,h=[r.x*yr,r.y*yr],p=[];for(const g of i)for(const y of g){const w=[y.x+h[0],y.y+h[1]];oc(w,e,n,c),p.push(w)}return p}function Io(i,e,n,r){const c=Math.pow(2,r.z)*yr,h=[r.x*yr,r.y*yr],p=[];for(const y of i){const w=[];for(const T of y){const S=[T.x+h[0],T.y+h[1]];nc(e,S),w.push(S)}p.push(w)}if(e[2]-e[0]<=c/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const y of p)for(const w of y)oc(w,e,n,c)}var g;return p}class xr{constructor(e,n){this.type=vt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ta(e[1])){const r=e[1];if(r.type==="FeatureCollection")for(let c=0;c<r.features.length;++c){const h=r.features[c].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new xr(r,r.features[c].geometry)}else if(r.type==="Feature"){const c=r.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new xr(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new xr(r,r)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,r){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(r.type==="Polygon"){const g=wn(r.coordinates,h,p),y=Is(n.geometry(),c,h,p);if(!Ca(c,h))return!1;for(const w of y)if(!Ia(w,g))return!1}if(r.type==="MultiPolygon"){const g=rc(r.coordinates,h,p),y=Is(n.geometry(),c,h,p);if(!Ca(c,h))return!1;for(const w of y)if(!Aa(w,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,r){const c=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(r.type==="Polygon"){const g=wn(r.coordinates,h,p),y=Io(n.geometry(),c,h,p);if(!Ca(c,h))return!1;for(const w of y)if(!th(w,g))return!1}if(r.type==="MultiPolygon"){const g=rc(r.coordinates,h,p),y=Io(n.geometry(),c,h,p);if(!Ca(c,h))return!1;for(const w of y)if(!Lp(w,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Ao(i){if(i instanceof Ri&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof xr)return!1;let e=!0;return i.eachChild(n=>{e&&!Ao(n)&&(e=!1)}),e}function Ma(i){if(i instanceof Ri&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!Ma(n)&&(e=!1)}),e}function Ct(i,e){if(i instanceof Ri&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(r=>{n&&!Ct(r,e)&&(n=!1)}),n}class ka{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const r=e[1];return n.scope.has(r)?new ka(r,n.scope.get(r)):n.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class za{constructor(e,n=[],r,c=new qr,h=[]){this.registry=e,this.path=n,this.key=n.map(p=>`[${p}]`).join(""),this.scope=c,this.errors=h,this.expectedType=r}parse(e,n,r,c,h={}){return n?this.concat(n,r,c)._parse(e,h):this._parse(e,h)}_parse(e,n){function r(c,h,p){return p==="assert"?new Ln(h,[c]):p==="coerce"?new gr(h,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[c];if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const g=this.expectedType,y=p.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||y.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(g,y))return null}else p=r(p,g,n.typeAnnotation||"coerce");else p=r(p,g,n.typeAnnotation||"assert")}if(!(p instanceof Yr)&&p.type.kind!=="resolvedImage"&&sc(p)){const g=new ic;try{p=new Yr(p.type,p.evaluate(g))}catch(y){return this.error(y.message),null}}return p}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,r){const c=typeof e=="number"?this.path.concat(e):this.path,h=r?this.scope.concat(r):this.scope;return new za(this.registry,c,n||null,h,this.errors)}error(e,...n){const r=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Mt(r,e))}checkSubtype(e,n){const r=_r(e,n);return r&&this.error(r),r}}function sc(i){if(i instanceof ka)return sc(i.boundExpression);if(i instanceof Ri&&i.name==="error"||i instanceof Sa||i instanceof xr)return!1;const e=i instanceof gr||i instanceof Ln;let n=!0;return i.eachChild(r=>{n=e?n&&sc(r):n&&r instanceof Yr}),!!n&&Ao(i)&&Ct(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function As(i,e){const n=i.length-1;let r,c,h=0,p=n,g=0;for(;h<=p;)if(g=Math.floor((h+p)/2),r=i[g],c=i[g+1],r<=e){if(g===n||e<c)return g;h=g+1}else{if(!(r>e))throw new pi("Input is not a number.");p=g-1}return 0}class Ms{constructor(e,n,r){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,h]of r)this.labels.push(c),this.outputs.push(h)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const r=n.parse(e[1],1,$e);if(!r)return null;const c=[];let h=null;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);for(let p=1;p<e.length;p+=2){const g=p===1?-1/0:e[p],y=e[p+1],w=p,T=p+1;if(typeof g!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=g)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const S=n.parse(y,T,h);if(!S)return null;h=h||S.type,c.push([g,S])}return new Ms(h,r,c)}evaluate(e){const n=this.labels,r=this.outputs;if(n.length===1)return r[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return r[0].evaluate(e);const h=n.length;return c>=n[h-1]?r[h-1].evaluate(e):r[As(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}function Pt(i,e,n){return i*(1-n)+e*n}var ks=Object.freeze({__proto__:null,number:Pt,color:function(i,e,n){return new kt(Pt(i.r,e.r,n),Pt(i.g,e.g,n),Pt(i.b,e.b,n),Pt(i.a,e.a,n))},array:function(i,e,n){return i.map((r,c)=>Pt(r,e[c],n))}});const Pa=.95047,ac=1.08883,ih=4/29,zs=6/29,lc=3*zs*zs,Rp=Math.PI/180,nh=180/Math.PI;function cc(i){return i>.008856451679035631?Math.pow(i,1/3):i/lc+ih}function Da(i){return i>zs?i*i*i:lc*(i-ih)}function La(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Ra(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function uc(i){const e=Ra(i.r),n=Ra(i.g),r=Ra(i.b),c=cc((.4124564*e+.3575761*n+.1804375*r)/Pa),h=cc((.2126729*e+.7151522*n+.072175*r)/1);return{l:116*h-16,a:500*(c-h),b:200*(h-cc((.0193339*e+.119192*n+.9503041*r)/ac)),alpha:i.a}}function rh(i){let e=(i.l+16)/116,n=isNaN(i.a)?e:e+i.a/500,r=isNaN(i.b)?e:e-i.b/200;return e=1*Da(e),n=Pa*Da(n),r=ac*Da(r),new kt(La(3.2404542*n-1.5371385*e-.4985314*r),La(-.969266*n+1.8760108*e+.041556*r),La(.0556434*n-.2040259*e+1.0572252*r),i.alpha)}function oh(i,e,n){const r=e-i;return i+n*(r>180||r<-180?r-360*Math.round(r/360):r)}const Mo={forward:uc,reverse:rh,interpolate:function(i,e,n){return{l:Pt(i.l,e.l,n),a:Pt(i.a,e.a,n),b:Pt(i.b,e.b,n),alpha:Pt(i.alpha,e.alpha,n)}}},Ps={forward:function(i){const{l:e,a:n,b:r}=uc(i),c=Math.atan2(r,n)*nh;return{h:c<0?c+360:c,c:Math.sqrt(n*n+r*r),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Rp,n=i.c;return rh({l:i.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:i.alpha})},interpolate:function(i,e,n){return{h:oh(i.h,e.h,n),c:Pt(i.c,e.c,n),l:Pt(i.l,e.l,n),alpha:Pt(i.alpha,e.alpha,n)}}};var sh=Object.freeze({__proto__:null,lab:Mo,hcl:Ps});class cn{constructor(e,n,r,c,h){this.type=e,this.operator=n,this.interpolation=r,this.input=c,this.labels=[],this.outputs=[];for(const[p,g]of h)this.labels.push(p),this.outputs.push(g)}static interpolationFactor(e,n,r,c){let h=0;if(e.name==="exponential")h=hc(n,e.base,r,c);else if(e.name==="linear")h=hc(n,1,r,c);else if(e.name==="cubic-bezier"){const p=e.controlPoints;h=new ge(p[0],p[1],p[2],p[3]).solve(hc(n,1,r,c))}return h}static parse(e,n){let[r,c,h,...p]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const w=c[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const w=c.slice(1);if(w.length!==4||w.some(T=>typeof T!="number"||T<0||T>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(h=n.parse(h,2,$e),!h)return null;const g=[];let y=null;r==="interpolate-hcl"||r==="interpolate-lab"?y=ci:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let w=0;w<p.length;w+=2){const T=p[w],S=p[w+1],I=w+3,D=w+4;if(typeof T!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(g.length&&g[g.length-1][0]>=T)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const L=n.parse(S,D,y);if(!L)return null;y=y||L.type,g.push([T,L])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new cn(y,r,c,h,g):n.error(`Type ${Kt(y)} is not interpolatable.`)}evaluate(e){const n=this.labels,r=this.outputs;if(n.length===1)return r[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return r[0].evaluate(e);const h=n.length;if(c>=n[h-1])return r[h-1].evaluate(e);const p=As(n,c),g=cn.interpolationFactor(this.interpolation,c,n[p],n[p+1]),y=r[p].evaluate(e),w=r[p+1].evaluate(e);return this.operator==="interpolate"?ks[this.type.kind.toLowerCase()](y,w,g):this.operator==="interpolate-hcl"?Ps.reverse(Ps.interpolate(Ps.forward(y),Ps.forward(w),g)):Mo.reverse(Mo.interpolate(Mo.forward(y),Mo.forward(w),g))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)n.push(this.labels[r],this.outputs[r].serialize());return n}}function hc(i,e,n,r){const c=r-n,h=i-n;return c===0?0:e===1?h/c:(Math.pow(e,h)-1)/(Math.pow(e,c)-1)}class Ba{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let r=null;const c=n.expectedType;c&&c.kind!=="value"&&(r=c);const h=[];for(const g of e.slice(1)){const y=n.parse(g,1+h.length,r,void 0,{typeAnnotation:"omit"});if(!y)return null;r=r||y.type,h.push(y)}const p=c&&h.some(g=>_r(c,g.type));return new Ba(p?wt:r,h)}evaluate(e){let n,r=null,c=0;for(const h of this.args)if(c++,r=h.evaluate(e),r&&r instanceof vn&&!r.available&&(n||(n=r.name),r=null,c===this.args.length&&(r=n)),r!==null)break;return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Ds{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let h=1;h<e.length-1;h+=2){const p=e[h];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",h);const g=n.parse(e[h+1],h+1);if(!g)return null;r.push([p,g])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,r);return c?new Ds(r,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,r]of this.bindings)e.push(n,r.serialize());return e.push(this.result.serialize()),e}}class dc{constructor(e,n,r){this.type=e,this.index=n,this.input=r}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,$e),c=n.parse(e[2],2,ln(n.expectedType||wt));return r&&c?new dc(c.type.itemType,r,c):null}evaluate(e){const n=this.index.evaluate(e),r=this.input.evaluate(e);if(n<0)throw new pi(`Array index out of bounds: ${n} < 0.`);if(n>=r.length)throw new pi(`Array index out of bounds: ${n} > ${r.length-1}.`);if(n!==Math.floor(n))throw new pi(`Array index must be an integer, but found ${n} instead.`);return r[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class pc{constructor(e,n){this.type=vt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,wt),c=n.parse(e[2],2,wt);return r&&c?ec(r.type,[vt,bt,$e,Zn,wt])?new pc(r,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(r.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Pn(n,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(ui(n))} instead.`);if(!Pn(r,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${Kt(ui(r))} instead.`);return r.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Fa{constructor(e,n,r){this.type=$e,this.needle=e,this.haystack=n,this.fromIndex=r}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,wt),c=n.parse(e[2],2,wt);if(!r||!c)return null;if(!ec(r.type,[vt,bt,$e,Zn,wt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(r.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,$e);return h?new Fa(r,c,h):null}return new Fa(r,c)}evaluate(e){const n=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Pn(n,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(ui(n))} instead.`);if(!Pn(r,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${Kt(ui(r))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return r.indexOf(n,c)}return r.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Oa{constructor(e,n,r,c,h,p){this.inputType=e,this.type=n,this.input=r,this.cases=c,this.outputs=h,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let r,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const h={},p=[];for(let w=2;w<e.length-1;w+=2){let T=e[w];const S=e[w+1];Array.isArray(T)||(T=[T]);const I=n.concat(w);if(T.length===0)return I.error("Expected at least one branch label.");for(const L of T){if(typeof L!="number"&&typeof L!="string")return I.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return I.error("Numeric branch labels must be integer values.");if(r){if(I.checkSubtype(r,ui(L)))return null}else r=ui(L);if(h[String(L)]!==void 0)return I.error("Branch labels must be unique.");h[String(L)]=p.length}const D=n.parse(S,w,c);if(!D)return null;c=c||D.type,p.push(D)}const g=n.parse(e[1],1,wt);if(!g)return null;const y=n.parse(e[e.length-1],e.length-1,c);return y?g.type.kind!=="value"&&n.concat(1).checkSubtype(r,g.type)?null:new Oa(r,c,g,h,p,y):null}evaluate(e){const n=this.input.evaluate(e);return(ui(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),r=[],c={};for(const p of n){const g=c[this.cases[p]];g===void 0?(c[this.cases[p]]=r.length,r.push([this.cases[p],[p]])):r[g][1].push(p)}const h=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,g]of r)e.push(g.length===1?h(g[0]):g.map(h)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class Ua{constructor(e,n,r){this.type=e,this.branches=n,this.otherwise=r}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let r;n.expectedType&&n.expectedType.kind!=="value"&&(r=n.expectedType);const c=[];for(let p=1;p<e.length-1;p+=2){const g=n.parse(e[p],p,vt);if(!g)return null;const y=n.parse(e[p+1],p+1,r);if(!y)return null;c.push([g,y]),r=r||y.type}const h=n.parse(e[e.length-1],e.length-1,r);return h?new Ua(r,c,h):null}evaluate(e){for(const[n,r]of this.branches)if(n.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,r]of this.branches)e(n),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Na{constructor(e,n,r,c){this.type=e,this.input=n,this.beginIndex=r,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=n.parse(e[1],1,wt),c=n.parse(e[2],2,$e);if(!r||!c)return null;if(!ec(r.type,[ln(wt),bt,wt]))return n.error(`Expected first argument to be of type array or string, but found ${Kt(r.type)} instead`);if(e.length===4){const h=n.parse(e[3],3,$e);return h?new Na(r.type,r,c,h):null}return new Na(r.type,r,c)}evaluate(e){const n=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Pn(n,["string","array"]))throw new pi(`Expected first argument to be of type array or string, but found ${Kt(ui(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(r,c)}return n.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function fc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ah(i,e,n,r){return r.compare(e,n)===0}function ko(i,e,n){const r=i!=="=="&&i!=="!=";return class o1{constructor(h,p,g){this.type=vt,this.lhs=h,this.rhs=p,this.collator=g,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const g=h[0];let y=p.parse(h[1],1,wt);if(!y)return null;if(!fc(g,y.type))return p.concat(1).error(`"${g}" comparisons are not supported for type '${Kt(y.type)}'.`);let w=p.parse(h[2],2,wt);if(!w)return null;if(!fc(g,w.type))return p.concat(2).error(`"${g}" comparisons are not supported for type '${Kt(w.type)}'.`);if(y.type.kind!==w.type.kind&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${Kt(y.type)}' and '${Kt(w.type)}'.`);r&&(y.type.kind==="value"&&w.type.kind!=="value"?y=new Ln(w.type,[y]):y.type.kind!=="value"&&w.type.kind==="value"&&(w=new Ln(y.type,[w])));let T=null;if(h.length===4){if(y.type.kind!=="string"&&w.type.kind!=="string"&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(T=p.parse(h[3],3,va),!T)return null}return new o1(y,w,T)}evaluate(h){const p=this.lhs.evaluate(h),g=this.rhs.evaluate(h);if(r&&this.hasUntypedArgument){const y=ui(p),w=ui(g);if(y.kind!==w.kind||y.kind!=="string"&&y.kind!=="number")throw new pi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${w.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const y=ui(p),w=ui(g);if(y.kind!=="string"||w.kind!=="string")return e(h,p,g)}return this.collator?n(h,p,g,this.collator.evaluate(h)):e(h,p,g)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[i];return this.eachChild(p=>{h.push(p.serialize())}),h}}}const lh=ko("==",function(i,e,n){return e===n},ah),ch=ko("!=",function(i,e,n){return e!==n},function(i,e,n,r){return!ah(0,e,n,r)}),Bp=ko("<",function(i,e,n){return e<n},function(i,e,n,r){return r.compare(e,n)<0}),Fp=ko(">",function(i,e,n){return e>n},function(i,e,n,r){return r.compare(e,n)>0}),Op=ko("<=",function(i,e,n){return e<=n},function(i,e,n,r){return r.compare(e,n)<=0}),Up=ko(">=",function(i,e,n){return e>=n},function(i,e,n,r){return r.compare(e,n)>=0});class zo{constructor(e,n,r,c,h){this.type=bt,this.number=e,this.locale=n,this.currency=r,this.minFractionDigits=c,this.maxFractionDigits=h}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const r=n.parse(e[1],1,$e);if(!r)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let h=null;if(c.locale&&(h=n.parse(c.locale,1,bt),!h))return null;let p=null;if(c.currency&&(p=n.parse(c.currency,1,bt),!p))return null;let g=null;if(c["min-fraction-digits"]&&(g=n.parse(c["min-fraction-digits"],1,$e),!g))return null;let y=null;return c["max-fraction-digits"]&&(y=n.parse(c["max-fraction-digits"],1,$e),!y)?null:new zo(r,h,p,g,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Va{constructor(e){this.type=$e,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=n.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Kt(r.type)} instead.`):new Va(r):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new pi(`Expected value to be of type string or array, but found ${Kt(ui(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Kr={"==":lh,"!=":ch,">":Fp,"<":Bp,">=":Up,"<=":Op,array:Ln,at:dc,boolean:Ln,case:Ua,coalesce:Ba,collator:Sa,format:Cs,image:Ea,in:pc,"index-of":Fa,interpolate:cn,"interpolate-hcl":cn,"interpolate-lab":cn,length:Va,let:Ds,literal:Yr,match:Oa,number:Ln,"number-format":zo,object:Ln,slice:Na,step:Ms,string:Ln,"to-boolean":gr,"to-color":gr,"to-number":gr,"to-string":gr,var:ka,within:xr};function uh(i,[e,n,r,c]){e=e.evaluate(i),n=n.evaluate(i),r=r.evaluate(i);const h=c?c.evaluate(i):1,p=Qu(e,n,r,h);if(p)throw new pi(p);return new kt(e/255*h,n/255*h,r/255*h,h)}function hh(i,e){return i in e}function mc(i,e){const n=e[i];return n===void 0?null:n}function vr(i){return{type:i}}function _c(i){return{result:"success",value:i}}function Jr(i){return{result:"error",value:i}}function wr(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function dh(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function gc(i){return!!i.expression&&i.expression.interpolated}function Dt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ja(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Np(i){return i}function ph(i,e){const n=e.type==="color",r=i.stops&&typeof i.stops[0][0]=="object",c=r||!(r||i.property!==void 0),h=i.type||(gc(e)?"exponential":"interval");if(n&&((i=Rt({},i)).stops&&(i.stops=i.stops.map(w=>[w[0],kt.parse(w[1])])),i.default=kt.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!sh[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,g,y;if(h==="exponential")p=mh;else if(h==="interval")p=$a;else if(h==="categorical"){p=fh,g=Object.create(null);for(const w of i.stops)g[w[0]]=w[1];y=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);p=Vp}if(r){const w={},T=[];for(let D=0;D<i.stops.length;D++){const L=i.stops[D],O=L[0].zoom;w[O]===void 0&&(w[O]={zoom:O,type:i.type,property:i.property,default:i.default,stops:[]},T.push(O)),w[O].stops.push([L[0].value,L[1]])}const S=[];for(const D of T)S.push([w[D].zoom,ph(w[D],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:cn.interpolationFactor.bind(void 0,I),zoomStops:S.map(D=>D[0]),evaluate:({zoom:D},L)=>mh({stops:S,base:i.base},e,D).evaluate(D,L)}}if(c){const w=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:cn.interpolationFactor.bind(void 0,w),zoomStops:i.stops.map(T=>T[0]),evaluate:({zoom:T})=>p(i,e,T,g,y)}}return{kind:"source",evaluate(w,T){const S=T&&T.properties?T.properties[i.property]:void 0;return S===void 0?Po(i.default,e.default):p(i,e,S,g,y)}}}function Po(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function fh(i,e,n,r,c){return Po(typeof n===c?r[n]:void 0,i.default,e.default)}function $a(i,e,n){if(Dt(n)!=="number")return Po(i.default,e.default);const r=i.stops.length;if(r===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[r-1][0])return i.stops[r-1][1];const c=As(i.stops.map(h=>h[0]),n);return i.stops[c][1]}function mh(i,e,n){const r=i.base!==void 0?i.base:1;if(Dt(n)!=="number")return Po(i.default,e.default);const c=i.stops.length;if(c===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[c-1][0])return i.stops[c-1][1];const h=As(i.stops.map(T=>T[0]),n),p=function(T,S,I,D){const L=D-I,O=T-I;return L===0?0:S===1?O/L:(Math.pow(S,O)-1)/(Math.pow(S,L)-1)}(n,r,i.stops[h][0],i.stops[h+1][0]),g=i.stops[h][1],y=i.stops[h+1][1];let w=ks[e.type]||Np;if(i.colorSpace&&i.colorSpace!=="rgb"){const T=sh[i.colorSpace];w=(S,I)=>T.reverse(T.interpolate(T.forward(S),T.forward(I),p))}return typeof g.evaluate=="function"?{evaluate(...T){const S=g.evaluate.apply(void 0,T),I=y.evaluate.apply(void 0,T);if(S!==void 0&&I!==void 0)return w(S,I,p)}}:w(g,y,p)}function Vp(i,e,n){return e.type==="color"?n=kt.parse(n):e.type==="formatted"?n=Li.fromString(n.toString()):e.type==="resolvedImage"?n=vn.fromString(n.toString()):Dt(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Po(n,i.default,e.default)}Ri.register(Kr,{error:[{kind:"error"},[bt],(i,[e])=>{throw new pi(e.evaluate(i))}],typeof:[bt,[wt],(i,[e])=>Kt(ui(e.evaluate(i)))],"to-rgba":[ln($e,4),[ci],(i,[e])=>e.evaluate(i).toArray()],rgb:[ci,[$e,$e,$e],uh],rgba:[ci,[$e,$e,$e,$e],uh],has:{type:vt,overloads:[[[bt],(i,[e])=>hh(e.evaluate(i),i.properties())],[[bt,Wr],(i,[e,n])=>hh(e.evaluate(i),n.evaluate(i))]]},get:{type:wt,overloads:[[[bt],(i,[e])=>mc(e.evaluate(i),i.properties())],[[bt,Wr],(i,[e,n])=>mc(e.evaluate(i),n.evaluate(i))]]},"feature-state":[wt,[bt],(i,[e])=>mc(e.evaluate(i),i.featureState||{})],properties:[Wr,[],i=>i.properties()],"geometry-type":[bt,[],i=>i.geometryType()],id:[wt,[],i=>i.id()],zoom:[$e,[],i=>i.globals.zoom],pitch:[$e,[],i=>i.globals.pitch||0],"distance-from-center":[$e,[],i=>i.distanceFromCenter()],"heatmap-density":[$e,[],i=>i.globals.heatmapDensity||0],"line-progress":[$e,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[$e,[],i=>i.globals.skyRadialProgress||0],accumulated:[wt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[$e,vr($e),(i,e)=>{let n=0;for(const r of e)n+=r.evaluate(i);return n}],"*":[$e,vr($e),(i,e)=>{let n=1;for(const r of e)n*=r.evaluate(i);return n}],"-":{type:$e,overloads:[[[$e,$e],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[$e],(i,[e])=>-e.evaluate(i)]]},"/":[$e,[$e,$e],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[$e,[$e,$e],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[$e,[$e],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[$e,[$e],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[$e,[$e],(i,[e])=>Math.log(e.evaluate(i))],log2:[$e,[$e],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[$e,[$e],(i,[e])=>Math.sin(e.evaluate(i))],cos:[$e,[$e],(i,[e])=>Math.cos(e.evaluate(i))],tan:[$e,[$e],(i,[e])=>Math.tan(e.evaluate(i))],asin:[$e,[$e],(i,[e])=>Math.asin(e.evaluate(i))],acos:[$e,[$e],(i,[e])=>Math.acos(e.evaluate(i))],atan:[$e,[$e],(i,[e])=>Math.atan(e.evaluate(i))],min:[$e,vr($e),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[$e,vr($e),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[$e,[$e],(i,[e])=>Math.abs(e.evaluate(i))],round:[$e,[$e],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[$e,[$e],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[$e,[$e],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[vt,[bt,wt],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[vt,[wt],(i,[e])=>i.id()===e.value],"filter-type-==":[vt,[bt],(i,[e])=>i.geometryType()===e.value],"filter-<":[vt,[bt,wt],(i,[e,n])=>{const r=i.properties()[e.value],c=n.value;return typeof r==typeof c&&r<c}],"filter-id-<":[vt,[wt],(i,[e])=>{const n=i.id(),r=e.value;return typeof n==typeof r&&n<r}],"filter->":[vt,[bt,wt],(i,[e,n])=>{const r=i.properties()[e.value],c=n.value;return typeof r==typeof c&&r>c}],"filter-id->":[vt,[wt],(i,[e])=>{const n=i.id(),r=e.value;return typeof n==typeof r&&n>r}],"filter-<=":[vt,[bt,wt],(i,[e,n])=>{const r=i.properties()[e.value],c=n.value;return typeof r==typeof c&&r<=c}],"filter-id-<=":[vt,[wt],(i,[e])=>{const n=i.id(),r=e.value;return typeof n==typeof r&&n<=r}],"filter->=":[vt,[bt,wt],(i,[e,n])=>{const r=i.properties()[e.value],c=n.value;return typeof r==typeof c&&r>=c}],"filter-id->=":[vt,[wt],(i,[e])=>{const n=i.id(),r=e.value;return typeof n==typeof r&&n>=r}],"filter-has":[vt,[wt],(i,[e])=>e.value in i.properties()],"filter-has-id":[vt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[vt,[ln(bt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[vt,[ln(wt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[vt,[bt,ln(wt)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[vt,[bt,ln(wt)],(i,[e,n])=>function(r,c,h,p){for(;h<=p;){const g=h+p>>1;if(c[g]===r)return!0;c[g]>r?p=g-1:h=g+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:vt,overloads:[[[vt,vt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[vr(vt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:vt,overloads:[[[vt,vt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[vr(vt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[vt,[vt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[vt,[bt],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[bt,[bt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[bt,[bt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[bt,vr(wt),(i,e)=>e.map(n=>Hr(n.evaluate(i))).join("")],"resolved-locale":[bt,[va],(i,[e])=>e.evaluate(i).resolvedLocale()]});class yc{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new ic,this._defaultValue=n?function(r){return r.type==="color"&&ja(r.default)?new kt(0,0,0,0):r.type==="color"?kt.parse(r.default)||null:r.default===void 0?null:r.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,r,c,h,p,g,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=r,this._evaluator.canonical=c,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,r,c,h,p,g,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=r||null,this._evaluator.canonical=c,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new pi(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console!="undefined"&&console.warn(w.message)),this._defaultValue}}}function Rn(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Kr}function Do(i,e){const n=new za(Kr,[],e?function(c){const h={color:ci,string:bt,number:$e,enum:bt,boolean:vt,formatted:So,resolvedImage:Co};return c.type==="array"?ln(h[c.value]||wt,c.length):h[c.type]}(e):void 0),r=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?_c(new yc(r,e)):Jr(n.errors)}class br{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!Ma(n.expression)}evaluateWithoutErrorHandling(e,n,r,c,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,r,c,h,p)}evaluate(e,n,r,c,h,p){return this._styleExpression.evaluate(e,n,r,c,h,p)}}class Ga{constructor(e,n,r,c){this.kind=e,this.zoomStops=r,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Ma(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,r,c,h,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,r,c,h,p)}evaluate(e,n,r,c,h,p){return this._styleExpression.evaluate(e,n,r,c,h,p)}interpolationFactor(e,n,r){return this.interpolationType?cn.interpolationFactor(this.interpolationType,e,n,r):0}}function _h(i,e){if((i=Do(i,e)).result==="error")return i;const n=i.value.expression,r=Ao(n);if(!r&&!wr(e))return Jr([new Mt("","data expressions not supported")]);const c=Ct(n,["zoom","pitch","distance-from-center"]);if(!c&&!dh(e))return Jr([new Mt("","zoom expressions not supported")]);const h=Tr(n);return h||c?h instanceof Mt?Jr([h]):h instanceof cn&&!gc(e)?Jr([new Mt("",'"interpolate" expressions cannot be used with this property')]):_c(h?new Ga(r?"camera":"composite",i.value,h.labels,h instanceof cn?h.interpolation:void 0):new br(r?"constant":"source",i.value)):Jr([new Mt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Lo{constructor(e,n){this._parameters=e,this._specification=n,Rt(this,ph(this._parameters,this._specification))}static deserialize(e){return new Lo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Tr(i){let e=null;if(i instanceof Ds)e=Tr(i.result);else if(i instanceof Ba){for(const n of i.args)if(e=Tr(n),e)break}else(i instanceof Ms||i instanceof cn)&&i.input instanceof Ri&&i.input.name==="zoom"&&(e=i);return e instanceof Mt||i.eachChild(n=>{const r=Tr(n);r instanceof Mt?e=r:!e&&r?e=new Mt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new Mt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function bn(i){const e=i.key,n=i.value,r=i.valueSpec||{},c=i.objectElementValidators||{},h=i.style,p=i.styleSpec;let g=[];const y=Dt(n);if(y!=="object")return[new be(e,n,`object expected, ${y} found`)];for(const w in n){const T=w.split(".")[0],S=r[T]||r["*"];let I;if(c[T])I=c[T];else if(r[T])I=Bi;else if(c["*"])I=c["*"];else{if(!r["*"]){g.push(new be(e,n[w],`unknown property "${w}"`));continue}I=Bi}g=g.concat(I({key:(e&&`${e}.`)+w,value:n[w],valueSpec:S,style:h,styleSpec:p,object:n,objectKey:w},n))}for(const w in r)c[w]||r[w].required&&r[w].default===void 0&&n[w]===void 0&&g.push(new be(e,n,`missing required property "${w}"`));return g}function Za(i){const e=i.value,n=i.valueSpec,r=i.style,c=i.styleSpec,h=i.key,p=i.arrayElementValidator||Bi;if(Dt(e)!=="array")return[new be(h,e,`array expected, ${Dt(e)} found`)];if(n.length&&e.length!==n.length)return[new be(h,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new be(h,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let g={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum};c.$version<7&&(g.function=n.function),Dt(n.value)==="object"&&(g=n.value);let y=[];for(let w=0;w<e.length;w++)y=y.concat(p({array:e,arrayIndex:w,value:e[w],valueSpec:g,style:r,styleSpec:c,key:`${h}[${w}]`}));return y}function xc(i){const e=i.key,n=i.value,r=i.valueSpec;let c=Dt(n);if(c==="number"&&n!=n&&(c="NaN"),c!=="number")return[new be(e,n,`number expected, ${c} found`)];if("minimum"in r){let h=r.minimum;if(Dt(r.minimum)==="array"&&(h=r.minimum[i.arrayIndex]),n<h)return[new be(e,n,`${n} is less than the minimum value ${h}`)]}if("maximum"in r){let h=r.maximum;if(Dt(r.maximum)==="array"&&(h=r.maximum[i.arrayIndex]),n>h)return[new be(e,n,`${n} is greater than the maximum value ${h}`)]}return[]}function qa(i){const e=i.valueSpec,n=mt(i.value.type);let r,c,h,p={};const g=n!=="categorical"&&i.value.property===void 0,y=!g,w=Dt(i.value.stops)==="array"&&Dt(i.value.stops[0])==="array"&&Dt(i.value.stops[0][0])==="object",T=bn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(D){if(n==="identity")return[new be(D.key,D.value,'identity function may not have a "stops" property')];let L=[];const O=D.value;return L=L.concat(Za({key:D.key,value:O,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:S})),Dt(O)==="array"&&O.length===0&&L.push(new be(D.key,O,"array must have at least one stop")),L},default:function(D){return Bi({key:D.key,value:D.value,valueSpec:e,style:D.style,styleSpec:D.styleSpec})}}});return n==="identity"&&g&&T.push(new be(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||T.push(new be(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!gc(i.valueSpec)&&T.push(new be(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(y&&!wr(i.valueSpec)?T.push(new be(i.key,i.value,"property functions not supported")):g&&!dh(i.valueSpec)&&T.push(new be(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!w||i.value.property!==void 0||T.push(new be(i.key,i.value,'"property" property is required')),T;function S(D){let L=[];const O=D.value,Z=D.key;if(Dt(O)!=="array")return[new be(Z,O,`array expected, ${Dt(O)} found`)];if(O.length!==2)return[new be(Z,O,`array length 2 expected, length ${O.length} found`)];if(w){if(Dt(O[0])!=="object")return[new be(Z,O,`object expected, ${Dt(O[0])} found`)];if(O[0].zoom===void 0)return[new be(Z,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new be(Z,O,"object stop key must have value")];if(h&&h>mt(O[0].zoom))return[new be(Z,O[0].zoom,"stop zoom values must appear in ascending order")];mt(O[0].zoom)!==h&&(h=mt(O[0].zoom),c=void 0,p={}),L=L.concat(bn({key:`${Z}[0]`,value:O[0],valueSpec:{zoom:{}},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{zoom:xc,value:I}}))}else L=L.concat(I({key:`${Z}[0]`,value:O[0],valueSpec:{},style:D.style,styleSpec:D.styleSpec},O));return Rn(St(O[1]))?L.concat([new be(`${Z}[1]`,O[1],"expressions are not allowed in function stops.")]):L.concat(Bi({key:`${Z}[1]`,value:O[1],valueSpec:e,style:D.style,styleSpec:D.styleSpec}))}function I(D,L){const O=Dt(D.value),Z=mt(D.value),Y=D.value!==null?D.value:L;if(r){if(O!==r)return[new be(D.key,Y,`${O} stop domain type must match previous stop domain type ${r}`)]}else r=O;if(O!=="number"&&O!=="string"&&O!=="boolean")return[new be(D.key,Y,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&n!=="categorical"){let ee=`number expected, ${O} found`;return wr(e)&&n===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new be(D.key,Y,ee)]}return n!=="categorical"||O!=="number"||isFinite(Z)&&Math.floor(Z)===Z?n!=="categorical"&&O==="number"&&c!==void 0&&Z<c?[new be(D.key,Y,"stop domain values must appear in ascending order")]:(c=Z,n==="categorical"&&Z in p?[new be(D.key,Y,"stop domain values must be unique")]:(p[Z]=!0,[])):[new be(D.key,Y,`integer expected, found ${Z}`)]}}function Er(i){const e=(i.expressionContext==="property"?_h:Do)(St(i.value),i.valueSpec);if(e.result==="error")return e.value.map(r=>new be(`${i.key}${r.key}`,i.value,r.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new be(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ma(n))return[new be(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return vc(n,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ct(n,["zoom","feature-state"]))return[new be(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ao(n))return[new be(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vc(i,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const c of e.valueSpec.expression.parameters)n.delete(c);if(n.size===0)return[];const r=[];return i instanceof Ri&&n.has(i.name)?[new be(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(c=>{r.push(...vc(c,e))}),r)}function Ro(i){const e=i.key,n=i.value,r=i.valueSpec,c=[];return Array.isArray(r.values)?r.values.indexOf(mt(n))===-1&&c.push(new be(e,n,`expected one of [${r.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(r.values).indexOf(mt(n))===-1&&c.push(new be(e,n,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function Wa(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Wa(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ls(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Wa(i)||(i=Xa(i));const n=i;let r=!0;try{r=function(w){if(!eo(w))return w;let T=St(w);return Qr(T),T=wc(T),T}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const c=le[`filter_${e}`],h=Do(r,c);let p=null;if(h.result==="error")throw new Error(h.value.map(w=>`${w.key}: ${w.message}`).join(", "));p=(w,T,S)=>h.value.evaluate(w,T,{},S);let g=null,y=null;if(r!==n){const w=Do(n,c);if(w.result==="error")throw new Error(w.value.map(T=>`${T.key}: ${T.message}`).join(", "));g=(T,S,I,D,L)=>w.value.evaluate(T,S,{},I,void 0,void 0,D,L),y=!Ao(w.value.expression)}return p=p,{filter:p,dynamicFilter:g||void 0,needGeometry:Tc(r),needFeature:!!y}}function wc(i){if(!Array.isArray(i))return i;const e=function(n){if(gh.has(n[0])){for(let r=1;r<n.length;r++)if(eo(n[r]))return!0}return n}(i);return e===!0?e:e.map(n=>wc(n))}function Qr(i){let e=!1;const n=[];if(i[0]==="case"){for(let r=1;r<i.length-1;r+=2)e=e||eo(i[r]),n.push(i[r+1]);n.push(i[i.length-1])}else if(i[0]==="match"){e=e||eo(i[1]);for(let r=2;r<i.length-1;r+=2)n.push(i[r+1]);n.push(i[i.length-1])}else if(i[0]==="step"){e=e||eo(i[1]);for(let r=1;r<i.length-1;r+=2)n.push(i[r+1])}e&&(i.length=0,i.push("any",...n));for(let r=1;r<i.length;r++)Qr(i[r])}function eo(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<i.length;n++)if(eo(i[n]))return!0;return!1}const gh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function bc(i,e){return i<e?-1:i>e?1:0}function Tc(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Tc(i[e]))return!0;return!1}function Xa(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Bo(i[1],i[2],"=="):e==="!="?Ha(Bo(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Bo(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(Xa))):e==="all"?["all"].concat(i.slice(1).map(Xa)):e==="none"?["all"].concat(i.slice(1).map(Xa).map(Ha)):e==="in"?yh(i[1],i.slice(2)):e==="!in"?Ha(yh(i[1],i.slice(2))):e==="has"?xh(i[1]):e==="!has"?Ha(xh(i[1])):e!=="within"||i;var n}function Bo(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function yh(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(bc)]]:["filter-in-small",i,["literal",e]]}}function xh(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ha(i){return["!",i]}function Ec(i){if(Wa(St(i.value))){const e=St(i.layerType);return Er(Rt({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${e||"fill"}`]}))}return vh(i)}function vh(i){const e=i.value,n=i.key;if(Dt(e)!=="array")return[new be(n,e,`array expected, ${Dt(e)} found`)];const r=i.styleSpec;let c,h=[];if(e.length<1)return[new be(n,e,"filter array must have at least 1 element")];switch(h=h.concat(Ro({key:`${n}[0]`,value:e[0],valueSpec:r.filter_operator,style:i.style,styleSpec:i.styleSpec})),mt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&mt(e[1])==="$type"&&h.push(new be(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new be(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Dt(e[1]),c!=="string"&&h.push(new be(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let p=2;p<e.length;p++)c=Dt(e[p]),mt(e[1])==="$type"?h=h.concat(Ro({key:`${n}[${p}]`,value:e[p],valueSpec:r.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&h.push(new be(`${n}[${p}]`,e[p],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)h=h.concat(vh({key:`${n}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=Dt(e[1]),e.length!==2?h.push(new be(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&h.push(new be(`${n}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=Dt(e[1]),e.length!==2?h.push(new be(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&h.push(new be(`${n}[1]`,e[1],`object expected, ${c} found`))}return h}function Rs(i,e){const n=i.key,r=i.style,c=i.styleSpec,h=i.value,p=i.objectKey,g=c[`${e}_${i.layerType}`];if(!g)return[];const y=p.match(/^(.*)-transition$/);if(e==="paint"&&y&&g[y[1]]&&g[y[1]].transition)return Bi({key:n,value:h,valueSpec:c.transition,style:r,styleSpec:c});const w=i.valueSpec||g[p];if(!w)return[new be(n,h,`unknown property "${p}"`)];let T;if(Dt(h)==="string"&&wr(w)&&!w.tokens&&(T=/^{([^}]+)}$/.exec(h)))return[new be(n,h,`"${p}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const S=[];return i.layerType==="symbol"&&(p==="text-field"&&r&&!r.glyphs&&S.push(new be(n,h,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&ja(St(h))&&mt(h.type)==="identity"&&S.push(new be(n,h,'"text-font" does not support identity functions'))),S.concat(Bi({key:i.key,value:h,valueSpec:w,style:r,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:p}))}function Bs(i){return Rs(i,"paint")}function Ki(i){return Rs(i,"layout")}function Fs(i){let e=[];const n=i.value,r=i.key,c=i.style,h=i.styleSpec;n.type||n.ref||e.push(new be(r,n,'either "type" or "ref" is required'));let p=mt(n.type);const g=mt(n.ref);if(n.id){const y=mt(n.id);for(let w=0;w<i.arrayIndex;w++){const T=c.layers[w];mt(T.id)===y&&e.push(new be(r,n.id,`duplicate layer id "${n.id}", previously used at line ${T.id.__line__}`))}}if("ref"in n){let y;["type","source","source-layer","filter","layout"].forEach(w=>{w in n&&e.push(new be(r,n[w],`"${w}" is prohibited for ref layers`))}),c.layers.forEach(w=>{mt(w.id)===g&&(y=w)}),y?y.ref?e.push(new be(r,n.ref,"ref cannot reference another ref layer")):p=mt(y.type):e.push(new be(r,n.ref,`ref layer "${g}" not found`))}else if(p!=="background"&&p!=="sky")if(n.source){const y=c.sources&&c.sources[n.source],w=y&&mt(y.type);y?w==="vector"&&p==="raster"?e.push(new be(r,n.source,`layer "${n.id}" requires a raster source`)):w==="raster"&&p!=="raster"?e.push(new be(r,n.source,`layer "${n.id}" requires a vector source`)):w!=="vector"||n["source-layer"]?w==="raster-dem"&&p!=="hillshade"?e.push(new be(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!n.paint||!n.paint["line-gradient"]||w==="geojson"&&y.lineMetrics||e.push(new be(r,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new be(r,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new be(r,n.source,`source "${n.source}" not found`))}else e.push(new be(r,n,'missing required property "source"'));return e=e.concat(bn({key:r,value:n,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Bi({key:`${r}.type`,value:n.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,object:n,objectKey:"type"}),filter:y=>Ec(Rt({layerType:p},y)),layout:y=>bn({layer:n,key:y.key,value:y.value,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":w=>Ki(Rt({layerType:p},w))}}),paint:y=>bn({layer:n,key:y.key,value:y.value,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":w=>Bs(Rt({layerType:p},w))}})}})),e}function Fo(i){const e=i.value,n=i.key,r=Dt(e);return r!=="string"?[new be(n,e,`string expected, ${r} found`)]:[]}const wh={promoteId:function({key:i,value:e}){if(Dt(e)==="string")return Fo({key:i,value:e});{const n=[];for(const r in e)n.push(...Fo({key:`${i}.${r}`,value:e[r]}));return n}}};function bh(i){const e=i.value,n=i.key,r=i.styleSpec,c=i.style;if(!e.type)return[new be(n,e,'"type" is required')];const h=mt(e.type);let p;switch(h){case"vector":case"raster":case"raster-dem":return p=bn({key:n,value:e,valueSpec:r[`source_${h.replace("-","_")}`],style:i.style,styleSpec:r,objectElementValidators:wh}),p;case"geojson":if(p=bn({key:n,value:e,valueSpec:r.source_geojson,style:c,styleSpec:r,objectElementValidators:wh}),e.cluster)for(const g in e.clusterProperties){const[y,w]=e.clusterProperties[g],T=typeof y=="string"?[y,["accumulated"],["get",g]]:y;p.push(...Er({key:`${n}.${g}.map`,value:w,expressionContext:"cluster-map"})),p.push(...Er({key:`${n}.${g}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return p;case"video":return bn({key:n,value:e,valueSpec:r.source_video,style:c,styleSpec:r});case"image":return bn({key:n,value:e,valueSpec:r.source_image,style:c,styleSpec:r});case"canvas":return[new be(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ro({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:r})}}function Th(i){const e=i.value,n=i.styleSpec,r=n.light,c=i.style;let h=[];const p=Dt(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new be("light",e,`object expected, ${p} found`)]),h;for(const g in e){const y=g.match(/^(.*)-transition$/);h=h.concat(y&&r[y[1]]&&r[y[1]].transition?Bi({key:g,value:e[g],valueSpec:n.transition,style:c,styleSpec:n}):r[g]?Bi({key:g,value:e[g],valueSpec:r[g],style:c,styleSpec:n}):[new be(g,e[g],`unknown property "${g}"`)])}return h}function Ya(i){const e=i.value,n=i.key,r=i.style,c=i.styleSpec,h=c.terrain;let p=[];const g=Dt(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new be("terrain",e,`object expected, ${g} found`)]),p;for(const y in e){const w=y.match(/^(.*)-transition$/);p=p.concat(w&&h[w[1]]&&h[w[1]].transition?Bi({key:y,value:e[y],valueSpec:c.transition,style:r,styleSpec:c}):h[y]?Bi({key:y,value:e[y],valueSpec:h[y],style:r,styleSpec:c}):[new be(y,e[y],`unknown property "${y}"`)])}if(e.source){const y=r.sources&&r.sources[e.source],w=y&&mt(y.type);y?w!=="raster-dem"&&p.push(new be(n,e.source,`terrain cannot be used with a source of type ${w}, it only be used with a "raster-dem" source type`)):p.push(new be(n,e.source,`source "${e.source}" not found`))}else p.push(new be(n,e,'terrain is missing required property "source"'));return p}function Eh(i){const e=i.value,n=i.style,r=i.styleSpec,c=r.fog;let h=[];const p=Dt(e);if(e===void 0)return h;if(p!=="object")return h=h.concat([new be("fog",e,`object expected, ${p} found`)]),h;for(const g in e){const y=g.match(/^(.*)-transition$/);h=h.concat(y&&c[y[1]]&&c[y[1]].transition?Bi({key:g,value:e[g],valueSpec:r.transition,style:n,styleSpec:r}):c[g]?Bi({key:g,value:e[g],valueSpec:c[g],style:n,styleSpec:r}):[new be(g,e[g],`unknown property "${g}"`)])}return h}const Ka={"*":()=>[],array:Za,boolean:function(i){const e=i.value,n=i.key,r=Dt(e);return r!=="boolean"?[new be(n,e,`boolean expected, ${r} found`)]:[]},number:xc,color:function(i){const e=i.key,n=i.value,r=Dt(n);return r!=="string"?[new be(e,n,`color expected, ${r} found`)]:Dn.parseCSSColor(n)===null?[new be(e,n,`color expected, "${n}" found`)]:[]},constants:Tt,enum:Ro,filter:Ec,function:qa,layer:Fs,object:bn,source:bh,light:Th,terrain:Ya,fog:Eh,string:Fo,formatted:function(i){return Fo(i).length===0?[]:Er(i)},resolvedImage:function(i){return Fo(i).length===0?[]:Er(i)},projection:function(i){const e=i.value,n=i.styleSpec,r=n.projection,c=i.style;let h=[];const p=Dt(e);if(p==="object")for(const g in e)h=h.concat(Bi({key:g,value:e[g],valueSpec:r[g],style:c,styleSpec:n}));else p!=="string"&&(h=h.concat([new be("projection",e,`object or string expected, ${p} found`)]));return h}};function Bi(i){const e=i.value,n=i.valueSpec,r=i.styleSpec;return n.expression&&ja(mt(e))?qa(i):n.expression&&Rn(St(e))?Er(i):n.type&&Ka[n.type]?Ka[n.type](i):bn(Rt({},i,{valueSpec:n.type?r[n.type]:n}))}function jp(i){const e=i.value,n=i.key,r=Fo(i);return r.length||(e.indexOf("{fontstack}")===-1&&r.push(new be(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&r.push(new be(n,e,'"glyphs" url must include a "{range}" token'))),r}function Bn(i,e=le){let n=[];return n=n.concat(Bi({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:jp,"*":()=>[]}})),i.constants&&(n=n.concat(Tt({key:"constants",value:i.constants,style:i,styleSpec:e}))),Sh(n)}function Sh(i){return[].concat(i).sort((e,n)=>e.line-n.line)}function nr(i){return function(...e){return Sh(i.apply(this,e))}}Bn.source=nr(bh),Bn.light=nr(Th),Bn.terrain=nr(Ya),Bn.fog=nr(Eh),Bn.layer=nr(Fs),Bn.filter=nr(Ec),Bn.paintProperty=nr(Bs),Bn.layoutProperty=nr(Ki);const to=Bn,$p=to.light,Sc=to.fog,Ja=to.paintProperty,Ch=to.layoutProperty;function Ih(i,e){let n=!1;if(e&&e.length)for(const r of e)i.fire(new et(new Error(r.message))),n=!0;return n}var Oo=qn;function qn(i,e,n){var r=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var c=new Int32Array(this.arrayBuffer);i=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var h=0;h<this.d*this.d;h++){var p=c[3+h],g=c[3+h+1];r.push(p===g?null:c.subarray(p,g))}var y=c[3+r.length+1];this.keys=c.subarray(c[3+r.length],y),this.bboxes=c.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var w=0;w<this.d*this.d;w++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=n,this.scale=e/i,this.uid=0;var T=n/e*i;this.min=-T,this.max=i+T}qn.prototype.insert=function(i,e,n,r,c){this._forEachCell(e,n,r,c,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(c)},qn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},qn.prototype._insertCell=function(i,e,n,r,c,h){this.cells[c].push(h)},qn.prototype.query=function(i,e,n,r,c){var h=this.min,p=this.max;if(i<=h&&e<=h&&p<=n&&p<=r&&!c)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(i,e,n,r,this._queryCell,g,{},c),g},qn.prototype._queryCell=function(i,e,n,r,c,h,p,g){var y=this.cells[c];if(y!==null)for(var w=this.keys,T=this.bboxes,S=0;S<y.length;S++){var I=y[S];if(p[I]===void 0){var D=4*I;(g?g(T[D+0],T[D+1],T[D+2],T[D+3]):i<=T[D+2]&&e<=T[D+3]&&n>=T[D+0]&&r>=T[D+1])?(p[I]=!0,h.push(w[I])):p[I]=!1}}},qn.prototype._forEachCell=function(i,e,n,r,c,h,p,g){for(var y=this._convertToCellCoord(i),w=this._convertToCellCoord(e),T=this._convertToCellCoord(n),S=this._convertToCellCoord(r),I=y;I<=T;I++)for(var D=w;D<=S;D++){var L=this.d*D+I;if((!g||g(this._convertFromCellCoord(I),this._convertFromCellCoord(D),this._convertFromCellCoord(I+1),this._convertFromCellCoord(D+1)))&&c.call(this,i,e,n,r,L,h,p,g))return}},qn.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},qn.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},qn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var h=e,p=0;p<i.length;p++){var g=i[p];c[3+p]=h,c.set(g,h),h+=g.length}return c[3+i.length]=h,c.set(this.keys,h),c[3+i.length+1]=h+=this.keys.length,c.set(this.bboxes,h),h+=this.bboxes.length,c.buffer};const{ImageData:Qa,ImageBitmap:Ah}=ze,Os={};function Je(i,e,n={}){Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Os[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Je("Object",Object),Oo.serialize=function(i,e){const n=i.toArrayBuffer();return e&&e.push(n),{buffer:n}},Oo.deserialize=function(i){return new Oo(i.buffer)},Je("Grid",Oo),Je("Color",kt),Je("Error",Error),Je("ResolvedImage",vn),Je("StylePropertyFunction",Lo),Je("StyleExpression",yc,{omit:["_evaluator"]}),Je("ZoomDependentExpression",Ga),Je("ZoomConstantExpression",br),Je("CompoundExpression",Ri,{omit:["_evaluate"]});for(const i in Kr)Kr[i]._classRegistryKey||Je(`Expression_${i}`,Kr[i]);function Mh(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Cc(i){return Ah&&i instanceof Ah}function Us(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Mh(i)||Cc(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return e&&e.push(n.buffer),n}if(i instanceof Qa)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const r of i)n.push(Us(r,e));return n}if(typeof i=="object"){const n=i.constructor,r=n._classRegistryKey;if(!r)throw new Error("can't serialize object of unregistered class");const c=n.serialize?n.serialize(i,e):{};if(!n.serialize){for(const h in i){if(!i.hasOwnProperty(h)||Os[r].omit.indexOf(h)>=0)continue;const p=i[h];c[h]=Os[r].shallow.indexOf(h)>=0?p:Us(p,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(c.$name=r),c}throw new Error("can't serialize object of type "+typeof i)}function Ns(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Mh(i)||Cc(i)||ArrayBuffer.isView(i)||i instanceof Qa)return i;if(Array.isArray(i))return i.map(Ns);if(typeof i=="object"){const e=i.$name||"Object",{klass:n}=Os[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const r=Object.create(n.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const h=i[c];r[c]=Os[e].shallow.indexOf(c)>=0?h:Ns(h)}return r}throw new Error("can't deserialize object of type "+typeof i)}class kh{constructor(){this.first=!0}update(e,n){const r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))}}const zh=i=>i>=1536&&i<=1791,Ph=i=>i>=1872&&i<=1919,Dh=i=>i>=2208&&i<=2303,Lh=i=>i>=11904&&i<=12031,Vs=i=>i>=12032&&i<=12255,Rh=i=>i>=12272&&i<=12287,el=i=>i>=12288&&i<=12351,Uo=i=>i>=12352&&i<=12447,tl=i=>i>=12448&&i<=12543,Ic=i=>i>=12544&&i<=12591,Bh=i=>i>=12704&&i<=12735,Ac=i=>i>=12736&&i<=12783,Mc=i=>i>=12784&&i<=12799,kc=i=>i>=12800&&i<=13055,zc=i=>i>=13056&&i<=13311,il=i=>i>=13312&&i<=19903,js=i=>i>=19968&&i<=40959,Fh=i=>i>=40960&&i<=42127,Oh=i=>i>=42128&&i<=42191,$s=i=>i>=44032&&i<=55215,Uh=i=>i>=63744&&i<=64255,Sr=i=>i>=64336&&i<=65023,Nh=i=>i>=65040&&i<=65055,Gs=i=>i>=65072&&i<=65103,Vh=i=>i>=65104&&i<=65135,Pc=i=>i>=65136&&i<=65279,Dc=i=>i>=65280&&i<=65519;function Cr(i){for(const e of i)if(Lc(e.charCodeAt(0)))return!0;return!1}function nl(i){for(const e of i)if(!Zs(e.charCodeAt(0)))return!1;return!0}function Zs(i){return!(zh(i)||Ph(i)||Dh(i)||Sr(i)||Pc(i))}function Lc(i){return!(i!==746&&i!==747&&(i<4352||!(Bh(i)||Ic(i)||Gs(i)&&!(i>=65097&&i<=65103)||Uh(i)||zc(i)||Lh(i)||Ac(i)||!(!el(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||il(i)||js(i)||kc(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||$s(i)||Uo(i)||Rh(i)||(e=>e>=12688&&e<=12703)(i)||Vs(i)||Mc(i)||tl(i)&&i!==12540||!(!Dc(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Vh(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||Nh(i)||(e=>e>=19904&&e<=19967)(i)||Fh(i)||Oh(i))))}function Rc(i){return!(Lc(i)||function(e){return!!((n=>n>=128&&n<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(n=>n>=8192&&n<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&e!==9251||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||el(e)||tl(e)||(n=>n>=57344&&n<=63743)(e)||Gs(e)||Vh(e)||Dc(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function No(i){return i>=1424&&i<=2303||Sr(i)||Pc(i)}function Gp(i,e){return!(!e&&No(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(n=>n>=6016&&n<=6143)(i))}function Zp(i){for(const e of i)if(No(e.charCodeAt(0)))return!0;return!1}const Vo="deferred",u="loading",t="loaded";let s=null,d="unavailable",m=null;const _=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(d="error"),s&&s(i)};function x(){b.fire(new De("pluginStateChange",{pluginStatus:d,pluginURL:m}))}const b=new Ne,C=function(){return d},A=function(){if(d!==Vo||!m)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");d=u,x(),m&&R({url:m},i=>{i?_(i):(d=t,x())})},M={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>d===t||M.applyArabicShaping!=null,isLoading:()=>d===u,setState(i){d=i.pluginStatus,m=i.pluginURL},isParsed:()=>M.applyArabicShaping!=null&&M.processBidirectionalText!=null&&M.processStyledBidirectionalText!=null,getPluginURL:()=>m};class z{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new kh,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,r){for(const c of n)if(!Gp(c.charCodeAt(0),r))return!1;return!0}(e,M.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*n}}}class F{constructor(e,n){this.property=e,this.value=n,this.expression=function(r,c){if(ja(r))return new Lo(r,c);if(Rn(r)){const h=_h(r,c);if(h.result==="error")throw new Error(h.value.map(p=>`${p.key}: ${p.message}`).join(", "));return h.value}{let h=r;return typeof r=="string"&&c.type==="color"&&(h=kt.parse(r)),{kind:"constant",evaluate:()=>h}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,r){return this.property.possiblyEvaluate(this,e,n,r)}}class V{constructor(e){this.property=e,this.value=new F(e,void 0)}transitioned(e,n){return new U(this.property,this.value,n,Yt({},e.transition,this.transition),e.now)}untransitioned(){return new U(this.property,this.value,null,{},0)}}class ${constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ve(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new V(this._values[e].property)),this._values[e].value=new F(this._values[e].property,n===null?void 0:Ve(n))}getTransition(e){return Ve(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new V(this._values[e].property)),this._values[e].transition=Ve(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const r=this.getValue(n);r!==void 0&&(e[n]=r);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const r=new W(this._properties);for(const c of Object.keys(this._values))r._values[c]=this._values[c].transitioned(e,n._values[c]);return r}untransitioned(){const e=new W(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class U{constructor(e,n,r,c,h){const p=c.delay||0,g=c.duration||0;h=h||0,this.property=e,this.value=n,this.begin=h+p,this.end=this.begin+g,e.specification.transition&&(c.delay||c.duration)&&(this.prior=r)}possiblyEvaluate(e,n,r){const c=e.now||0,h=this.value.possiblyEvaluate(e,n,r),p=this.prior;if(p){if(c>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(c<this.begin)return p.possiblyEvaluate(e,n,r);{const g=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,r),h,Pe(g))}}return h}}class W{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,r){const c=new K(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,n,r);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class N{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Ve(this._values[e].value)}setValue(e,n){this._values[e]=new F(this._values[e].property,n===null?void 0:Ve(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const r=this.getValue(n);r!==void 0&&(e[n]=r)}return e}possiblyEvaluate(e,n,r){const c=new K(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].possiblyEvaluate(e,n,r);return c}}class X{constructor(e,n,r){this.property=e,this.value=n,this.parameters=r}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,r,c){return this.property.evaluate(this.value,this.parameters,e,n,r,c)}}class K{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class j{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,r){const c=ks[this.specification.type];return c?c(e,n,r):e}}class J{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,r,c){return new X(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},r,c)}:e.expression,n)}interpolate(e,n,r){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new X(this,{kind:"constant",value:void 0},e.parameters);const c=ks[this.specification.type];return c?new X(this,{kind:"constant",value:c(e.value.value,n.value.value,r)},e.parameters):e}evaluate(e,n,r,c,h,p){return e.kind==="constant"?e.value:e.evaluate(n,r,c,h,p)}}class ne extends J{possiblyEvaluate(e,n,r,c){if(e.value===void 0)return new X(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const h=e.expression.evaluate(n,null,{},r,c),p=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,g=this._calculate(p,p,p,n);return new X(this,{kind:"constant",value:g},n)}if(e.expression.kind==="camera"){const h=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new X(this,{kind:"constant",value:h},n)}return new X(this,e.expression,n)}evaluate(e,n,r,c,h,p){if(e.kind==="source"){const g=e.evaluate(n,r,c,h,p);return this._calculate(g,g,g,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},r,c),e.evaluate({zoom:Math.floor(n.zoom)},r,c),e.evaluate({zoom:Math.floor(n.zoom)+1},r,c),n):e.value}_calculate(e,n,r,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n,other:r}:{from:r,to:n,other:e}}interpolate(e){return e}}class ve{constructor(e){this.specification=e}possiblyEvaluate(e,n,r,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const h=e.expression.evaluate(n,null,{},r,c);return this._calculate(h,h,h,n)}return this._calculate(e.expression.evaluate(new z(Math.floor(n.zoom-1),n)),e.expression.evaluate(new z(Math.floor(n.zoom),n)),e.expression.evaluate(new z(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,r,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:r,to:n}}interpolate(e){return e}}class xe{constructor(e){this.specification=e}possiblyEvaluate(e,n,r,c){return!!e.expression.evaluate(n,null,{},r,c)}interpolate(){return!1}}class Ee{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const r=e[n];r.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new F(r,void 0),h=this.defaultTransitionablePropertyValues[n]=new V(r);this.defaultTransitioningPropertyValues[n]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}function Se(i,e){return 256*(i=Ye(Math.floor(i),0,255))+Ye(Math.floor(e),0,255)}Je("DataDrivenProperty",J),Je("DataConstantProperty",j),Je("CrossFadedDataDrivenProperty",ne),Je("CrossFadedProperty",ve),Je("ColorRampProperty",xe);const Fe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Te{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Oe{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ye(i,e=1){let n=0,r=0;return{members:i.map(c=>{const h=Fe[c.type].BYTES_PER_ELEMENT,p=n=Ue(n,Math.max(e,h)),g=c.components||1;return r=Math.max(r,h),n+=h*g,{name:c.name,type:c.type,components:g,offset:p}}),size:Ue(n,Math.max(r,e)),alignment:e}}function Ue(i,e){return Math.ceil(i/e)*e}class Qe extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,n)}emplace(e,n,r){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=r,e}}Qe.prototype.bytesPerElement=4,Je("StructArrayLayout2i4",Qe);class lt extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,r,c)}emplace(e,n,r,c,h){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=r,this.int16[p+2]=c,this.int16[p+3]=h,e}}lt.prototype.bytesPerElement=8,Je("StructArrayLayout4i8",lt);class ut extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,c,h,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,r,c,h,p,g)}emplace(e,n,r,c,h,p,g,y){const w=6*e,T=12*e,S=3*e;return this.int16[w+0]=n,this.int16[w+1]=r,this.uint8[T+4]=c,this.uint8[T+5]=h,this.uint8[T+6]=p,this.uint8[T+7]=g,this.float32[S+2]=y,e}}ut.prototype.bytesPerElement=12,Je("StructArrayLayout2i4ub1f12",ut);class pt extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,r)}emplace(e,n,r,c){const h=3*e;return this.float32[h+0]=n,this.float32[h+1]=r,this.float32[h+2]=c,e}}pt.prototype.bytesPerElement=12,Je("StructArrayLayout3f12",pt);class ft extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,c,h,p,g,y,w,T){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,r,c,h,p,g,y,w,T)}emplace(e,n,r,c,h,p,g,y,w,T,S){const I=10*e;return this.uint16[I+0]=n,this.uint16[I+1]=r,this.uint16[I+2]=c,this.uint16[I+3]=h,this.uint16[I+4]=p,this.uint16[I+5]=g,this.uint16[I+6]=y,this.uint16[I+7]=w,this.uint16[I+8]=T,this.uint16[I+9]=S,e}}ft.prototype.bytesPerElement=20,Je("StructArrayLayout10ui20",ft);class st extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,c,h,p,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,r,c,h,p,g,y)}emplace(e,n,r,c,h,p,g,y,w){const T=8*e;return this.uint16[T+0]=n,this.uint16[T+1]=r,this.uint16[T+2]=c,this.uint16[T+3]=h,this.uint16[T+4]=p,this.uint16[T+5]=g,this.uint16[T+6]=y,this.uint16[T+7]=w,e}}st.prototype.bytesPerElement=16,Je("StructArrayLayout8ui16",st);class _t extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,c,h,p,g,y,w,T,S,I,D,L,O,Z){const Y=this.length;return this.resize(Y+1),this.emplace(Y,e,n,r,c,h,p,g,y,w,T,S,I,D,L,O,Z)}emplace(e,n,r,c,h,p,g,y,w,T,S,I,D,L,O,Z,Y){const ee=16*e;return this.int16[ee+0]=n,this.int16[ee+1]=r,this.int16[ee+2]=c,this.int16[ee+3]=h,this.uint16[ee+4]=p,this.uint16[ee+5]=g,this.uint16[ee+6]=y,this.uint16[ee+7]=w,this.int16[ee+8]=T,this.int16[ee+9]=S,this.int16[ee+10]=I,this.int16[ee+11]=D,this.int16[ee+12]=L,this.int16[ee+13]=O,this.int16[ee+14]=Z,this.int16[ee+15]=Y,e}}_t.prototype.bytesPerElement=32,Je("StructArrayLayout4i4ui4i4i32",_t);class Bt extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Bt.prototype.bytesPerElement=4,Je("StructArrayLayout1ul4",Bt);class fi extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,c,h,p,g,y,w,T,S,I,D){const L=this.length;return this.resize(L+1),this.emplace(L,e,n,r,c,h,p,g,y,w,T,S,I,D)}emplace(e,n,r,c,h,p,g,y,w,T,S,I,D,L){const O=20*e,Z=10*e;return this.int16[O+0]=n,this.int16[O+1]=r,this.int16[O+2]=c,this.int16[O+3]=h,this.int16[O+4]=p,this.float32[Z+3]=g,this.float32[Z+4]=y,this.float32[Z+5]=w,this.float32[Z+6]=T,this.int16[O+14]=S,this.uint32[Z+8]=I,this.uint16[O+18]=D,this.uint16[O+19]=L,e}}fi.prototype.bytesPerElement=40,Je("StructArrayLayout5i4f1i1ul2ui40",fi);class Ai extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r,c,h,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,r,c,h,p,g)}emplace(e,n,r,c,h,p,g,y){const w=8*e;return this.int16[w+0]=n,this.int16[w+1]=r,this.int16[w+2]=c,this.int16[w+4]=h,this.int16[w+5]=p,this.int16[w+6]=g,this.int16[w+7]=y,e}}Ai.prototype.bytesPerElement=16,Je("StructArrayLayout3i2i2i16",Ai);class Fi extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,r,c,h)}emplace(e,n,r,c,h,p){const g=4*e,y=8*e;return this.float32[g+0]=n,this.float32[g+1]=r,this.float32[g+2]=c,this.int16[y+6]=h,this.int16[y+7]=p,e}}Fi.prototype.bytesPerElement=16,Je("StructArrayLayout2f1f2i16",Fi);class Zi extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,r,c)}emplace(e,n,r,c,h){const p=12*e,g=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=r,this.float32[g+1]=c,this.float32[g+2]=h,e}}Zi.prototype.bytesPerElement=12,Je("StructArrayLayout2ub2f12",Zi);class mi extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,r)}emplace(e,n,r,c){const h=3*e;return this.uint16[h+0]=n,this.uint16[h+1]=r,this.uint16[h+2]=c,e}}mi.prototype.bytesPerElement=6,Je("StructArrayLayout3ui6",mi);class rr extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,r,c,h,p,g,y,w,T,S,I,D,L,O,Z,Y,ee,se,ce,ae){const he=this.length;return this.resize(he+1),this.emplace(he,e,n,r,c,h,p,g,y,w,T,S,I,D,L,O,Z,Y,ee,se,ce,ae)}emplace(e,n,r,c,h,p,g,y,w,T,S,I,D,L,O,Z,Y,ee,se,ce,ae,he){const Ce=30*e,we=15*e,Ge=60*e;return this.int16[Ce+0]=n,this.int16[Ce+1]=r,this.int16[Ce+2]=c,this.float32[we+2]=h,this.float32[we+3]=p,this.uint16[Ce+8]=g,this.uint16[Ce+9]=y,this.uint32[we+5]=w,this.uint32[we+6]=T,this.uint32[we+7]=S,this.uint16[Ce+16]=I,this.uint16[Ce+17]=D,this.uint16[Ce+18]=L,this.float32[we+10]=O,this.float32[we+11]=Z,this.uint8[Ge+48]=Y,this.uint8[Ge+49]=ee,this.uint8[Ge+50]=se,this.uint32[we+13]=ce,this.int16[Ce+28]=ae,this.uint8[Ge+58]=he,e}}rr.prototype.bytesPerElement=60,Je("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",rr);class Wn extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,r,c,h,p,g,y,w,T,S,I,D,L,O,Z,Y,ee,se,ce,ae,he,Ce,we,Ge,Le,Ie,Re,Be,Me){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,e,n,r,c,h,p,g,y,w,T,S,I,D,L,O,Z,Y,ee,se,ce,ae,he,Ce,we,Ge,Le,Ie,Re,Be,Me)}emplace(e,n,r,c,h,p,g,y,w,T,S,I,D,L,O,Z,Y,ee,se,ce,ae,he,Ce,we,Ge,Le,Ie,Re,Be,Me,Ze){const Ke=38*e,gt=19*e;return this.int16[Ke+0]=n,this.int16[Ke+1]=r,this.int16[Ke+2]=c,this.float32[gt+2]=h,this.float32[gt+3]=p,this.int16[Ke+8]=g,this.int16[Ke+9]=y,this.int16[Ke+10]=w,this.int16[Ke+11]=T,this.int16[Ke+12]=S,this.int16[Ke+13]=I,this.uint16[Ke+14]=D,this.uint16[Ke+15]=L,this.uint16[Ke+16]=O,this.uint16[Ke+17]=Z,this.uint16[Ke+18]=Y,this.uint16[Ke+19]=ee,this.uint16[Ke+20]=se,this.uint16[Ke+21]=ce,this.uint16[Ke+22]=ae,this.uint16[Ke+23]=he,this.uint16[Ke+24]=Ce,this.uint16[Ke+25]=we,this.uint16[Ke+26]=Ge,this.uint16[Ke+27]=Le,this.uint16[Ke+28]=Ie,this.uint32[gt+15]=Re,this.float32[gt+16]=Be,this.float32[gt+17]=Me,this.float32[gt+18]=Ze,e}}Wn.prototype.bytesPerElement=76,Je("StructArrayLayout3i2f6i15ui1ul3f76",Wn);class Wt extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Wt.prototype.bytesPerElement=4,Je("StructArrayLayout1f4",Wt);class si extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,r){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,r)}emplace(e,n,r,c){const h=3*e;return this.int16[h+0]=n,this.int16[h+1]=r,this.int16[h+2]=c,e}}si.prototype.bytesPerElement=6,Je("StructArrayLayout3i6",si);class It extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,r,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,r,c)}emplace(e,n,r,c,h){const p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=r,this.uint16[p+3]=c,this.uint16[p+4]=h,e}}It.prototype.bytesPerElement=12,Je("StructArrayLayout1ul3ui12",It);class Ht extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,n)}emplace(e,n,r){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=r,e}}Ht.prototype.bytesPerElement=4,Je("StructArrayLayout2ui4",Ht);class Mi extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Mi.prototype.bytesPerElement=2,Je("StructArrayLayout1ui2",Mi);class Xt extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,n)}emplace(e,n,r){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=r,e}}Xt.prototype.bytesPerElement=8,Je("StructArrayLayout2f8",Xt);class un extends Oe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,r,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,r,c)}emplace(e,n,r,c,h){const p=4*e;return this.float32[p+0]=n,this.float32[p+1]=r,this.float32[p+2]=c,this.float32[p+3]=h,e}}un.prototype.bytesPerElement=16,Je("StructArrayLayout4f16",un);class qs extends Te{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}qs.prototype.size=40;class Ji extends fi{get(e){return new qs(this,e)}}Je("CollisionBoxArray",Ji);class Ir extends Te{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ir.prototype.size=60;class jh extends rr{get(e){return new Ir(this,e)}}Je("PlacedSymbolArray",jh);class rl extends Te{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}rl.prototype.size=76;class jo extends Wn{get(e){return new rl(this,e)}}Je("SymbolInstanceArray",jo);class $h extends Wt{getoffsetX(e){return this.float32[1*e+0]}}Je("GlyphOffsetArray",$h);class Ws extends si{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Je("SymbolLineVertexArray",Ws);class ol extends Te{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ol.prototype.size=12;class Y_ extends It{get(e){return new ol(this,e)}}Je("FeatureIndexArray",Y_);class K_ extends Te{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}K_.prototype.size=4;class J_ extends Ht{get(e){return new K_(this,e)}}Je("FillExtrusionCentroidArray",J_);const c1=ye([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),u1=ye([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Q_=wa(function(i){i.exports=function(e,n){var r,c,h,p,g,y,w,T;for(c=e.length-(r=3&e.length),h=n,g=3432918353,y=461845907,T=0;T<c;)w=255&e.charCodeAt(T)|(255&e.charCodeAt(++T))<<8|(255&e.charCodeAt(++T))<<16|(255&e.charCodeAt(++T))<<24,++T,h=27492+(65535&(p=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,r){case 3:w^=(255&e.charCodeAt(T+2))<<16;case 2:w^=(255&e.charCodeAt(T+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(T)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*y+(((w>>>16)*y&65535)<<16)&4294967295}return h^=e.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}}),h1=wa(function(i){i.exports=function(e,n){for(var r,c=e.length,h=n^c,p=0;c>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),c-=4,++p;switch(c){case 3:h^=(255&e.charCodeAt(p+2))<<16;case 2:h^=(255&e.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&e.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}}),Bc=Q_,d1=h1;Bc.murmur3=Q_,Bc.murmur2=d1;class Gh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,r,c){this.ids.push(eg(e)),this.positions.push(n,r,c)}getPositions(e){const n=eg(e);let r=0,c=this.ids.length-1;for(;r<c;){const p=r+c>>1;this.ids[p]>=n?c=p:r=p+1}const h=[];for(;this.ids[r]===n;)h.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return h}static serialize(e,n){const r=new Float64Array(e.ids),c=new Uint32Array(e.positions);return qp(r,c,0,r.length-1),n&&n.push(r.buffer,c.buffer),{ids:r,positions:c}}static deserialize(e){const n=new Gh;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function eg(i){const e=+i;return!isNaN(e)&&e<=it?e:Bc(String(i))}function qp(i,e,n,r){for(;n<r;){const c=i[n+r>>1];let h=n-1,p=r+1;for(;;){do h++;while(i[h]<c);do p--;while(i[p]>c);if(h>=p)break;Zh(i,h,p),Zh(e,3*h,3*p),Zh(e,3*h+1,3*p+1),Zh(e,3*h+2,3*p+2)}p-n<r-p?(qp(i,e,n,p),n=p+1):(qp(i,e,p+1,r),r=p)}}function Zh(i,e,n){const r=i[e];i[e]=i[n],i[n]=r}Je("FeaturePositionMap",Gh);class io{constructor(e,n){this.gl=e.gl,this.location=n}}class qh extends io{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class tg extends io{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ig extends io{constructor(e,n){super(e,n),this.current=kt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const p1=new Float32Array(16),f1=new Float32Array(9),m1=new Float32Array(4);function Wp(i){return[Se(255*i.r,255*i.g),Se(255*i.b,255*i.a)]}class Fc{constructor(e,n,r){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=r}setUniform(e,n,r){e.set(r.constantOr(this.value))}getBinding(e,n,r){return this.type==="color"?new ig(e,n):new qh(e,n)}}class sl{constructor(e,n){this.uniformNames=n.map(r=>`u_${r}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tl.concat(n.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,n,r,c){const h=c==="u_pattern_to"||c==="u_dash_to"?this.patternTo:c==="u_pattern_from"||c==="u_dash_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,n,r){return r==="u_pattern_from"||r==="u_pattern_to"||r==="u_dash_from"||r==="u_dash_to"?new tg(e,n):new qh(e,n)}}class no{constructor(e,n,r,c){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=n.map(h=>({name:`a_${h}`,type:"Float32",components:r==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,r,c,h,p){const g=this.paintVertexArray.length,y=this.expression.evaluate(new z(0),n,{},h,c,p);this.paintVertexArray.resize(e),this._setPaintValue(g,e,y)}updatePaintArray(e,n,r,c,h){const p=this.expression.evaluate({zoom:0},r,c,void 0,h);this._setPaintValue(e,n,p)}_setPaintValue(e,n,r){if(this.type==="color"){const c=Wp(r);for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class or{constructor(e,n,r,c,h,p){this.expression=e,this.uniformNames=n.map(g=>`u_${g}_t`),this.type=r,this.useIntegerZoom=c,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:r==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,r,c,h,p){const g=this.expression.evaluate(new z(this.zoom),n,{},h,c,p),y=this.expression.evaluate(new z(this.zoom+1),n,{},h,c,p),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,g,y)}updatePaintArray(e,n,r,c,h){const p=this.expression.evaluate({zoom:this.zoom},r,c,void 0,h),g=this.expression.evaluate({zoom:this.zoom+1},r,c,void 0,h);this._setPaintValue(e,n,p,g)}_setPaintValue(e,n,r,c){if(this.type==="color"){const h=Wp(r),p=Wp(c);for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,h[0],h[1],p[0],p[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,r,c);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const r=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=Ye(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,n,r){return new qh(e,n)}}class $o{constructor(e,n,r,c,h,p,g){this.expression=e,this.type=r,this.useIntegerZoom=c,this.zoom=h,this.layerId=g,this.paintVertexAttributes=(r==="array"?u1:c1).members;for(let y=0;y<n.length;++y);this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,n,r){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],r)}updatePaintArray(e,n,r,c,h,p){this._setPaintValues(e,n,r.patterns&&r.patterns[this.layerId],p)}_setPaintValues(e,n,r,c){if(!c||!r)return;const{min:h,mid:p,max:g}=r,y=c[h],w=c[p],T=c[g];if(y&&w&&T)for(let S=e;S<n;S++)this._setPaintValue(this.zoomInPaintVertexArray,S,w,y),this._setPaintValue(this.zoomOutPaintVertexArray,S,w,T)}_setPaintValue(e,n,r,c){e.emplace(n,r.tl[0],r.tl[1],r.br[0],r.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],r.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ro{constructor(e,n,r=()=>!0){this.binders={},this._buffers=[];const c=[];for(const h in e.paint._values){if(!r(h))continue;const p=e.paint.get(h);if(!(p instanceof X&&wr(p.property.specification)))continue;const g=g1(h,e.type),y=p.value,w=p.property.specification.type,T=p.property.useIntegerZoom,S=p.property.specification["property-type"],I=S==="cross-faded"||S==="cross-faded-data-driven",D=String(h)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||D)if(y.kind==="source"||D||I){const L=ng(h,w,"source");this.binders[h]=I?new $o(y,g,w,T,n,L,e.id):new no(y,g,w,L),c.push(`/a_${h}`)}else{const L=ng(h,w,"composite");this.binders[h]=new or(y,g,w,T,n,L),c.push(`/z_${h}`)}else this.binders[h]=I?new sl(y.value,g):new Fc(y.value,g,w),c.push(`/u_${h}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof no||n instanceof or?n.maxValue:0}populatePaintArrays(e,n,r,c,h,p){for(const g in this.binders){const y=this.binders[g];(y instanceof no||y instanceof or||y instanceof $o)&&y.populatePaintArray(e,n,r,c,h,p)}}setConstantPatternPositions(e,n){for(const r in this.binders){const c=this.binders[r];c instanceof sl&&c.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,r,c,h,p){let g=!1;for(const y in e){const w=n.getPositions(y);for(const T of w){const S=r.feature(T.index);for(const I in this.binders){const D=this.binders[I];if((D instanceof no||D instanceof or||D instanceof $o)&&D.expression.isStateDependent===!0){const L=c.paint.get(I);D.expression=L.value,D.updatePaintArray(T.start,T.end,S,e[y],h,p),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const r=this.binders[n];(r instanceof Fc||r instanceof sl)&&e.push(...r.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof no||r instanceof or||r instanceof $o)for(let c=0;c<r.paintVertexAttributes.length;c++)e.push(r.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof Fc||r instanceof sl||r instanceof or)for(const c of r.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const r=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof Fc||h instanceof sl||h instanceof or){for(const p of h.uniformNames)if(n[p]){const g=h.getBinding(e,n[p],p);r.push({name:p,property:c,binding:g})}}}return r}setUniforms(e,n,r,c){for(const{name:h,property:p,binding:g}of n)this.binders[p].setUniform(g,c,r.get(p),h)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const r=this.binders[n];if(e&&r instanceof $o){const c=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(r instanceof no||r instanceof or)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const n in this.binders){const r=this.binders[n];(r instanceof no||r instanceof or||r instanceof $o)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof no||n instanceof or||n instanceof $o)&&n.destroy()}}}class Xs{constructor(e,n,r=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new ro(c,n,r);this.needsUpload=!1,this._featureMap=new Gh,this._bufferOffset=0}populatePaintArrays(e,n,r,c,h,p,g){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(e,n,c,h,p,g);n.id!==void 0&&this._featureMap.add(n.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,r,c,h){for(const p of r)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,n,p,c,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const _1={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function g1(i,e){return _1[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const y1={"line-pattern":{source:ft,composite:ft},"fill-pattern":{source:ft,composite:ft},"fill-extrusion-pattern":{source:ft,composite:ft},"line-dasharray":{source:st,composite:st}},x1={color:{source:Xt,composite:un},number:{source:Wt,composite:Xt}};function ng(i,e,n){const r=y1[i];return r&&r[n]||x1[e][n]}Je("ConstantBinder",Fc),Je("CrossFadedConstantBinder",sl),Je("SourceExpressionBinder",no),Je("CrossFadedCompositeBinder",$o),Je("CompositeExpressionBinder",or),Je("ProgramConfiguration",ro,{omit:["_buffers"]}),Je("ProgramConfigurationSet",Xs);const Wh="-transition";class sr extends Ne{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new N(n.layout)),n.paint)){this._transitionablePaint=new $(n.paint);for(const r in e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(const r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new K(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,r={}){n!=null&&this._validate(Ch,`layers.${this.id}.layout.${e}`,e,n,r)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return zn(e,Wh)?this._transitionablePaint.getTransition(e.slice(0,-Wh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,r={}){if(n!=null&&this._validate(Ja,`layers.${this.id}.paint.${e}`,e,n,r))return!1;if(zn(e,Wh))return this._transitionablePaint.setTransition(e.slice(0,-Wh.length),n||void 0),!1;{const c=this._transitionablePaint._values[e],h=c.property.specification["property-type"]==="cross-faded-data-driven",p=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value;return y.isDataDriven()||p||h||this._handleOverridablePaintPropertyUpdate(e,g,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),mn(e,(n,r)=>!(n===void 0||r==="layout"&&!Object.keys(n).length||r==="paint"&&!Object.keys(n).length))}_validate(e,n,r,c,h={}){return(!h||h.validate!==!1)&&Ih(this,e.call(to,{key:n,layerType:this.type,objectKey:r,value:c,styleSpec:le,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof X&&wr(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ls(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const v1=ye([{name:"a_pos",components:2,type:"Int16"}],4),{members:w1}=v1;class ki{constructor(e=[]){this.segments=e}prepareSegment(e,n,r,c){let h=this.segments[this.segments.length-1];return e>ki.MAX_VERTEX_ARRAY_LENGTH&&nt(`Max vertices per segment is ${ki.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>ki.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==c)&&(h={vertexOffset:n.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},c!==void 0&&(h.sortKey=c),this.segments.push(h)),h}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,r,c){return new ki([{vertexOffset:e,primitiveOffset:n,vertexLength:r,primitiveLength:c,vaos:{},sortKey:0}])}}ki.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Je("SegmentVector",ki);var At=8192;class Hs{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Nt?new Nt(e.lng,e.lat):Nt.convert(e),this}setSouthWest(e){return this._sw=e instanceof Nt?new Nt(e.lng,e.lat):Nt.convert(e),this}extend(e){const n=this._sw,r=this._ne;let c,h;if(e instanceof Nt)c=e,h=e;else{if(!(e instanceof Hs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Hs.convert(e)):this.extend(Nt.convert(e)):this;if(c=e._sw,h=e._ne,!c||!h)return this}return n||r?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),r.lng=Math.max(h.lng,r.lng),r.lat=Math.max(h.lat,r.lat)):(this._sw=new Nt(c.lng,c.lat),this._ne=new Nt(h.lng,h.lat)),this}getCenter(){return new Nt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Nt(this.getWest(),this.getNorth())}getSouthEast(){return new Nt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:r}=Nt.convert(e);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&c}static convert(e){return!e||e instanceof Hs?e:new Hs(e)}}const rg=63710088e-1;class Nt{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Nt(dt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,r=this.lat*n,c=e.lat*n,h=Math.sin(r)*Math.sin(c)+Math.cos(r)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return rg*Math.acos(Math.min(h,1))}toBounds(e=0){const n=360*e/40075017,r=n/Math.cos(Math.PI/180*this.lat);return new Hs(new Nt(this.lng-r,this.lat-n),new Nt(this.lng+r,this.lat+n))}static convert(e){if(e instanceof Nt)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Nt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Nt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const og=2*Math.PI*rg;function sg(i){return og*Math.cos(i*Math.PI/180)}function Xp(i){return(180+i)/360}function Hp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Yp(i,e){return i/sg(e)}function Ys(i){return 360*i-180}function Ar(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Kp(i,e){return i*sg(Ar(e))}const Go=85.051129;class Xh{constructor(e,n,r=0){this.x=+e,this.y=+n,this.z=+r}static fromLngLat(e,n=0){const r=Nt.convert(e);return new Xh(Xp(r.lng),Hp(r.lat),Yp(n,r.lat))}toLngLat(){return new Nt(Ys(this.x),Ar(this.y))}toAltitude(){return Kp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/og*(e=Ar(this.y),1/Math.cos(e*Math.PI/180));var e}}function Jp(i,e,n,r,c,h,p,g,y){const w=(e+r)/2,T=(n+c)/2,S=new _e(w,T);g(S),function(I,D,L,O,Z,Y){const ee=L-Z,se=O-Y;return Math.abs((O-D)*ee-(L-I)*se)/Math.hypot(ee,se)}(S.x,S.y,h.x,h.y,p.x,p.y)>=y?(Jp(i,e,n,w,T,h,S,g,y),Jp(i,w,T,r,c,S,p,g,y)):i.push(p)}function b1(i,e,n){const r=[];let c,h,p;for(const g of i){const{x:y,y:w}=g;e(g),p?Jp(r,c,h,y,w,p,g,e,n):r.push(g),c=y,h=w,p=g}return r}const Qp=Math.pow(2,14)-1,ag=-Qp-1;function T1(i,e){const n=Math.round(i.x*e),r=Math.round(i.y*e);return i.x=Ye(n,ag,Qp),i.y=Ye(r,ag,Qp),(n<i.x||n>i.x+1||r<i.y||r>i.y+1)&&nt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function oo(i,e,n){const r=i.loadGeometry(),c=i.extent,h=At/c;if(e&&n&&n.projection.name!=="mercator"){const p=1<<e.z,{scale:g,x:y,y:w,projection:T}=n,S=I=>{const D=Ys((e.x+I.x/c)/p),L=Ar((e.y+I.y/c)/p),O=T.project(D,L);I.x=(O.x*g-y)*c,I.y=(O.y*g-w)*c};for(let I=0;I<r.length;I++)if(i.type!==1)r[I]=b1(r[I],S,1);else{const D=[];for(const L of r[I])L.x<0||L.x>=c||L.y<0||L.y>=c||(S(L),D.push(L));r[I]=D}}for(const p of r)for(const g of p)T1(g,h);return r}function Ks(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?oo(i):[]}}function Hh(i,e,n,r,c){i.emplaceBack(2*e+(r+1)/2,2*n+(c+1)/2)}class ef{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Qe,this.indexArray=new mi,this.segments=new ki,this.programConfigurations=new Xs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,r,c){const h=this.layers[0],p=[];let g=null;h.type==="circle"&&(g=h.layout.get("circle-sort-key"));for(const{feature:y,id:w,index:T,sourceLayerIndex:S}of e){const I=this.layers[0]._featureFilter.needGeometry,D=Ks(y,I);if(!this.layers[0]._featureFilter.filter(new z(this.zoom),D,r))continue;const L=g?g.evaluate(D,{},r):void 0,O={id:w,properties:y.properties,type:y.type,sourceLayerIndex:S,index:T,geometry:I?D.geometry:oo(y,r,c),patterns:{},sortKey:L};p.push(O)}g&&p.sort((y,w)=>y.sortKey-w.sortKey);for(const y of p){const{geometry:w,index:T,sourceLayerIndex:S}=y,I=e[T].feature;this.addFeature(y,w,T,n.availableImages,r),n.featureIndex.insert(I,w,T,S,this.index)}}update(e,n,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,r,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,w1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,r,c,h){for(const p of n)for(const g of p){const y=g.x,w=g.y;if(y<0||y>=At||w<0||w>=At)continue;const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=T.vertexLength;Hh(this.layoutVertexArray,y,w,-1,-1),Hh(this.layoutVertexArray,y,w,1,-1),Hh(this.layoutVertexArray,y,w,1,1),Hh(this.layoutVertexArray,y,w,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+3,S+2),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},c,h)}}function lg(i,e){for(let n=0;n<i.length;n++)if(al(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(al(i,e[n]))return!0;return!!tf(i,e)}function E1(i,e,n){return!!al(i,e)||!!nf(e,i,n)}function cg(i,e){if(i.length===1)return hg(e,i[0]);for(let n=0;n<e.length;n++){const r=e[n];for(let c=0;c<r.length;c++)if(al(i,r[c]))return!0}for(let n=0;n<i.length;n++)if(hg(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(tf(i,e[n]))return!0;return!1}function S1(i,e,n){if(i.length>1){if(tf(i,e))return!0;for(let r=0;r<e.length;r++)if(nf(e[r],i,n))return!0}for(let r=0;r<i.length;r++)if(nf(i[r],e,n))return!0;return!1}function tf(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const r=i[n],c=i[n+1];for(let h=0;h<e.length-1;h++)if(C1(r,c,e[h],e[h+1]))return!0}return!1}function C1(i,e,n,r){return zt(i,n,r)!==zt(e,n,r)&&zt(i,e,n)!==zt(i,e,r)}function nf(i,e,n){const r=n*n;if(e.length===1)return i.distSqr(e[0])<r;for(let c=1;c<e.length;c++)if(ug(i,e[c-1],e[c])<r)return!0;return!1}function ug(i,e,n){const r=e.distSqr(n);if(r===0)return i.distSqr(e);const c=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/r;return i.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function hg(i,e){let n,r,c,h=!1;for(let p=0;p<i.length;p++){n=i[p];for(let g=0,y=n.length-1;g<n.length;y=g++)r=n[g],c=n[y],r.y>e.y!=c.y>e.y&&e.x<(c.x-r.x)*(e.y-r.y)/(c.y-r.y)+r.x&&(h=!h)}return h}function al(i,e){let n=!1;for(let r=0,c=i.length-1;r<i.length;c=r++){const h=i[r],p=i[c];h.y>e.y!=p.y>e.y&&e.x<(p.x-h.x)*(e.y-h.y)/(p.y-h.y)+h.x&&(n=!n)}return n}function dg(i,e,n,r,c){for(const p of i)if(e<=p.x&&n<=p.y&&r>=p.x&&c>=p.y)return!0;const h=[new _e(e,n),new _e(e,c),new _e(r,c),new _e(r,n)];if(i.length>2){for(const p of h)if(al(i,p))return!0}for(let p=0;p<i.length-1;p++)if(I1(i[p],i[p+1],h))return!0;return!1}function I1(i,e,n){const r=n[0],c=n[2];if(i.x<r.x&&e.x<r.x||i.x>c.x&&e.x>c.x||i.y<r.y&&e.y<r.y||i.y>c.y&&e.y>c.y)return!1;const h=zt(i,e,n[0]);return h!==zt(i,e,n[1])||h!==zt(i,e,n[2])||h!==zt(i,e,n[3])}function ll(i,e,n){const r=e.paint.get(i).value;return r.kind==="constant"?r.value:n.programConfigurations.get(e.id).getMaxValue(i)}function Yh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function pg(i,e,n,r,c){if(!e[0]&&!e[1])return i;const h=_e.convert(e)._mult(c);n==="viewport"&&h._rotate(-r);const p=[];for(let g=0;g<i.length;g++)p.push(i[g].sub(h));return p}function fg(i,e,n,r){const c=_e.convert(i)._mult(r);return e==="viewport"&&c._rotate(-n),c}Je("CircleBucket",ef,{omit:["layers"]});const A1=new Ee({"circle-sort-key":new J(le.layout_circle["circle-sort-key"])});var M1={paint:new Ee({"circle-radius":new J(le.paint_circle["circle-radius"]),"circle-color":new J(le.paint_circle["circle-color"]),"circle-blur":new J(le.paint_circle["circle-blur"]),"circle-opacity":new J(le.paint_circle["circle-opacity"]),"circle-translate":new j(le.paint_circle["circle-translate"]),"circle-translate-anchor":new j(le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new j(le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new j(le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new J(le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new J(le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new J(le.paint_circle["circle-stroke-opacity"])}),layout:A1},Qi=typeof Float32Array!="undefined"?Float32Array:Array;function mg(){var i=new Qi(9);return Qi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function rf(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function _g(i,e,n){var r=e[0],c=e[1],h=e[2],p=e[3],g=e[4],y=e[5],w=e[6],T=e[7],S=e[8],I=e[9],D=e[10],L=e[11],O=e[12],Z=e[13],Y=e[14],ee=e[15],se=n[0],ce=n[1],ae=n[2],he=n[3];return i[0]=se*r+ce*g+ae*S+he*O,i[1]=se*c+ce*y+ae*I+he*Z,i[2]=se*h+ce*w+ae*D+he*Y,i[3]=se*p+ce*T+ae*L+he*ee,i[4]=(se=n[4])*r+(ce=n[5])*g+(ae=n[6])*S+(he=n[7])*O,i[5]=se*c+ce*y+ae*I+he*Z,i[6]=se*h+ce*w+ae*D+he*Y,i[7]=se*p+ce*T+ae*L+he*ee,i[8]=(se=n[8])*r+(ce=n[9])*g+(ae=n[10])*S+(he=n[11])*O,i[9]=se*c+ce*y+ae*I+he*Z,i[10]=se*h+ce*w+ae*D+he*Y,i[11]=se*p+ce*T+ae*L+he*ee,i[12]=(se=n[12])*r+(ce=n[13])*g+(ae=n[14])*S+(he=n[15])*O,i[13]=se*c+ce*y+ae*I+he*Z,i[14]=se*h+ce*w+ae*D+he*Y,i[15]=se*p+ce*T+ae*L+he*ee,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var k1=_g;function Kh(){var i=new Qi(3);return Qi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function gg(i){return Math.hypot(i[0],i[1],i[2])}function cl(i,e,n){var r=new Qi(3);return r[0]=i,r[1]=e,r[2]=n,r}function yg(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i}function xg(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i}function vg(i,e,n,r){return i[0]=e[0]+n[0]*r,i[1]=e[1]+n[1]*r,i[2]=e[2]+n[2]*r,i}function wg(i,e){var n=e[0],r=e[1],c=e[2],h=n*n+r*r+c*c;return h>0&&(h=1/Math.sqrt(h)),i[0]=e[0]*h,i[1]=e[1]*h,i[2]=e[2]*h,i}function bg(i,e,n){var r=n[0],c=n[1],h=n[2],p=e[0],g=e[1],y=e[2],w=c*y-h*g,T=h*p-r*y,S=r*g-c*p,I=c*S-h*T,D=h*w-r*S,L=r*T-c*w,O=2*n[3];return T*=O,S*=O,D*=2,L*=2,i[0]=p+(w*=O)+(I*=2),i[1]=g+T+D,i[2]=y+S+L,i}var Oc,z1=yg,P1=xg,D1=gg;function Uc(i,e,n){var r=e[0],c=e[1],h=e[2],p=e[3];return i[0]=n[0]*r+n[4]*c+n[8]*h+n[12]*p,i[1]=n[1]*r+n[5]*c+n[9]*h+n[13]*p,i[2]=n[2]*r+n[6]*c+n[10]*h+n[14]*p,i[3]=n[3]*r+n[7]*c+n[11]*h+n[15]*p,i}function of(){var i=new Qi(4);return Qi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Tg(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Eg(i,e,n){n*=.5;var r=e[0],c=e[1],h=e[2],p=e[3],g=Math.sin(n),y=Math.cos(n);return i[0]=r*y+p*g,i[1]=c*y+h*g,i[2]=h*y-c*g,i[3]=p*y-r*g,i}function Sg(i,e){return i[0]===e[0]&&i[1]===e[1]}function Cg(i,e,n,r,c,h,p,g,y){if(h&&i.queryGeometry.isAboveHorizon)return!1;h&&(y*=i.pixelToTileUnitsFactor);for(const w of e)for(const T of w){const S=T.add(g),I=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(S.x,S.y,!0):0,D=h?S:L1(S,I,r),L=h?i.tilespaceRays.map(Z=>B1(Z,I)):i.queryGeometry.screenGeometry,O=Uc([],[T.x,T.y,I,1],r);if(!p&&h?y*=O[3]/n.cameraToCenterDistance:p&&!h&&(y*=n.cameraToCenterDistance/O[3]),E1(L,D,y))return!0}return!1}function L1(i,e,n){const r=Uc([],[i.x,i.y,e,1],n);return new _e(r[0]/r[3],r[1]/r[3])}Kh(),Oc=new Qi(4),Qi!=Float32Array&&(Oc[0]=0,Oc[1]=0,Oc[2]=0,Oc[3]=0),Kh(),cl(1,0,0),cl(0,1,0),of(),of(),mg(),function(){var i;i=new Qi(2),Qi!=Float32Array&&(i[0]=0,i[1]=0)}();const Ig=cl(0,0,0),R1=cl(0,0,1);function B1(i,e){const n=Kh();return Ig[2]=e,i.intersectsPlane(Ig,R1,n),new _e(n[0],n[1])}class Ag extends ef{}function sf(i,{width:e,height:n},r,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*r)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*r);return i.width=e,i.height=n,i.data=c,i}function Mg(i,{width:e,height:n},r){if(e===i.width&&n===i.height)return;const c=sf({},{width:e,height:n},r);af(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},r),i.width=e,i.height=n,i.data=c.data}function af(i,e,n,r,c,h){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||n.x>i.width-c.width||n.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||r.x>e.width-c.width||r.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,g=e.data;for(let y=0;y<c.height;y++){const w=((n.y+y)*i.width+n.x)*h,T=((r.y+y)*e.width+r.x)*h;for(let S=0;S<c.width*h;S++)g[T+S]=p[w+S]}return e}Je("HeatmapBucket",Ag,{omit:["layers"]});class Zo{constructor(e,n){sf(this,e,1,n)}resize(e){Mg(this,e,1)}clone(){return new Zo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,r,c,h){af(e,n,r,c,h,1)}}class Fn{constructor(e,n){sf(this,e,4,n)}resize(e){Mg(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Fn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,r,c,h){af(e,n,r,c,h,4)}}Je("AlphaImage",Zo),Je("RGBAImage",Fn);var F1={paint:new Ee({"heatmap-radius":new J(le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new J(le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new j(le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xe(le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new j(le.paint_heatmap["heatmap-opacity"])})};function lf(i){const e={},n=i.resolution||256,r=i.clips?i.clips.length:1,c=i.image||new Fn({width:n,height:r}),h=(p,g,y)=>{e[i.evaluationKey]=y;const w=i.expression.evaluate(e);c.data[p+g+0]=Math.floor(255*w.r/w.a),c.data[p+g+1]=Math.floor(255*w.g/w.a),c.data[p+g+2]=Math.floor(255*w.b/w.a),c.data[p+g+3]=Math.floor(255*w.a)};if(i.clips)for(let p=0,g=0;p<r;++p,g+=4*n)for(let y=0,w=0;y<n;y++,w+=4){const T=y/(n-1),{start:S,end:I}=i.clips[p];h(g,w,S*(1-T)+I*T)}else for(let p=0,g=0;p<n;p++,g+=4)h(0,g,p/(n-1));return c}var O1={paint:new Ee({"hillshade-illumination-direction":new j(le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new j(le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new j(le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new j(le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new j(le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new j(le.paint_hillshade["hillshade-accent-color"])})};const U1=ye([{name:"a_pos",components:2,type:"Int16"}],4),{members:N1}=U1;var Jh=Qh,V1=Qh;function Qh(i,e,n){n=n||2;var r,c,h,p,g,y,w,T=e&&e.length,S=T?e[0]*n:i.length,I=kg(i,0,S,n,!0),D=[];if(!I||I.next===I.prev)return D;if(T&&(I=function(O,Z,Y,ee){var se,ce,ae,he=[];for(se=0,ce=Z.length;se<ce;se++)(ae=kg(O,Z[se]*ee,se<ce-1?Z[se+1]*ee:O.length,ee,!1))===ae.next&&(ae.steiner=!0),he.push(H1(ae));for(he.sort(q1),se=0;se<he.length;se++)Y=qo(Y=W1(he[se],Y),Y.next);return Y}(i,e,I,n)),i.length>80*n){r=h=i[0],c=p=i[1];for(var L=n;L<S;L+=n)(g=i[L])<r&&(r=g),(y=i[L+1])<c&&(c=y),g>h&&(h=g),y>p&&(p=y);w=(w=Math.max(h-r,p-c))!==0?1/w:0}return Nc(I,D,n,r,c,w),D}function kg(i,e,n,r,c){var h,p;if(c===hf(i,e,n,r)>0)for(h=e;h<n;h+=r)p=Dg(h,i[h],i[h+1],p);else for(h=n-r;h>=e;h-=r)p=Dg(h,i[h],i[h+1],p);return p&&ed(p,p.next)&&(jc(p),p=p.next),p}function qo(i,e){if(!i)return i;e||(e=i);var n,r=i;do if(n=!1,r.steiner||!ed(r,r.next)&&hi(r.prev,r,r.next)!==0)r=r.next;else{if(jc(r),(r=e=r.prev)===r.next)break;n=!0}while(n||r!==e);return e}function Nc(i,e,n,r,c,h,p){if(i){!p&&h&&function(T,S,I,D){var L=T;do L.z===null&&(L.z=cf(L.x,L.y,S,I,D)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==T);L.prevZ.nextZ=null,L.prevZ=null,function(O){var Z,Y,ee,se,ce,ae,he,Ce,we=1;do{for(Y=O,O=null,ce=null,ae=0;Y;){for(ae++,ee=Y,he=0,Z=0;Z<we&&(he++,ee=ee.nextZ);Z++);for(Ce=we;he>0||Ce>0&&ee;)he!==0&&(Ce===0||!ee||Y.z<=ee.z)?(se=Y,Y=Y.nextZ,he--):(se=ee,ee=ee.nextZ,Ce--),ce?ce.nextZ=se:O=se,se.prevZ=ce,ce=se;Y=ee}ce.nextZ=null,we*=2}while(ae>1)}(L)}(i,r,c,h);for(var g,y,w=i;i.prev!==i.next;)if(g=i.prev,y=i.next,h?$1(i,r,c,h):j1(i))e.push(g.i/n),e.push(i.i/n),e.push(y.i/n),jc(i),i=y.next,w=y.next;else if((i=y)===w){p?p===1?Nc(i=G1(qo(i),e,n),e,n,r,c,h,2):p===2&&Z1(i,e,n,r,c,h):Nc(qo(i),e,n,r,c,h,1);break}}}function j1(i){var e=i.prev,n=i,r=i.next;if(hi(e,n,r)>=0)return!1;for(var c=i.next.next;c!==i.prev;){if(ul(e.x,e.y,n.x,n.y,r.x,r.y,c.x,c.y)&&hi(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function $1(i,e,n,r){var c=i.prev,h=i,p=i.next;if(hi(c,h,p)>=0)return!1;for(var g=c.x>h.x?c.x>p.x?c.x:p.x:h.x>p.x?h.x:p.x,y=c.y>h.y?c.y>p.y?c.y:p.y:h.y>p.y?h.y:p.y,w=cf(c.x<h.x?c.x<p.x?c.x:p.x:h.x<p.x?h.x:p.x,c.y<h.y?c.y<p.y?c.y:p.y:h.y<p.y?h.y:p.y,e,n,r),T=cf(g,y,e,n,r),S=i.prevZ,I=i.nextZ;S&&S.z>=w&&I&&I.z<=T;){if(S!==i.prev&&S!==i.next&&ul(c.x,c.y,h.x,h.y,p.x,p.y,S.x,S.y)&&hi(S.prev,S,S.next)>=0||(S=S.prevZ,I!==i.prev&&I!==i.next&&ul(c.x,c.y,h.x,h.y,p.x,p.y,I.x,I.y)&&hi(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;S&&S.z>=w;){if(S!==i.prev&&S!==i.next&&ul(c.x,c.y,h.x,h.y,p.x,p.y,S.x,S.y)&&hi(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;I&&I.z<=T;){if(I!==i.prev&&I!==i.next&&ul(c.x,c.y,h.x,h.y,p.x,p.y,I.x,I.y)&&hi(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function G1(i,e,n){var r=i;do{var c=r.prev,h=r.next.next;!ed(c,h)&&zg(c,r,r.next,h)&&Vc(c,h)&&Vc(h,c)&&(e.push(c.i/n),e.push(r.i/n),e.push(h.i/n),jc(r),jc(r.next),r=i=h),r=r.next}while(r!==i);return qo(r)}function Z1(i,e,n,r,c,h){var p=i;do{for(var g=p.next.next;g!==p.prev;){if(p.i!==g.i&&Y1(p,g)){var y=Pg(p,g);return p=qo(p,p.next),y=qo(y,y.next),Nc(p,e,n,r,c,h),void Nc(y,e,n,r,c,h)}g=g.next}p=p.next}while(p!==i)}function q1(i,e){return i.x-e.x}function W1(i,e){var n=function(h,p){var g,y=p,w=h.x,T=h.y,S=-1/0;do{if(T<=y.y&&T>=y.next.y&&y.next.y!==y.y){var I=y.x+(T-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(I<=w&&I>S){if(S=I,I===w){if(T===y.y)return y;if(T===y.next.y)return y.next}g=y.x<y.next.x?y:y.next}}y=y.next}while(y!==p);if(!g)return null;if(w===S)return g;var D,L=g,O=g.x,Z=g.y,Y=1/0;y=g;do w>=y.x&&y.x>=O&&w!==y.x&&ul(T<Z?w:S,T,O,Z,T<Z?S:w,T,y.x,y.y)&&(D=Math.abs(T-y.y)/(w-y.x),Vc(y,h)&&(D<Y||D===Y&&(y.x>g.x||y.x===g.x&&X1(g,y)))&&(g=y,Y=D)),y=y.next;while(y!==L);return g}(i,e);if(!n)return e;var r=Pg(n,i),c=qo(n,n.next);return qo(r,r.next),e===n?c:e}function X1(i,e){return hi(i.prev,i,e.prev)<0&&hi(e.next,i,i.next)<0}function cf(i,e,n,r,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-n)*c)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*c)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function H1(i){var e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function ul(i,e,n,r,c,h,p,g){return(c-p)*(e-g)-(i-p)*(h-g)>=0&&(i-p)*(r-g)-(n-p)*(e-g)>=0&&(n-p)*(h-g)-(c-p)*(r-g)>=0}function Y1(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,r){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==r.i&&c.next.i!==r.i&&zg(c,c.next,n,r))return!0;c=c.next}while(c!==n);return!1}(i,e)&&(Vc(i,e)&&Vc(e,i)&&function(n,r){var c=n,h=!1,p=(n.x+r.x)/2,g=(n.y+r.y)/2;do c.y>g!=c.next.y>g&&c.next.y!==c.y&&p<(c.next.x-c.x)*(g-c.y)/(c.next.y-c.y)+c.x&&(h=!h),c=c.next;while(c!==n);return h}(i,e)&&(hi(i.prev,i,e.prev)||hi(i,e.prev,e))||ed(i,e)&&hi(i.prev,i,i.next)>0&&hi(e.prev,e,e.next)>0)}function hi(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function ed(i,e){return i.x===e.x&&i.y===e.y}function zg(i,e,n,r){var c=id(hi(i,e,n)),h=id(hi(i,e,r)),p=id(hi(n,r,i)),g=id(hi(n,r,e));return c!==h&&p!==g||!(c!==0||!td(i,n,e))||!(h!==0||!td(i,r,e))||!(p!==0||!td(n,i,r))||!(g!==0||!td(n,e,r))}function td(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function id(i){return i>0?1:i<0?-1:0}function Vc(i,e){return hi(i.prev,i,i.next)<0?hi(i,e,i.next)>=0&&hi(i,i.prev,e)>=0:hi(i,e,i.prev)<0||hi(i,i.next,e)<0}function Pg(i,e){var n=new uf(i.i,i.x,i.y),r=new uf(e.i,e.x,e.y),c=i.next,h=e.prev;return i.next=e,e.prev=i,n.next=c,c.prev=n,r.next=n,n.prev=r,h.next=r,r.prev=h,r}function Dg(i,e,n,r){var c=new uf(i,e,n);return r?(c.next=r.next,c.prev=r,r.next.prev=c,r.next=c):(c.prev=c,c.next=c),c}function jc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function uf(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function hf(i,e,n,r){for(var c=0,h=e,p=n-r;h<n;h+=r)c+=(i[p]-i[h])*(i[h+1]+i[p+1]),p=h;return c}function K1(i,e,n,r,c){Lg(i,e,n||0,r||i.length-1,c||J1)}function Lg(i,e,n,r,c){for(;r>n;){if(r-n>600){var h=r-n+1,p=e-n+1,g=Math.log(h),y=.5*Math.exp(2*g/3),w=.5*Math.sqrt(g*y*(h-y)/h)*(p-h/2<0?-1:1);Lg(i,e,Math.max(n,Math.floor(e-p*y/h+w)),Math.min(r,Math.floor(e+(h-p)*y/h+w)),c)}var T=i[e],S=n,I=r;for($c(i,n,e),c(i[r],T)>0&&$c(i,n,r);S<I;){for($c(i,S,I),S++,I--;c(i[S],T)<0;)S++;for(;c(i[I],T)>0;)I--}c(i[n],T)===0?$c(i,n,I):$c(i,++I,r),I<=e&&(n=I+1),e<=I&&(r=I-1)}}function $c(i,e,n){var r=i[e];i[e]=i[n],i[n]=r}function J1(i,e){return i<e?-1:i>e?1:0}function df(i,e){const n=i.length;if(n<=1)return[i];const r=[];let c,h;for(let p=0;p<n;p++){const g=oi(i[p]);g!==0&&(i[p].area=Math.abs(g),h===void 0&&(h=g<0),h===g<0?(c&&r.push(c),c=[i[p]]):c.push(i[p]))}if(c&&r.push(c),e>1)for(let p=0;p<r.length;p++)r[p].length<=e||(K1(r[p],e,1,r[p].length-1,Q1),r[p]=r[p].slice(0,e));return r}function Q1(i,e){return e.area-i.area}function pf(i,e,n){const r=n.patternDependencies;let c=!1;for(const h of e){const p=h.paint.get(`${i}-pattern`);p.isConstant()||(c=!0);const g=p.constantOr(null);g&&(c=!0,r[g.to]=!0,r[g.from]=!0)}return c}function ff(i,e,n,r,c){const h=c.patternDependencies;for(const p of e){const g=p.paint.get(`${i}-pattern`).value;if(g.kind!=="constant"){let y=g.evaluate({zoom:r-1},n,{},c.availableImages),w=g.evaluate({zoom:r},n,{},c.availableImages),T=g.evaluate({zoom:r+1},n,{},c.availableImages);y=y&&y.name?y.name:y,w=w&&w.name?w.name:w,T=T&&T.name?T.name:T,h[y]=!0,h[w]=!0,h[T]=!0,n.patterns[p.id]={min:y,mid:w,max:T}}}return n}Qh.deviation=function(i,e,n,r){var c=e&&e.length,h=Math.abs(hf(i,0,c?e[0]*n:i.length,n));if(c)for(var p=0,g=e.length;p<g;p++)h-=Math.abs(hf(i,e[p]*n,p<g-1?e[p+1]*n:i.length,n));var y=0;for(p=0;p<r.length;p+=3){var w=r[p]*n,T=r[p+1]*n,S=r[p+2]*n;y+=Math.abs((i[w]-i[S])*(i[T+1]-i[w+1])-(i[w]-i[T])*(i[S+1]-i[w+1]))}return h===0&&y===0?0:Math.abs((y-h)/h)},Qh.flatten=function(i){for(var e=i[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,c=0;c<i.length;c++){for(var h=0;h<i[c].length;h++)for(var p=0;p<e;p++)n.vertices.push(i[c][h][p]);c>0&&n.holes.push(r+=i[c-1].length)}return n},Jh.default=V1;class nd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Qe,this.indexArray=new mi,this.indexArray2=new Ht,this.programConfigurations=new Xs(e.layers,e.zoom),this.segments=new ki,this.segments2=new ki,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,r,c){this.hasPattern=pf("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:g,id:y,index:w,sourceLayerIndex:T}of e){const S=this.layers[0]._featureFilter.needGeometry,I=Ks(g,S);if(!this.layers[0]._featureFilter.filter(new z(this.zoom),I,r))continue;const D=h?h.evaluate(I,{},r,n.availableImages):void 0,L={id:y,properties:g.properties,type:g.type,sourceLayerIndex:T,index:w,geometry:S?I.geometry:oo(g,r,c),patterns:{},sortKey:D};p.push(L)}h&&p.sort((g,y)=>g.sortKey-y.sortKey);for(const g of p){const{geometry:y,index:w,sourceLayerIndex:T}=g;if(this.hasPattern){const S=ff("fill",this.layers,g,this.zoom,n);this.patternFeatures.push(S)}else this.addFeature(g,y,w,r,{},n.availableImages);n.featureIndex.insert(e[w].feature,y,w,T,this.index)}}update(e,n,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,r,c)}addFeatures(e,n,r,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,r,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,N1),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,r,c,h,p=[]){for(const g of df(n,500)){let y=0;for(const L of g)y+=L.length;const w=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),T=w.vertexLength,S=[],I=[];for(const L of g){if(L.length===0)continue;L!==g[0]&&I.push(S.length/2);const O=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),Z=O.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(Z+L.length-1,Z),S.push(L[0].x),S.push(L[0].y);for(let Y=1;Y<L.length;Y++)this.layoutVertexArray.emplaceBack(L[Y].x,L[Y].y),this.indexArray2.emplaceBack(Z+Y-1,Z+Y),S.push(L[Y].x),S.push(L[Y].y);O.vertexLength+=L.length,O.primitiveLength+=L.length}const D=Jh(S,I);for(let L=0;L<D.length;L+=3)this.indexArray.emplaceBack(T+D[L],T+D[L+1],T+D[L+2]);w.vertexLength+=y,w.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,h,p,c)}}Je("FillBucket",nd,{omit:["layers","patternFeatures"]});const ew=new Ee({"fill-sort-key":new J(le.layout_fill["fill-sort-key"])});var tw={paint:new Ee({"fill-antialias":new j(le.paint_fill["fill-antialias"]),"fill-opacity":new J(le.paint_fill["fill-opacity"]),"fill-color":new J(le.paint_fill["fill-color"]),"fill-outline-color":new J(le.paint_fill["fill-outline-color"]),"fill-translate":new j(le.paint_fill["fill-translate"]),"fill-translate-anchor":new j(le.paint_fill["fill-translate-anchor"]),"fill-pattern":new ne(le.paint_fill["fill-pattern"])}),layout:ew};const iw=ye([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),nw=ye([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:rw}=iw;var Rg=hl;function hl(i,e,n,r,c){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=r,this._values=c,i.readFields(ow,this,e)}function ow(i,e,n){i==1?e.id=n.readVarint():i==2?function(r,c){for(var h=r.readVarint()+r.pos;r.pos<h;){var p=c._keys[r.readVarint()],g=c._values[r.readVarint()];c.properties[p]=g}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function sw(i){for(var e,n,r=0,c=0,h=i.length,p=h-1;c<h;p=c++)r+=((n=i[p]).x-(e=i[c]).x)*(e.y+n.y);return r}hl.types=["Unknown","Point","LineString","Polygon"],hl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,r=1,c=0,h=0,p=0,g=[];i.pos<n;){if(c<=0){var y=i.readVarint();r=7&y,c=y>>3}if(c--,r===1||r===2)h+=i.readSVarint(),p+=i.readSVarint(),r===1&&(e&&g.push(e),e=[]),e.push(new _e(h,p));else{if(r!==7)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&g.push(e),g},hl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,r=0,c=0,h=0,p=1/0,g=-1/0,y=1/0,w=-1/0;i.pos<e;){if(r<=0){var T=i.readVarint();n=7&T,r=T>>3}if(r--,n===1||n===2)(c+=i.readSVarint())<p&&(p=c),c>g&&(g=c),(h+=i.readSVarint())<y&&(y=h),h>w&&(w=h);else if(n!==7)throw new Error("unknown command "+n)}return[p,y,g,w]},hl.prototype.toGeoJSON=function(i,e,n){var r,c,h=this.extent*Math.pow(2,n),p=this.extent*i,g=this.extent*e,y=this.loadGeometry(),w=hl.types[this.type];function T(D){for(var L=0;L<D.length;L++){var O=D[L];D[L]=[360*(O.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+g)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(r=0;r<y.length;r++)S[r]=y[r][0];T(y=S);break;case 2:for(r=0;r<y.length;r++)T(y[r]);break;case 3:for(y=function(D){var L=D.length;if(L<=1)return[D];for(var O,Z,Y=[],ee=0;ee<L;ee++){var se=sw(D[ee]);se!==0&&(Z===void 0&&(Z=se<0),Z===se<0?(O&&Y.push(O),O=[D[ee]]):O.push(D[ee]))}return O&&Y.push(O),Y}(y),r=0;r<y.length;r++)for(c=0;c<y[r].length;c++)T(y[r][c])}y.length===1?y=y[0]:w="Multi"+w;var I={type:"Feature",geometry:{type:w,coordinates:y},properties:this.properties};return"id"in this&&(I.id=this.id),I};var Bg=Fg;function Fg(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(aw,this,e),this.length=this._features.length}function aw(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(r){for(var c=null,h=r.readVarint()+r.pos;r.pos<h;){var p=r.readVarint()>>3;c=p===1?r.readString():p===2?r.readFloat():p===3?r.readDouble():p===4?r.readVarint64():p===5?r.readVarint():p===6?r.readSVarint():p===7?r.readBoolean():null}return c}(n))}function lw(i,e,n){if(i===3){var r=new Bg(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}Fg.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Rg(this._pbf,e,this.extent,this._keys,this._values)};var Js={VectorTile:function(i,e){this.layers=i.readFields(lw,{},e)},VectorTileFeature:Rg,VectorTileLayer:Bg};const cw=Js.VectorTileFeature.types,uw=Math.pow(2,13);function Gc(i,e,n,r,c,h,p,g){i.emplaceBack((e<<1)+p,(n<<1)+h,(Math.floor(r*uw)<<1)+c,Math.round(g))}class Og{constructor(){this.acc=new _e(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new _e(e.x,e.y),this.max=new _e(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);let r=!!this.borders;const c=this.min,h=this.max;e.x<c.x?(c.x=e.x,r=!0):e.x>h.x&&(h.x=e.x,r=!0),e.y<c.y?(c.y=e.y,r=!0):e.y>h.y&&(h.y=e.y,r=!0),((e.x===0||e.x===At)&&e.x===n.x)!=((e.y===0||e.y===At)&&e.y===n.y)&&this.processBorderOverlap(e,n),r&&this.checkBorderIntersection(e,n)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Pt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>At!=e.x>At&&this.addBorderIntersection(1,Pt(n.y,e.y,(At-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Pt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>At!=e.y>At&&this.addBorderIntersection(3,Pt(n.x,e.x,(At-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];n<r[0]&&(r[0]=n),n>r[1]&&(r[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const r=e.x===0?0:1;this.addBorderIntersection(r,n.y),this.addBorderIntersection(r,e.y)}else{const r=e.y===0?2:3;this.addBorderIntersection(r,n.x),this.addBorderIntersection(r,e.x)}}centroid(){const e=this.polyCount.reduce((n,r)=>n+r.edges,0);return e!==0?this.acc.div(e)._round():new _e(0,0)}span(){return new _e(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class mf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new lt,this.centroidVertexArray=new J_,this.indexArray=new mi,this.programConfigurations=new Xs(e.layers,e.zoom),this.segments=new ki,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,r,c){this.features=[],this.hasPattern=pf("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(h){const p=Math.exp(Math.PI*(1-h.y/(1<<h.z)*2));return 80150034*p/(p*p+1)/At/(1<<h.z)}(r);for(const{feature:h,id:p,index:g,sourceLayerIndex:y}of e){const w=this.layers[0]._featureFilter.needGeometry,T=Ks(h,w);if(!this.layers[0]._featureFilter.filter(new z(this.zoom),T,r))continue;const S={id:p,sourceLayerIndex:y,index:g,geometry:w?T.geometry:oo(h,r,c),properties:h.properties,type:h.type,patterns:{}},I=this.layoutVertexArray.length;this.hasPattern?this.features.push(ff("fill-extrusion",this.layers,S,this.zoom,n)):this.addFeature(S,S.geometry,g,r,{},n.availableImages),n.featureIndex.insert(h,S.geometry,g,y,this.index,I)}this.sortBorders()}addFeatures(e,n,r,c){for(const h of this.features){const{geometry:p}=h;this.addFeature(h,p,h.index,n,r,c)}this.sortBorders()}update(e,n,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,r,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,nw.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,r,c,h,p){const g=this.enableTerrain?new Og:null;for(const w of df(n,500)){let T=0,S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(w.length===0||(y=w[0]).every(Z=>Z.x<=0)||y.every(Z=>Z.x>=At)||y.every(Z=>Z.y<=0)||y.every(Z=>Z.y>=At))continue;for(let Z=0;Z<w.length;Z++){const Y=w[Z];if(Y.length===0)continue;T+=Y.length;let ee=0;g&&g.startRing(Y[0]);for(let se=0;se<Y.length;se++){const ce=Y[se];if(se>=1){const ae=Y[se-1];if(!hw(ce,ae)){g&&g.append(ce,ae),S.vertexLength+4>ki.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const he=ce.sub(ae)._perp(),Ce=he.x/(Math.abs(he.x)+Math.abs(he.y)),we=he.y>0?1:0,Ge=ae.dist(ce);ee+Ge>32768&&(ee=0),Gc(this.layoutVertexArray,ce.x,ce.y,Ce,we,0,0,ee),Gc(this.layoutVertexArray,ce.x,ce.y,Ce,we,0,1,ee),ee+=Ge,Gc(this.layoutVertexArray,ae.x,ae.y,Ce,we,0,0,ee),Gc(this.layoutVertexArray,ae.x,ae.y,Ce,we,0,1,ee);const Le=S.vertexLength;this.indexArray.emplaceBack(Le,Le+2,Le+1),this.indexArray.emplaceBack(Le+1,Le+2,Le+3),S.vertexLength+=4,S.primitiveLength+=2}}}}if(S.vertexLength+T>ki.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),cw[e.type]!=="Polygon")continue;const I=[],D=[],L=S.vertexLength;for(let Z=0;Z<w.length;Z++){const Y=w[Z];if(Y.length!==0){Y!==w[0]&&D.push(I.length/2);for(let ee=0;ee<Y.length;ee++){const se=Y[ee];Gc(this.layoutVertexArray,se.x,se.y,0,0,1,1,0),I.push(se.x),I.push(se.y),g&&g.currentPolyCount.top++}}}const O=Jh(I,D);for(let Z=0;Z<O.length;Z+=3)this.indexArray.emplaceBack(L+O[Z],L+O[Z+2],L+O[Z+1]);S.primitiveLength+=O.length/3,S.vertexLength+=T}var y;if(g&&g.polyCount.length>0){if(g.borders){g.vertexArrayOffset=this.centroidVertexArray.length;const w=g.borders,T=this.featuresOnBorder.push(g)-1;for(let S=0;S<4;S++)w[S][0]!==Number.MAX_VALUE&&this.borders[S].push(T)}this.encodeCentroid(g.borders?void 0:g.centroid(),g)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,h,p,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,r)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}encodeCentroid(e,n,r=!0){let c,h;if(e)if(e.y!==0){const g=n.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(g.x/10)),h=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(g.y/10))}else c=Math.ceil(7*(e.x+450)),h=0;else c=0,h=+r;let p=r?this.centroidVertexArray.length:n.vertexArrayOffset;for(const g of n.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*g.edges+g.top);for(let y=0;y<2*g.edges;y++)this.centroidVertexArray.emplace(p++,0,h),this.centroidVertexArray.emplace(p++,c,h);for(let y=0;y<g.top;y++)this.centroidVertexArray.emplace(p++,c,h)}}}function hw(i,e){return i.x===e.x&&(i.x<0||i.x>At)||i.y===e.y&&(i.y<0||i.y>At)}Je("FillExtrusionBucket",mf,{omit:["layers","features"]}),Je("PartMetadata",Og);var dw={paint:new Ee({"fill-extrusion-opacity":new j(le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new J(le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new j(le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new j(le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ne(le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new J(le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new J(le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new j(le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Zc(i,e){return i.x*e.x+i.y*e.y}function Ug(i,e){if(i.length===1){let n=0;const r=e[n++];let c;for(;!c||r.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const h=e[n],p=i[0],g=c.sub(r),y=h.sub(r),w=p.sub(r),T=Zc(g,g),S=Zc(g,y),I=Zc(y,y),D=Zc(w,g),L=Zc(w,y),O=T*I-S*S,Z=(I*D-S*L)/O,Y=(T*L-S*D)/O,ee=r.z*(1-Z-Y)+c.z*Z+h.z*Y;if(isFinite(ee))return ee}return 1/0}{let n=1/0;for(const r of e)n=Math.min(n,r.z);return n}}function Ng(i){const e=new _e(i[0],i[1]);return e.z=i[2],e}function pw(i,e,n,r,c,h,p,g){const y=p*c.getElevationAt(i,e,!0,!0),w=h[0]!==0,T=w?h[1]===0?p*(h[0]/7-450):p*function(S,I,D){const L=Math.floor(I[0]/8),O=Math.floor(I[1]/8),Z=10*(I[0]-8*L),Y=10*(I[1]-8*O),ee=S.getElevationAt(L,O,!0,!0),se=S.getMeterToDEM(D),ce=Math.floor(.5*(Z*se-1)),ae=Math.floor(.5*(Y*se-1)),he=S.tileCoordToPixel(L,O),Ce=2*ce+1,we=2*ae+1,Ge=function(Ze,Ke,gt,$t,ht){return[Ze.getElevationAtPixel(Ke,gt,!0),Ze.getElevationAtPixel(Ke+ht,gt,!0),Ze.getElevationAtPixel(Ke,gt+ht,!0),Ze.getElevationAtPixel(Ke+$t,gt+ht,!0)]}(S,he.x-ce,he.y-ae,Ce,we),Le=Math.abs(Ge[0]-Ge[1]),Ie=Math.abs(Ge[2]-Ge[3]),Re=Math.abs(Ge[0]-Ge[2])+Math.abs(Ge[1]-Ge[3]),Be=Math.min(.25,.5*se*(Le+Ie)/Ce),Me=Math.min(.25,.5*se*Re/we);return ee+Math.max(Be*Z,Me*Y)}(c,h,g):y;return{base:y+(n===0)?-1:n,top:w?Math.max(T+r,y+n+2):y+r}}const fw=ye([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:mw}=fw,_w=ye([{name:"a_packed",components:3,type:"Float32"}]),{members:gw}=_w,yw=Js.VectorTileFeature.types,xw=Math.cos(Math.PI/180*37.5);class rd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new ut,this.layoutVertexArray2=new pt,this.indexArray=new mi,this.programConfigurations=new Xs(e.layers,e.zoom),this.segments=new ki,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,r,c){this.hasPattern=pf("line",this.layers,n);const h=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:T,id:S,index:I,sourceLayerIndex:D}of e){const L=this.layers[0]._featureFilter.needGeometry,O=Ks(T,L);if(!this.layers[0]._featureFilter.filter(new z(this.zoom),O,r))continue;const Z=h?h.evaluate(O,{},r):void 0,Y={id:S,properties:T.properties,type:T.type,sourceLayerIndex:D,index:I,geometry:L?O.geometry:oo(T,r,c),patterns:{},sortKey:Z};p.push(Y)}h&&p.sort((T,S)=>T.sortKey-S.sortKey);const{lineAtlas:g,featureIndex:y}=n,w=this.addConstantDashes(g);for(const T of p){const{geometry:S,index:I,sourceLayerIndex:D}=T;if(w&&this.addFeatureDashes(T,g),this.hasPattern){const L=ff("line",this.layers,T,this.zoom,n);this.patternFeatures.push(L)}else this.addFeature(T,S,I,r,g.positions,n.availableImages);y.insert(e[I].feature,S,I,D,this.index)}}addConstantDashes(e){let n=!1;for(const r of this.layers){const c=r.paint.get("line-dasharray").value,h=r.layout.get("line-cap").value;if(c.kind!=="constant"||h.kind!=="constant")n=!0;else{const p=h.value,g=c.value;if(!g)continue;e.addDash(g.from,p),e.addDash(g.to,p),g.other&&e.addDash(g.other,p)}}return n}addFeatureDashes(e,n){const r=this.zoom;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(h.kind==="constant"&&p.kind==="constant")continue;let g,y,w,T,S,I;if(h.kind==="constant"){const Z=h.value;if(!Z)continue;g=Z.other||Z.to,y=Z.to,w=Z.from}else g=h.evaluate({zoom:r-1},e),y=h.evaluate({zoom:r},e),w=h.evaluate({zoom:r+1},e);p.kind==="constant"?T=S=I=p.value:(T=p.evaluate({zoom:r-1},e),S=p.evaluate({zoom:r},e),I=p.evaluate({zoom:r+1},e)),n.addDash(g,T),n.addDash(y,S),n.addDash(w,I);const D=n.getKey(g,T),L=n.getKey(y,S),O=n.getKey(w,I);e.patterns[c.id]={min:D,mid:L,max:O}}}update(e,n,r,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,r,c)}addFeatures(e,n,r,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,r,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,gw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,r,c,h,p){const g=this.layers[0].layout,y=g.get("line-join").evaluate(e,{}),w=g.get("line-cap").evaluate(e,{}),T=g.get("line-miter-limit"),S=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const I of n)this.addLine(I,e,y,w,T,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,h,p,c)}addLine(e,n,r,c,h,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=yw[n.type]==="Polygon";let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let w=0;for(;w<y-1&&e[w].equals(e[w+1]);)w++;if(y<(g?3:2))return;r==="bevel"&&(h=1.05);const T=this.overscaling<=16?122880/(512*this.overscaling):0,S=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let I,D,L,O,Z;this.e1=this.e2=-1,g&&(I=e[y-2],Z=e[w].sub(I)._unit()._perp());for(let Y=w;Y<y;Y++){if(L=Y===y-1?g?e[w+1]:void 0:e[Y+1],L&&e[Y].equals(L))continue;Z&&(O=Z),I&&(D=I),I=e[Y],Z=L?L.sub(I)._unit()._perp():O,O=O||Z;let ee=O.add(Z);ee.x===0&&ee.y===0||ee._unit();const se=O.x*Z.x+O.y*Z.y,ce=ee.x*Z.x+ee.y*Z.y,ae=ce!==0?1/ce:1/0,he=2*Math.sqrt(2-2*ce),Ce=ce<xw&&D&&L,we=O.x*Z.y-O.y*Z.x>0;if(Ce&&Y>w){const Ie=I.dist(D);if(Ie>2*T){const Re=I.sub(I.sub(D)._mult(T/Ie)._round());this.updateDistance(D,Re),this.addCurrentVertex(Re,O,0,0,S),D=Re}}const Ge=D&&L;let Le=Ge?r:g?"butt":c;if(Ge&&Le==="round"&&(ae<p?Le="miter":ae<=2&&(Le="fakeround")),Le==="miter"&&ae>h&&(Le="bevel"),Le==="bevel"&&(ae>2&&(Le="flipbevel"),ae<h&&(Le="miter")),D&&this.updateDistance(D,I),Le==="miter")ee._mult(ae),this.addCurrentVertex(I,ee,0,0,S);else if(Le==="flipbevel"){if(ae>100)ee=Z.mult(-1);else{const Ie=ae*O.add(Z).mag()/O.sub(Z).mag();ee._perp()._mult(Ie*(we?-1:1))}this.addCurrentVertex(I,ee,0,0,S),this.addCurrentVertex(I,ee.mult(-1),0,0,S)}else if(Le==="bevel"||Le==="fakeround"){const Ie=-Math.sqrt(ae*ae-1),Re=we?Ie:0,Be=we?0:Ie;if(D&&this.addCurrentVertex(I,O,Re,Be,S),Le==="fakeround"){const Me=Math.round(180*he/Math.PI/20);for(let Ze=1;Ze<Me;Ze++){let Ke=Ze/Me;if(Ke!==.5){const $t=Ke-.5;Ke+=Ke*$t*(Ke-1)*((1.0904+se*(se*(3.55645-1.43519*se)-3.2452))*$t*$t+(.848013+se*(.215638*se-1.06021)))}const gt=Z.sub(O)._mult(Ke)._add(O)._unit()._mult(we?-1:1);this.addHalfVertex(I,gt.x,gt.y,!1,we,0,S)}}L&&this.addCurrentVertex(I,Z,-Re,-Be,S)}else if(Le==="butt")this.addCurrentVertex(I,ee,0,0,S);else if(Le==="square"){const Ie=D?1:-1;D||this.addCurrentVertex(I,ee,Ie,Ie,S),this.addCurrentVertex(I,ee,0,0,S),D&&this.addCurrentVertex(I,ee,Ie,Ie,S)}else Le==="round"&&(D&&(this.addCurrentVertex(I,O,0,0,S),this.addCurrentVertex(I,O,1,1,S,!0)),L&&(this.addCurrentVertex(I,Z,-1,-1,S,!0),this.addCurrentVertex(I,Z,0,0,S)));if(Ce&&Y<y-1){const Ie=I.dist(L);if(Ie>2*T){const Re=I.add(L.sub(I)._mult(T/Ie)._round());this.updateDistance(I,Re),this.addCurrentVertex(Re,Z,0,0,S),I=Re}}}}addCurrentVertex(e,n,r,c,h,p=!1){const g=n.y*c-n.x,y=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*r,n.y-n.x*r,p,!1,r,h),this.addHalfVertex(e,g,y,p,!0,-c,h)}addHalfVertex({x:e,y:n},r,c,h,p,g,y){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(n<<1)+(p?1:0),Math.round(63*r)+128,Math.round(63*c)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const w=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),y.primitiveLength++),p?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}Je("LineBucket",rd,{omit:["layers","patternFeatures"]});const vw=new Ee({"line-cap":new J(le.layout_line["line-cap"]),"line-join":new J(le.layout_line["line-join"]),"line-miter-limit":new j(le.layout_line["line-miter-limit"]),"line-round-limit":new j(le.layout_line["line-round-limit"]),"line-sort-key":new J(le.layout_line["line-sort-key"])});var Vg={paint:new Ee({"line-opacity":new J(le.paint_line["line-opacity"]),"line-color":new J(le.paint_line["line-color"]),"line-translate":new j(le.paint_line["line-translate"]),"line-translate-anchor":new j(le.paint_line["line-translate-anchor"]),"line-width":new J(le.paint_line["line-width"]),"line-gap-width":new J(le.paint_line["line-gap-width"]),"line-offset":new J(le.paint_line["line-offset"]),"line-blur":new J(le.paint_line["line-blur"]),"line-dasharray":new ne(le.paint_line["line-dasharray"]),"line-pattern":new ne(le.paint_line["line-pattern"]),"line-gradient":new xe(le.paint_line["line-gradient"])}),layout:vw};const jg=new class extends J{possiblyEvaluate(i,e){return e=new z(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,n,r){return e=Yt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,n,r)}}(Vg.paint.properties["line-width"].specification);function $g(i,e){return e>0?e+2*i:i}jg.useIntegerZoom=!0;const ww=ye([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),bw=ye([{name:"a_projected_pos",components:3,type:"Float32"}],4);ye([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Tw=ye([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ew=ye([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gg=ye([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Sw=ye([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ye([{name:"triangle",components:3,type:"Uint16"}]),ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ye([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ye([{type:"Float32",name:"offsetX"}]),ye([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Oi=24;const Mr=128;function _f(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new z(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:r,interpolationType:c}=n;let h=0;for(;h<r.length&&r[h]<=i;)h++;h=Math.max(0,h-1);let p=h;for(;p<r.length&&r[p]<i+1;)p++;p=Math.min(r.length-1,p);const g=r[h],y=r[p];return n.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:y,interpolationType:c}:{kind:"camera",minZoom:g,maxZoom:y,minSize:n.evaluate(new z(g)),maxSize:n.evaluate(new z(y)),interpolationType:c}}}function od(i,{uSize:e,uSizeT:n},{lowerSize:r,upperSize:c}){return i.kind==="source"?r/Mr:i.kind==="composite"?Pt(r/Mr,c/Mr,n):e}function dl(i,e){let n=0,r=0;if(i.kind==="constant")r=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:h,maxZoom:p}=i,g=c?Ye(cn.interpolationFactor(c,e,h,p),0,1):0;i.kind==="camera"?r=Pt(i.minSize,i.maxSize,g):n=g}return{uSizeT:n,uSize:r}}var Cw=Object.freeze({__proto__:null,getSizeData:_f,evaluateSizeForFeature:od,evaluateSizeForZoom:dl,SIZE_PACK_FACTOR:Mr});function Iw(i,e,n){return i.sections.forEach(r=>{r.text=function(c,h,p){const g=h.layout.get("text-transform").evaluate(p,{});return g==="uppercase"?c=c.toLocaleUpperCase():g==="lowercase"&&(c=c.toLocaleLowerCase()),M.applyArabicShaping&&(c=M.applyArabicShaping(c)),c}(r.text,e,n)}),i}const qc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function Aw(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function Mw(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var Zg=function(i,e,n,r,c){var h,p,g=8*c-r-1,y=(1<<g)-1,w=y>>1,T=-7,S=n?c-1:0,I=n?-1:1,D=i[e+S];for(S+=I,h=D&(1<<-T)-1,D>>=-T,T+=g;T>0;h=256*h+i[e+S],S+=I,T-=8);for(p=h&(1<<-T)-1,h>>=-T,T+=r;T>0;p=256*p+i[e+S],S+=I,T-=8);if(h===0)h=1-w;else{if(h===y)return p?NaN:1/0*(D?-1:1);p+=Math.pow(2,r),h-=w}return(D?-1:1)*p*Math.pow(2,h-r)},qg=function(i,e,n,r,c,h){var p,g,y,w=8*h-c-1,T=(1<<w)-1,S=T>>1,I=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=r?0:h-1,L=r?1:-1,O=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,p=T):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+S>=1?I/y:I*Math.pow(2,1-S))*y>=2&&(p++,y/=2),p+S>=T?(g=0,p=T):p+S>=1?(g=(e*y-1)*Math.pow(2,c),p+=S):(g=e*Math.pow(2,S-1)*Math.pow(2,c),p=0));c>=8;i[n+D]=255&g,D+=L,g/=256,c-=8);for(p=p<<c|g,w+=c;w>0;i[n+D]=255&p,D+=L,p/=256,w-=8);i[n+D-L]|=128*O},Wc=jt;function jt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}jt.Varint=0,jt.Fixed64=1,jt.Bytes=2,jt.Fixed32=5;var gf=4294967296,Wg=1/gf,Xg=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function so(i){return i.type===jt.Bytes?i.readVarint()+i.pos:i.pos+1}function pl(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Hg(i,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var c=n.pos-1;c>=i;c--)n.buf[c+r]=n.buf[c]}function kw(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function zw(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function Pw(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function Dw(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function Lw(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function Rw(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function Bw(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function Fw(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function Ow(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function sd(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function fl(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function Yg(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Uw(i,e,n){e.glyphs=[],i===1&&n.readMessage(Nw,e)}function Nw(i,e,n){if(i===3){const{id:r,bitmap:c,width:h,height:p,left:g,top:y,advance:w}=n.readMessage(Vw,{});e.glyphs.push({id:r,bitmap:new Zo({width:h+6,height:p+6},c),metrics:{width:h,height:p,left:g,top:y,advance:w}})}else i===4?e.ascender=n.readSVarint():i===5&&(e.descender=n.readSVarint())}function Vw(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function yf(i){let e=0,n=0;for(const p of i)e+=p.w*p.h,n=Math.max(n,p.w);i.sort((p,g)=>g.h-p.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,h=0;for(const p of i)for(let g=r.length-1;g>=0;g--){const y=r[g];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,h=Math.max(h,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===y.w&&p.h===y.h){const w=r.pop();g<r.length&&(r[g]=w)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(r.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:c,h,fill:e/(c*h)||0}}jt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),c=r>>3,h=this.pos;this.type=7&r,i(c,e,this),this.pos===h&&this.skip(r)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=sd(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Yg(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=sd(this.buf,this.pos)+sd(this.buf,this.pos+4)*gf;return this.pos+=8,i},readSFixed64:function(){var i=sd(this.buf,this.pos)+Yg(this.buf,this.pos+4)*gf;return this.pos+=8,i},readFloat:function(){var i=Zg(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Zg(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(c,h,p){var g,y,w=p.buf;if(g=(112&(y=w[p.pos++]))>>4,y<128||(g|=(127&(y=w[p.pos++]))<<3,y<128)||(g|=(127&(y=w[p.pos++]))<<10,y<128)||(g|=(127&(y=w[p.pos++]))<<17,y<128)||(g|=(127&(y=w[p.pos++]))<<24,y<128)||(g|=(1&(y=w[p.pos++]))<<31,y<128))return pl(c,g,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Xg?function(n,r,c){return Xg.decode(n.subarray(r,c))}(this.buf,e,i):function(n,r,c){for(var h="",p=r;p<c;){var g,y,w,T=n[p],S=null,I=T>239?4:T>223?3:T>191?2:1;if(p+I>c)break;I===1?T<128&&(S=T):I===2?(192&(g=n[p+1]))==128&&(S=(31&T)<<6|63&g)<=127&&(S=null):I===3?(y=n[p+2],(192&(g=n[p+1]))==128&&(192&y)==128&&((S=(15&T)<<12|(63&g)<<6|63&y)<=2047||S>=55296&&S<=57343)&&(S=null)):I===4&&(y=n[p+2],w=n[p+3],(192&(g=n[p+1]))==128&&(192&y)==128&&(192&w)==128&&((S=(15&T)<<18|(63&g)<<12|(63&y)<<6|63&w)<=65535||S>=1114112)&&(S=null)),S===null?(S=65533,I=1):S>65535&&(S-=65536,h+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),h+=String.fromCharCode(S),p+=I}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==jt.Bytes)return i.push(this.readVarint(e));var n=so(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==jt.Bytes)return i.push(this.readSVarint());var e=so(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==jt.Bytes)return i.push(this.readBoolean());var e=so(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==jt.Bytes)return i.push(this.readFloat());var e=so(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==jt.Bytes)return i.push(this.readDouble());var e=so(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==jt.Bytes)return i.push(this.readFixed32());var e=so(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==jt.Bytes)return i.push(this.readSFixed32());var e=so(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==jt.Bytes)return i.push(this.readFixed64());var e=so(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==jt.Bytes)return i.push(this.readSFixed64());var e=so(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===jt.Varint)for(;this.buf[this.pos++]>127;);else if(e===jt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===jt.Fixed32)this.pos+=4;else{if(e!==jt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),fl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),fl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),fl(this.buf,-1&i,this.pos),fl(this.buf,Math.floor(i*Wg),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),fl(this.buf,-1&i,this.pos),fl(this.buf,Math.floor(i*Wg),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var r,c;if(e>=0?(r=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(h,p,g){g.buf[g.pos++]=127&h|128,h>>>=7,g.buf[g.pos++]=127&h|128,h>>>=7,g.buf[g.pos++]=127&h|128,h>>>=7,g.buf[g.pos++]=127&h|128,g.buf[g.pos]=127&(h>>>=7)}(r,0,n),function(h,p){var g=(7&h)<<4;p.buf[p.pos++]|=g|((h>>>=3)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h|((h>>>=7)?128:0),h&&(p.buf[p.pos++]=127&h)))))}(c,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(r,c,h){for(var p,g,y=0;y<c.length;y++){if((p=c.charCodeAt(y))>55295&&p<57344){if(!g){p>56319||y+1===c.length?(r[h++]=239,r[h++]=191,r[h++]=189):g=p;continue}if(p<56320){r[h++]=239,r[h++]=191,r[h++]=189,g=p;continue}p=g-55296<<10|p-56320|65536,g=null}else g&&(r[h++]=239,r[h++]=191,r[h++]=189,g=null);p<128?r[h++]=p:(p<2048?r[h++]=p>>6|192:(p<65536?r[h++]=p>>12|224:(r[h++]=p>>18|240,r[h++]=p>>12&63|128),r[h++]=p>>6&63|128),r[h++]=63&p|128)}return h}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&Hg(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),qg(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),qg(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var r=this.pos-n;r>=128&&Hg(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(i,e,n){this.writeTag(i,jt.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,kw,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,zw,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Lw,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Pw,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Dw,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,Rw,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Bw,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Fw,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,Ow,e)},writeBytesField:function(i,e){this.writeTag(i,jt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,jt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,jt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,jt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,jt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,jt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,jt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,jt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,jt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,jt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class xf{constructor(e,{pixelRatio:n,version:r,stretchX:c,stretchY:h,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=h,this.content=p,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Kg{constructor(e,n){const r={},c={};this.haveRenderCallbacks=[];const h=[];this.addImages(e,r,h),this.addImages(n,c,h);const{w:p,h:g}=yf(h),y=new Fn({width:p||1,height:g||1});for(const w in e){const T=e[w],S=r[w].paddedRect;Fn.copy(T.data,y,{x:0,y:0},{x:S.x+1,y:S.y+1},T.data)}for(const w in n){const T=n[w],S=c[w].paddedRect,I=S.x+1,D=S.y+1,L=T.data.width,O=T.data.height;Fn.copy(T.data,y,{x:0,y:0},{x:I,y:D},T.data),Fn.copy(T.data,y,{x:0,y:O-1},{x:I,y:D-1},{width:L,height:1}),Fn.copy(T.data,y,{x:0,y:0},{x:I,y:D+O},{width:L,height:1}),Fn.copy(T.data,y,{x:L-1,y:0},{x:I-1,y:D},{width:1,height:O}),Fn.copy(T.data,y,{x:0,y:0},{x:I+L,y:D},{width:1,height:O})}this.image=y,this.iconPositions=r,this.patternPositions=c}addImages(e,n,r){for(const c in e){const h=e[c],p={x:0,y:0,w:h.data.width+2,h:h.data.height+2};r.push(p),n[c]=new xf(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),n),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),n)}patchUpdatedImage(e,n,r){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,h]=e.tl;r.update(n.data,void 0,{x:c,y:h})}}Je("ImagePosition",xf),Je("ImageAtlas",Kg);const On={horizontal:1,vertical:2,horizontalOnly:3};class Xc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const r=new Xc;return r.scale=e||1,r.fontStack=n,r}static forImage(e){const n=new Xc;return n.imageName=e,n}}class ml{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const r=new ml;for(let c=0;c<e.sections.length;c++){const h=e.sections[c];h.image?r.addImageSection(h):r.addTextSection(h,n)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,r){let c="";for(let h=0;h<n.length;h++){const p=n.charCodeAt(h+1)||null,g=n.charCodeAt(h-1)||null;c+=!r&&(p&&Rc(p)&&!qc[n[h+1]]||g&&Rc(g)&&!qc[n[h-1]])||!qc[n[h]]?n[h]:qc[n[h]]}return c}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&ad[this.text.charCodeAt(r)];r++)e++;let n=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&ad[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const r=new ml;return r.text=this.text.substring(e,n),r.sectionIndex=this.sectionIndex.slice(e,n),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Xc.forText(e.scale,e.fontStack||n));const r=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(r)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void nt("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Xc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):nt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vf(i,e,n,r,c,h,p,g,y,w,T,S,I,D,L,O){const Z=ml.fromFeature(i,c);let Y;S===On.vertical&&Z.verticalizePunctuation(I);const{processBidirectionalText:ee,processStyledBidirectionalText:se}=M;if(ee&&Z.sections.length===1){Y=[];const he=ee(Z.toString(),wf(Z,w,h,e,r,D,L));for(const Ce of he){const we=new ml;we.text=Ce,we.sections=Z.sections;for(let Ge=0;Ge<Ce.length;Ge++)we.sectionIndex.push(0);Y.push(we)}}else if(se){Y=[];const he=se(Z.text,Z.sectionIndex,wf(Z,w,h,e,r,D,L));for(const Ce of he){const we=new ml;we.text=Ce[0],we.sectionIndex=Ce[1],we.sections=Z.sections,Y.push(we)}}else Y=function(he,Ce){const we=[],Ge=he.text;let Le=0;for(const Ie of Ce)we.push(he.substring(Le,Ie)),Le=Ie;return Le<Ge.length&&we.push(he.substring(Le,Ge.length)),we}(Z,wf(Z,w,h,e,r,D,L));const ce=[],ae={positionedLines:ce,text:Z.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,Ce,we,Ge,Le,Ie,Re,Be,Me,Ze,Ke,gt){let $t=0,ht=0,Ft=0;const We=Be==="right"?1:Be==="left"?0:.5;let Gt=!1;for(const Vt of Le){const Ot=Vt.getSections();for(const Jt of Ot){if(Jt.imageName)continue;const Ui=Ce[Jt.fontStack];if(Ui&&(Gt=Ui.ascender!==void 0&&Ui.descender!==void 0,!Gt))break}if(!Gt)break}let Lt=0;for(const Vt of Le){Vt.trim();const Ot=Vt.getMaxScale(),Jt=(Ot-1)*Oi,Ui={positionedGlyphs:[],lineOffset:0};he.positionedLines[Lt]=Ui;const yi=Ui.positionedGlyphs;let Ii=0;if(!Vt.length()){ht+=Ie,++Lt;continue}let Ni=0,ii=0;for(let Zt=0;Zt<Vt.length();Zt++){const xi=Vt.getSection(Zt),vi=Vt.getSectionIndex(Zt),di=Vt.getCharCode(Zt);let ai=xi.scale,Si=null,qt=null,qi=null,lr=Oi,Un=0;const Hn=!(Me===On.horizontal||!Ke&&!Lc(di)||Ke&&(ad[di]||(_i=di,zh(_i)||Ph(_i)||Dh(_i)||Sr(_i)||Pc(_i))));if(xi.imageName){const Nn=Ge[xi.imageName];if(!Nn)continue;qi=xi.imageName,he.iconsInText=he.iconsInText||!0,qt=Nn.paddedRect;const Wi=Nn.displaySize;ai=ai*Oi/gt,Si={width:Wi[0],height:Wi[1],left:1,top:-3,advance:Hn?Wi[1]:Wi[0],localGlyph:!1},Un=Gt?-Si.height*ai:Ot*Oi-17-Wi[1]*ai,lr=Si.advance;const ao=(Hn?Wi[0]:Wi[1])*ai-Oi*Ot;ao>0&&ao>Ii&&(Ii=ao)}else{const Nn=we[xi.fontStack];if(!Nn)continue;Nn[di]&&(qt=Nn[di]);const Wi=Ce[xi.fontStack];if(!Wi)continue;const ao=Wi.glyphs[di];if(!ao)continue;if(Si=ao.metrics,lr=di!==8203?Oi:0,Gt){const vl=Wi.ascender!==void 0?Math.abs(Wi.ascender):0,wl=Wi.descender!==void 0?Math.abs(Wi.descender):0,bl=(vl+wl)*ai;Ni<bl&&(Ni=bl,ii=(vl-wl)/2*ai),Un=-vl*ai}else Un=(Ot-ai)*Oi-17}Hn?(he.verticalizable=!0,yi.push({glyph:di,imageName:qi,x:$t,y:ht+Un,vertical:Hn,scale:ai,localGlyph:Si.localGlyph,fontStack:xi.fontStack,sectionIndex:vi,metrics:Si,rect:qt}),$t+=lr*ai+Ze):(yi.push({glyph:di,imageName:qi,x:$t,y:ht+Un,vertical:Hn,scale:ai,localGlyph:Si.localGlyph,fontStack:xi.fontStack,sectionIndex:vi,metrics:Si,rect:qt}),$t+=Si.advance*ai+Ze)}yi.length!==0&&(Ft=Math.max($t-Ze,Ft),Gt?iy(yi,We,Ii,ii,Ie*Ot/2):iy(yi,We,Ii,0,Ie/2)),$t=0;const dn=Ie*Ot+Ii;Ui.lineOffset=Math.max(Ii,Jt),ht+=dn,++Lt}var _i;const gi=ht,{horizontalAlign:Ei,verticalAlign:zi}=bf(Re);(function(Vt,Ot,Jt,Ui,yi,Ii){const Ni=(Ot-Jt)*yi,ii=-Ii*Ui;for(const dn of Vt)for(const Zt of dn.positionedGlyphs)Zt.x+=Ni,Zt.y+=ii})(he.positionedLines,We,Ei,zi,Ft,gi),he.top+=-zi*gi,he.bottom=he.top+gi,he.left+=-Ei*Ft,he.right=he.left+Ft,he.hasBaseline=Gt}(ae,e,n,r,Y,p,g,y,S,w,I,O),!function(he){for(const Ce of he)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(ce)&&ae}const ad={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Jg(i,e,n,r,c,h){if(e.imageName){const p=r[e.imageName];return p?p.displaySize[0]*e.scale*Oi/h+c:0}{const p=n[e.fontStack],g=p&&p.glyphs[i];return g?g.metrics.advance*e.scale+c:0}}function Qg(i,e,n,r){const c=Math.pow(i-e,2);return r?i<e?c/2:2*c:c+Math.abs(n)*n}function $w(i,e,n){let r=0;return i===10&&(r-=1e4),n&&(r+=150),i!==40&&i!==65288||(r+=50),e!==41&&e!==65289||(r+=50),r}function ey(i,e,n,r,c,h){let p=null,g=Qg(e,n,c,h);for(const y of r){const w=Qg(e-y.x,n,c,h)+y.badness;w<=g&&(p=y,g=w)}return{index:i,x:e,priorBreak:p,badness:g}}function ty(i){return i?ty(i.priorBreak).concat(i.index):[]}function wf(i,e,n,r,c,h,p){if(h!=="point")return[];if(!i)return[];const g=[],y=function(I,D,L,O,Z,Y){let ee=0;for(let se=0;se<I.length();se++){const ce=I.getSection(se);ee+=Jg(I.getCharCode(se),ce,O,Z,D,Y)}return ee/Math.max(1,Math.ceil(ee/L))}(i,e,n,r,c,p),w=i.text.indexOf("\u200B")>=0;let T=0;for(let I=0;I<i.length();I++){const D=i.getSection(I),L=i.getCharCode(I);if(ad[L]||(T+=Jg(L,D,r,c,e,p)),I<i.length()-1){const O=!((S=L)<11904||!(Bh(S)||Ic(S)||Gs(S)||Uh(S)||zc(S)||Lh(S)||Ac(S)||el(S)||il(S)||js(S)||kc(S)||Dc(S)||Uo(S)||Rh(S)||Vs(S)||Mc(S)||tl(S)||Nh(S)||Oh(S)||Fh(S)));(jw[L]||O||D.imageName)&&g.push(ey(I+1,T,y,g,$w(L,i.getCharCode(I+1),O&&w),!1))}}var S;return ty(ey(i.length(),T,y,g,0,!0))}function bf(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function iy(i,e,n,r,c){if(!(e||n||r||c))return;const h=i.length-1,p=i[h],g=(p.x+p.metrics.advance*p.scale)*e;for(let y=0;y<=h;y++)i[y].x-=g,i[y].y+=n+r+c}function Gw(i,e,n){const{horizontalAlign:r,verticalAlign:c}=bf(n),h=e[0]-i.displaySize[0]*r,p=e[1]-i.displaySize[1]*c;return{image:i,top:p,bottom:p+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function ny(i,e,n,r,c,h){const p=i.image;let g;if(p.content){const Z=p.content,Y=p.pixelRatio||1;g=[Z[0]/Y,Z[1]/Y,p.displaySize[0]-Z[2]/Y,p.displaySize[1]-Z[3]/Y]}const y=e.left*h,w=e.right*h;let T,S,I,D;n==="width"||n==="both"?(D=c[0]+y-r[3],S=c[0]+w+r[1]):(D=c[0]+(y+w-p.displaySize[0])/2,S=D+p.displaySize[0]);const L=e.top*h,O=e.bottom*h;return n==="height"||n==="both"?(T=c[1]+L-r[0],I=c[1]+O+r[2]):(T=c[1]+(L+O-p.displaySize[1])/2,I=T+p.displaySize[1]),{image:p,top:T,right:S,bottom:I,left:D,collisionPadding:g}}class Wo extends _e{constructor(e,n,r,c,h){super(e,n),this.angle=c,this.z=r,h!==void 0&&(this.segment=h)}clone(){return new Wo(this.x,this.y,this.z,this.angle,this.segment)}}function ry(i,e,n,r,c){if(e.segment===void 0)return!0;let h=e,p=e.segment+1,g=0;for(;g>-n/2;){if(p--,p<0)return!1;g-=i[p].dist(h),h=i[p]}g+=i[p].dist(i[p+1]),p++;const y=[];let w=0;for(;g<n/2;){const T=i[p],S=i[p+1];if(!S)return!1;let I=i[p-1].angleTo(T)-T.angleTo(S);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:g,angleDelta:I}),w+=I;g-y[0].distance>r;)w-=y.shift().angleDelta;if(w>c)return!1;p++,g+=T.dist(S)}return!0}function oy(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function sy(i,e,n){return i?.6*e*n:0}function ay(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Zw(i,e,n,r,c,h){const p=sy(n,c,h),g=ay(n,r)*h;let y=0;const w=oy(i)/2;for(let T=0;T<i.length-1;T++){const S=i[T],I=i[T+1],D=S.dist(I);if(y+D>w){const L=(w-y)/D,O=Pt(S.x,I.x,L),Z=Pt(S.y,I.y,L),Y=new Wo(O,Z,0,I.angleTo(S),T);return!p||ry(i,Y,g,p,e)?Y:void 0}y+=D}}function qw(i,e,n,r,c,h,p,g,y){const w=sy(r,h,p),T=ay(r,c),S=T*p,I=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-S<e/4&&(e=S+e/4),ly(i,I?e/2*g%e:(T/2+2*h)*p*g%e,e,w,n,S,I,!1,y)}function ly(i,e,n,r,c,h,p,g,y){const w=h/2,T=oy(i);let S=0,I=e-n,D=[];for(let L=0;L<i.length-1;L++){const O=i[L],Z=i[L+1],Y=O.dist(Z),ee=Z.angleTo(O);for(;I+n<S+Y;){I+=n;const se=(I-S)/Y,ce=Pt(O.x,Z.x,se),ae=Pt(O.y,Z.y,se);if(ce>=0&&ce<y&&ae>=0&&ae<y&&I-w>=0&&I+w<=T){const he=new Wo(ce,ae,0,ee,L);he._round(),r&&!ry(i,he,h,r,c)||D.push(he)}}S+=Y}return g||D.length||p||(D=ly(i,S/2,n,r,c,h,p,!0,y)),D}function cy(i,e,n,r,c){const h=[];for(let p=0;p<i.length;p++){const g=i[p];let y;for(let w=0;w<g.length-1;w++){let T=g[w],S=g[w+1];T.x<e&&S.x<e||(T.x<e?T=new _e(e,T.y+(e-T.x)/(S.x-T.x)*(S.y-T.y))._round():S.x<e&&(S=new _e(e,T.y+(e-T.x)/(S.x-T.x)*(S.y-T.y))._round()),T.y<n&&S.y<n||(T.y<n?T=new _e(T.x+(n-T.y)/(S.y-T.y)*(S.x-T.x),n)._round():S.y<n&&(S=new _e(T.x+(n-T.y)/(S.y-T.y)*(S.x-T.x),n)._round()),T.x>=r&&S.x>=r||(T.x>=r?T=new _e(r,T.y+(r-T.x)/(S.x-T.x)*(S.y-T.y))._round():S.x>=r&&(S=new _e(r,T.y+(r-T.x)/(S.x-T.x)*(S.y-T.y))._round()),T.y>=c&&S.y>=c||(T.y>=c?T=new _e(T.x+(c-T.y)/(S.y-T.y)*(S.x-T.x),c)._round():S.y>=c&&(S=new _e(T.x+(c-T.y)/(S.y-T.y)*(S.x-T.x),c)._round()),y&&T.equals(y[y.length-1])||(y=[T],h.push(y)),y.push(S)))))}}return h}Je("Anchor",Wo);const Hc=1e20;function uy(i,e,n,r,c,h,p,g,y){for(let w=e;w<e+r;w++)hy(i,n*h+w,h,c,p,g,y);for(let w=n;w<n+c;w++)hy(i,w*h+e,1,r,p,g,y)}function hy(i,e,n,r,c,h,p){h[0]=0,p[0]=-Hc,p[1]=Hc,c[0]=i[e];for(let g=1,y=0,w=0;g<r;g++){c[g]=i[e+g*n];const T=g*g;do{const S=h[y];w=(c[g]-c[S]+T-S*S)/(g-S)/2}while(w<=p[y]&&--y>-1);y++,h[y]=g,p[y]=w,p[y+1]=Hc}for(let g=0,y=0;g<r;g++){for(;p[y+1]<g;)y++;const w=h[y],T=g-w;i[e+g*n]=c[w]+T*T}}const Tf={none:0,ideographs:1,all:2};class _l{constructor(e,n,r){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const r=[];for(const c in e)for(const h of e[c])r.push({stack:c,id:h});ot(r,({stack:c,id:h},p)=>{let g=this.entries[c];g||(g=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let y=g.glyphs[h];if(y!==void 0)return void p(null,{stack:c,id:h,glyph:y});if(y=this._tinySDF(g,c,h),y)return g.glyphs[h]=y,void p(null,{stack:c,id:h,glyph:y});const w=Math.floor(h/256);if(256*w>65535)return void p(new Error("glyphs > 65535 not supported"));if(g.ranges[w])return void p(null,{stack:c,id:h,glyph:y});let T=g.requests[w];T||(T=g.requests[w]=[],_l.loadGlyphRange(c,w,this.url,this.requestManager,(S,I)=>{if(I){g.ascender=I.ascender,g.descender=I.descender;for(const D in I.glyphs)this._doesCharSupportLocalGlyph(+D)||(g.glyphs[+D]=I.glyphs[+D]);g.ranges[w]=!0}for(const D of T)D(S,I);delete g.requests[w]})),T.push((S,I)=>{S?p(S):I&&p(null,{stack:c,id:h,glyph:I.glyphs[h]||null})})},(c,h)=>{if(c)n(c);else if(h){const p={};for(const{stack:g,id:y,glyph:w}of h)p[g]===void 0&&(p[g]={}),p[g].glyphs===void 0&&(p[g].glyphs={}),p[g].glyphs[y]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},p[g].ascender=this.entries[g].ascender,p[g].descender=this.entries[g].descender;n(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Tf.none&&(this.localGlyphMode===Tf.all?!!this.localFontFamily:!!this.localFontFamily&&(js(e)||$s(e)||Uo(e)||tl(e))||el(e))}_tinySDF(e,n,r){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(r))return;let h=e.tinySDF;if(!h){let O="400";/bold/i.test(n)?O="900":/medium/i.test(n)?O="500":/light/i.test(n)&&(O="200"),h=e.tinySDF=new _l.TinySDF({fontFamily:c,fontWeight:O,fontSize:48,buffer:6,radius:16}),h.fontWeight=O}if(this.localGlyphs[h.fontWeight][r])return this.localGlyphs[h.fontWeight][r];const p=String.fromCharCode(r),{data:g,width:y,height:w,glyphWidth:T,glyphHeight:S,glyphLeft:I,glyphTop:D,glyphAdvance:L}=h.draw(p);return this.localGlyphs[h.fontWeight][r]={id:r,bitmap:new Zo({width:y,height:w},g),metrics:{width:T/2,height:S/2,left:I/2,top:D/2-27,advance:L/2,localGlyph:!0}}}}function dy(i,e,n,r){const c=[],h=i.image,p=h.pixelRatio,g=h.paddedRect.w-2,y=h.paddedRect.h-2,w=i.right-i.left,T=i.bottom-i.top,S=h.stretchX||[[0,g]],I=h.stretchY||[[0,y]],D=(Ie,Re)=>Ie+Re[1]-Re[0],L=S.reduce(D,0),O=I.reduce(D,0),Z=g-L,Y=y-O;let ee=0,se=L,ce=0,ae=O,he=0,Ce=Z,we=0,Ge=Y;if(h.content&&r){const Ie=h.content;ee=ld(S,0,Ie[0]),ce=ld(I,0,Ie[1]),se=ld(S,Ie[0],Ie[2]),ae=ld(I,Ie[1],Ie[3]),he=Ie[0]-ee,we=Ie[1]-ce,Ce=Ie[2]-Ie[0]-se,Ge=Ie[3]-Ie[1]-ae}const Le=(Ie,Re,Be,Me)=>{const Ze=cd(Ie.stretch-ee,se,w,i.left),Ke=ud(Ie.fixed-he,Ce,Ie.stretch,L),gt=cd(Re.stretch-ce,ae,T,i.top),$t=ud(Re.fixed-we,Ge,Re.stretch,O),ht=cd(Be.stretch-ee,se,w,i.left),Ft=ud(Be.fixed-he,Ce,Be.stretch,L),We=cd(Me.stretch-ce,ae,T,i.top),Gt=ud(Me.fixed-we,Ge,Me.stretch,O),Lt=new _e(Ze,gt),_i=new _e(ht,gt),gi=new _e(ht,We),Ei=new _e(Ze,We),zi=new _e(Ke/p,$t/p),Vt=new _e(Ft/p,Gt/p),Ot=e*Math.PI/180;if(Ot){const yi=Math.sin(Ot),Ii=Math.cos(Ot),Ni=[Ii,-yi,yi,Ii];Lt._matMult(Ni),_i._matMult(Ni),Ei._matMult(Ni),gi._matMult(Ni)}const Jt=Ie.stretch+Ie.fixed,Ui=Re.stretch+Re.fixed;return{tl:Lt,tr:_i,bl:Ei,br:gi,tex:{x:h.paddedRect.x+1+Jt,y:h.paddedRect.y+1+Ui,w:Be.stretch+Be.fixed-Jt,h:Me.stretch+Me.fixed-Ui},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:zi,pixelOffsetBR:Vt,minFontScaleX:Ce/p/w,minFontScaleY:Ge/p/T,isSDF:n}};if(r&&(h.stretchX||h.stretchY)){const Ie=py(S,Z,L),Re=py(I,Y,O);for(let Be=0;Be<Ie.length-1;Be++){const Me=Ie[Be],Ze=Ie[Be+1];for(let Ke=0;Ke<Re.length-1;Ke++)c.push(Le(Me,Re[Ke],Ze,Re[Ke+1]))}}else c.push(Le({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:y+1}));return c}function ld(i,e,n){let r=0;for(const c of i)r+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return r}function py(i,e,n){const r=[{fixed:-1,stretch:0}];for(const[c,h]of i){const p=r[r.length-1];r.push({fixed:c-p.stretch,stretch:p.stretch}),r.push({fixed:c-p.stretch,stretch:p.stretch+(h-c)})}return r.push({fixed:e+1,stretch:n}),r}function cd(i,e,n,r){return i/e*n+r}function ud(i,e,n,r){return i-e*n/r}function Ww(i,e,n,r){const c=e+i.positionedLines[r].lineOffset;return r===0?n+c/2:n+(c+(e+i.positionedLines[r-1].lineOffset))/2}_l.loadGlyphRange=function(i,e,n,r,c){const h=256*e,p=h+255,g=r.transformRequest(r.normalizeGlyphsURL(n).replace("{fontstack}",i).replace("{range}",`${h}-${p}`),Gr.Glyphs);R(g,(y,w)=>{if(y)c(y);else if(w){const T={},S=function(I){return new Wc(I).readFields(Uw,{})}(w);for(const I of S.glyphs)T[I.id]=I;c(null,{glyphs:T,ascender:S.ascender,descender:S.descender})}})},_l.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:n=8,cutoff:r=.25,fontFamily:c="sans-serif",fontWeight:h="normal",fontStyle:p="normal"}){this.buffer=e,this.cutoff=r,this.radius=n;const g=this.size=i+4*e,y=this._createCanvas(g),w=this.ctx=y.getContext("2d",{willReadFrequently:!0});w.font=`${p} ${h} ${i}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:c,actualBoundingBoxRight:h}=this.ctx.measureText(i),p=Math.floor(n),g=Math.min(this.size-this.buffer,Math.ceil(h-c)),y=Math.min(this.size-this.buffer,Math.ceil(n)+Math.ceil(r)),w=g+2*this.buffer,T=y+2*this.buffer,S=w*T,I=new Uint8ClampedArray(S),D={data:I,width:w,height:T,glyphWidth:g,glyphHeight:y,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(g===0||y===0)return D;const{ctx:L,buffer:O,gridInner:Z,gridOuter:Y}=this;L.clearRect(O,O,g,y),L.fillText(i,O,O+p+1);const ee=L.getImageData(O,O,g,y);Y.fill(Hc,0,S),Z.fill(0,0,S);for(let se=0;se<y;se++)for(let ce=0;ce<g;ce++){const ae=ee.data[4*(se*g+ce)+3]/255;if(ae===0)continue;const he=(se+O)*w+ce+O;if(ae===1)Y[he]=0,Z[he]=Hc;else{const Ce=.5-ae;Y[he]=Ce>0?Ce*Ce:0,Z[he]=Ce<0?Ce*Ce:0}}uy(Y,0,0,w,T,w,this.f,this.v,this.z),uy(Z,O,O,g,y,w,this.f,this.v,this.z);for(let se=0;se<S;se++){const ce=Math.sqrt(Y[se])-Math.sqrt(Z[se]);I[se]=Math.round(255-255*(ce/this.radius+this.cutoff))}return D}};class Xw{constructor(e=[],n=Hw){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:r}=this,c=n[e];for(;e>0;){const h=e-1>>1,p=n[h];if(r(c,p)>=0)break;n[e]=p,e=h}n[e]=c}_down(e){const{data:n,compare:r}=this,c=this.length>>1,h=n[e];for(;e<c;){let p=1+(e<<1),g=n[p];const y=p+1;if(y<this.length&&r(n[y],g)<0&&(p=y,g=n[y]),r(g,h)>=0)break;n[e]=g,e=p}n[e]=h}}function Hw(i,e){return i<e?-1:i>e?1:0}function Yw(i,e=1,n=!1){let r=1/0,c=1/0,h=-1/0,p=-1/0;const g=i[0];for(let D=0;D<g.length;D++){const L=g[D];(!D||L.x<r)&&(r=L.x),(!D||L.y<c)&&(c=L.y),(!D||L.x>h)&&(h=L.x),(!D||L.y>p)&&(p=L.y)}const y=Math.min(h-r,p-c);let w=y/2;const T=new Xw([],Kw);if(y===0)return new _e(r,c);for(let D=r;D<h;D+=y)for(let L=c;L<p;L+=y)T.push(new gl(D+w,L+w,w,i));let S=function(D){let L=0,O=0,Z=0;const Y=D[0];for(let ee=0,se=Y.length,ce=se-1;ee<se;ce=ee++){const ae=Y[ee],he=Y[ce],Ce=ae.x*he.y-he.x*ae.y;O+=(ae.x+he.x)*Ce,Z+=(ae.y+he.y)*Ce,L+=3*Ce}return new gl(O/L,Z/L,0,D)}(i),I=T.length;for(;T.length;){const D=T.pop();(D.d>S.d||!S.d)&&(S=D,n&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,I)),D.max-S.d<=e||(w=D.h/2,T.push(new gl(D.p.x-w,D.p.y-w,w,i)),T.push(new gl(D.p.x+w,D.p.y-w,w,i)),T.push(new gl(D.p.x-w,D.p.y+w,w,i)),T.push(new gl(D.p.x+w,D.p.y+w,w,i)),I+=4)}return n&&(console.log(`num probes: ${I}`),console.log(`best distance: ${S.d}`)),S.p}function Kw(i,e){return e.max-i.max}function gl(i,e,n,r){this.p=new _e(i,e),this.h=n,this.d=function(c,h){let p=!1,g=1/0;for(let y=0;y<h.length;y++){const w=h[y];for(let T=0,S=w.length,I=S-1;T<S;I=T++){const D=w[T],L=w[I];D.y>c.y!=L.y>c.y&&c.x<(L.x-D.x)*(c.y-D.y)/(L.y-D.y)+D.x&&(p=!p),g=Math.min(g,ug(c,D,L))}}return(p?1:-1)*Math.sqrt(g)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}const Ef=Number.POSITIVE_INFINITY,Jw=Math.sqrt(2);function fy(i,e){return e[1]!==Ef?function(n,r,c){let h=0,p=0;switch(r=Math.abs(r),c=Math.abs(c),n){case"top-right":case"top-left":case"top":p=c-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-c}switch(n){case"top-right":case"bottom-right":case"right":h=-r;break;case"top-left":case"bottom-left":case"left":h=r}return[h,p]}(i,e[0],e[1]):function(n,r){let c=0,h=0;r<0&&(r=0);const p=r/Jw;switch(n){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-r;break;case"top":h=r-7}switch(n){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=r;break;case"right":c=-r}return[c,h]}(i,e[0])}function Qw(i,e,n,r,c,h,p,g,y){i.createArrays(),i.tilePixelRatio=At/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const w=i.layers[0].layout,T=i.layers[0]._unevaluatedLayout._values,S={};if(i.textSizeData.kind==="composite"){const{minZoom:L,maxZoom:O}=i.textSizeData;S.compositeTextSizes=[T["text-size"].possiblyEvaluate(new z(L),g),T["text-size"].possiblyEvaluate(new z(O),g)]}if(i.iconSizeData.kind==="composite"){const{minZoom:L,maxZoom:O}=i.iconSizeData;S.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new z(L),g),T["icon-size"].possiblyEvaluate(new z(O),g)]}S.layoutTextSize=T["text-size"].possiblyEvaluate(new z(y+1),g),S.layoutIconSize=T["icon-size"].possiblyEvaluate(new z(y+1),g),S.textMaxSize=T["text-size"].possiblyEvaluate(new z(18),g);const I=w.get("text-rotation-alignment")==="map"&&w.get("symbol-placement")!=="point",D=w.get("text-size");for(const L of i.features){const O=w.get("text-font").evaluate(L,{},g).join(","),Z=D.evaluate(L,{},g),Y=S.layoutTextSize.evaluate(L,{},g),ee=(S.layoutIconSize.evaluate(L,{},g),{horizontal:{},vertical:void 0}),se=L.text;let ce,ae=[0,0];if(se){const we=se.toString(),Ge=w.get("text-letter-spacing").evaluate(L,{},g)*Oi,Le=w.get("text-line-height").evaluate(L,{},g)*Oi,Ie=nl(we)?Ge:0,Re=w.get("text-anchor").evaluate(L,{},g),Be=w.get("text-variable-anchor");if(!Be){const ht=w.get("text-radial-offset").evaluate(L,{},g);ae=ht?fy(Re,[ht*Oi,Ef]):w.get("text-offset").evaluate(L,{},g).map(Ft=>Ft*Oi)}let Me=I?"center":w.get("text-justify").evaluate(L,{},g);const Ze=w.get("symbol-placement"),Ke=Ze==="point",gt=Ze==="point"?w.get("text-max-width").evaluate(L,{},g)*Oi:0,$t=ht=>{i.allowVerticalPlacement&&Cr(we)&&(ee.vertical=vf(se,e,n,c,O,gt,Le,Re,ht,Ie,ae,On.vertical,!0,Ze,Y,Z))};if(!I&&Be){const ht=Me==="auto"?Be.map(We=>Sf(We)):[Me];let Ft=!1;for(let We=0;We<ht.length;We++){const Gt=ht[We];if(!ee.horizontal[Gt])if(Ft)ee.horizontal[Gt]=ee.horizontal[0];else{const Lt=vf(se,e,n,c,O,gt,Le,"center",Gt,Ie,ae,On.horizontal,!1,Ze,Y,Z);Lt&&(ee.horizontal[Gt]=Lt,Ft=Lt.positionedLines.length===1)}}$t("left")}else{if(Me==="auto"&&(Me=Sf(Re)),Ke||w.get("text-writing-mode").indexOf("horizontal")>=0||!Cr(we)){const ht=vf(se,e,n,c,O,gt,Le,Re,Me,Ie,ae,On.horizontal,!1,Ze,Y,Z);ht&&(ee.horizontal[Me]=ht)}$t(Ze==="point"?"left":Me)}}let he=!1;if(L.icon&&L.icon.name){const we=r[L.icon.name];we&&(ce=Gw(c[L.icon.name],w.get("icon-offset").evaluate(L,{},g),w.get("icon-anchor").evaluate(L,{},g)),he=we.sdf,i.sdfIcons===void 0?i.sdfIcons=we.sdf:i.sdfIcons!==we.sdf&&nt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(we.pixelRatio!==i.pixelRatio||w.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Ce=_y(ee.horizontal)||ee.vertical;i.iconsInText||(i.iconsInText=!!Ce&&Ce.iconsInText),(Ce||ce)&&eb(i,L,ee,ce,r,S,Y,0,ae,he,p,g)}h&&i.generateCollisionDebugBuffers(y,i.collisionBoxArray)}function Sf(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function eb(i,e,n,r,c,h,p,g,y,w,T,S){let I=h.textMaxSize.evaluate(e,{},S);I===void 0&&(I=p);const D=i.layers[0].layout,L=D.get("icon-offset").evaluate(e,{},S),O=_y(n.horizontal)||n.vertical,Z=p/24,Y=i.tilePixelRatio*I/24,ee=i.tilePixelRatio*D.get("symbol-spacing"),se=D.get("text-padding")*i.tilePixelRatio,ce=D.get("icon-padding")*i.tilePixelRatio,ae=te(D.get("text-max-angle")),he=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",Ce=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",we=D.get("symbol-placement"),Ge=ee/2,Le=D.get("icon-text-fit");let Ie;r&&Le!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Ie=ny(r,n.vertical,Le,D.get("icon-text-fit-padding"),L,Z)),O&&(r=ny(r,O,Le,D.get("icon-text-fit-padding"),L,Z)));const Re=(Be,Me)=>{Me.x<0||Me.x>=At||Me.y<0||Me.y>=At||function(Ze,Ke,gt,$t,ht,Ft,We,Gt,Lt,_i,gi,Ei,zi,Vt,Ot,Jt,Ui,yi,Ii,Ni,ii,dn,Zt,xi,vi){const di=Ze.addToLineVertexArray(Ke,$t);let ai,Si,qt,qi,lr,Un,Hn,Nn=0,Wi=0,ao=0,vl=0,wl=-1,bl=-1;const Dr={};let Xy=Bc(""),Nf=0,Vf=0;if(Lt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Nf,Vf]=Lt.layout.get("text-offset").evaluate(ii,{},vi).map(Tn=>Tn*Oi):(Nf=Lt.layout.get("text-radial-offset").evaluate(ii,{},vi)*Oi,Vf=Ef),Ze.allowVerticalPlacement&&ht.vertical){const Tn=ht.vertical;if(Ot)Un=Cf(Tn),Gt&&(Hn=Cf(Gt));else{const En=Lt.layout.get("text-rotate").evaluate(ii,{},vi)+90;qt=hd(_i,gt,Ke,gi,Ei,zi,Tn,Vt,En,Jt),Gt&&(qi=hd(_i,gt,Ke,gi,Ei,zi,Gt,yi,En))}}if(Ft){const Tn=Lt.layout.get("icon-rotate").evaluate(ii,{},vi),En=Lt.layout.get("icon-text-fit")!=="none",tu=dy(Ft,Tn,Zt,En),$f=Gt?dy(Gt,Tn,Zt,En):void 0;Si=hd(_i,gt,Ke,gi,Ei,zi,Ft,yi,Tn),Nn=4*tu.length;const Hy=Ze.iconSizeData;let ea=null;Hy.kind==="source"?(ea=[Mr*Lt.layout.get("icon-size").evaluate(ii,{},vi)],ea[0]>Xo&&nt(`${Ze.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Hy.kind==="composite"&&(ea=[Mr*dn.compositeIconSizes[0].evaluate(ii,{},vi),Mr*dn.compositeIconSizes[1].evaluate(ii,{},vi)],(ea[0]>Xo||ea[1]>Xo)&&nt(`${Ze.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ze.addSymbols(Ze.icon,tu,ea,Ni,Ii,ii,!1,gt,Ke,di.lineStartIndex,di.lineLength,-1,xi,vi),wl=Ze.icon.placedSymbolArray.length-1,$f&&(Wi=4*$f.length,Ze.addSymbols(Ze.icon,$f,ea,Ni,Ii,ii,On.vertical,gt,Ke,di.lineStartIndex,di.lineLength,-1,xi,vi),bl=Ze.icon.placedSymbolArray.length-1)}for(const Tn in ht.horizontal){const En=ht.horizontal[Tn];ai||(Xy=Bc(En.text),Ot?lr=Cf(En):ai=hd(_i,gt,Ke,gi,Ei,zi,En,Vt,Lt.layout.get("text-rotate").evaluate(ii,{},vi),Jt));const tu=En.positionedLines.length===1;if(ao+=my(Ze,gt,Ke,En,We,Lt,Ot,ii,Jt,di,ht.vertical?On.horizontal:On.horizontalOnly,tu?Object.keys(ht.horizontal):[Tn],Dr,wl,dn,xi,vi),tu)break}ht.vertical&&(vl+=my(Ze,gt,Ke,ht.vertical,We,Lt,Ot,ii,Jt,di,On.vertical,["vertical"],Dr,bl,dn,xi,vi));let Qo=-1;const jf=(Tn,En)=>Tn?Math.max(Tn,En):En;Qo=jf(lr,Qo),Qo=jf(Un,Qo),Qo=jf(Hn,Qo);const Sb=Qo>-1?1:0;Ze.glyphOffsetArray.length>=Ho.MAX_GLYPHS&&nt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ii.sortKey!==void 0&&Ze.addToSortKeyRanges(Ze.symbolInstances.length,ii.sortKey),Ze.symbolInstances.emplaceBack(gt.x,gt.y,gt.z,Ke.x,Ke.y,Dr.right>=0?Dr.right:-1,Dr.center>=0?Dr.center:-1,Dr.left>=0?Dr.left:-1,Dr.vertical>=0?Dr.vertical:-1,wl,bl,Xy,ai!==void 0?ai:Ze.collisionBoxArray.length,ai!==void 0?ai+1:Ze.collisionBoxArray.length,qt!==void 0?qt:Ze.collisionBoxArray.length,qt!==void 0?qt+1:Ze.collisionBoxArray.length,Si!==void 0?Si:Ze.collisionBoxArray.length,Si!==void 0?Si+1:Ze.collisionBoxArray.length,qi||Ze.collisionBoxArray.length,qi?qi+1:Ze.collisionBoxArray.length,gi,ao,vl,Nn,Wi,Sb,0,Nf,Vf,Qo)}(i,Me,Me,Be,n,r,c,Ie,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,se,he,y,0,ce,Ce,L,e,h,w,T,S)};if(we==="line")for(const Be of cy(e.geometry,0,0,At,At)){const Me=qw(Be,ee,ae,n.vertical||O,r,24,Y,i.overscaling,At);for(const Ze of Me){const Ke=O;Ke&&tb(i,Ke.text,Ge,Ze)||Re(Be,Ze)}}else if(we==="line-center"){for(const Be of e.geometry)if(Be.length>1){const Me=Zw(Be,ae,n.vertical||O,r,24,Y);Me&&Re(Be,Me)}}else if(e.type==="Polygon")for(const Be of df(e.geometry,0)){const Me=Yw(Be,16);Re(Be[0],new Wo(Me.x,Me.y,0,0,void 0))}else if(e.type==="LineString")for(const Be of e.geometry)Re(Be,new Wo(Be[0].x,Be[0].y,0,0,void 0));else if(e.type==="Point")for(const Be of e.geometry)for(const Me of Be)Re([Me],new Wo(Me.x,Me.y,0,0,void 0))}const Xo=32640;function my(i,e,n,r,c,h,p,g,y,w,T,S,I,D,L,O,Z){const Y=function(ce,ae,he,Ce,we,Ge,Le,Ie){const Re=[];if(ae.positionedLines.length===0)return Re;const Be=Ce.layout.get("text-rotate").evaluate(Ge,{})*Math.PI/180,Me=function(ht){const Ft=ht[0],We=ht[1],Gt=Ft*We;return Gt>0?[Ft,-We]:Gt<0?[-Ft,We]:Ft===0?[We,Ft]:[We,-Ft]}(he);let Ze=Math.abs(ae.top-ae.bottom);for(const ht of ae.positionedLines)Ze-=ht.lineOffset;const Ke=ae.positionedLines.length,gt=Ze/Ke;let $t=ae.top-he[1];for(let ht=0;ht<Ke;++ht){const Ft=ae.positionedLines[ht];$t=Ww(ae,gt,$t,ht);for(const We of Ft.positionedGlyphs){if(!We.rect)continue;const Gt=We.rect||{};let Lt=4,_i=!0,gi=1,Ei=0;if(We.imageName){const qt=Le[We.imageName];if(!qt)continue;if(qt.sdf){nt("SDF images are not supported in formatted text and will be ignored.");continue}_i=!1,gi=qt.pixelRatio,Lt=1/gi}const zi=(we||Ie)&&We.vertical,Vt=We.metrics.advance*We.scale/2,Ot=We.metrics,Jt=We.rect;if(Jt===null)continue;Ie&&ae.verticalizable&&(Ei=We.imageName?Vt-We.metrics.width*We.scale/2:0);const Ui=we?[We.x+Vt,We.y]:[0,0];let yi=[0,0],Ii=[0,0],Ni=!1;we||(zi?(Ii=[We.x+Vt+Me[0],We.y+Me[1]-Ei],Ni=!0):yi=[We.x+Vt+he[0],We.y+he[1]-Ei]);const ii=Jt.w*We.scale/(gi*(We.localGlyph?2:1)),dn=Jt.h*We.scale/(gi*(We.localGlyph?2:1));let Zt,xi,vi,di;if(zi){const qt=We.y-$t,qi=new _e(-Vt,Vt-qt),lr=-Math.PI/2,Un=new _e(...Ii);Zt=new _e(-Vt+yi[0],yi[1]),Zt._rotateAround(lr,qi)._add(Un),Zt.x+=-qt+Vt,Zt.y-=(Ot.left-Lt)*We.scale;const Hn=We.imageName?Ot.advance*We.scale:Oi*We.scale,Nn=String.fromCharCode(We.glyph);Aw(Nn)?Zt.x+=(1-Lt)*We.scale:Mw(Nn)?Zt.x+=Hn-Ot.height*We.scale+(-Lt-1)*We.scale:Zt.x+=We.imageName||Ot.width+2*Lt===Jt.w&&Ot.height+2*Lt===Jt.h?(Hn-dn)/2:(Hn-(Ot.height+2*Lt)*We.scale)/2,xi=new _e(Zt.x,Zt.y-ii),vi=new _e(Zt.x+dn,Zt.y),di=new _e(Zt.x+dn,Zt.y-ii)}else{const qt=(Ot.left-Lt)*We.scale-Vt+yi[0],qi=(-Ot.top-Lt)*We.scale+yi[1],lr=qt+ii,Un=qi+dn;Zt=new _e(qt,qi),xi=new _e(lr,qi),vi=new _e(qt,Un),di=new _e(lr,Un)}if(Be){let qt;qt=we?new _e(0,0):Ni?new _e(Me[0],Me[1]):new _e(he[0],he[1]),Zt._rotateAround(Be,qt),xi._rotateAround(Be,qt),vi._rotateAround(Be,qt),di._rotateAround(Be,qt)}const ai=new _e(0,0),Si=new _e(0,0);Re.push({tl:Zt,tr:xi,bl:vi,br:di,tex:Gt,writingMode:ae.writingMode,glyphOffset:Ui,sectionIndex:We.sectionIndex,isSDF:_i,pixelOffsetTL:ai,pixelOffsetBR:Si,minFontScaleX:0,minFontScaleY:0})}}return Re}(0,r,y,h,p,g,c,i.allowVerticalPlacement),ee=i.textSizeData;let se=null;ee.kind==="source"?(se=[Mr*h.layout.get("text-size").evaluate(g,{},Z)],se[0]>Xo&&nt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ee.kind==="composite"&&(se=[Mr*L.compositeTextSizes[0].evaluate(g,{},Z),Mr*L.compositeTextSizes[1].evaluate(g,{},Z)],(se[0]>Xo||se[1]>Xo)&&nt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,Y,se,y,p,g,T,e,n,w.lineStartIndex,w.lineLength,D,O,Z);for(const ce of S)I[ce]=i.text.placedSymbolArray.length-1;return 4*Y.length}function _y(i){for(const e in i)return i[e];return null}function hd(i,e,n,r,c,h,p,g,y,w){let T=p.top,S=p.bottom,I=p.left,D=p.right;const L=p.collisionPadding;if(L&&(I-=L[0],T-=L[1],D+=L[2],S+=L[3]),y){const O=new _e(I,T),Z=new _e(D,T),Y=new _e(I,S),ee=new _e(D,S),se=te(y);let ce=new _e(0,0);w&&(ce=new _e(w[0],w[1])),O._rotateAround(se,ce),Z._rotateAround(se,ce),Y._rotateAround(se,ce),ee._rotateAround(se,ce),I=Math.min(O.x,Z.x,Y.x,ee.x),D=Math.max(O.x,Z.x,Y.x,ee.x),T=Math.min(O.y,Z.y,Y.y,ee.y),S=Math.max(O.y,Z.y,Y.y,ee.y)}return i.emplaceBack(e.x,e.y,e.z,n.x,n.y,I,T,D,S,g,r,c,h),i.length-1}function Cf(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function tb(i,e,n,r){const c=i.compareText;if(e in c){const h=c[e];for(let p=h.length-1;p>=0;p--)if(r.dist(h[p])<n)return!0}else c[e]=[];return c[e].push(r),!1}const ib=Js.VectorTileFeature.types,nb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function dd(i,e,n,r,c,h,p,g,y,w,T,S,I,D,L,O){const Z=T?Math.min(Xo,Math.round(T[0])):0,Y=T?Math.min(Xo,Math.round(T[1])):0;i.emplaceBack(e,n,Math.round(32*p),Math.round(32*g),y,w,(Z<<1)+(S?1:0),Y,16*I,16*D,256*L,256*O,r,c,h,0)}function If(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function rb(i){for(const e of i.sections)if(Zp(e.text))return!0;return!1}class Af{constructor(e){this.layoutVertexArray=new _t,this.indexArray=new mi,this.programConfigurations=e,this.segments=new ki,this.dynamicLayoutVertexArray=new pt,this.opacityVertexArray=new Bt,this.placedSymbolArray=new jh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,r,c){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ww.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,bw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,nb,!0),this.opacityVertexBuffer.itemSize=1),(r||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Je("SymbolBuffers",Af);class Mf{constructor(e,n,r){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new r,this.segments=new ki,this.collisionVertexArray=new Zi,this.collisionVertexArrayExt=new pt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Tw.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Ew.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Je("CollisionBuffers",Mf);class Ho{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=rf([]),this.placementViewportMatrix=rf([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_f(this.zoom,n["text-size"]),this.iconSizeData=_f(this.zoom,n["icon-size"]);const r=this.layers[0].layout,c=r.get("symbol-sort-key"),h=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(p=>On[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new Af(new Xs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Af(new Xs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new $h,this.lineVertexArray=new Ws,this.symbolInstances=new jo}calculateGlyphDependencies(e,n,r,c,h){for(let p=0;p<e.length;p++)if(n[e.charCodeAt(p)]=!0,c&&h){const g=qc[e.charAt(p)];g&&(n[g.charCodeAt(0)]=!0)}}populate(e,n,r,c){const h=this.layers[0],p=h.layout,g=p.get("text-font"),y=p.get("text-field"),w=p.get("icon-image"),T=(y.value.kind!=="constant"||y.value.value instanceof Li&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),S=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,I=p.get("symbol-sort-key");if(this.features=[],!T&&!S)return;const D=n.iconDependencies,L=n.glyphDependencies,O=n.availableImages,Z=new z(this.zoom);for(const{feature:Y,id:ee,index:se,sourceLayerIndex:ce}of e){const ae=h._featureFilter.needGeometry,he=Ks(Y,ae);if(!h._featureFilter.filter(Z,he,r))continue;let Ce,we;if(ae||(he.geometry=oo(Y,r,c)),T){const Le=h.getValueAndResolveTokens("text-field",he,r,O),Ie=Li.factory(Le);rb(Ie)&&(this.hasRTLText=!0),(!this.hasRTLText||C()==="unavailable"||this.hasRTLText&&M.isParsed())&&(Ce=Iw(Ie,h,he))}if(S){const Le=h.getValueAndResolveTokens("icon-image",he,r,O);we=Le instanceof vn?Le:vn.fromString(Le)}if(!Ce&&!we)continue;const Ge=this.sortFeaturesByKey?I.evaluate(he,{},r):void 0;if(this.features.push({id:ee,text:Ce,icon:we,index:se,sourceLayerIndex:ce,geometry:he.geometry,properties:Y.properties,type:ib[Y.type],sortKey:Ge}),we&&(D[we.name]=!0),Ce){const Le=g.evaluate(he,{},r).join(","),Ie=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(On.vertical)>=0;for(const Re of Ce.sections)if(Re.image)D[Re.image.name]=!0;else{const Be=Cr(Ce.toString()),Me=Re.fontStack||Le,Ze=L[Me]=L[Me]||{};this.calculateGlyphDependencies(Re.text,Ze,Ie,this.allowVerticalPlacement,Be)}}}p.get("symbol-placement")==="line"&&(this.features=function(Y){const ee={},se={},ce=[];let ae=0;function he(Le){ce.push(Y[Le]),ae++}function Ce(Le,Ie,Re){const Be=se[Le];return delete se[Le],se[Ie]=Be,ce[Be].geometry[0].pop(),ce[Be].geometry[0]=ce[Be].geometry[0].concat(Re[0]),Be}function we(Le,Ie,Re){const Be=ee[Ie];return delete ee[Ie],ee[Le]=Be,ce[Be].geometry[0].shift(),ce[Be].geometry[0]=Re[0].concat(ce[Be].geometry[0]),Be}function Ge(Le,Ie,Re){const Be=Re?Ie[0][Ie[0].length-1]:Ie[0][0];return`${Le}:${Be.x}:${Be.y}`}for(let Le=0;Le<Y.length;Le++){const Ie=Y[Le],Re=Ie.geometry,Be=Ie.text?Ie.text.toString():null;if(!Be){he(Le);continue}const Me=Ge(Be,Re),Ze=Ge(Be,Re,!0);if(Me in se&&Ze in ee&&se[Me]!==ee[Ze]){const Ke=we(Me,Ze,Re),gt=Ce(Me,Ze,ce[Ke].geometry);delete ee[Me],delete se[Ze],se[Ge(Be,ce[gt].geometry,!0)]=gt,ce[Ke].geometry=null}else Me in se?Ce(Me,Ze,Re):Ze in ee?we(Me,Ze,Re):(he(Le),ee[Me]=ae-1,se[Ze]=ae-1)}return ce.filter(Le=>Le.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,ee)=>Y.sortKey-ee.sortKey)}update(e,n,r,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,r,c),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,r,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const r=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(n[e.segment+1]),h=e.dist(n[e.segment]);const p={};for(let g=e.segment+1;g<n.length;g++)p[g]={x:n[g].x,y:n[g].y,tileUnitDistanceFromAnchor:c},g<n.length-1&&(c+=n[g+1].dist(n[g]));for(let g=e.segment||0;g>=0;g--)p[g]={x:n[g].x,y:n[g].y,tileUnitDistanceFromAnchor:h},g>0&&(h+=n[g-1].dist(n[g]));for(let g=0;g<n.length;g++){const y=p[g];this.lineVertexArray.emplaceBack(y.x,y.y,y.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,n,r,c,h,p,g,y,w,T,S,I,D,L){const O=e.indexArray,Z=e.layoutVertexArray,Y=e.segments.prepareSegment(4*n.length,Z,O,this.canOverlap?p.sortKey:void 0),ee=this.glyphOffsetArray.length,se=Y.vertexLength,ce=this.allowVerticalPlacement&&g===On.vertical?Math.PI/2:0,ae=p.text&&p.text.sections;for(let he=0;he<n.length;he++){const{tl:Ce,tr:we,bl:Ge,br:Le,tex:Ie,pixelOffsetTL:Re,pixelOffsetBR:Be,minFontScaleX:Me,minFontScaleY:Ze,glyphOffset:Ke,isSDF:gt,sectionIndex:$t}=n[he],ht=Y.vertexLength,Ft=Ke[1];dd(Z,y.x,y.y,y.z,w.x,w.y,Ce.x,Ft+Ce.y,Ie.x,Ie.y,r,gt,Re.x,Re.y,Me,Ze),dd(Z,y.x,y.y,y.z,w.x,w.y,we.x,Ft+we.y,Ie.x+Ie.w,Ie.y,r,gt,Be.x,Re.y,Me,Ze),dd(Z,y.x,y.y,y.z,w.x,w.y,Ge.x,Ft+Ge.y,Ie.x,Ie.y+Ie.h,r,gt,Re.x,Be.y,Me,Ze),dd(Z,y.x,y.y,y.z,w.x,w.y,Le.x,Ft+Le.y,Ie.x+Ie.w,Ie.y+Ie.h,r,gt,Be.x,Be.y,Me,Ze),If(e.dynamicLayoutVertexArray,y,ce),O.emplaceBack(ht,ht+1,ht+2),O.emplaceBack(ht+1,ht+2,ht+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ke[0]),he!==n.length-1&&$t===n[he+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,p,p.index,{},D,L,ae&&ae[$t])}e.placedSymbolArray.emplaceBack(y.x,y.y,y.z,w.x,w.y,ee,this.glyphOffsetArray.length-ee,se,T,S,w.segment,r?r[0]:0,r?r[1]:0,c[0],c[1],g,0,!1,0,I,0)}_commitLayoutVertex(e,n,r,c,h,p,g){e.emplaceBack(n,r,c,h,p,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,n,r,c,h,p,g){const y=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),w=y.vertexLength,T=g.tileAnchorX,S=g.tileAnchorY;for(let D=0;D<4;D++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,c,h,p,T,S,new _e(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,c,h,p,T,S,new _e(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,c,h,p,T,S,new _e(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,c,h,p,T,S,new _e(e.x1,e.y2)),y.vertexLength+=4;const I=r.indexArray;I.emplaceBack(w,w+1),I.emplaceBack(w+1,w+2),I.emplaceBack(w+2,w+3),I.emplaceBack(w+3,w),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,r,c,h,p){for(let g=c;g<h;g++){const y=r.get(g),w=this.getSymbolInstanceTextSize(e,p,n,g);this._addCollisionDebugVertices(y,w,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,r,c,h,p){for(let g=c;g<h;g++){const y=r.get(g),w=this.getSymbolInstanceIconSize(e,n,g);this._addCollisionDebugVertices(y,w,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Mf(Ai,Gg.members,Ht),this.iconCollisionBox=new Mf(Ai,Gg.members,Ht);const r=dl(this.iconSizeData,e),c=dl(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(r,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(r,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,r,c){const h=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),p=od(this.textSizeData,e,h)/Oi;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,r){const c=this.icon.placedSymbolArray.get(r),h=od(this.iconSizeData,e,c);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,n,r){e.emplaceBack(n,-r,-r),e.emplaceBack(n,r,-r),e.emplaceBack(n,r,r),e.emplaceBack(n,-r,r)}_updateTextDebugCollisionBoxes(e,n,r,c,h,p){for(let g=c;g<h;g++){const y=r.get(g),w=this.getSymbolInstanceTextSize(e,p,n,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,y.padding)}}_updateIconDebugCollisionBoxes(e,n,r,c,h){for(let p=c;p<h;p++){const g=r.get(p),y=this.getSymbolInstanceIconSize(e,n,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,y,g.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=dl(this.iconSizeData,e),c=dl(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(r,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(r,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,r,c,h,p,g,y,w){const T={};for(let S=n;S<r;S++){const I=e.get(S);T.textBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},T.textFeatureIndex=I.featureIndex;break}for(let S=c;S<h;S++){const I=e.get(S);T.verticalTextBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},T.verticalTextFeatureIndex=I.featureIndex;break}for(let S=p;S<g;S++){const I=e.get(S);T.iconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},T.iconFeatureIndex=I.featureIndex;break}for(let S=y;S<w;S++){const I=e.get(S);T.verticalIconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},T.verticalIconFeatureIndex=I.featureIndex;break}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const r=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const r=e.placedSymbolArray.get(n),c=r.vertexStartIndex+4*r.numGlyphs;for(let h=r.vertexStartIndex;h<c;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),r=Math.cos(e),c=[],h=[],p=[];for(let g=0;g<this.symbolInstances.length;++g){p.push(g);const y=this.symbolInstances.get(g);c.push(0|Math.round(n*y.tileAnchorX+r*y.tileAnchorY)),h.push(y.featureIndex)}return p.sort((g,y)=>c[g]-c[y]||h[y]-h[g]),p}addToSortKeyRanges(e,n){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===n?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const r=this.symbolInstances.get(n);this.featureSortOrder.push(r.featureIndex),[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((c,h,p)=>{c>=0&&p.indexOf(c)===h&&this.addIndicesForPlacedSymbol(this.text,c)}),r.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,r.verticalPlacedTextSymbolIndex),r.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.placedIconSymbolIndex),r.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Je("SymbolBucket",Ho,{omit:["layers","collisionBoxArray","features","compareText"]}),Ho.MAX_GLYPHS=65535,Ho.addDynamicAttributes=If;const ob=new Ee({"symbol-placement":new j(le.layout_symbol["symbol-placement"]),"symbol-spacing":new j(le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new j(le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new J(le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new j(le.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new j(le.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new j(le.layout_symbol["icon-ignore-placement"]),"icon-optional":new j(le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new j(le.layout_symbol["icon-rotation-alignment"]),"icon-size":new J(le.layout_symbol["icon-size"]),"icon-text-fit":new j(le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new j(le.layout_symbol["icon-text-fit-padding"]),"icon-image":new J(le.layout_symbol["icon-image"]),"icon-rotate":new J(le.layout_symbol["icon-rotate"]),"icon-padding":new j(le.layout_symbol["icon-padding"]),"icon-keep-upright":new j(le.layout_symbol["icon-keep-upright"]),"icon-offset":new J(le.layout_symbol["icon-offset"]),"icon-anchor":new J(le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new j(le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new j(le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new j(le.layout_symbol["text-rotation-alignment"]),"text-field":new J(le.layout_symbol["text-field"]),"text-font":new J(le.layout_symbol["text-font"]),"text-size":new J(le.layout_symbol["text-size"]),"text-max-width":new J(le.layout_symbol["text-max-width"]),"text-line-height":new J(le.layout_symbol["text-line-height"]),"text-letter-spacing":new J(le.layout_symbol["text-letter-spacing"]),"text-justify":new J(le.layout_symbol["text-justify"]),"text-radial-offset":new J(le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new j(le.layout_symbol["text-variable-anchor"]),"text-anchor":new J(le.layout_symbol["text-anchor"]),"text-max-angle":new j(le.layout_symbol["text-max-angle"]),"text-writing-mode":new j(le.layout_symbol["text-writing-mode"]),"text-rotate":new J(le.layout_symbol["text-rotate"]),"text-padding":new j(le.layout_symbol["text-padding"]),"text-keep-upright":new j(le.layout_symbol["text-keep-upright"]),"text-transform":new J(le.layout_symbol["text-transform"]),"text-offset":new J(le.layout_symbol["text-offset"]),"text-allow-overlap":new j(le.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new j(le.layout_symbol["text-ignore-placement"]),"text-optional":new j(le.layout_symbol["text-optional"])});var kf={paint:new Ee({"icon-opacity":new J(le.paint_symbol["icon-opacity"]),"icon-color":new J(le.paint_symbol["icon-color"]),"icon-halo-color":new J(le.paint_symbol["icon-halo-color"]),"icon-halo-width":new J(le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new J(le.paint_symbol["icon-halo-blur"]),"icon-translate":new j(le.paint_symbol["icon-translate"]),"icon-translate-anchor":new j(le.paint_symbol["icon-translate-anchor"]),"text-opacity":new J(le.paint_symbol["text-opacity"]),"text-color":new J(le.paint_symbol["text-color"],{runtimeType:ci,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new J(le.paint_symbol["text-halo-color"]),"text-halo-width":new J(le.paint_symbol["text-halo-width"]),"text-halo-blur":new J(le.paint_symbol["text-halo-blur"]),"text-translate":new j(le.paint_symbol["text-translate"]),"text-translate-anchor":new j(le.paint_symbol["text-translate-anchor"])}),layout:ob};class gy{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Zn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Je("FormatSectionOverride",gy,{omit:["defaultValue"]});class pd extends sr{constructor(e){super(e,kf)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const c=[];for(const h of r)c.indexOf(h)<0&&c.push(h);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,r,c){const h=this.layout.get(e).evaluate(n,{},r,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Rn(p.value)||!h?h:function(g,y){return y.replace(/{([^{}]+)}/g,(w,T)=>T in g?String(g[T]):"")}(n.properties,h)}createBucket(e){return new Ho(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of kf.paint.overridableProperties){if(!pd.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),r=new gy(n),c=new yc(r,n.property.specification);let h=null;h=n.value.kind==="constant"||n.value.kind==="source"?new br("source",c):new Ga("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new X(n.property,h,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,r){return!(!this.layout||n.isDataDriven()||r.isDataDriven())&&pd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const r=e.get("text-field"),c=kf.paint.properties[n];let h=!1;const p=g=>{for(const y of g)if(c.overrides&&c.overrides.hasOverride(y))return void(h=!0)};if(r.value.kind==="constant"&&r.value.value instanceof Li)p(r.value.value.sections);else if(r.value.kind==="source"){const g=w=>{h||(w instanceof Yr&&ui(w.value)===So?p(w.value.sections):w instanceof Cs?p(w.sections):w.eachChild(g))},y=r.value;y._styleExpression&&g(y._styleExpression.expression)}return h}getProgramConfiguration(e){return new ro(this,e)}}var sb={paint:new Ee({"background-color":new j(le.paint_background["background-color"]),"background-pattern":new ve(le.paint_background["background-pattern"]),"background-opacity":new j(le.paint_background["background-opacity"])})},ab={paint:new Ee({"raster-opacity":new j(le.paint_raster["raster-opacity"]),"raster-hue-rotate":new j(le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new j(le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new j(le.paint_raster["raster-brightness-max"]),"raster-saturation":new j(le.paint_raster["raster-saturation"]),"raster-contrast":new j(le.paint_raster["raster-contrast"]),"raster-resampling":new j(le.paint_raster["raster-resampling"]),"raster-fade-duration":new j(le.paint_raster["raster-fade-duration"])})};class lb extends sr{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var cb={paint:new Ee({"sky-type":new j(le.paint_sky["sky-type"]),"sky-atmosphere-sun":new j(le.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new j(le.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new j(le.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new j(le.paint_sky["sky-gradient-radius"]),"sky-gradient":new xe(le.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new j(le.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new j(le.paint_sky["sky-atmosphere-color"]),"sky-opacity":new j(le.paint_sky["sky-opacity"])})};function zf(i,e,n){const r=cl(0,0,1),c=Tg(of());return function(h,p,g){g*=.5;var y=p[0],w=p[1],T=p[2],S=p[3],I=Math.sin(g),D=Math.cos(g);h[0]=y*D-T*I,h[1]=w*D+S*I,h[2]=T*D+y*I,h[3]=S*D-w*I}(c,c,n?-te(i)+Math.PI:te(i)),Eg(c,c,-te(e)),bg(r,r,c),wg(r,r)}const ub={circle:class extends sr{constructor(i){super(i,M1)}createBucket(i){return new ef(i)}queryRadius(i){const e=i;return ll("circle-radius",this,e)+ll("circle-stroke-width",this,e)+Yh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,n,r,c,h,p,g){const y=fg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Cg(i,r,h,p,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,w)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new ro(this,i)}},heatmap:class extends sr{createBucket(i){return new Ag(i)}constructor(i){super(i,F1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=lf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return ll("heatmap-radius",this,i)}queryIntersectsFeature(i,e,n,r,c,h,p,g){const y=this.paint.get("heatmap-radius").evaluate(e,n);return Cg(i,r,h,p,g,!0,!0,new _e(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new ro(this,i)}},hillshade:class extends sr{constructor(i){super(i,O1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(i){return new ro(this,i)}},fill:class extends sr{constructor(i){super(i,tw)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(i){return new ro(this,i)}recalculate(i,e){super.recalculate(i,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new nd(i)}queryRadius(){return Yh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,n,r,c,h){return!i.queryGeometry.isAboveHorizon&&cg(pg(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends sr{constructor(i){super(i,dw)}createBucket(i){return new mf(i)}queryRadius(){return Yh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new ro(this,i)}queryIntersectsFeature(i,e,n,r,c,h,p,g,y){const w=fg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,n),S=this.paint.get("fill-extrusion-base").evaluate(e,n),I=[0,0],D=g&&h.elevation,L=h.elevation?h.elevation.exaggeration():1;if(D){const Y=i.tile.getBucket(this).centroidVertexArray,ee=y+1;if(ee<Y.length){const se=Y.get(ee);I[0]=se.a_centroid_pos0,I[1]=se.a_centroid_pos1}}if(I[0]===0&&I[1]===1)return!1;const O=function(Y,ee,se,ce,ae,he,Ce,we,Ge){return he?function(Le,Ie,Re,Be,Me,Ze,Ke,gt,$t){const ht=[],Ft=[],We=[0,0,0,1];for(const Gt of Le){const Lt=[],_i=[];for(const gi of Gt){const Ei=gi.x+Be.x,zi=gi.y+Be.y,Vt=pw(Ei,zi,Ie,Re,Ze,Ke,gt,$t);We[0]=Ei,We[1]=zi,We[2]=Vt.base,We[3]=1,Uc(We,We,Me),We[3]=Math.max(We[3],1e-5);const Ot=Ng([We[0]/We[3],We[1]/We[3],We[2]/We[3]]);We[0]=Ei,We[1]=zi,We[2]=Vt.top,We[3]=1,Uc(We,We,Me),We[3]=Math.max(We[3],1e-5);const Jt=Ng([We[0]/We[3],We[1]/We[3],We[2]/We[3]]);Lt.push(Ot),_i.push(Jt)}ht.push(Lt),Ft.push(_i)}return[ht,Ft]}(Y,ee,se,ce,ae,he,Ce,we,Ge):function(Le,Ie,Re,Be,Me){const Ze=[],Ke=[],gt=Me[8]*Ie,$t=Me[9]*Ie,ht=Me[10]*Ie,Ft=Me[11]*Ie,We=Me[8]*Re,Gt=Me[9]*Re,Lt=Me[10]*Re,_i=Me[11]*Re;for(const gi of Le){const Ei=[],zi=[];for(const Vt of gi){const Ot=Vt.x+Be.x,Jt=Vt.y+Be.y,Ui=Me[0]*Ot+Me[4]*Jt+Me[12],yi=Me[1]*Ot+Me[5]*Jt+Me[13],Ii=Me[2]*Ot+Me[6]*Jt+Me[14],Ni=Me[3]*Ot+Me[7]*Jt+Me[15],ii=Ui+gt,dn=yi+$t,Zt=Ii+ht,xi=Math.max(Ni+Ft,1e-5),vi=Ui+We,di=yi+Gt,ai=Ii+Lt,Si=Math.max(Ni+_i,1e-5),qt=new _e(ii/xi,dn/xi);qt.z=Zt/xi,Ei.push(qt);const qi=new _e(vi/Si,di/Si);qi.z=ai/Si,zi.push(qi)}Ze.push(Ei),Ke.push(zi)}return[Ze,Ke]}(Y,ee,se,ce,ae)}(r,S,T,w,p,D?g:null,I,L,h.center.lat),Z=i.queryGeometry;return function(Y,ee,se){let ce=1/0;cg(se,ee)&&(ce=Ug(se,ee[0]));for(let ae=0;ae<ee.length;ae++){const he=ee[ae],Ce=Y[ae];for(let we=0;we<he.length-1;we++){const Ge=he[we],Le=[Ge,he[we+1],Ce[we+1],Ce[we],Ge];lg(se,Le)&&(ce=Math.min(ce,Ug(se,Le)))}}return ce!==1/0&&ce}(O[0],O[1],Z.isPointQuery()?Z.screenBounds:Z.screenGeometry)}},line:class extends sr{constructor(i){super(i,Vg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ms,this.gradientVersion=(this.gradientVersion+1)%it}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=jg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new rd(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new ro(this,i)}queryRadius(i){const e=i,n=$g(ll("line-width",this,e),ll("line-gap-width",this,e)),r=ll("line-offset",this,e);return n/2+Math.abs(r)+Yh(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,n,r,c,h){if(i.queryGeometry.isAboveHorizon)return!1;const p=pg(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),g=i.pixelToTileUnitsFactor/2*$g(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(r=function(w,T){const S=[],I=new _e(0,0);for(let D=0;D<w.length;D++){const L=w[D],O=[];for(let Z=0;Z<L.length;Z++){const Y=L[Z-1],ee=L[Z],se=L[Z+1],ce=Z===0?I:ee.sub(Y)._unit()._perp(),ae=Z===L.length-1?I:se.sub(ee)._unit()._perp(),he=ce._add(ae)._unit();he._mult(1/(he.x*ae.x+he.y*ae.y)),O.push(he._mult(T)._add(ee))}S.push(O)}return S}(r,y*i.pixelToTileUnitsFactor)),function(w,T,S){for(let I=0;I<T.length;I++){const D=T[I];if(w.length>=3){for(let L=0;L<D.length;L++)if(al(w,D[L]))return!0}if(S1(w,D,S))return!0}return!1}(p,r,g)}isTileClipped(){return!0}},symbol:pd,background:class extends sr{constructor(i){super(i,sb)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends sr{constructor(i){super(i,ab)}getProgramIds(){return["raster"]}},sky:class extends sr{constructor(i){super(i,cb),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=lf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(i,e){const n=this.paint.get("sky-type");if(n==="atmosphere"){const r=this.paint.get("sky-atmosphere-sun"),c=!r,h=i.style.light,p=h.properties.get("position");return c&&h.properties.get("anchor")==="viewport"&&nt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?zf(p.azimuthal,90-p.polar,e):zf(r[0],90-r[1],e)}if(n==="gradient"){const r=this.paint.get("sky-gradient-center");return zf(r[0],90-r[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:yy,HTMLCanvasElement:xy,HTMLVideoElement:vy,ImageData:wy,ImageBitmap:fd}=ze;class md{constructor(e,n,r,c){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,r){const{width:c,height:h}=e,{context:p}=this,{gl:g}=p;if(g.bindTexture(g.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!n||n.premultiply!==!1)),r||this.size&&this.size[0]===c&&this.size[1]===h){const{x:y,y:w}=r||{x:0,y:0};e instanceof yy||e instanceof xy||e instanceof vy||e instanceof wy||fd&&e instanceof fd?g.texSubImage2D(g.TEXTURE_2D,0,y,w,g.RGBA,g.UNSIGNED_BYTE,e):g.texSubImage2D(g.TEXTURE_2D,0,y,w,c,h,g.RGBA,g.UNSIGNED_BYTE,e.data)}else this.size=[c,h],e instanceof yy||e instanceof xy||e instanceof vy||e instanceof wy||fd&&e instanceof fd?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,e):g.texImage2D(g.TEXTURE_2D,0,this.format,c,h,0,this.format,g.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,n){const{context:r}=this,{gl:c}=r;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Pf{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Zo({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const r=this.getKey(e,n);return this.positions[r]}trim(){const e=this.width,n=this.height=on(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,r){const c=[];let h=e.length%2==1?-e[e.length-1]*r:0,p=e[0]*r,g=!0;c.push({left:h,right:p,isDash:g,zeroLength:e[0]===0});let y=e[0];for(let w=1;w<e.length;w++){g=!g;const T=e[w];h=y*r,y+=T,p=y*r,c.push({left:h,right:p,isDash:g,zeroLength:T===0})}return c}addRoundDash(e,n,r){const c=n/2;for(let h=-r;h<=r;h++){const p=this.width*(this.nextRow+r+h);let g=0,y=e[g];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++g]);const T=Math.abs(w-y.left),S=Math.abs(w-y.right),I=Math.min(T,S);let D;const L=h/r*(c+1);if(y.isDash){const O=c-Math.abs(L);D=Math.sqrt(I*I+O*O)}else D=c-Math.sqrt(I*I+L*L);this.image.data[p+w]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){const w=e[y],T=e[y+1];w.zeroLength?e.splice(y,1):T&&T.isDash===w.isDash&&(T.left=w.left,e.splice(y,1))}const r=e[0],c=e[e.length-1];r.isDash===c.isDash&&(r.left=c.left-this.width,c.right=r.right+this.width);const h=this.width*this.nextRow;let p=0,g=e[p];for(let y=0;y<this.width;y++){y/g.right>1&&(g=e[++p]);const w=Math.abs(y-g.left),T=Math.abs(y-g.right),S=Math.min(w,T);this.image.data[h+y]=Math.max(0,Math.min(255,(g.isDash?S:-S)+n+128))}}addDash(e,n){const r=this.getKey(e,n);if(this.positions[r])return this.positions[r];const c=n==="round",h=c?7:0,p=2*h+1;if(this.nextRow+p>this.height)return nt("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let T=0;T<e.length;T++)e[T]<0&&(nt("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),g+=e[T];if(g!==0){const T=this.width/g,S=this.getDashRanges(e,this.width,T);c?this.addRoundDash(S,T,h):this.addRegularDash(S,n==="square"?.5*T:0)}const y=this.nextRow+h;this.nextRow+=p;const w={tl:[y,h],br:[g,0]};return this.positions[r]=w,w}}Je("LineAtlas",Pf);class hb{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const db=ze.performance;function by(i){const e=i?i.url.toString():void 0;return db.getEntriesByName(e)}class pb{constructor(){this.tasks={},this.taskQueue=[],kn(["process"],this),this.invoker=new hb(this.process),this.nextId=0}add(e,n){const r=this.nextId++,c=function({type:h,isSymbolTile:p,zoom:g}){return g=g||0,h==="message"?0:h!=="maybePrepare"||p?h!=="parseTile"||p?h==="parseTile"&&p?300-g:h==="maybePrepare"&&p?400-g:500:200-g:100-g}(n);if(c===0){Ti();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:n,priority:c,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){Ti();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){const h=this.tasks[this.taskQueue[c]];h.priority<n&&(n=h.priority,e=c)}if(e===null)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}function _d(i,e){const n=Math.pow(2,-i.z),r=i.x*n,c=(i.x+1)*n,h=i.y*n,p=(i.y+1)*n;if(e.name==="mercator")return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const g=Ys(r),y=Ys(c),w=Ar(h),T=Ar(p),S=e.project(g,w),I=e.project(y,w),D=e.project(y,T),L=e.project(g,T);let O=Math.min(S.x,I.x,D.x,L.x),Z=Math.min(S.y,I.y,D.y,L.y),Y=Math.max(S.x,I.x,D.x,L.x),ee=Math.max(S.y,I.y,D.y,L.y);const se=n/16;function ce(he,Ce,we,Ge,Le,Ie){const Re=(we+Le)/2,Be=(Ge+Ie)/2,Me=e.project(Ys(Re),Ar(Be)),Ze=Math.max(0,O-Me.x,Z-Me.y,Me.x-Y,Me.y-ee);O=Math.min(O,Me.x),Y=Math.max(Y,Me.x),Z=Math.min(Z,Me.y),ee=Math.max(ee,Me.y),Ze>se&&(ce(he,Me,we,Ge,Re,Be),ce(Me,Ce,Re,Be,Le,Ie))}ce(S,I,r,h,c,h),ce(I,D,c,h,c,p),ce(D,L,c,p,r,p),ce(L,S,r,p,r,h),O-=se,Z-=se,Y+=se,ee+=se;const ae=1/Math.max(Y-O,ee-Z);return{scale:ae,x:O*ae,y:Z*ae,x2:Y*ae,y2:ee*ae,projection:e}}function Ty(i,e,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[i*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class Df{constructor(e,n,r){this.z=e,this.x=n,this.y=r,this.key=Yc(0,e,e,n,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const r=(h=this.y,p=this.z,g=Ty(256*(c=this.x),256*(h=Math.pow(2,p)-h-1),p),y=Ty(256*(c+1),256*(h+1),p),g[0]+","+g[1]+","+y[0]+","+y[1]);var c,h,p,g,y;const w=function(T,S,I){let D,L="";for(let O=T;O>0;O--)D=1<<O-1,L+=(S&D?1:0)+(I&D?2:0);return L}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",w).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ey{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Yc(e,n.z,n.z,n.x,n.y)}}class hn{constructor(e,n,r,c,h){this.overscaledZ=e,this.wrap=n,this.canonical=new Df(r,+c,+h),this.key=n===0&&e===r?this.canonical.key:Yc(n,e,r,c,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new hn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hn(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Yc(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return Yc(this.wrap*+n,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new hn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,r=2*this.canonical.x,c=2*this.canonical.y;return[new hn(n,this.wrap,n,r,c),new hn(n,this.wrap,n,r+1,c),new hn(n,this.wrap,n,r,c+1),new hn(n,this.wrap,n,r+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new hn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new hn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ey(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Yc(i,e,n,r,c){const h=1<<Math.min(n,22);let p=h*(c%h)+r%h;return i&&n<22&&(p+=h*h*((i<0?-2*i-1:2*i)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}Je("CanonicalTileID",Df),Je("OverscaledTileID",hn,{omit:["projMatrix"]});class Sy{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const r=e[n];this._stringToNumber[r]=n,this._numberToString[n]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Cy{constructor(e,n,r,c,h){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=r,e._y=c,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}var fb=ye([{name:"a_pos",type:"Int16",components:2}]);const Xn=32,kr=33,Yo=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,n=0,r=0,c=0,h=0,p=0,g=0;for(1&e?c=h=p=Xn:n=r=g=Xn;(e>>=1)>1;){const w=n+c>>1,T=r+h>>1;1&e?(c=n,h=r,n=p,r=g):(n=c,r=h,c=p,h=g),p=w,g=T}const y=4*i;Yo[y+0]=n,Yo[y+1]=r,Yo[y+2]=c,Yo[y+3]=h}const zr=new Uint16Array(2178),Ko=new Uint8Array(1089),gd=new Uint16Array(1089);function Iy(i){return i===0?-.03125:i===32?.03125:0}var Lf=ye([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Ay={type:2,extent:At,loadGeometry:()=>[[new _e(0,0),new _e(8193,0),new _e(8193,8193),new _e(0,8193),new _e(0,0)]]};class My{constructor(e,n,r,c,h){this.tileID=e,this.uid=ei(),this.uses=0,this.tileSize=n,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=h,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<an.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=_d(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,h){const p={};if(!h)return p;for(const g of c){const y=g.layerIds.map(w=>h.getLayer(w)).filter(Boolean);if(y.length!==0){g.layers=y,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(w=>y.filter(T=>T.id===w)[0]));for(const w of y)p[w.id]=g}}return p}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const h=this.buckets[c];if(h instanceof Ho){if(this.hasSymbolBuckets=!0,!r)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const h=this.buckets[c];if(h instanceof Ho&&h.hasRTLText){this.hasRTLText=!0,M.isLoading()||M.isLoaded()||C()!=="deferred"||A();break}}this.queryPadding=0;for(const c in this.buckets){const h=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ji}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const r in this.buckets){const c=this.buckets[r];c.uploadPending()&&c.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new md(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new md(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new md(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,r,c,h,p,g,y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:g,transform:p,params:h,tileTransform:this.tileTransform},e,n,r):{}}querySourceFeatures(e,n){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const c=r.loadVTLayers(),h=n?n.sourceLayer:"",p=c._geojsonTileLayer||c[h];if(!p)return;const g=Ls(n&&n.filter),{z:y,x:w,y:T}=this.tileID.canonical,S={z:y,x:w,y:T};for(let I=0;I<p.length;I++){const D=p.feature(I);if(g.needGeometry){const Z=Ks(D,!0);if(!g.filter(new z(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!g.filter(new z(this.tileID.overscaledZ),D))continue;const L=r.getId(D,h),O=new Cy(D,y,w,T,L);O.tile=S,e.push(O)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const r=$i(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const r=Date.now();let c=!1;if(this.expirationTime>r)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const h=this.expirationTime-n;h?this.expirationTime=r+Math.max(h,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!n)return;const r=this.latestFeatureIndex.loadVTLayers(),c=n.style.listImages();for(const h in this.buckets){if(!n.style.hasLayer(h))continue;const p=this.buckets[h],g=p.layers[0].sourceLayer||"_geojsonTileLayer",y=r[g],w=e[g];if(!y||!w||Object.keys(w).length===0)continue;if(p.update(w,y,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof rd||p instanceof nd){const S=n.style._getSourceCache(p.layers[0].source);n._terrain&&n._terrain.enabled&&S&&p.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(S.id,this.tileID)}const T=n&&n.style&&n.style.getLayer(h);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<an.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=an.now()+e}setDependencies(e,n){const r={};for(const c of n)r[c]=!0;this.dependencies[e]=r}hasDependency(e,n){for(const r of e){const c=this.dependencies[r];if(c){for(const h of n)if(c[h])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const r=oo(Ay,this.tileID.canonical,this.tileTransform)[0],c=new Qe,h=new Mi;for(let p=0;p<r.length;p++){const{x:g,y}=r[p];c.emplaceBack(g,y),h.emplaceBack(p)}h.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(c,Lf.members),this._tileDebugSegments=ki.simpleSegment(0,0,c.length,h.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const r=oo(Ay,this.tileID.canonical,this.tileTransform)[0];let c,h;if(this.isRaster){const p=function(g,y){const w=_d(g,y),T=Math.pow(2,g.z);for(let Z=0;Z<kr;Z++)for(let Y=0;Y<kr;Y++){const ee=Ys((g.x+(Y+Iy(Y))/Xn)/T),se=Ar((g.y+(Z+Iy(Z))/Xn)/T),ce=y.project(ee,se),ae=Z*kr+Y;zr[2*ae+0]=Math.round((ce.x*w.scale-w.x)*At),zr[2*ae+1]=Math.round((ce.y*w.scale-w.y)*At)}Ko.fill(0),gd.fill(0);for(let Z=2045;Z>=0;Z--){const Y=4*Z,ee=Yo[Y+0],se=Yo[Y+1],ce=Yo[Y+2],ae=Yo[Y+3],he=ee+ce>>1,Ce=se+ae>>1,we=he+Ce-se,Ge=Ce+ee-he,Le=se*kr+ee,Ie=ae*kr+ce,Re=Ce*kr+he,Be=Math.hypot((zr[2*Le+0]+zr[2*Ie+0])/2-zr[2*Re+0],(zr[2*Le+1]+zr[2*Ie+1])/2-zr[2*Re+1])>=16;if(Ko[Re]=Ko[Re]||(Be?1:0),Z<1022){const Me=(se+Ge>>1)*kr+(ee+we>>1),Ze=(ae+Ge>>1)*kr+(ce+we>>1);Ko[Re]=Ko[Re]||Ko[Me]||Ko[Ze]}}const S=new lt,I=new mi;let D=0;function L(Z,Y){const ee=Y*kr+Z;return gd[ee]===0&&(S.emplaceBack(zr[2*ee+0],zr[2*ee+1],Z*At/Xn,Y*At/Xn),gd[ee]=++D),gd[ee]-1}function O(Z,Y,ee,se,ce,ae){const he=Z+ee>>1,Ce=Y+se>>1;if(Math.abs(Z-ce)+Math.abs(Y-ae)>1&&Ko[Ce*kr+he])O(ce,ae,Z,Y,he,Ce),O(ee,se,ce,ae,he,Ce);else{const we=L(Z,Y),Ge=L(ee,se),Le=L(ce,ae);I.emplaceBack(we,Ge,Le)}}return O(0,0,Xn,Xn,Xn,0),O(Xn,Xn,0,0,0,Xn),{vertices:S,indices:I}}(this.tileID.canonical,n);c=p.vertices,h=p.indices}else{c=new lt,h=new mi;for(const{x:g,y}of r)c.emplaceBack(g,y,0,0);const p=Jh(c.int16,void 0,4);for(let g=0;g<p.length;g+=3)h.emplaceBack(p[g],p[g+1],p[g+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,Lf.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(h),this._tileBoundsSegments=ki.simpleSegment(0,0,c.length,h.length)}}class mb{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,r){const c=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},Yt(this.stateChanges[e][c],r),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==c&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const h in this.state[e][c])r[h]||(this.deletedStates[e][c][h]=null)}else for(const h in r)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][h]===null&&delete this.deletedStates[e][c][h]}removeFeatureState(e,n,r){if(this.deletedStates[e]===null)return;const c=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&n!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][r]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(r in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][r]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,n){const r=String(n),c=Yt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][n];if(h===null)return{};for(const p in h)delete c[p]}return c}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const r={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const h={};for(const p in this.stateChanges[c])this.state[c][p]||(this.state[c][p]={}),Yt(this.state[c][p],this.stateChanges[c][p]),h[p]=this.state[c][p];r[c]=h}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const h={};if(this.deletedStates[c]===null)for(const p in this.state[c])h[p]={},this.state[c][p]={};else for(const p in this.deletedStates[c]){if(this.deletedStates[c][p]===null)this.state[c][p]={};else for(const g of Object.keys(this.deletedStates[c][p]))delete this.state[c][p][g];h[p]=this.state[c][p]}r[c]=r[c]||{},Yt(r[c],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(const c in e)e[c].setFeatureState(r,n)}}class ky{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const r=this.toIdx(e,n);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function zy(i,e,n,r){let c=0,h=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(r[p])<1e-15){if(n[p]<i[p]||n[p]>e[p])return null}else{const g=1/r[p];let y=(i[p]-n[p])*g,w=(e[p]-n[p])*g;if(y>w){const T=y;y=w,w=T}if(y>c&&(c=y),w<h&&(h=w),c>h)return null}return c}function Py(i,e,n,r,c,h,p,g,y,w,T){const S=r-i,I=c-e,D=h-n,L=p-i,O=g-e,Z=y-n,Y=T[1]*Z-T[2]*O,ee=T[2]*L-T[0]*Z,se=T[0]*O-T[1]*L,ce=S*Y+I*ee+D*se;if(Math.abs(ce)<1e-15)return null;const ae=1/ce,he=w[0]-i,Ce=w[1]-e,we=w[2]-n,Ge=(he*Y+Ce*ee+we*se)*ae;if(Ge<0||Ge>1)return null;const Le=Ce*D-we*I,Ie=we*S-he*D,Re=he*I-Ce*S,Be=(T[0]*Le+T[1]*Ie+T[2]*Re)*ae;return Be<0||Ge+Be>1?null:(L*Le+O*Ie+Z*Re)*ae}function Dy(i,e,n){return(i-e)/(n-e)}function Ly(i,e,n,r,c,h,p,g,y){const w=1<<n,T=h-r,S=p-c,I=(i+1)/w*T+r,D=(e+0)/w*S+c,L=(e+1)/w*S+c;g[0]=(i+0)/w*T+r,g[1]=D,y[0]=I,y[1]=L}class Ry{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(h){const p=Math.ceil(Math.log2(h.dim/8)),g=[];let y=Math.ceil(Math.pow(2,p));const w=1/y,T=(D,L,O,Z,Y)=>{const ee=Z?1:0,se=(D+1)*O-ee,ce=L*O,ae=(L+1)*O-ee;Y[0]=D*O,Y[1]=ce,Y[2]=se,Y[3]=ae};let S=new ky(y);const I=[];for(let D=0;D<y*y;D++){T(D%y,Math.floor(D/y),w,!1,I);const L=Jo(I[0],I[1],h),O=Jo(I[2],I[1],h),Z=Jo(I[2],I[3],h),Y=Jo(I[0],I[3],h);S.minimums.push(Math.min(L,O,Z,Y)),S.maximums.push(Math.max(L,O,Z,Y)),S.leaves.push(1)}for(g.push(S),y/=2;y>=1;y/=2){const D=g[g.length-1];S=new ky(y);for(let L=0;L<y*y;L++){T(L%y,Math.floor(L/y),2,!0,I);const O=D.getElevation(I[0],I[1]),Z=D.getElevation(I[2],I[1]),Y=D.getElevation(I[2],I[3]),ee=D.getElevation(I[0],I[3]),se=D.isLeaf(I[0],I[1]),ce=D.isLeaf(I[2],I[1]),ae=D.isLeaf(I[2],I[3]),he=D.isLeaf(I[0],I[3]),Ce=Math.min(O.min,Z.min,Y.min,ee.min),we=Math.max(O.max,Z.max,Y.max,ee.max),Ge=se&&ce&&ae&&he;S.maximums.push(we),S.minimums.push(Ce),S.leaves.push(we-Ce<=5&&Ge?1:0)}g.push(S)}return g}(this.dem),r=n.length-1,c=n[r];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,r,0)}raycastRoot(e,n,r,c,h,p,g=1){return zy([e,n,-100],[r,c,this.maximums[0]*g],h,p)}raycast(e,n,r,c,h,p,g=1){if(!this.nodeCount)return null;const y=this.raycastRoot(e,n,r,c,h,p,g);if(y==null)return null;const w=[],T=[],S=[],I=[],D=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:L,t:O,nodex:Z,nodey:Y,depth:ee}=D.pop();if(this.leaves[L]){Ly(Z,Y,ee,e,n,r,c,S,I);const ce=1<<ee,ae=(Z+0)/ce,he=(Z+1)/ce,Ce=(Y+0)/ce,we=(Y+1)/ce,Ge=Jo(ae,Ce,this.dem)*g,Le=Jo(he,Ce,this.dem)*g,Ie=Jo(he,we,this.dem)*g,Re=Jo(ae,we,this.dem)*g,Be=Py(S[0],S[1],Ge,I[0],S[1],Le,I[0],I[1],Ie,h,p),Me=Py(I[0],I[1],Ie,S[0],I[1],Re,S[0],S[1],Ge,h,p),Ze=Math.min(Be!==null?Be:Number.MAX_VALUE,Me!==null?Me:Number.MAX_VALUE);if(Ze!==Number.MAX_VALUE)return Ze;{const Ke=vg([],h,p,O);if(By(Ge,Le,Re,Ie,Dy(Ke[0],S[0],I[0]),Dy(Ke[1],S[1],I[1]))>=Ke[2])return O}continue}let se=0;for(let ce=0;ce<this._siblingOffset.length;ce++){Ly((Z<<1)+this._siblingOffset[ce][0],(Y<<1)+this._siblingOffset[ce][1],ee+1,e,n,r,c,S,I),S[2]=-100,I[2]=this.maximums[this.childOffsets[L]+ce]*g;const ae=zy(S,I,h,p);if(ae!=null){const he=ae;w[ce]=he;let Ce=!1;for(let we=0;we<se&&!Ce;we++)he>=w[T[we]]&&(T.splice(we,0,ce),Ce=!0);Ce||(T[se]=ce),se++}}for(let ce=0;ce<se;ce++){const ae=T[ce];D.push({idx:this.childOffsets[L]+ae,t:w[ae],nodex:(Z<<1)+this._siblingOffset[ae][0],nodey:(Y<<1)+this._siblingOffset[ae][1],depth:ee+1})}}return null}_addNode(e,n,r){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,r,c,h){if(e[c].isLeaf(n,r)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const p=c-1,g=e[p];let y,w=0;for(let T=0;T<this._siblingOffset.length;T++){const S=2*n+this._siblingOffset[T][0],I=2*r+this._siblingOffset[T][1],D=g.getElevation(S,I),L=g.isLeaf(S,I),O=this._addNode(D.min,D.max,L);L&&(w|=1<<T),y||(y=O)}for(let T=0;T<this._siblingOffset.length;T++)w&1<<T||this._construct(e,2*n+this._siblingOffset[T][0],2*r+this._siblingOffset[T][1],p,y+T)}}function By(i,e,n,r,c,h){return Pt(Pt(i,n,h),Pt(e,r,h),c)}function Jo(i,e,n){const r=n.dim,c=Ye(i*r-.5,0,r-1),h=Ye(e*r-.5,0,r-1),p=Math.floor(c),g=Math.floor(h),y=Math.min(p+1,r-1),w=Math.min(g+1,r-1);return By(n.get(p,g),n.get(y,g),n.get(p,w),n.get(y,w),c-p,h-g)}const Fy={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class yd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,r,c=!1,h=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return nt(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const p=this.dim=n.height-2;if(this.data=new Uint32Array(n.data.buffer),this.encoding=r||"mapbox",this.borderReady=c,!c){for(let g=0;g<p;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(p,g)]=this.data[this._idx(p-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,p)]=this.data[this._idx(g,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)],h&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Ry(this)}get(e,n,r=!1){const c=new Uint8Array(this.data.buffer);r&&(e=Ye(e,-1,this.dim),n=Ye(n,-1,this.dim));const h=4*this._idx(e,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[h],c[h+1],c[h+2])}static getUnpackVector(e){return Fy[e]}get unpackVector(){return Fy[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,r){return(256*e*256+256*n+r)/10-1e4}_unpackTerrarium(e,n,r){return 256*e+n+r/256-32768}static pack(e,n){const r=[0,0,0,0],c=yd.getUnpackVector(n);let h=Math.floor((e+c[3])/c[2]);return r[2]=h%256,h=Math.floor(h/256),r[1]=h%256,h=Math.floor(h/256),r[0]=h,r}getPixels(){return new Fn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,h=n*this.dim+this.dim,p=r*this.dim,g=r*this.dim+this.dim;switch(n){case-1:c=h-1;break;case 1:h=c+1}switch(r){case-1:p=g-1;break;case 1:g=p+1}const y=-n*this.dim,w=-r*this.dim;for(let T=p;T<g;T++)for(let S=c;S<h;S++)this.data[this._idx(S,T)]=e.data[this._idx(S+y,T+w)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Je("DEMData",yd),Je("DemMinMaxQuadTree",Ry,{omit:["dem"]});class _b{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,r){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const h={value:n,timeout:void 0};if(r!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},r)),this.data[c].push(h),this.order.push(c),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const r=e.wrapped().key,c=n===void 0?0:this.data[r].indexOf(n),h=this.data[r][c];return this.data[r].splice(c,1),h.timeout&&clearTimeout(h.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(h.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const r in this.data)for(const c of this.data[r])e(c.value)||n.push(c);for(const r of n)this.remove(r.value.tileID,r)}}class yl{constructor(e,n,r){this.func=e,this.mask=n,this.range=r}}yl.ReadOnly=!1,yl.ReadWrite=!0,yl.disabled=new yl(519,yl.ReadOnly,[0,1]);const Rf=7680;class Bf{constructor(e,n,r,c,h,p){this.test=e,this.ref=n,this.mask=r,this.fail=c,this.depthFail=h,this.pass=p}}Bf.disabled=new Bf({func:519,mask:0},0,0,Rf,Rf,Rf);class Pr{constructor(e,n,r){this.blendFunction=e,this.blendColor=n,this.mask=r}}Pr.Replace=[1,0],Pr.disabled=new Pr(Pr.Replace,kt.transparent,[!1,!1,!1,!1]),Pr.unblended=new Pr(Pr.Replace,kt.transparent,[!0,!0,!0,!0]),Pr.alphaBlended=new Pr([1,771],kt.transparent,[!0,!0,!0,!0]);const Ff=1029,Of=2305;class ar{constructor(e,n,r){this.enable=e,this.mode=n,this.frontFace=r}}ar.disabled=new ar(!1,Ff,Of),ar.backCCW=new ar(!0,Ff,Of),ar.backCW=new ar(!0,Ff,2304),ar.frontCW=new ar(!0,1028,2304),ar.frontCCW=new ar(!0,1028,Of);class Qs extends Ne{constructor(e,n,r){super(),this.id=e,this._onlySymbols=r,n.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new _b(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new mb}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const r=this._tiles[n];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return Qt(this._tiles).map(e=>e.tileID).sort(Oy).map(e=>e.key)}getRenderableIds(e){const n=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&n.push(this._tiles[r]);return e?n.sort((r,c)=>{const h=r.tileID,p=c.tileID,g=new _e(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),y=new _e(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-p.overscaledZ||y.y-g.y||y.x-g.x}).map(r=>r.tileID.key):n.map(r=>r.tileID).sort(Oy).map(r=>r.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const r=this._tiles[e];r&&(r.state!=="loading"&&(r.state=n),this._loadTile(r,this._tileLoaded.bind(this,r,e,n)))}_tileLoaded(e,n,r,c){if(c)return e.state="errored",void(c.status!==404?this._source.fire(new et(c,{tile:e})):this.update(this.transform));e.timeAdded=an.now(),r==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new De("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const h=n[c];if(e.neighboringTiles&&e.neighboringTiles[h]){const p=this.getTileByID(h);r(e,p),r(p,e)}}function r(c,h){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let p=h.tileID.canonical.x-c.tileID.canonical.x;const g=h.tileID.canonical.y-c.tileID.canonical.y,y=Math.pow(2,c.tileID.canonical.z),w=h.tileID.key;p===0&&g===0||Math.abs(g)>1||(Math.abs(p)>1&&(Math.abs(p+y)===1?p+=y:Math.abs(p-y)===1&&(p-=y)),h.dem&&c.dem&&(c.dem.backfillBorder(h.dem,p,g),c.neighboringTiles&&c.neighboringTiles[w]&&(c.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,r,c){for(const h in this._tiles){let p=this._tiles[h];if(c[h]||!p.hasData()||p.tileID.overscaledZ<=n||p.tileID.overscaledZ>r)continue;let g=p.tileID;for(;p&&p.tileID.overscaledZ>n+1;){const w=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[w.key],p&&p.hasData()&&(g=w)}let y=g;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){c[g.key]=g;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=n?r:null}for(let r=e.overscaledZ-1;r>=n;r--){const c=e.scaledTo(r),h=this._getLoadedTile(c);if(h)return h}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const r=Math.ceil(e.width/n)+1,c=Math.ceil(e.height/n)+1,h=Math.floor(r*c*5),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(p)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const r={};for(const c in this._tiles){const h=this._tiles[c];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+n),r[h.tileID.key]=h}this._tiles=r;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,n,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let c;this.updateCacheSize(e,n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(g=>new hn(g.canonical.z,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y)):(c=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(g=>this._source.hasTile(g)))):c=[];const h=this._updateRetainedTiles(c);if(Uy(this._source.type)&&c.length!==0){const g={},y={},w=Object.keys(h);for(const S of w){const I=h[S],D=this._tiles[S];if(!D||D.fadeEndTime&&D.fadeEndTime<=an.now())continue;const L=this.findLoadedParent(I,Math.max(I.overscaledZ-Qs.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),g[L.tileID.key]=L.tileID),y[S]=I}const T=c[c.length-1].overscaledZ;for(const S in this._tiles){const I=this._tiles[S];if(h[S]||!I.hasData())continue;let D=I.tileID;for(;D.overscaledZ>T;){D=D.scaledTo(D.overscaledZ-1);const L=this._tiles[D.key];if(L&&L.hasData()&&y[D.key]){h[S]=I.tileID;break}}}for(const S in g)h[S]||(this._coveredTiles[S]=!0,h[S]=g[S])}for(const g in h)this._tiles[g].clearFadeHold();const p=function(g,y){const w=[];for(const T in g)T in y||w.push(T);return w}(this._tiles,h);for(const g of p){const y=this._tiles[g];y.hasSymbolBuckets&&!y.holdingForFade()?y.setHoldDuration(this.map._fadeDuration):y.hasSymbolBuckets&&!y.symbolFadeFinished()||this._removeTile(+g)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(e.length===0)return n;const r={},c=e.reduce((w,T)=>Math.min(w,T.overscaledZ),1/0),h=e[0].overscaledZ,p=Math.max(h-Qs.maxOverzooming,this._source.minzoom),g=Math.max(h+Qs.maxUnderzooming,this._source.minzoom),y={};for(const w of e){const T=this._addTile(w);n[w.key]=w,T.hasData()||c<this._source.maxzoom&&(y[w.key]=w)}this._retainLoadedChildren(y,c,g,n);for(const w of e){let T=this._tiles[w.key];if(T.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const I=w.children(this._source.maxzoom)[0],D=this.getTile(I);if(D&&D.hasData()){n[I.key]=I;continue}}else{const I=w.children(this._source.maxzoom);if(n[I[0].key]&&n[I[1].key]&&n[I[2].key]&&n[I[3].key])continue}let S=T.wasRequested();for(let I=w.overscaledZ-1;I>=p;--I){const D=w.scaledTo(I);if(r[D.key]||(r[D.key]=!0,T=this.getTile(D),!T&&S&&(T=this._addTile(D)),T&&(n[D.key]=D,S=T.wasRequested(),T.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let r,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){r=this._loadedParentTiles[c.key];break}n.push(c.key);const h=c.scaledTo(c.overscaledZ-1);if(r=this._getLoadedTile(h),r)break;c=h}for(const h of n)this._loadedParentTiles[h]=r}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const r=Boolean(n);if(!r){const c=this.map?this.map.painter:null;n=new My(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._source.type==="raster"||this._source.type==="raster-dem"),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,r||this._source.fire(new De("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=n.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,n,r){const c=[],h=this.transform;if(!h)return c;for(const p in this._tiles){const g=this._tiles[p];if(r&&g.clearQueryDebugViz(),g.holdingForFade())continue;const y=e.containsTile(g,h,n);y&&c.push(y)}return c}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(r=>this._tiles[r].tileID);for(const r of n)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Uy(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=an.now())return!0}return!1}setFeatureState(e,n,r){this._state.updateState(e=e||"_geojsonTileLayer",n,r)}removeFeatureState(e,n,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,r)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,r){const c=this._tiles[e];c&&c.setDependencies(n,r)}reloadTilesForDependencies(e,n){for(const r in this._tiles)this._tiles[r].hasDependency(e,n)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,n))}}function Oy(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||r-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function Uy(i){return i==="raster"||i==="image"||i==="video"}Qs.maxOverzooming=10,Qs.maxUnderzooming=3;class xd{constructor(e,n,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=r}static create(e,n,r){const c=r||e.findDEMTileFor(n);if(!c||!c.dem)return;const h=c.dem,p=c.tileID,g=1<<n.canonical.z-p.canonical.z;return new xd(c,c.tileSize/At/g,[(n.canonical.x/g-p.canonical.x)*h.dim,(n.canonical.y/g-p.canonical.y)*h.dim])}tileCoordToPixel(e,n){const r=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(r);return new _e(c,h)}getElevationAt(e,n,r,c){const h=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],g=Math.floor(h),y=Math.floor(p),w=this._dem;return c=!!c,r?Pt(Pt(w.get(g,y,c),w.get(g,y+1,c),p-y),Pt(w.get(g+1,y,c),w.get(g+1,y+1,c),p-y),h-g):w.get(g,y,c)}getElevationAtPixel(e,n,r){return this._dem.get(e,n,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Yp(1,e)*this._dem.stride}}class Ny{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Oo(At,16,0),this.featureIndexArray=new Y_,this.promoteId=n}insert(e,n,r,c,h,p=0){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,c,h,p);const y=this.grid;for(let w=0;w<n.length;w++){const T=n[w],S=[1/0,1/0,-1/0,-1/0];for(let I=0;I<T.length;I++){const D=T[I];S[0]=Math.min(S[0],D.x),S[1]=Math.min(S[1],D.y),S[2]=Math.max(S[2],D.x),S[3]=Math.max(S[3],D.y)}S[0]<At&&S[1]<At&&S[2]>=0&&S[3]>=0&&y.insert(g,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Js.VectorTile(new Wc(this.rawTileData)).layers,this.sourceLayerCoder=new Sy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,r,c){this.loadVTLayers();const h=e.params||{},p=Ls(h.filter),g=e.tileResult,y=e.transform,w=g.bufferedTilespaceBounds,T=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(L,O,Z,Y)=>dg(g.bufferedTilespaceGeometry,L,O,Z,Y));T.sort(gb);let S=null;y.elevation&&T.length>0&&(S=xd.create(y.elevation,this.tileID));const I={};let D;for(let L=0;L<T.length;L++){const O=T[L];if(O===D)continue;D=O;const Z=this.featureIndexArray.get(O);let Y=null;this.loadMatchingFeature(I,Z,p,h.layers,h.availableImages,n,r,c,(ee,se,ce,ae=0)=>(Y||(Y=oo(ee,this.tileID.canonical,e.tileTransform)),se.queryIntersectsFeature(g,ee,ce,Y,this.z,e.transform,e.pixelPosMatrix,S,ae)))}return I}loadMatchingFeature(e,n,r,c,h,p,g,y,w){const{featureIndex:T,bucketIndex:S,sourceLayerIndex:I,layoutVertexArrayOffset:D}=n,L=this.bucketLayerIDs[S];if(c&&!function(ee,se){for(let ce=0;ce<ee.length;ce++)if(se.indexOf(ee[ce])>=0)return!0;return!1}(c,L))return;const O=this.sourceLayerCoder.decode(I),Z=this.vtLayers[O].feature(T);if(r.needGeometry){const ee=Ks(Z,!0);if(!r.filter(new z(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!r.filter(new z(this.tileID.overscaledZ),Z))return;const Y=this.getId(Z,O);for(let ee=0;ee<L.length;ee++){const se=L[ee];if(c&&c.indexOf(se)<0)continue;const ce=p[se];if(!ce)continue;let ae={};Y!==void 0&&y&&(ae=y.getState(ce.sourceLayer||"_geojsonTileLayer",Y));const he=Yt({},g[se]);he.paint=Vy(he.paint,ce.paint,Z,ae,h),he.layout=Vy(he.layout,ce.layout,Z,ae,h);const Ce=!w||w(Z,ce,ae,D);if(!Ce)continue;const we=new Cy(Z,this.z,this.x,this.y,Y);we.layer=he;let Ge=e[se];Ge===void 0&&(Ge=e[se]=[]),Ge.push({featureIndex:T,feature:we,intersectionZ:Ce})}}lookupSymbolFeatures(e,n,r,c,h,p,g,y){const w={};this.loadVTLayers();const T=Ls(h);for(const S of e)this.loadMatchingFeature(w,{bucketIndex:r,sourceLayerIndex:c,featureIndex:S,layoutVertexArrayOffset:0},T,p,g,y,n);return w}loadFeature(e){const{featureIndex:n,sourceLayerIndex:r}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(r),h=this.vtFeatures[c];if(h[n])return h[n];const p=this.vtLayers[c].feature(n);return h[n]=p,p}hasLayer(e){for(const n of this.bucketLayerIDs)for(const r of n)if(e===r)return!0;return!1}getId(e,n){let r=e.id;return this.promoteId&&(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof r=="boolean"&&(r=Number(r))),r}}function Vy(i,e,n,r,c){return sn(i,(h,p)=>{const g=e instanceof K?e.get(p):null;return g&&g.evaluate?g.evaluate(n,r,c):g})}function gb(i,e){return e-i}Je("FeatureIndex",Ny,{omit:["rawTileData","sourceLayerCoder"]});class jy{constructor(e){const n={},r=[];for(const g in e){const y=e[g],w=n[g]={};for(const T in y.glyphs){const S=y.glyphs[+T];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const I=S.metrics.localGlyph?2:1,D={x:0,y:0,w:S.bitmap.width+2*I,h:S.bitmap.height+2*I};r.push(D),w[T]=D}}const{w:c,h}=yf(r),p=new Zo({width:c||1,height:h||1});for(const g in e){const y=e[g];for(const w in y.glyphs){const T=y.glyphs[+w];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;const S=n[g][w],I=T.metrics.localGlyph?2:1;Zo.copy(T.bitmap,p,{x:0,y:0},{x:S.x+I,y:S.y+I},T.bitmap)}}this.image=p,this.positions=n}}Je("GlyphAtlas",jy);class yb{constructor(e){this.tileID=new hn(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,e.projection&&(this.tileTransform=_d(e.tileID.canonical,e.projection))}parse(e,n,r,c,h){this.status="parsing",this.data=e,this.collisionBoxArray=new Ji;const p=new Sy(Object.keys(e.layers).sort()),g=new Ny(this.tileID,this.promoteId);g.bucketLayerIDs=[];const y={},w=new Pf(256,256),T={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:r},S=n.familiesBySource[this.source];for(const ae in S){const he=e.layers[ae];if(!he)continue;let Ce=!1,we=!1;for(const Ie of S[ae])Ie[0].type==="symbol"?Ce=!0:we=!0;if(this.isSymbolTile===!0&&!Ce||this.isSymbolTile===!1&&!we)continue;he.version===1&&nt(`Vector tile source "${this.source}" layer "${ae}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ge=p.encode(ae),Le=[];for(let Ie=0;Ie<he.length;Ie++){const Re=he.feature(Ie),Be=g.getId(Re,ae);Le.push({feature:Re,id:Be,index:Ie,sourceLayerIndex:Ge})}for(const Ie of S[ae]){const Re=Ie[0];this.isSymbolTile!==void 0&&Re.type==="symbol"!==this.isSymbolTile||Re.minzoom&&this.zoom<Math.floor(Re.minzoom)||Re.maxzoom&&this.zoom>=Re.maxzoom||Re.visibility!=="none"&&(Uf(Ie,this.zoom,r),(y[Re.id]=Re.createBucket({index:g.bucketLayerIDs.length,layers:Ie,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ge,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:r})).populate(Le,T,this.tileID.canonical,this.tileTransform),g.bucketLayerIDs.push(Ie.map(Be=>Be.id)))}}let I,D,L,O;w.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Y=sn(T.glyphDependencies,ae=>Object.keys(ae).map(Number));Object.keys(Y).length?c.send("getGlyphs",{uid:this.uid,stacks:Y},(ae,he)=>{I||(I=ae,D=he,ce.call(this))},void 0,!1,Z):D={};const ee=Object.keys(T.iconDependencies);ee.length?c.send("getImages",{icons:ee,source:this.source,tileID:this.tileID,type:"icons"},(ae,he)=>{I||(I=ae,L=he,ce.call(this))},void 0,!1,Z):L={};const se=Object.keys(T.patternDependencies);function ce(){if(I)return h(I);if(D&&L&&O){const ae=new jy(D),he=new Kg(L,O);for(const Ce in y){const we=y[Ce];we instanceof Ho?(Uf(we.layers,this.zoom,r),Qw(we,D,ae.positions,L,he.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom)):we.hasPattern&&(we instanceof rd||we instanceof nd||we instanceof mf)&&(Uf(we.layers,this.zoom,r),we.addFeatures(T,this.tileID.canonical,he.patternPositions,r))}this.status="done",h(null,{buckets:Qt(y).filter(Ce=>!Ce.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ae.image,lineAtlas:w,imageAtlas:he,glyphMap:this.returnDependencies?D:null,iconMap:this.returnDependencies?L:null,glyphPositions:this.returnDependencies?ae.positions:null})}}se.length?c.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"patterns"},(ae,he)=>{I||(I=ae,O=he,ce.call(this))},void 0,!1,Z):O={},ce.call(this)}}function Uf(i,e,n){const r=new z(e);for(const c of i)c.recalculate(r,n)}class $y{constructor(e){this.entries={},this.scheduler=e}request(e,n,r,c){const h=this.entries[e]=this.entries[e]||{callbacks:[]};if(h.result){const[p,g]=h.result;return this.scheduler?this.scheduler.add(()=>{c(p,g)},n):c(p,g),()=>{}}return h.callbacks.push(c),h.cancel||(h.cancel=r((p,g)=>{h.result=[p,g];for(const y of h.callbacks)this.scheduler?this.scheduler.add(()=>{y(p,g)},n):y(p,g);setTimeout(()=>delete this.entries[e],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==c),h.callbacks.length||(h.cancel(),delete this.entries[e]))}}}function Gy(i,e,n){const r=JSON.stringify(i.request);return i.data&&(this.deduped.entries[r]={result:[null,i.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},c=>{const h=R(i.request,(p,g,y,w)=>{p?c(p):g&&c(null,{vectorTile:n?void 0:new Js.VectorTile(new Wc(g)),rawData:g,cacheControl:y,expires:w})});return()=>{h.cancel(),c()}},e)}var xb={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],conic:!0,initializeConstants(){if(this.constants&&Sg(this.parallels,this.constants.parallels))return;const i=Math.sin(te(this.parallels[0])),e=(i+Math.sin(te(this.parallels[1])))/2,n=1+i*(2*e-i),r=Math.sqrt(n)/e;this.constants={n:e,c:n,r0:r,parallels:this.parallels}},project(i,e){this.initializeConstants();const n=te(i-this.center[0]),r=te(e),{n:c,c:h,r0:p}=this.constants,g=Math.sqrt(h-2*c*Math.sin(r))/c;return{x:g*Math.sin(n*c),y:g*Math.cos(n*c)-p}},unproject(i,e){this.initializeConstants();const{n,c:r,r0:c}=this.constants,h=c+e;let p=Math.atan2(i,Math.abs(h))*Math.sign(h);h*n<0&&(p-=Math.PI*Math.sign(i)*Math.sign(h));const g=te(this.center[0])*n;p=dt(p,-Math.PI-g,Math.PI-g);const y=ue(p/n)+this.center[0],w=Math.asin(Ye((r-(i*i+h*h)*n*n)/(2*n),-1,1)),T=Ye(ue(w),-85.051129,Go);return new Nt(y,T)}};const Kc=1.340264,Jc=-.081106,Qc=893e-6,eu=.003796,vd=Math.sqrt(3)/2;var vb={name:"equalEarth",center:[0,0],range:[3.5,7],project(i,e){e=e/180*Math.PI,i=i/180*Math.PI;const n=Math.asin(vd*Math.sin(e)),r=n*n,c=r*r*r;return{x:.5*(i*Math.cos(n)/(vd*(Kc+3*Jc*r+c*(7*Qc+9*eu*r)))/Math.PI+.5),y:1-.5*(n*(Kc+Jc*r+c*(Qc+eu*r))/Math.PI+1)}},unproject(i,e){i=(2*i-.5)*Math.PI;let n=e=(2*(1-e)-1)*Math.PI,r=n*n,c=r*r*r;for(let w,T,S,I=0;I<12&&(T=n*(Kc+Jc*r+c*(Qc+eu*r))-e,S=Kc+3*Jc*r+c*(7*Qc+9*eu*r),w=T/S,n=Ye(n-w,-Math.PI/3,Math.PI/3),r=n*n,c=r*r*r,!(Math.abs(w)<1e-12));++I);const h=vd*i*(Kc+3*Jc*r+c*(7*Qc+9*eu*r))/Math.cos(n),p=Math.asin(Math.sin(n)/vd),g=Ye(180*h/Math.PI,-180,180),y=Ye(180*p/Math.PI,-85.051129,Go);return new Nt(g,y)}},wb={name:"equirectangular",wrap:!0,center:[0,0],range:[3.5,7],project:(i,e)=>({x:.5+i/360,y:.5-e/360}),unproject(i,e){const n=360*(i-.5),r=Ye(360*(.5-e),-85.051129,Go);return new Nt(n,r)}};const xl=Math.PI/2;function wd(i){return Math.tan((xl+i)/2)}var bb={name:"lambertConformalConic",range:[3.5,7],center:[0,30],parallels:[30,30],conic:!0,initializeConstants(){if(this.constants&&Sg(this.parallels,this.constants.parallels))return;const i=te(this.parallels[0]),e=te(this.parallels[1]),n=Math.cos(i),r=i===e?Math.sin(i):Math.log(n/Math.cos(e))/Math.log(wd(e)/wd(i)),c=n*Math.pow(wd(i),r)/r;this.constants={n:r,f:c,parallels:this.parallels}},project(i,e){this.initializeConstants(),e=te(e),i=te(i-this.center[0]);const n=1e-6,{n:r,f:c}=this.constants;c>0?e<-xl+n&&(e=-xl+n):e>xl-n&&(e=xl-n);const h=c/Math.pow(wd(e),r),p=h*Math.sin(r*i),g=c-h*Math.cos(r*i);return{x:.5*(p/Math.PI+.5),y:1-.5*(g/Math.PI+.5)}},unproject(i,e){this.initializeConstants(),i=(2*i-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n,f:r}=this.constants,c=r-e,h=Math.sign(c),p=Math.sign(n)*Math.sqrt(i*i+c*c);let g=Math.atan2(i,Math.abs(c))*h;c*n<0&&(g-=Math.PI*Math.sign(i)*h);const y=Ye(ue(g/n)+this.center[0],-180,180),w=Ye(ue(2*Math.atan(Math.pow(r/p,1/n))-xl),-85.051129,Go);return new Nt(y,w)}},Tb={name:"mercator",wrap:!0,center:[0,0],project:(i,e)=>({x:Xp(i),y:Hp(e)}),unproject(i,e){const n=Ys(i),r=Ar(e);return new Nt(n,r)}};const Zy=te(Go);var Eb={name:"naturalEarth",center:[0,0],range:[3.5,7],project(i,e){const n=(e=te(e))*e,r=n*n;return{x:.5*((i=te(i))*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))/Math.PI+1)}},unproject(i,e){i=(2*i-.5)*Math.PI;let n=e=(2*(1-e)-1)*Math.PI,r=25,c=0,h=n*n;do{h=n*n;const y=h*h;c=(n*(1.007226+h*(.015085+y*(.028874*h-.044475-.005916*y)))-e)/(1.007226+h*(.045255+y*(.259866*h-.311325-.005916*11*y))),n=Ye(n-c,-Zy,Zy)}while(Math.abs(c)>1e-6&&--r>0);h=n*n;const p=Ye(ue(i/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),g=ue(n);return new Nt(p,g)}};const qy=te(Go),Wy={albers:xb,equalEarth:vb,equirectangular:wb,lambertConformalConic:bb,mercator:Tb,naturalEarth:Eb,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],project(i,e){e=te(e),i=te(i);const n=Math.cos(e),r=2/Math.PI,c=Math.acos(n*Math.cos(i/2)),h=Math.sin(c)/c,p=.5*(i*r+2*n*Math.sin(i/2)/h)||0,g=.5*(e+Math.sin(e)/h)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(g/Math.PI+1)}},unproject(i,e){let n=i=(2*i-.5)*Math.PI,r=e=(2*(1-e)-1)*Math.PI,c=25;const h=1e-6;let p=0,g=0;do{const y=Math.cos(r),w=Math.sin(r),T=2*w*y,S=w*w,I=y*y,D=Math.cos(n/2),L=Math.sin(n/2),O=2*D*L,Z=L*L,Y=1-I*D*D,ee=Y?1/Y:0,se=Y?Math.acos(y*D)*Math.sqrt(1/Y):0,ce=.5*(2*se*y*L+2*n/Math.PI)-i,ae=.5*(se*w+r)-e,he=.5*ee*(I*Z+se*y*D*S)+1/Math.PI,Ce=ee*(O*T/4-se*w*L),we=.125*ee*(T*L-se*w*I*O),Ge=.5*ee*(S*D+se*Z*y)+.5,Le=Ce*we-Ge*he;p=(ae*Ce-ce*Ge)/Le,g=(ce*we-ae*he)/Le,n=Ye(n-p,-Math.PI,Math.PI),r=Ye(r-g,-qy,qy)}while((Math.abs(p)>h||Math.abs(g)>h)&&--c>0);return new Nt(ue(n),ue(r))}}};a.ARRAY_TYPE=Qi,a.AUTH_ERR_MSG=wo,a.Actor=class{constructor(i,e,n){this.target=i,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},kn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ti()?i:ze,this.scheduler=new pb}send(i,e,n,r,c=!1,h){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=h,this.callbacks[p]=n);const g=vs(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:i,hasCallback:!!n,targetMapId:r,mustQueue:c,sourceMapId:this.mapId,data:Us(e,g)},g),{cancel:()=>{n&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(i){const e=i.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const r=this.cancelCallbacks[n];delete this.cancelCallbacks[n],r&&r.cancel()}else if(e.mustQueue||Ti()){const r=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),r&&r.metadata||{type:"message"})}else this.processTask(n,e)}processTask(i,e){if(e.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(e.error?n(Ns(e.error)):n(null,Ns(e.data)))}else{const n=vs(this.globalScope)?void 0:[],r=e.hasCallback?(h,p)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:h?Us(h):null,data:Us(p,n)},n)}:h=>{},c=Ns(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,r);else if(this.parent.getWorkerSource){const h=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,h[0],c.source)[h[1]](c,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Df,a.Color=kt,a.ColorMode=Pr,a.CullFaceMode=ar,a.DEMData=yd,a.DataConstantProperty=j,a.DedupedRequest=$y,a.DepthMode=yl,a.EXTENT=At,a.Elevation=class{getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,n=!0){e==null&&(e=null);const r=this._source();if(!r||i.y<0||i.y>1)return e;const c=r.getSource().maxzoom,h=1<<c,p=Math.floor(i.x),g=i.x-p,y=new hn(c,p,c,Math.floor(g*h),Math.floor(i.y*h)),w=this.findDEMTileFor(y);if(!w||!w.dem)return e;const T=w.dem,S=1<<w.tileID.canonical.z,I=(g*S-w.tileID.canonical.x)*T.dim,D=(i.y*S-w.tileID.canonical.y)*T.dim,L=Math.floor(I),O=Math.floor(D);return(n?this.exaggeration():1)*Pt(Pt(T.get(L,O),T.get(L,O+1),D-O),Pt(T.get(L+1,O),T.get(L+1,O+1),D-O),I-L)}getAtTileOffset(i,e,n){const r=1<<i.canonical.z;return this.getAtPointOrZero(new Xh(i.wrap+(i.canonical.x+e/At)/r,(i.canonical.y+n/At)/r))}getForTilePoints(i,e,n,r){const c=xd.create(this,i,r);return!!c&&(e.forEach(h=>{h[2]=this.exaggeration()*c.getElevationAt(h[0],h[1],n)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const n=e.dem.tree,r=e.tileID,c=1<<i.canonical.z-r.canonical.z;let h=i.canonical.x/c-r.canonical.x,p=i.canonical.y/c-r.canonical.y,g=0;for(let y=0;y<i.canonical.z-r.canonical.z&&!n.leaves[g];y++){h*=2,p*=2;const w=2*Math.floor(p)+Math.floor(h);g=n.childOffsets[g]+w,h%=1,p%=1}return{min:this.exaggeration()*n.minimums[g],max:this.exaggeration()*n.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=et,a.EvaluationParameters=z,a.Event=De,a.Evented=Ne,a.GlyphManager=_l,a.ImagePosition=xf,a.LineAtlas=Pf,a.LngLat=Nt,a.LngLatBounds=Hs,a.LocalGlyphMode=Tf,a.MAX_MERCATOR_LATITUDE=Go,a.MAX_SAFE_INTEGER=it,a.MercatorCoordinate=Xh,a.ONE_EM=Oi,a.OverscaledTileID=hn,a.Properties=Ee,a.RGBAImage=Fn,a.RequestManager=class{constructor(i,e,n){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",vo,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!gn(i))return i;const n=yn(i);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!gn(i))return i;const n=yn(i);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(i,e){if(!gn(i))return i;const n=yn(i);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)}normalizeSpriteURL(i,e,n,r){const c=yn(i);return gn(i)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||r)):(c.path+=`${e}${n}`,Gi(c))}normalizeTileURL(i,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!gn(i))return i;const r=yn(i);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&r.authority!=="raster"&&n===512?"@2x":""}${Vr.supported?".webp":"$1"}`),r.authority==="raster"?r.path=`/${Et.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${Et.TILE_URL_VERSION}${r.path}`);const c=this._customAccessToken||function(h){for(const p of h){const g=p.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(r.params)||Et.ACCESS_TOKEN;return Et.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,c)}canonicalizeTileURL(i,e){const n=yn(i);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return i;let r="mapbox://";n.path.match(/^\/raster\/v1\//)?r+=`raster/${n.path.replace(`/${Et.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${n.path.replace(`/${Et.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(h=>!h.match(/^access_token=/))),c.length&&(r+=`?${c.join("&")}`),r}canonicalizeTileset(i,e){const n=!!e&&gn(e),r=[];for(const c of i.tiles||[])fr(c)?r.push(this.canonicalizeTileURL(c,n)):r.push(c);return r}_makeAPIURL(i,e){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=yn(Et.API_URL);if(i.protocol=r.protocol,i.authority=r.authority,i.protocol==="http"){const c=i.params.indexOf("secure");c>=0&&i.params.splice(c,1)}if(r.path!=="/"&&(i.path=`${r.path}${i.path}`),!Et.REQUIRE_ACCESS_TOKEN)return Gi(i);if(e=e||Et.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return i.params=i.params.filter(c=>c.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),Gi(i)}},a.ResourceType=Gr,a.SegmentVector=ki,a.SourceCache=Qs,a.StencilMode=Bf,a.StructArrayLayout1ui2=Mi,a.StructArrayLayout2f1f2i16=Fi,a.StructArrayLayout2i4=Qe,a.StructArrayLayout2ui4=Ht,a.StructArrayLayout3f12=pt,a.StructArrayLayout3ui6=mi,a.StructArrayLayout4i8=lt,a.Texture=md,a.Tile=My,a.Transitionable=$,a.Uniform1f=qh,a.Uniform1i=class extends io{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends io{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},a.Uniform3f=class extends io{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},a.Uniform4f=tg,a.UniformColor=ig,a.UniformMatrix2f=class extends io{constructor(i,e){super(i,e),this.current=m1}set(i){for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},a.UniformMatrix3f=class extends io{constructor(i,e){super(i,e),this.current=f1}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},a.UniformMatrix4f=class extends io{constructor(i,e){super(i,e),this.current=p1}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},a.UnwrappedTileID=Ey,a.ValidationError=be,a.VectorTileWorkerSource=class extends Ne{constructor(i,e,n,r,c){super(),this.actor=i,this.layerIndex=e,this.availableImages=n,this.loadVectorData=c||Gy,this.loading={},this.loaded={},this.deduped=new $y(i.scheduler),this.isSpriteLoaded=r,this.scheduler=i.scheduler}loadTile(i,e){const n=i.uid,r=i&&i.request,c=r&&r.collectResourceTiming,h=this.loading[n]=new yb(i);h.abort=this.loadVectorData(i,(p,g)=>{const y=!this.loading[n];if(delete this.loading[n],y||p||!g)return h.status="done",y||(this.loaded[n]=h),e(p);const w=g.rawData,T={};g.expires&&(T.expires=g.expires),g.cacheControl&&(T.cacheControl=g.cacheControl),h.vectorTile=g.vectorTile||new Js.VectorTile(new Wc(w));const S=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,(I,D)=>{if(I||!D)return e(I);const L={};if(c){const O=by(r);O.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(O)))}e(null,Yt({rawTileData:w.slice(0)},D,T,L))})};this.isSpriteLoaded?S():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(S,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):S()}),this.loaded=this.loaded||{},this.loaded[n]=h})}reloadTile(i,e){const n=this.loaded,r=i.uid,c=this;if(n&&n[r]){const h=n[r];h.showCollisionBoxes=i.showCollisionBoxes,h.enableTerrain=!!i.enableTerrain;const p=(g,y)=>{const w=h.reloadCallback;w&&(delete h.reloadCallback,h.parse(h.vectorTile,c.layerIndex,this.availableImages,c.actor,w)),e(g,y)};h.status==="parsing"?h.reloadCallback=p:h.status==="done"&&(h.vectorTile?h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(i,e){const n=i.uid,r=this.loading[n];r&&(r.abort&&r.abort(),delete this.loading[n]),e()}removeTile(i,e){const n=this.loaded,r=i.uid;n&&n[r]&&delete n[r],e()}},a.WritingMode=On,a.ZoomHistory=kh,a.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i},a.addDynamicAttributes=If,a.altitudeFromMercatorZ=Kp,a.asyncAll=ot,a.bezier=at,a.bindAll=kn,a.boundsAttributes=Lf,a.bufferConvexPolygon=function(i,e){const n=[];for(let r=0;r<i.length;r++){const c=dt(r-1,-1,i.length-1),h=dt(r+1,-1,i.length-1),p=i[r],g=i[h],y=i[c].sub(p).unit(),w=g.sub(p).unit(),T=w.angleWithSep(y.x,y.y),S=y.add(w).unit().mult(-1*e/Math.sin(T/2));n.push(p.add(S))}return n},a.cacheEntryPossiblyAdded=function(i){Ss++,Ss>$r&&(i.getActor().send("enforceCacheSizeLimit",xa),Ss=0)},a.clamp=Ye,a.clearTileCache=function(i){const e=ze.caches.delete(Es);i&&e.catch(i).then(()=>i())},a.clipLine=cy,a.clone=function(i){var e=new Qi(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},a.clone$1=function(i){var e=new Qi(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},a.clone$2=Ve,a.collisionCircleLayout=Sw,a.config=Et,a.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},a.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i},a.create=Kh,a.create$1=function(){var i=new Qi(16);return Qi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a.create$2=mg,a.createExpression=Do,a.createLayout=ye,a.createStyleLayer=function(i){return i.type==="custom"?new lb(i):new ub[i.type](i)},a.cross=function(i,e,n){var r=e[0],c=e[1],h=e[2],p=n[0],g=n[1],y=n[2];return i[0]=c*y-h*g,i[1]=h*p-r*y,i[2]=r*g-c*p,i},a.degToRad=te,a.div=function(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i},a.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},a.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},a.ease=Xe,a.easeCubicInOut=Pe,a.emitValidationErrors=Ih,a.endsWith=zn,a.enforceCacheSizeLimit=function(i){ir(),xn&&xn.then(e=>{e.keys().then(n=>{for(let r=0;r<n.length-i;r++)e.delete(n[r])})})},a.evaluateSizeForFeature=od,a.evaluateSizeForZoom=dl,a.evaluateVariableOffset=fy,a.evented=b,a.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},a.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},a.exported=an,a.exported$1=Vr,a.extend=Yt,a.filterObject=mn,a.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},a.fromQuat=function(i,e){var n=e[0],r=e[1],c=e[2],h=e[3],p=n+n,g=r+r,y=c+c,w=n*p,T=r*p,S=r*g,I=c*p,D=c*g,L=c*y,O=h*p,Z=h*g,Y=h*y;return i[0]=1-S-L,i[1]=T+Y,i[2]=I-Z,i[3]=0,i[4]=T-Y,i[5]=1-w-L,i[6]=D+O,i[7]=0,i[8]=I+Z,i[9]=D-O,i[10]=1-w-S,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.fromRotation=function(i,e){var n=Math.sin(e),r=Math.cos(e);return i[0]=r,i[1]=n,i[2]=0,i[3]=-n,i[4]=r,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},a.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return ke[e]},a.getAABBPointSquareDist=function(i,e,n){let r=0;for(let c=0;c<2;++c){const h=n?n[c]:0;i[c]>h&&(r+=(i[c]-h)*(i[c]-h)),e[c]<h&&(r+=(h-e[c])*(h-e[c]))}return r},a.getAnchorAlignment=bf,a.getAnchorJustification=Sf,a.getBounds=function(i){let e=1/0,n=1/0,r=-1/0,c=-1/0;for(const h of i)e=Math.min(e,h.x),n=Math.min(n,h.y),r=Math.max(r,h.x),c=Math.max(c,h.y);return{min:new _e(e,n),max:new _e(r,c)}},a.getImage=fe,a.getJSON=function(i,e){return P(Yt(i,{type:"json"}),e)},a.getMapSessionAPI=ya,a.getPerformanceMeasurement=by,a.getProjection=function(i){const e=Wy[i.name];if(!e)throw new Error(`Invalid projection name: ${i.name}`);return e.conic?function(n,r){if(r.parallels&&Math.abs(r.parallels[0]+r.parallels[1])<.01){let c=function(h){const p=Math.max(.01,Math.cos(te(h))),g=1/(2*Math.max(Math.PI*p,1/p));return{wrap:!0,project(y,w){const T=te(y)*p,S=Math.sin(te(w))/p;return{x:T*g+.5,y:-S*g+.5}},unproject(y,w){const T=-(w-.5)/g,S=Ye(ue((y-.5)/g)/p,-180,180),I=Math.asin(Ye(T*p,-1,1)),D=Ye(ue(I),-85.051129,Go);return new Nt(S,D)}}}(r.parallels[0]);if(r.name==="lambertConformalConic"){const{project:h,unproject:p}=Wy.mercator;c={wrap:!0,project:h,unproject:p}}return Yt({},n,r,c)}return Yt({},n,r)}(e,i):e},a.getRTLTextPluginStatus=C,a.getReferrer=q,a.getTilePoint=function(i,{x:e,y:n},r=0){return new _e(((e-r)*i.scale-i.x)*At,(n*i.scale-i.y)*At)},a.getTileVec3=function(i,e,n=0){return cl(((e.x-n)*i.scale-i.x)*At,(e.y*i.scale-i.y)*At,Kp(e.z,e.y))},a.getVideo=function(i,e){const n=ze.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let r=0;r<i.length;r++){const c=ze.document.createElement("source");ie(i[r])||(n.crossOrigin="Anonymous"),c.src=i[r],n.appendChild(c)}return{cancel:()=>{}}},a.identity=rf,a.identity$1=Tg,a.invert=function(i,e){var n=e[0],r=e[1],c=e[2],h=e[3],p=e[4],g=e[5],y=e[6],w=e[7],T=e[8],S=e[9],I=e[10],D=e[11],L=e[12],O=e[13],Z=e[14],Y=e[15],ee=n*g-r*p,se=n*y-c*p,ce=n*w-h*p,ae=r*y-c*g,he=r*w-h*g,Ce=c*w-h*y,we=T*O-S*L,Ge=T*Z-I*L,Le=T*Y-D*L,Ie=S*Z-I*O,Re=S*Y-D*O,Be=I*Y-D*Z,Me=ee*Be-se*Re+ce*Ie+ae*Le-he*Ge+Ce*we;return Me?(i[0]=(g*Be-y*Re+w*Ie)*(Me=1/Me),i[1]=(c*Re-r*Be-h*Ie)*Me,i[2]=(O*Ce-Z*he+Y*ae)*Me,i[3]=(I*he-S*Ce-D*ae)*Me,i[4]=(y*Le-p*Be-w*Ge)*Me,i[5]=(n*Be-c*Le+h*Ge)*Me,i[6]=(Z*ce-L*Ce-Y*se)*Me,i[7]=(T*Ce-I*ce+D*se)*Me,i[8]=(p*Re-g*Le+w*we)*Me,i[9]=(r*Le-n*Re-h*we)*Me,i[10]=(L*he-O*ce+Y*ee)*Me,i[11]=(S*ce-T*he-D*ee)*Me,i[12]=(g*Ge-p*Ie-y*we)*Me,i[13]=(n*Ie-r*Ge+c*we)*Me,i[14]=(O*se-L*ae-Z*ee)*Me,i[15]=(T*ae-S*se+I*ee)*Me,i):null},a.isMapAuthenticated=function(i){return mr.has(i)},a.isMapboxURL=gn,a.latFromMercatorY=Ar,a.len=D1,a.length=gg,a.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},a.loadVectorTile=Gy,a.makeRequest=P,a.mercatorXfromLng=Xp,a.mercatorYfromLat=Hp,a.mercatorZfromAltitude=Yp,a.mul=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},a.mul$1=k1,a.mul$2=P1,a.multiply=_g,a.multiply$1=xg,a.nextPowerOfTwo=on,a.normalize=wg,a.normalize$1=function(i,e){var n=e[0],r=e[1],c=e[2],h=e[3],p=n*n+r*r+c*c+h*h;return p>0&&(p=1/Math.sqrt(p)),i[0]=n*p,i[1]=r*p,i[2]=c*p,i[3]=h*p,i},a.number=Pt,a.ortho=function(i,e,n,r,c,h,p){var g=1/(e-n),y=1/(r-c),w=1/(h-p);return i[0]=-2*g,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+n)*g,i[13]=(c+r)*y,i[14]=(p+h)*w,i[15]=1,i},a.pbf=Wc,a.perspective=function(i,e,n,r,c){var h,p=1/Math.tan(e/2);return i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+r)*(h=1/(r-c)),i[14]=2*c*r*h):(i[10]=-1,i[14]=-2*r),i},a.pick=function(i,e){const n={};for(let r=0;r<e.length;r++){const c=e[r];c in i&&(n[c]=i[c])}return n},a.plugin=M,a.pointGeometry=_e,a.polygonIntersectsBox=dg,a.polygonIntersectsPolygon=lg,a.polygonizeBounds=function(i,e,n=0,r=!0){const c=new _e(n,n),h=i.sub(c),p=e.add(c),g=[h,new _e(p.x,h.y),p,new _e(h.x,p.y)];return r&&g.push(h),g},a.posAttributes=fb,a.postMapLoadEvent=Ql,a.postTurnstileEvent=Ts,a.potpack=yf,a.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},a.radToDeg=ue,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(i){return i({pluginStatus:d,pluginURL:m}),b.on("pluginStateChange",i),i},a.removeAuthState=function(i){mr.delete(i)},a.renderColorRamp=lf,a.rotateX=function(i,e,n){var r=Math.sin(n),c=Math.cos(n),h=e[4],p=e[5],g=e[6],y=e[7],w=e[8],T=e[9],S=e[10],I=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*c+w*r,i[5]=p*c+T*r,i[6]=g*c+S*r,i[7]=y*c+I*r,i[8]=w*c-h*r,i[9]=T*c-p*r,i[10]=S*c-g*r,i[11]=I*c-y*r,i},a.rotateX$1=Eg,a.rotateY=function(i,e,n){var r=Math.sin(n),c=Math.cos(n),h=e[0],p=e[1],g=e[2],y=e[3],w=e[8],T=e[9],S=e[10],I=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*c-w*r,i[1]=p*c-T*r,i[2]=g*c-S*r,i[3]=y*c-I*r,i[8]=h*r+w*c,i[9]=p*r+T*c,i[10]=g*r+S*c,i[11]=y*r+I*c,i},a.rotateZ=function(i,e,n){var r=Math.sin(n),c=Math.cos(n),h=e[0],p=e[1],g=e[2],y=e[3],w=e[4],T=e[5],S=e[6],I=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*c+w*r,i[1]=p*c+T*r,i[2]=g*c+S*r,i[3]=y*c+I*r,i[4]=w*c-h*r,i[5]=T*c-p*r,i[6]=S*c-g*r,i[7]=I*c-y*r,i},a.rotateZ$1=function(i,e,n){n*=.5;var r=e[0],c=e[1],h=e[2],p=e[3],g=Math.sin(n),y=Math.cos(n);return i[0]=r*y+c*g,i[1]=c*y-r*g,i[2]=h*y+p*g,i[3]=p*y-h*g,i},a.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i},a.scale$1=function(i,e,n){var r=n[0],c=n[1],h=n[2];return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.scale$2=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},a.scaleAndAdd=vg,a.setCacheLimits=function(i,e){xa=i,$r=e},a.setRTLTextPlugin=function(i,e,n=!1){if(d===Vo||d===u||d===t)throw new Error("setRTLTextPlugin cannot be called multiple times.");m=an.resolveURL(i),d=Vo,s=e,x(),n||A()},a.smoothstep=function(i,e,n){return(n=Ye((n-i)/(e-i),0,1))*n*(3-2*n)},a.spec=le,a.storeAuthState=function(i,e){e?mr.add(i):mr.delete(i)},a.sub=z1,a.subtract=yg,a.symbolSize=Cw,a.tileTransform=_d,a.transformMat3=function(i,e,n){var r=e[0],c=e[1],h=e[2];return i[0]=r*n[0]+c*n[3]+h*n[6],i[1]=r*n[1]+c*n[4]+h*n[7],i[2]=r*n[2]+c*n[5]+h*n[8],i},a.transformMat4=Uc,a.transformMat4$1=function(i,e,n){var r=e[0],c=e[1],h=e[2],p=n[3]*r+n[7]*c+n[11]*h+n[15];return i[0]=(n[0]*r+n[4]*c+n[8]*h+n[12])/(p=p||1),i[1]=(n[1]*r+n[5]*c+n[9]*h+n[13])/p,i[2]=(n[2]*r+n[6]*c+n[10]*h+n[14])/p,i},a.transformQuat=bg,a.translate=function(i,e,n){var r,c,h,p,g,y,w,T,S,I,D,L,O=n[0],Z=n[1],Y=n[2];return e===i?(i[12]=e[0]*O+e[4]*Z+e[8]*Y+e[12],i[13]=e[1]*O+e[5]*Z+e[9]*Y+e[13],i[14]=e[2]*O+e[6]*Z+e[10]*Y+e[14],i[15]=e[3]*O+e[7]*Z+e[11]*Y+e[15]):(c=e[1],h=e[2],p=e[3],g=e[4],y=e[5],w=e[6],T=e[7],S=e[8],I=e[9],D=e[10],L=e[11],i[0]=r=e[0],i[1]=c,i[2]=h,i[3]=p,i[4]=g,i[5]=y,i[6]=w,i[7]=T,i[8]=S,i[9]=I,i[10]=D,i[11]=L,i[12]=r*O+g*Z+S*Y+e[12],i[13]=c*O+y*Z+I*Y+e[13],i[14]=h*O+w*Z+D*Y+e[14],i[15]=p*O+T*Z+L*Y+e[15]),i},a.triggerPluginCompletionEvent=_,a.uniqueId=ei,a.validateCustomStyleLayer=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFog=Sc,a.validateLight=$p,a.validateStyle=to,a.values=Qt,a.vectorTile=Js,a.version=Q,a.warnOnce=nt,a.window=ze,a.wrap=dt}),k(["./shared"],function(a){function Q(q){const P=typeof q;if(P==="number"||P==="boolean"||P==="string"||q==null)return JSON.stringify(q);if(Array.isArray(q)){let H="[";for(const ie of q)H+=`${Q(ie)},`;return`${H}]`}const R=Object.keys(q).sort();let G="{";for(let H=0;H<R.length;H++)G+=`${JSON.stringify(R[H])}:${Q(q[R[H]])},`;return`${G}}`}function ge(q){let P="";for(const R of a.refProperties)P+=`/${Q(q[R])}`;return P}class qe{constructor(P){this.keyCache={},P&&this.replace(P)}replace(P){this._layerConfigs={},this._layers={},this.update(P,[])}update(P,R){for(const H of P)this._layerConfigs[H.id]=H,(this._layers[H.id]=a.createStyleLayer(H)).compileFilter(),this.keyCache[H.id]&&delete this.keyCache[H.id];for(const H of R)delete this.keyCache[H],delete this._layerConfigs[H],delete this._layers[H];this.familiesBySource={};const G=function(H,ie){const pe={};for(let re=0;re<H.length;re++){const fe=ie&&ie[H[re].id]||ge(H[re]);ie&&(ie[H[re].id]=fe);let Ae=pe[fe];Ae||(Ae=pe[fe]=[]),Ae.push(H[re])}const de=[];for(const re in pe)de.push(pe[re]);return de}(a.values(this._layerConfigs),this.keyCache);for(const H of G){const ie=H.map(je=>this._layers[je.id]),pe=ie[0];if(pe.visibility==="none")continue;const de=pe.source||"";let re=this.familiesBySource[de];re||(re=this.familiesBySource[de]={});const fe=pe.sourceLayer||"_geojsonTileLayer";let Ae=re[fe];Ae||(Ae=re[fe]=[]),Ae.push(ie)}}}const{ImageBitmap:_e}=a.window;class oe{loadTile(P,R){const{uid:G,encoding:H,rawImageData:ie,padding:pe,buildQuadTree:de}=P,re=_e&&ie instanceof _e?this.getImageData(ie,pe):ie;R(null,new a.DEMData(G,re,H,pe<1,de))}getImageData(P,R){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(P.width,P.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=P.width,this.offscreenCanvas.height=P.height,this.offscreenCanvasContext.drawImage(P,0,0,P.width,P.height);const G=this.offscreenCanvasContext.getImageData(-R,-R,P.width+2*R,P.height+2*R);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:G.width,height:G.height},G.data)}}var ze=function q(P,R){var G,H=P&&P.type;if(H==="FeatureCollection")for(G=0;G<P.features.length;G++)q(P.features[G],R);else if(H==="GeometryCollection")for(G=0;G<P.geometries.length;G++)q(P.geometries[G],R);else if(H==="Feature")q(P.geometry,R);else if(H==="Polygon")it(P.coordinates,R);else if(H==="MultiPolygon")for(G=0;G<P.coordinates.length;G++)it(P.coordinates[G],R);return P};function it(q,P){if(q.length!==0){rt(q[0],P);for(var R=1;R<q.length;R++)rt(q[R],!P)}}function rt(q,P){for(var R=0,G=0,H=0,ie=q.length,pe=ie-1;H<ie;pe=H++){var de=(q[H][0]-q[pe][0])*(q[pe][1]+q[H][1]),re=R+de;G+=Math.abs(R)>=Math.abs(de)?R-re+de:de-re+R,R=re}R+G>=0!=!!P&&q.reverse()}const me=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class te{constructor(P){this._feature=P,this.extent=a.EXTENT,this.type=P.type,this.properties=P.tags,"id"in P&&!isNaN(P.id)&&(this.id=parseInt(P.id,10))}loadGeometry(){if(this._feature.type===1){const P=[];for(const R of this._feature.geometry)P.push([new a.pointGeometry(R[0],R[1])]);return P}{const P=[];for(const R of this._feature.geometry){const G=[];for(const H of R)G.push(new a.pointGeometry(H[0],H[1]));P.push(G)}return P}}toGeoJSON(P,R,G){return me.call(this,P,R,G)}}class ue{constructor(P){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=P.length,this._features=P}feature(P){return new te(this._features[P])}}var ke=a.vectorTile.VectorTileFeature,Pe=at;function at(q,P){this.options=P||{},this.features=q,this.length=q.length}function Xe(q,P){this.id=typeof q.id=="number"?q.id:void 0,this.type=q.type,this.rawGeometry=q.type===1?[q.geometry]:q.geometry,this.properties=q.tags,this.extent=P||4096}at.prototype.feature=function(q){return new Xe(this.features[q],this.options.extent)},Xe.prototype.loadGeometry=function(){var q=this.rawGeometry;this.geometry=[];for(var P=0;P<q.length;P++){for(var R=q[P],G=[],H=0;H<R.length;H++)G.push(new a.pointGeometry(R[H][0],R[H][1]));this.geometry.push(G)}return this.geometry},Xe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var q=this.geometry,P=1/0,R=-1/0,G=1/0,H=-1/0,ie=0;ie<q.length;ie++)for(var pe=q[ie],de=0;de<pe.length;de++){var re=pe[de];P=Math.min(P,re.x),R=Math.max(R,re.x),G=Math.min(G,re.y),H=Math.max(H,re.y)}return[P,G,R,H]},Xe.prototype.toGeoJSON=ke.prototype.toGeoJSON;var Ye=ot,dt=Pe;function ot(q){var P=new a.pbf;return function(R,G){for(var H in R.layers)G.writeMessage(3,Qt,R.layers[H])}(q,P),P.finish()}function Qt(q,P){var R;P.writeVarintField(15,q.version||1),P.writeStringField(1,q.name||""),P.writeVarintField(5,q.extent||4096);var G={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<q.length;R++)G.feature=q.feature(R),P.writeMessage(2,Yt,G);var H=G.keys;for(R=0;R<H.length;R++)P.writeStringField(3,H[R]);var ie=G.values;for(R=0;R<ie.length;R++)P.writeMessage(4,Mn,ie[R])}function Yt(q,P){var R=q.feature;R.id!==void 0&&P.writeVarintField(1,R.id),P.writeMessage(2,Di,q),P.writeVarintField(3,R.type),P.writeMessage(4,on,R)}function Di(q,P){var R=q.feature,G=q.keys,H=q.values,ie=q.keycache,pe=q.valuecache;for(var de in R.properties){var re=R.properties[de],fe=ie[de];if(re!==null){fe===void 0&&(G.push(de),ie[de]=fe=G.length-1),P.writeVarint(fe);var Ae=typeof re;Ae!=="string"&&Ae!=="boolean"&&Ae!=="number"&&(re=JSON.stringify(re));var je=Ae+":"+re,De=pe[je];De===void 0&&(H.push(re),pe[je]=De=H.length-1),P.writeVarint(De)}}}function ei(q,P){return(P<<3)+(7&q)}function $n(q){return q<<1^q>>31}function on(q,P){for(var R=q.loadGeometry(),G=q.type,H=0,ie=0,pe=R.length,de=0;de<pe;de++){var re=R[de],fe=1;G===1&&(fe=re.length),P.writeVarint(ei(1,fe));for(var Ae=G===3?re.length-1:re.length,je=0;je<Ae;je++){je===1&&G!==1&&P.writeVarint(ei(2,Ae-1));var De=re[je].x-H,et=re[je].y-ie;P.writeVarint($n(De)),P.writeVarint($n(et)),H+=De,ie+=et}G===3&&P.writeVarint(ei(7,1))}}function Mn(q,P){var R=typeof q;R==="string"?P.writeStringField(1,q):R==="boolean"?P.writeBooleanField(7,q):R==="number"&&(q%1!=0?P.writeDoubleField(3,q):q<0?P.writeSVarintField(6,q):P.writeVarintField(5,q))}function kn(q,P,R,G,H,ie){if(H-G<=R)return;const pe=G+H>>1;zn(q,P,pe,G,H,ie%2),kn(q,P,R,G,pe-1,ie+1),kn(q,P,R,pe+1,H,ie+1)}function zn(q,P,R,G,H,ie){for(;H>G;){if(H-G>600){const fe=H-G+1,Ae=R-G+1,je=Math.log(fe),De=.5*Math.exp(2*je/3),et=.5*Math.sqrt(je*De*(fe-De)/fe)*(Ae-fe/2<0?-1:1);zn(q,P,R,Math.max(G,Math.floor(R-Ae*De/fe+et)),Math.min(H,Math.floor(R+(fe-Ae)*De/fe+et)),ie)}const pe=P[2*R+ie];let de=G,re=H;for(sn(q,P,G,R),P[2*H+ie]>pe&&sn(q,P,G,H);de<re;){for(sn(q,P,de,re),de++,re--;P[2*de+ie]<pe;)de++;for(;P[2*re+ie]>pe;)re--}P[2*G+ie]===pe?sn(q,P,G,re):(re++,sn(q,P,re,H)),re<=R&&(G=re+1),R<=re&&(H=re-1)}}function sn(q,P,R,G){mn(q,R,G),mn(P,2*R,2*G),mn(P,2*R+1,2*G+1)}function mn(q,P,R){const G=q[P];q[P]=q[R],q[R]=G}function Ve(q,P,R,G){const H=q-R,ie=P-G;return H*H+ie*ie}Ye.fromVectorTileJs=ot,Ye.fromGeojsonVt=function(q,P){P=P||{};var R={};for(var G in q)R[G]=new Pe(q[G].features,P),R[G].name=G,R[G].version=P.version,R[G].extent=P.extent;return ot({layers:R})},Ye.GeoJSONWrapper=dt;const ct=q=>q[0],nt=q=>q[1];class zt{constructor(P,R=ct,G=nt,H=64,ie=Float64Array){this.nodeSize=H,this.points=P;const pe=P.length<65536?Uint16Array:Uint32Array,de=this.ids=new pe(P.length),re=this.coords=new ie(2*P.length);for(let fe=0;fe<P.length;fe++)de[fe]=fe,re[2*fe]=R(P[fe]),re[2*fe+1]=G(P[fe]);kn(de,re,H,0,de.length-1,0)}range(P,R,G,H){return function(ie,pe,de,re,fe,Ae,je){const De=[0,ie.length-1,0],et=[];let Ne,le;for(;De.length;){const be=De.pop(),Tt=De.pop(),Rt=De.pop();if(Tt-Rt<=je){for(let Mt=Rt;Mt<=Tt;Mt++)Ne=pe[2*Mt],le=pe[2*Mt+1],Ne>=de&&Ne<=fe&&le>=re&&le<=Ae&&et.push(ie[Mt]);continue}const mt=Math.floor((Rt+Tt)/2);Ne=pe[2*mt],le=pe[2*mt+1],Ne>=de&&Ne<=fe&&le>=re&&le<=Ae&&et.push(ie[mt]);const St=(be+1)%2;(be===0?de<=Ne:re<=le)&&(De.push(Rt),De.push(mt-1),De.push(St)),(be===0?fe>=Ne:Ae>=le)&&(De.push(mt+1),De.push(Tt),De.push(St))}return et}(this.ids,this.coords,P,R,G,H,this.nodeSize)}within(P,R,G){return function(H,ie,pe,de,re,fe){const Ae=[0,H.length-1,0],je=[],De=re*re;for(;Ae.length;){const et=Ae.pop(),Ne=Ae.pop(),le=Ae.pop();if(Ne-le<=fe){for(let St=le;St<=Ne;St++)Ve(ie[2*St],ie[2*St+1],pe,de)<=De&&je.push(H[St]);continue}const be=Math.floor((le+Ne)/2),Tt=ie[2*be],Rt=ie[2*be+1];Ve(Tt,Rt,pe,de)<=De&&je.push(H[be]);const mt=(et+1)%2;(et===0?pe-re<=Tt:de-re<=Rt)&&(Ae.push(le),Ae.push(be-1),Ae.push(mt)),(et===0?pe+re>=Tt:de+re>=Rt)&&(Ae.push(be+1),Ae.push(Ne),Ae.push(mt))}return je}(this.ids,this.coords,P,R,G,this.nodeSize)}}const oi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:q=>q},Ti=Math.fround||($i=new Float32Array(1),q=>($i[0]=+q,$i[0]));var $i;class _n{constructor(P){this.options=Et(Object.create(oi),P),this.trees=new Array(this.options.maxZoom+1)}load(P){const{log:R,minZoom:G,maxZoom:H,nodeSize:ie}=this.options;R&&console.time("total time");const pe=`prepare ${P.length} points`;R&&console.time(pe),this.points=P;let de=[];for(let re=0;re<P.length;re++)P[re].geometry&&de.push(_o(P[re],re));this.trees[H+1]=new zt(de,Vr,dr,ie,Float32Array),R&&console.timeEnd(pe);for(let re=H;re>=G;re--){const fe=+Date.now();de=this._cluster(de,re),this.trees[re]=new zt(de,Vr,dr,ie,Float32Array),R&&console.log("z%d: %d clusters in %dms",re,de.length,+Date.now()-fe)}return R&&console.timeEnd("total time"),this}getClusters(P,R){let G=((P[0]+180)%360+360)%360-180;const H=Math.max(-90,Math.min(90,P[1]));let ie=P[2]===180?180:((P[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,P[3]));if(P[2]-P[0]>=360)G=-180,ie=180;else if(G>ie){const Ae=this.getClusters([G,H,180,pe],R),je=this.getClusters([-180,H,ie,pe],R);return Ae.concat(je)}const de=this.trees[this._limitZoom(R)],re=de.range(Nr(G),an(pe),Nr(ie),an(H)),fe=[];for(const Ae of re){const je=de.points[Ae];fe.push(je.numPoints?go(je):this.points[je.index])}return fe}getChildren(P){const R=this._getOriginId(P),G=this._getOriginZoom(P),H="No cluster with the specified id.",ie=this.trees[G];if(!ie)throw new Error(H);const pe=ie.points[R];if(!pe)throw new Error(H);const de=this.options.radius/(this.options.extent*Math.pow(2,G-1)),re=ie.within(pe.x,pe.y,de),fe=[];for(const Ae of re){const je=ie.points[Ae];je.parentId===P&&fe.push(je.numPoints?go(je):this.points[je.index])}if(fe.length===0)throw new Error(H);return fe}getLeaves(P,R,G){const H=[];return this._appendLeaves(H,P,R=R||10,G=G||0,0),H}getTile(P,R,G){const H=this.trees[this._limitZoom(P)],ie=Math.pow(2,P),{extent:pe,radius:de}=this.options,re=de/pe,fe=(G-re)/ie,Ae=(G+1+re)/ie,je={features:[]};return this._addTileFeatures(H.range((R-re)/ie,fe,(R+1+re)/ie,Ae),H.points,R,G,ie,je),R===0&&this._addTileFeatures(H.range(1-re/ie,fe,1,Ae),H.points,ie,G,ie,je),R===ie-1&&this._addTileFeatures(H.range(0,fe,re/ie,Ae),H.points,-1,G,ie,je),je.features.length?je:null}getClusterExpansionZoom(P){let R=this._getOriginZoom(P)-1;for(;R<=this.options.maxZoom;){const G=this.getChildren(P);if(R++,G.length!==1)break;P=G[0].properties.cluster_id}return R}_appendLeaves(P,R,G,H,ie){const pe=this.getChildren(R);for(const de of pe){const re=de.properties;if(re&&re.cluster?ie+re.point_count<=H?ie+=re.point_count:ie=this._appendLeaves(P,re.cluster_id,G,H,ie):ie<H?ie++:P.push(de),P.length===G)break}return ie}_addTileFeatures(P,R,G,H,ie,pe){for(const de of P){const re=R[de],fe=re.numPoints;let Ae,je,De;if(fe)Ae=vs(re),je=re.x,De=re.y;else{const le=this.points[re.index];Ae=le.properties,je=Nr(le.geometry.coordinates[0]),De=an(le.geometry.coordinates[1])}const et={type:1,geometry:[[Math.round(this.options.extent*(je*ie-G)),Math.round(this.options.extent*(De*ie-H))]],tags:Ae};let Ne;fe?Ne=re.id:this.options.generateId?Ne=re.index:this.points[re.index].id&&(Ne=this.points[re.index].id),Ne!==void 0&&(et.id=Ne),pe.features.push(et)}}_limitZoom(P){return Math.max(this.options.minZoom,Math.min(+P,this.options.maxZoom+1))}_cluster(P,R){const G=[],{radius:H,extent:ie,reduce:pe,minPoints:de}=this.options,re=H/(ie*Math.pow(2,R));for(let fe=0;fe<P.length;fe++){const Ae=P[fe];if(Ae.zoom<=R)continue;Ae.zoom=R;const je=this.trees[R+1],De=je.within(Ae.x,Ae.y,re),et=Ae.numPoints||1;let Ne=et;for(const le of De){const be=je.points[le];be.zoom>R&&(Ne+=be.numPoints||1)}if(Ne>et&&Ne>=de){let le=Ae.x*et,be=Ae.y*et,Tt=pe&&et>1?this._map(Ae,!0):null;const Rt=(fe<<5)+(R+1)+this.points.length;for(const mt of De){const St=je.points[mt];if(St.zoom<=R)continue;St.zoom=R;const Mt=St.numPoints||1;le+=St.x*Mt,be+=St.y*Mt,St.parentId=Rt,pe&&(Tt||(Tt=this._map(Ae,!0)),pe(Tt,this._map(St)))}Ae.parentId=Rt,G.push(xt(le/Ne,be/Ne,Rt,Ne,Tt))}else if(G.push(Ae),Ne>1)for(const le of De){const be=je.points[le];be.zoom<=R||(be.zoom=R,G.push(be))}}return G}_getOriginId(P){return P-this.points.length>>5}_getOriginZoom(P){return(P-this.points.length)%32}_map(P,R){if(P.numPoints)return R?Et({},P.properties):P.properties;const G=this.points[P.index].properties,H=this.options.map(G);return R&&H===G?Et({},H):H}}function xt(q,P,R,G,H){return{x:Ti(q),y:Ti(P),zoom:1/0,id:R,parentId:-1,numPoints:G,properties:H}}function _o(q,P){const[R,G]=q.geometry.coordinates;return{x:Ti(Nr(R)),y:Ti(an(G)),zoom:1/0,index:P,parentId:-1}}function go(q){return{type:"Feature",id:q.id,properties:vs(q),geometry:{type:"Point",coordinates:[(P=q.x,360*(P-.5)),yo(q.y)]}};var P}function vs(q){const P=q.numPoints,R=P>=1e4?`${Math.round(P/1e3)}k`:P>=1e3?Math.round(P/100)/10+"k":P;return Et(Et({},q.properties),{cluster:!0,cluster_id:q.id,point_count:P,point_count_abbreviated:R})}function Nr(q){return q/360+.5}function an(q){const P=Math.sin(q*Math.PI/180),R=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return R<0?0:R>1?1:R}function yo(q){const P=(180-360*q)*Math.PI/180;return 360*Math.atan(Math.exp(P))/Math.PI-90}function Et(q,P){for(const R in P)q[R]=P[R];return q}function Vr(q){return q.x}function dr(q){return q.y}function Gn(q,P,R,G){for(var H,ie=G,pe=R-P>>1,de=R-P,re=q[P],fe=q[P+1],Ae=q[R],je=q[R+1],De=P+3;De<R;De+=3){var et=ws(q[De],q[De+1],re,fe,Ae,je);if(et>ie)H=De,ie=et;else if(et===ie){var Ne=Math.abs(De-pe);Ne<de&&(H=De,de=Ne)}}ie>G&&(H-P>3&&Gn(q,P,H,G),q[H+2]=ie,R-H>3&&Gn(q,H,R,G))}function ws(q,P,R,G,H,ie){var pe=H-R,de=ie-G;if(pe!==0||de!==0){var re=((q-R)*pe+(P-G)*de)/(pe*pe+de*de);re>1?(R=H,G=ie):re>0&&(R+=pe*re,G+=de*re)}return(pe=q-R)*pe+(de=P-G)*de}function pr(q,P,R,G){var H={id:q===void 0?null:q,type:P,geometry:R,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ie){var pe=ie.geometry,de=ie.type;if(de==="Point"||de==="MultiPoint"||de==="LineString")xo(ie,pe);else if(de==="Polygon"||de==="MultiLineString")for(var re=0;re<pe.length;re++)xo(ie,pe[re]);else if(de==="MultiPolygon")for(re=0;re<pe.length;re++)for(var fe=0;fe<pe[re].length;fe++)xo(ie,pe[re][fe])}(H),H}function xo(q,P){for(var R=0;R<P.length;R+=3)q.minX=Math.min(q.minX,P[R]),q.minY=Math.min(q.minY,P[R+1]),q.maxX=Math.max(q.maxX,P[R]),q.maxY=Math.max(q.maxY,P[R+1])}function vo(q,P,R,G){if(P.geometry){var H=P.geometry.coordinates,ie=P.geometry.type,pe=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),de=[],re=P.id;if(R.promoteId?re=P.properties[R.promoteId]:R.generateId&&(re=G||0),ie==="Point")wo(H,de);else if(ie==="MultiPoint")for(var fe=0;fe<H.length;fe++)wo(H[fe],de);else if(ie==="LineString")gn(H,de,pe,!1);else if(ie==="MultiLineString"){if(R.lineMetrics){for(fe=0;fe<H.length;fe++)gn(H[fe],de=[],pe,!1),q.push(pr(re,"LineString",de,P.properties));return}fr(H,de,pe,!1)}else if(ie==="Polygon")fr(H,de,pe,!0);else{if(ie!=="MultiPolygon"){if(ie==="GeometryCollection"){for(fe=0;fe<P.geometry.geometries.length;fe++)vo(q,{id:re,geometry:P.geometry.geometries[fe],properties:P.properties},R,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(fe=0;fe<H.length;fe++){var Ae=[];fr(H[fe],Ae,pe,!0),de.push(Ae)}}q.push(pr(re,ie,de,P.properties))}}function wo(q,P){P.push(ma(q[0])),P.push(yn(q[1])),P.push(0)}function gn(q,P,R,G){for(var H,ie,pe=0,de=0;de<q.length;de++){var re=ma(q[de][0]),fe=yn(q[de][1]);P.push(re),P.push(fe),P.push(0),de>0&&(pe+=G?(H*fe-re*ie)/2:Math.sqrt(Math.pow(re-H,2)+Math.pow(fe-ie,2))),H=re,ie=fe}var Ae=P.length-3;P[2]=1,Gn(P,0,Ae,R),P[Ae+2]=1,P.size=Math.abs(pe),P.start=0,P.end=P.size}function fr(q,P,R,G){for(var H=0;H<q.length;H++){var ie=[];gn(q[H],ie,R,G),P.push(ie)}}function ma(q){return q/360+.5}function yn(q){var P=Math.sin(q*Math.PI/180),R=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return R<0?0:R>1?1:R}function Gi(q,P,R,G,H,ie,pe,de){if(G/=P,ie>=(R/=P)&&pe<G)return q;if(pe<R||ie>=G)return null;for(var re=[],fe=0;fe<q.length;fe++){var Ae=q[fe],je=Ae.geometry,De=Ae.type,et=H===0?Ae.minX:Ae.minY,Ne=H===0?Ae.maxX:Ae.maxY;if(et>=R&&Ne<G)re.push(Ae);else if(!(Ne<R||et>=G)){var le=[];if(De==="Point"||De==="MultiPoint")_a(je,le,R,G,H);else if(De==="LineString")bo(je,le,R,G,H,!1,de.lineMetrics);else if(De==="MultiLineString")Ts(je,le,R,G,H,!1);else if(De==="Polygon")Ts(je,le,R,G,H,!0);else if(De==="MultiPolygon")for(var be=0;be<je.length;be++){var Tt=[];Ts(je[be],Tt,R,G,H,!0),Tt.length&&le.push(Tt)}if(le.length){if(de.lineMetrics&&De==="LineString"){for(be=0;be<le.length;be++)re.push(pr(Ae.id,De,le[be],Ae.tags));continue}De!=="LineString"&&De!=="MultiLineString"||(le.length===1?(De="LineString",le=le[0]):De="MultiLineString"),De!=="Point"&&De!=="MultiPoint"||(De=le.length===3?"Point":"MultiPoint"),re.push(pr(Ae.id,De,le,Ae.tags))}}}return re.length?re:null}function _a(q,P,R,G,H){for(var ie=0;ie<q.length;ie+=3){var pe=q[ie+H];pe>=R&&pe<=G&&(P.push(q[ie]),P.push(q[ie+1]),P.push(q[ie+2]))}}function bo(q,P,R,G,H,ie,pe){for(var de,re,fe=bs(q),Ae=H===0?Ql:ga,je=q.start,De=0;De<q.length-3;De+=3){var et=q[De],Ne=q[De+1],le=q[De+2],be=q[De+3],Tt=q[De+4],Rt=H===0?et:Ne,mt=H===0?be:Tt,St=!1;pe&&(de=Math.sqrt(Math.pow(et-be,2)+Math.pow(Ne-Tt,2))),Rt<R?mt>R&&(re=Ae(fe,et,Ne,be,Tt,R),pe&&(fe.start=je+de*re)):Rt>G?mt<G&&(re=Ae(fe,et,Ne,be,Tt,G),pe&&(fe.start=je+de*re)):To(fe,et,Ne,le),mt<R&&Rt>=R&&(re=Ae(fe,et,Ne,be,Tt,R),St=!0),mt>G&&Rt<=G&&(re=Ae(fe,et,Ne,be,Tt,G),St=!0),!ie&&St&&(pe&&(fe.end=je+de*re),P.push(fe),fe=bs(q)),pe&&(je+=de)}var Mt=q.length-3;et=q[Mt],Ne=q[Mt+1],le=q[Mt+2],(Rt=H===0?et:Ne)>=R&&Rt<=G&&To(fe,et,Ne,le),Mt=fe.length-3,ie&&Mt>=3&&(fe[Mt]!==fe[0]||fe[Mt+1]!==fe[1])&&To(fe,fe[0],fe[1],fe[2]),fe.length&&P.push(fe)}function bs(q){var P=[];return P.size=q.size,P.start=q.start,P.end=q.end,P}function Ts(q,P,R,G,H,ie){for(var pe=0;pe<q.length;pe++)bo(q[pe],P,R,G,H,ie,!1)}function To(q,P,R,G){q.push(P),q.push(R),q.push(G)}function Ql(q,P,R,G,H,ie){var pe=(ie-P)/(G-P);return q.push(ie),q.push(R+(H-R)*pe),q.push(1),pe}function ga(q,P,R,G,H,ie){var pe=(ie-R)/(H-R);return q.push(P+(G-P)*pe),q.push(ie),q.push(1),pe}function ya(q,P){for(var R=[],G=0;G<q.length;G++){var H,ie=q[G],pe=ie.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")H=mr(ie.geometry,P);else if(pe==="MultiLineString"||pe==="Polygon"){H=[];for(var de=0;de<ie.geometry.length;de++)H.push(mr(ie.geometry[de],P))}else if(pe==="MultiPolygon")for(H=[],de=0;de<ie.geometry.length;de++){for(var re=[],fe=0;fe<ie.geometry[de].length;fe++)re.push(mr(ie.geometry[de][fe],P));H.push(re)}R.push(pr(ie.id,pe,H,ie.tags))}return R}function mr(q,P){var R=[];R.size=q.size,q.start!==void 0&&(R.start=q.start,R.end=q.end);for(var G=0;G<q.length;G+=3)R.push(q[G]+P,q[G+1],q[G+2]);return R}function Es(q,P){if(q.transformed)return q;var R,G,H,ie=1<<q.z,pe=q.x,de=q.y;for(R=0;R<q.features.length;R++){var re=q.features[R],fe=re.geometry,Ae=re.type;if(re.geometry=[],Ae===1)for(G=0;G<fe.length;G+=2)re.geometry.push(xn(fe[G],fe[G+1],P,ie,pe,de));else for(G=0;G<fe.length;G++){var je=[];for(H=0;H<fe[G].length;H+=2)je.push(xn(fe[G][H],fe[G][H+1],P,ie,pe,de));re.geometry.push(je)}}return q.transformed=!0,q}function xn(q,P,R,G,H,ie){return[Math.round(R*(q*G-H)),Math.round(R*(P*G-ie))]}function jr(q,P,R,G,H){for(var ie=P===H.maxZoom?0:H.tolerance/((1<<P)*H.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:G,z:P,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},de=0;de<q.length;de++){pe.numFeatures++,xa(pe,q[de],ie,H);var re=q[de].minX,fe=q[de].minY,Ae=q[de].maxX,je=q[de].maxY;re<pe.minX&&(pe.minX=re),fe<pe.minY&&(pe.minY=fe),Ae>pe.maxX&&(pe.maxX=Ae),je>pe.maxY&&(pe.maxY=je)}return pe}function xa(q,P,R,G){var H=P.geometry,ie=P.type,pe=[];if(ie==="Point"||ie==="MultiPoint")for(var de=0;de<H.length;de+=3)pe.push(H[de]),pe.push(H[de+1]),q.numPoints++,q.numSimplified++;else if(ie==="LineString")$r(pe,H,q,R,!1,!1);else if(ie==="MultiLineString"||ie==="Polygon")for(de=0;de<H.length;de++)$r(pe,H[de],q,R,ie==="Polygon",de===0);else if(ie==="MultiPolygon")for(var re=0;re<H.length;re++){var fe=H[re];for(de=0;de<fe.length;de++)$r(pe,fe[de],q,R,!0,de===0)}if(pe.length){var Ae=P.tags||null;if(ie==="LineString"&&G.lineMetrics){for(var je in Ae={},P.tags)Ae[je]=P.tags[je];Ae.mapbox_clip_start=H.start/H.size,Ae.mapbox_clip_end=H.end/H.size}var De={geometry:pe,type:ie==="Polygon"||ie==="MultiPolygon"?3:ie==="LineString"||ie==="MultiLineString"?2:1,tags:Ae};P.id!==null&&(De.id=P.id),q.features.push(De)}}function $r(q,P,R,G,H,ie){var pe=G*G;if(G>0&&P.size<(H?pe:G))R.numPoints+=P.length/3;else{for(var de=[],re=0;re<P.length;re+=3)(G===0||P[re+2]>pe)&&(R.numSimplified++,de.push(P[re]),de.push(P[re+1])),R.numPoints++;H&&function(fe,Ae){for(var je=0,De=0,et=fe.length,Ne=et-2;De<et;Ne=De,De+=2)je+=(fe[De]-fe[Ne])*(fe[De+1]+fe[Ne+1]);if(je>0===Ae)for(De=0,et=fe.length;De<et/2;De+=2){var le=fe[De],be=fe[De+1];fe[De]=fe[et-2-De],fe[De+1]=fe[et-1-De],fe[et-2-De]=le,fe[et-1-De]=be}}(de,ie),q.push(de)}}function ir(q,P){var R=(P=this.options=function(H,ie){for(var pe in ie)H[pe]=ie[pe];return H}(Object.create(this.options),P)).debug;if(R&&console.time("preprocess data"),P.maxZoom<0||P.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(P.promoteId&&P.generateId)throw new Error("promoteId and generateId cannot be used together.");var G=function(H,ie){var pe=[];if(H.type==="FeatureCollection")for(var de=0;de<H.features.length;de++)vo(pe,H.features[de],ie,de);else vo(pe,H.type==="Feature"?H:{geometry:H},ie);return pe}(q,P);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",P.indexMaxZoom,P.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(G=function(H,ie){var pe=ie.buffer/ie.extent,de=H,re=Gi(H,1,-1-pe,pe,0,-1,2,ie),fe=Gi(H,1,1-pe,2+pe,0,-1,2,ie);return(re||fe)&&(de=Gi(H,1,-pe,1+pe,0,-1,2,ie)||[],re&&(de=ya(re,1).concat(de)),fe&&(de=de.concat(ya(fe,-1)))),de}(G,P)).length&&this.splitTile(G,0,0,0),R&&(G.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Eo(q,P,R){return 32*((1<<q)*R+P)+q}function Ss(q,P){const R=q.tileID.canonical;if(!this._geoJSONIndex)return P(null,null);const G=this._geoJSONIndex.getTile(R.z,R.x,R.y);if(!G)return P(null,null);const H=new ue(G.features);let ie=Ye(H);ie.byteOffset===0&&ie.byteLength===ie.buffer.byteLength||(ie=new Uint8Array(ie)),P(null,{vectorTile:H,rawData:ie.buffer})}ir.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ir.prototype.splitTile=function(q,P,R,G,H,ie,pe){for(var de=[q,P,R,G],re=this.options,fe=re.debug;de.length;){G=de.pop(),R=de.pop(),P=de.pop(),q=de.pop();var Ae=1<<P,je=Eo(P,R,G),De=this.tiles[je];if(!De&&(fe>1&&console.time("creation"),De=this.tiles[je]=jr(q,P,R,G,re),this.tileCoords.push({z:P,x:R,y:G}),fe)){fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",P,R,G,De.numFeatures,De.numPoints,De.numSimplified),console.timeEnd("creation"));var et="z"+P;this.stats[et]=(this.stats[et]||0)+1,this.total++}if(De.source=q,H){if(P===re.maxZoom||P===H)continue;var Ne=1<<H-P;if(R!==Math.floor(ie/Ne)||G!==Math.floor(pe/Ne))continue}else if(P===re.indexMaxZoom||De.numPoints<=re.indexMaxPoints)continue;if(De.source=null,q.length!==0){fe>1&&console.time("clipping");var le,be,Tt,Rt,mt,St,Mt=.5*re.buffer/re.extent,qr=.5-Mt,Zn=.5+Mt,$e=1+Mt;le=be=Tt=Rt=null,mt=Gi(q,Ae,R-Mt,R+Zn,0,De.minX,De.maxX,re),St=Gi(q,Ae,R+qr,R+$e,0,De.minX,De.maxX,re),q=null,mt&&(le=Gi(mt,Ae,G-Mt,G+Zn,1,De.minY,De.maxY,re),be=Gi(mt,Ae,G+qr,G+$e,1,De.minY,De.maxY,re),mt=null),St&&(Tt=Gi(St,Ae,G-Mt,G+Zn,1,De.minY,De.maxY,re),Rt=Gi(St,Ae,G+qr,G+$e,1,De.minY,De.maxY,re),St=null),fe>1&&console.timeEnd("clipping"),de.push(le||[],P+1,2*R,2*G),de.push(be||[],P+1,2*R,2*G+1),de.push(Tt||[],P+1,2*R+1,2*G),de.push(Rt||[],P+1,2*R+1,2*G+1)}}},ir.prototype.getTile=function(q,P,R){var G=this.options,H=G.extent,ie=G.debug;if(q<0||q>24)return null;var pe=1<<q,de=Eo(q,P=(P%pe+pe)%pe,R);if(this.tiles[de])return Es(this.tiles[de],H);ie>1&&console.log("drilling down to z%d-%d-%d",q,P,R);for(var re,fe=q,Ae=P,je=R;!re&&fe>0;)fe--,Ae=Math.floor(Ae/2),je=Math.floor(je/2),re=this.tiles[Eo(fe,Ae,je)];return re&&re.source?(ie>1&&console.log("found parent tile z%d-%d-%d",fe,Ae,je),ie>1&&console.time("drilling down"),this.splitTile(re.source,fe,Ae,je,q,P,R),ie>1&&console.timeEnd("drilling down"),this.tiles[de]?Es(this.tiles[de],H):null):null};class Gr extends a.VectorTileWorkerSource{constructor(P,R,G,H,ie){super(P,R,G,H,Ss),ie&&(this.loadGeoJSON=ie)}loadData(P,R){const G=P&&P.request,H=G&&G.collectResourceTiming;this.loadGeoJSON(P,(ie,pe)=>{if(ie||!pe)return R(ie);if(typeof pe!="object")return R(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));{ze(pe,!0);try{if(P.filter){const re=a.createExpression(P.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(re.result==="error")throw new Error(re.value.map(Ae=>`${Ae.key}: ${Ae.message}`).join(", "));const fe=pe.features.filter(Ae=>re.value.evaluate({zoom:0},Ae));pe={type:"FeatureCollection",features:fe}}this._geoJSONIndex=P.cluster?new _n(function({superclusterOptions:re,clusterProperties:fe}){if(!fe||!re)return re;const Ae={},je={},De={accumulated:null,zoom:0},et={properties:null},Ne=Object.keys(fe);for(const le of Ne){const[be,Tt]=fe[le],Rt=a.createExpression(Tt),mt=a.createExpression(typeof be=="string"?[be,["accumulated"],["get",le]]:be);Ae[le]=Rt.value,je[le]=mt.value}return re.map=le=>{et.properties=le;const be={};for(const Tt of Ne)be[Tt]=Ae[Tt].evaluate(De,et);return be},re.reduce=(le,be)=>{et.properties=be;for(const Tt of Ne)De.accumulated=le[Tt],le[Tt]=je[Tt].evaluate(De,et)},re}(P)).load(pe.features):function(re,fe){return new ir(re,fe)}(pe,P.geojsonVtOptions)}catch(re){return R(re)}this.loaded={};const de={};if(H){const re=a.getPerformanceMeasurement(G);re&&(de.resourceTiming={},de.resourceTiming[P.source]=JSON.parse(JSON.stringify(re)))}R(null,de)}})}reloadTile(P,R){const G=this.loaded;return G&&G[P.uid]?super.reloadTile(P,R):this.loadTile(P,R)}loadGeoJSON(P,R){if(P.request)a.getJSON(P.request,R);else{if(typeof P.data!="string")return R(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));try{return R(null,JSON.parse(P.data))}catch{return R(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(P,R){try{R(null,this._geoJSONIndex.getClusterExpansionZoom(P.clusterId))}catch(G){R(G)}}getClusterChildren(P,R){try{R(null,this._geoJSONIndex.getChildren(P.clusterId))}catch(G){R(G)}}getClusterLeaves(P,R){try{R(null,this._geoJSONIndex.getLeaves(P.clusterId,P.limit,P.offset))}catch(G){R(G)}}}class Zr{constructor(P){this.self=P,this.actor=new a.Actor(P,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:Gr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(R,G)=>{if(this.workerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.workerSourceTypes[R]=G},this.self.registerRTLTextPlugin=R=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=R.applyArabicShaping,a.plugin.processBidirectionalText=R.processBidirectionalText,a.plugin.processStyledBidirectionalText=R.processStyledBidirectionalText}}clearCaches(P,R,G){delete this.layerIndexes[P],delete this.availableImages[P],delete this.workerSources[P],delete this.demWorkerSources[P],G()}checkIfReady(P,R,G){G()}setReferrer(P,R){this.referrer=R}spriteLoaded(P,R){this.isSpriteLoaded[P]=R;for(const G in this.workerSources[P]){const H=this.workerSources[P][G];for(const ie in H)H[ie]instanceof a.VectorTileWorkerSource&&(H[ie].isSpriteLoaded=R,H[ie].fire(new a.Event("isSpriteLoaded")))}}setImages(P,R,G){this.availableImages[P]=R;for(const H in this.workerSources[P]){const ie=this.workerSources[P][H];for(const pe in ie)ie[pe].availableImages=R}G()}enableTerrain(P,R,G){this.terrain=R,G()}setProjection(P,R){this.projections[P]=a.getProjection(R)}setLayers(P,R,G){this.getLayerIndex(P).replace(R),G()}updateLayers(P,R,G){this.getLayerIndex(P).update(R.layers,R.removedIds),G()}loadTile(P,R,G){const H=this.enableTerrain?a.extend({enableTerrain:this.terrain},R):R;H.projection=this.projections[P]||this.defaultProjection,this.getWorkerSource(P,R.type,R.source).loadTile(H,G)}loadDEMTile(P,R,G){const H=this.enableTerrain?a.extend({buildQuadTree:this.terrain},R):R;this.getDEMWorkerSource(P,R.source).loadTile(H,G)}reloadTile(P,R,G){const H=this.enableTerrain?a.extend({enableTerrain:this.terrain},R):R;H.projection=this.projections[P]||this.defaultProjection,this.getWorkerSource(P,R.type,R.source).reloadTile(H,G)}abortTile(P,R,G){this.getWorkerSource(P,R.type,R.source).abortTile(R,G)}removeTile(P,R,G){this.getWorkerSource(P,R.type,R.source).removeTile(R,G)}removeSource(P,R,G){if(!this.workerSources[P]||!this.workerSources[P][R.type]||!this.workerSources[P][R.type][R.source])return;const H=this.workerSources[P][R.type][R.source];delete this.workerSources[P][R.type][R.source],H.removeSource!==void 0?H.removeSource(R,G):G()}loadWorkerSource(P,R,G){try{this.self.importScripts(R.url),G()}catch(H){G(H.toString())}}syncRTLPluginState(P,R,G){try{a.plugin.setState(R);const H=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&H!=null){this.self.importScripts(H);const ie=a.plugin.isParsed();G(ie?void 0:new Error(`RTL Text Plugin failed to import scripts from ${H}`),ie)}}catch(H){G(H.toString())}}getAvailableImages(P){let R=this.availableImages[P];return R||(R=[]),R}getLayerIndex(P){let R=this.layerIndexes[P];return R||(R=this.layerIndexes[P]=new qe),R}getWorkerSource(P,R,G){return this.workerSources[P]||(this.workerSources[P]={}),this.workerSources[P][R]||(this.workerSources[P][R]={}),this.workerSources[P][R][G]||(this.workerSources[P][R][G]=new this.workerSourceTypes[R]({send:(H,ie,pe,de,re,fe)=>{this.actor.send(H,ie,pe,P,re,fe)},scheduler:this.actor.scheduler},this.getLayerIndex(P),this.getAvailableImages(P),this.isSpriteLoaded[P])),this.workerSources[P][R][G]}getDEMWorkerSource(P,R){return this.demWorkerSources[P]||(this.demWorkerSources[P]={}),this.demWorkerSources[P][R]||(this.demWorkerSources[P][R]=new oe),this.demWorkerSources[P][R]}enforceCacheSizeLimit(P,R){a.enforceCacheSizeLimit(R)}getWorkerPerformanceMetrics(P,R,G){G(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Zr(self)),Zr}),k(["./shared"],function(a){var Q=ge;function ge(u){return!function(t){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,m,_=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(_);try{m=new Worker(x),d=!0}catch{d=!1}return m&&m.terminate(),URL.revokeObjectURL(x),d}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var d=document.createElement("canvas");d.width=d.height=1;var m=d.getContext("2d");if(!m)return!1;var _=m.getImageData(0,0,1,1);return _&&_.width===d.width}()?(qe[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&(qe[s]=function(d){var m,_=function(x){var b=document.createElement("canvas"),C=Object.create(ge.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=x,b.getContext("webgl",C)||b.getContext("experimental-webgl",C)}(d);if(!_)return!1;try{m=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!m||_.isContextLost())&&(_.shaderSource(m,"void main() {}"),_.compileShader(m),_.getShaderParameter(m,_.COMPILE_STATUS)===!0)}(s)),qe[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(u)}var qe={};function _e(u,t){if(Array.isArray(u)){if(!Array.isArray(t)||u.length!==t.length)return!1;for(let s=0;s<u.length;s++)if(!_e(u[s],t[s]))return!1;return!0}if(typeof u=="object"&&u!==null&&t!==null){if(typeof t!="object"||Object.keys(u).length!==Object.keys(t).length)return!1;for(const s in u)if(!_e(u[s],t[s]))return!1;return!0}return u===t}ge.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const oe={create:function(u,t,s){const d=a.window.document.createElement(u);return t!==void 0&&(d.className=t),s&&s.appendChild(d),d},createNS:function(u,t){return a.window.document.createElementNS(u,t)}},ze=a.window.document&&a.window.document.documentElement.style,it=ze&&ze.userSelect!==void 0?"userSelect":"WebkitUserSelect";let rt;oe.disableDrag=function(){ze&&it&&(rt=ze[it],ze[it]="none")},oe.enableDrag=function(){ze&&it&&(ze[it]=rt)},oe.setTransform=function(u,t){u.style.transform=t};let me=!1;try{const u=Object.defineProperty({},"passive",{get(){me=!0}});a.window.addEventListener("test",u,u),a.window.removeEventListener("test",u,u)}catch{me=!1}oe.addEventListener=function(u,t,s,d={}){u.addEventListener(t,s,"passive"in d&&me?d:d.capture)},oe.removeEventListener=function(u,t,s,d={}){u.removeEventListener(t,s,"passive"in d&&me?d:d.capture)};const te=function(u){u.preventDefault(),u.stopPropagation(),a.window.removeEventListener("click",te,!0)};function ue(u,t,s){const d=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new a.pointGeometry((s.clientX-t.left)*d,(s.clientY-t.top)*d)}function ke(u,t){var s=t[0],d=t[1],m=t[2],_=t[3],x=s*_-m*d;return x?(u[0]=_*(x=1/x),u[1]=-d*x,u[2]=-m*x,u[3]=s*x,u):null}oe.suppressClick=function(){a.window.addEventListener("click",te,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",te,!0)},0)},oe.mousePos=function(u,t){const s=u.getBoundingClientRect();return ue(u,s,t)},oe.touchPos=function(u,t){const s=u.getBoundingClientRect(),d=[];for(let m=0;m<t.length;m++)d.push(ue(u,s,t[m]));return d},oe.mouseButton=function(u){return a.window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button},oe.remove=function(u){u.parentNode&&u.parentNode.removeChild(u)};class Pe{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,d){const m=a.dot(s,this.dir);if(Math.abs(m)<1e-6)return!1;const _=a.dot(a.sub(a.create(),t,this.pos),s)/m,x=a.scaleAndAdd(a.create(),this.pos,this.dir,_);return a.copy(d,x),!0}}class at{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,d){const m=Math.pow(2,d),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const C=a.transformMat4([],b,t),A=1/C[3]/s*m;return a.mul(C,C,[A,A,1/C[3],A])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const C=a.sub([],_[b[0]],_[b[1]]),A=a.sub([],_[b[2]],_[b[1]]),M=a.normalize([],a.cross([],C,A)),z=-a.dot(M,_[b[1]]);return M.concat(z)});return new at(_,x)}}class Xe{constructor(t,s){this.min=t,this.max=s,this.center=a.scale([],a.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],d=a.clone(this.min),m=a.clone(this.max);for(let _=0;_<s.length;_++)d[_]=s[_]?this.min[_]:this.center[_],m[_]=s[_]?this.center[_]:this.max[_];return m[2]=this.max[2],new Xe(d,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let m=0;m<t.planes.length;m++){const _=t.planes[m];let x=0;for(let b=0;b<s.length;b++)x+=a.dot$1(_,s[b])>=0;if(x===0)return 0;x!==s.length&&(d=!1)}if(d)return 2;for(let m=0;m<3;m++){let _=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let b=0;b<t.points.length;b++){const C=t.points[b][m]-this.min[m];_=Math.min(_,C),x=Math.max(x,C)}if(x<0||_>this.max[m]-this.min[m])return 0}return 1}}function Ye(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class dt extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:d}of this.requestors)this._notify(s,d);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,s){this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let d=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),d=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),d=!1),this._validateContent(s.content,s)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),d=!1),d}_validateStretch(t,s){if(!t)return!0;let d=0;for(const m of t){if(m[0]<d||m[1]<m[0]||s<m[1])return!1;d=m[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){s.version=this.images[t].version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let d=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(d=!1);this.isLoaded()||d?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const d={};for(const m of t){this.images[m]||this.fire(new a.Event("styleimagemissing",{id:m}));const _=this.images[m];_?d[m]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:Boolean(_.userImage&&_.userImage.render)}:a.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,d)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],d=this.getImage(t);if(!d)return null;if(s&&s.position.version===d.version)return s.position;if(s)s.position.version=d.version;else{const m={w:d.data.width+2,h:d.data.height+2,x:0,y:0},_=new a.ImagePosition(m,d);this.patterns[t]={bin:m,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:s,h:d}=a.potpack(t),m=this.atlasImage;m.resize({width:s||1,height:d||1});for(const _ in this.patterns){const{bin:x}=this.patterns[_],b=x.x+1,C=x.y+1,A=this.images[_].data,M=A.width,z=A.height;a.RGBAImage.copy(A,m,{x:0,y:0},{x:b,y:C},{width:M,height:z}),a.RGBAImage.copy(A,m,{x:0,y:z-1},{x:b,y:C-1},{width:M,height:1}),a.RGBAImage.copy(A,m,{x:0,y:0},{x:b,y:C+z},{width:M,height:1}),a.RGBAImage.copy(A,m,{x:M-1,y:0},{x:b-1,y:C},{width:1,height:z}),a.RGBAImage.copy(A,m,{x:0,y:0},{x:b+M,y:C},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const d=this.images[s];Ye(d)&&this.updateImage(s,d)}}}const ot=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(u,t){return function([s,d,m]){const _=a.degToRad(d+90),x=a.degToRad(m);return{x:s*Math.cos(_)*Math.sin(x),y:s*Math.sin(_)*Math.sin(x),z:s*Math.cos(x),azimuthal:d,polar:m}}(u.expression.evaluate(t))}interpolate(u,t,s){return{x:a.number(u.x,t.x,s),y:a.number(u.y,t.y,s),z:a.number(u.z,t.z,s),azimuthal:a.number(u.azimuthal,t.azimuthal,s),polar:a.number(u.polar,t.polar,s)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),Qt="-transition";class Yt extends a.Evented{constructor(t){super(),this._transitionable=new a.Transitionable(ot),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(a.validateLight,t,s))for(const d in t){const m=t[d];a.endsWith(d,Qt)?this._transitionable.setTransition(d.slice(0,-Qt.length),m):this._transitionable.setValue(d,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,d){return(!d||d.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const Di=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)}),ei="-transition";class $n extends a.Evented{constructor(t){super(),this._transitionable=new a.Transitionable(Di),this.set(t),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(t){for(const s in t){const d=t[s];a.endsWith(s,ei)?this._transitionable.setTransition(s.slice(0,-ei.length),d):this._transitionable.setValue(s,d)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function on(u,t,s,d){const m=a.smoothstep(45,65,s),[_,x]=Mn(u,d),b=a.length(t);let C=1-Math.min(1,Math.exp((b-_)/(x-_)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*m*u.alpha}function Mn(u,t){const s=.5/Math.tan(.5*t);return[u.range[0]+s,u.range[1]+s]}const kn=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"])}),zn="-transition";class sn extends a.Evented{constructor(t,s){super(),this._transitionable=new a.Transitionable(kn),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=s}isSoftDisabled(){return this._transform.projection.name!=="mercator"}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s={}){if(!this._validate(a.validateFog,t,s))for(const d in t){const m=t[d];a.endsWith(d,zn)?this._transitionable.setTransition(d.slice(0,-zn.length),m):this._transitionable.setValue(d,m)}}getOpacity(t){if(this.isSoftDisabled())return 0;const s=this.properties&&this.properties.get("color")||1;return a.smoothstep(45,65,t)*s.a}getOpacityAtLatLng(t,s){return this.isSoftDisabled()?0:function(d,m,_){const x=a.MercatorCoordinate.fromLngLat(m),b=_.elevation?_.elevation.getAtPointOrZero(x):0,C=[x.x,x.y,b];return a.transformMat4$1(C,C,_.mercatorFogMatrix),on(d,C,_.pitch,_._fov)}(this.state,t,s)}getFovAdjustedRange(t){return this.isSoftDisabled()?[0,1]:Mn(this.state,t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,d){return(!d||d.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class mn{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const d=this.workerPool.acquire(this.id);for(let m=0;m<d.length;m++){const _=new mn.Actor(d[m],s,this.id);_.name=`Worker ${m}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,s,d){a.asyncAll(this.actors,(m,_)=>{m.send(t,s,_)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ve(u,t,s){return t*(a.EXTENT/(u.tileSize*Math.pow(2,s-u.tileID.overscaledZ)))}mn.Actor=a.Actor;class ct{constructor(t,s,d,m){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(_=>m.pointCoordinate3D(_)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,s){let d,m;if(t instanceof a.pointGeometry||typeof t[0]=="number"){const _=a.pointGeometry.convert(t);d=[a.pointGeometry.convert(t)],m=s.isPointAboveHorizon(_)}else{const _=a.pointGeometry.convert(t[0]),x=a.pointGeometry.convert(t[1]);d=[_,x],m=a.polygonizeBounds(_,x).every(b=>s.isPointAboveHorizon(b))}return new ct(d,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],m=a.polygonizeBounds(s,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<d.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),a.bufferConvexPolygon(m,t)}containsTile(t,s,d){const m=t.queryPadding+1,_=t.tileID.wrap,x=d?this._bufferedCameraMercator(m,s).map($=>a.getTilePoint(t.tileTransform,$,_)):this._bufferedScreenMercator(m,s).map($=>a.getTilePoint(t.tileTransform,$,_)),b=this.screenGeometryMercator.map($=>a.getTileVec3(t.tileTransform,$,_)),C=b.map($=>new a.pointGeometry($[0],$[1])),A=s.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),M=a.getTileVec3(t.tileTransform,A,_),z=b.map($=>{const U=a.sub($,$,M);return a.normalize(U,U),new Pe(M,U)}),F=Ve(t,1,s.zoom);if(a.polygonIntersectsBox(x,0,0,a.EXTENT,a.EXTENT))return{queryGeometry:this,tilespaceGeometry:C,tilespaceRays:z,bufferedTilespaceGeometry:x,bufferedTilespaceBounds:(V=a.getBounds(x),V.min.x=a.clamp(V.min.x,0,a.EXTENT),V.min.y=a.clamp(V.min.y,0,a.EXTENT),V.max.x=a.clamp(V.max.x,0,a.EXTENT),V.max.y=a.clamp(V.max.y,0,a.EXTENT),V),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:F};var V}_bufferedScreenMercator(t,s){const d=nt(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{const m=this.bufferedScreenGeometry(t).map(_=>s.pointCoordinate3D(_));return this._screenRaycastCache[d]=m,m}}_bufferedCameraMercator(t,s){const d=nt(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{const m=this.bufferedCameraGeometry(t).map(_=>s.pointCoordinate3D(_));return this._cameraRaycastCache[d]=m,m}}}function nt(u){return 100*u|0}function zt(u,t,s){const d=function(m,_){if(m)return s(m);if(_){const x=a.pick(a.extend(_,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);_.vector_layers&&(x.vectorLayers=_.vector_layers,x.vectorLayerIds=x.vectorLayers.map(b=>b.id)),x.tiles=t.canonicalizeTileset(x,u.url),s(null,x)}};return u.url?a.getJSON(t.transformRequest(t.normalizeSourceURL(u.url),a.ResourceType.Source),d):a.exported.frame(()=>d(null,u))}class oi{constructor(t,s,d){this.bounds=a.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),d=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*s),m=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*s),_=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*s),x=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=d&&t.x<_&&t.y>=m&&t.y<x}}class Ti{constructor(t,s,d){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $i={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _n{constructor(t,s,d,m){this.length=s.length,this.attributes=d,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let d=0;d<this.attributes.length;d++){const m=s.attributes[this.attributes[d].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,d){for(let m=0;m<this.attributes.length;m++){const _=this.attributes[m],x=s.attributes[_.name];x!==void 0&&t.vertexAttribPointer(x,_.components,t[$i[_.type]],!1,this.itemSize,_.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class xt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _o extends xt{getDefault(){return a.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class go extends xt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class vs extends xt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Nr extends xt{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class an extends xt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class yo extends xt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Et extends xt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Vr extends xt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class dr extends xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Gn extends xt{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ws extends xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class pr extends xt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class xo extends xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class vo extends xt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class wo extends xt{getDefault(){return a.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class gn extends xt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class fr extends xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class ma extends xt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class yn extends xt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Gi extends xt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class _a extends xt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class bo extends xt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class bs extends xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ts extends xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class To extends xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ql extends xt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ga extends xt{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ya extends xt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class mr extends xt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Es extends xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class xn extends xt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class jr extends xt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class xa extends jr{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class $r extends jr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ir extends $r{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Eo{constructor(t,s,d,m){this.context=t,this.width=s,this.height=d;const _=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new xa(t,_),m&&(this.depthAttachment=new $r(t,_))}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const d=this.depthAttachment.get();d&&t.deleteRenderbuffer(d)}t.deleteFramebuffer(this.framebuffer)}}class Ss{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new _o(this),this.clearDepth=new go(this),this.clearStencil=new vs(this),this.colorMask=new Nr(this),this.depthMask=new an(this),this.stencilMask=new yo(this),this.stencilFunc=new Et(this),this.stencilOp=new Vr(this),this.stencilTest=new dr(this),this.depthRange=new Gn(this),this.depthTest=new ws(this),this.depthFunc=new pr(this),this.blend=new xo(this),this.blendFunc=new vo(this),this.blendColor=new wo(this),this.blendEquation=new gn(this),this.cullFace=new fr(this),this.cullFaceSide=new ma(this),this.frontFace=new yn(this),this.program=new Gi(this),this.activeTexture=new _a(this),this.viewport=new bo(this),this.bindFramebuffer=new bs(this),this.bindRenderbuffer=new Ts(this),this.bindTexture=new To(this),this.bindVertexBuffer=new Ql(this),this.bindElementBuffer=new ga(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ya(this),this.pixelStoreUnpack=new mr(this),this.pixelStoreUnpackPremultiplyAlpha=new Es(this),this.pixelStoreUnpackFlipY=new xn(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Ti(this,t,s)}createVertexBuffer(t,s,d){return new _n(this,t,s,d)}createRenderbuffer(t,s,d){const m=this.gl,_=m.createRenderbuffer();return this.bindRenderbuffer.set(_),m.renderbufferStorage(m.RENDERBUFFER,t,s,d),this.bindRenderbuffer.set(null),_}createFramebuffer(t,s,d){return new Eo(this,t,s,d)}clear({color:t,depth:s,stencil:d}){const m=this.gl;let _=0;t&&(_|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(_|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),d!==void 0&&(_|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),m.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){_e(t.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Gr extends a.Evented{constructor(t,s,d,m){super(),this.id=t,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},s),a.extend(this,a.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=zt(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):s&&(a.extend(this,s),s.bounds&&(this.tileBounds=new oi(s.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(s.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const d=a.exported.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=a.getImage(this.map._requestManager.transformRequest(m,a.ResourceType.Tile),(_,x,b,C)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(_)t.state="errored",s(_);else if(x){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:b,expires:C});const A=this.map.painter.context,M=A.gl;t.texture=this.map.painter.getTileTexture(x.width),t.texture?t.texture.update(x,{useMipmap:!0}):(t.texture=new a.Texture(A,x,M.RGBA,{useMipmap:!0}),t.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE),A.extTextureFilterAnisotropic&&M.texParameterf(M.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax)),t.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let Zr;class q extends a.Evented{constructor(t,s,d,m){super(),this.id=t,this.dispatcher=d,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=s}load(t,s){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(d,m)=>{this._loaded=!0,d?this.fire(new a.ErrorEvent(d)):m&&(this.image=a.exported.getImageData(m),t&&(this.coordinates=t),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t,delete this._boundsArray;const s=t.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(d){let m=1/0,_=1/0,x=-1/0,b=-1/0;for(const z of d)m=Math.min(m,z.x),_=Math.min(_,z.y),x=Math.max(x,z.x),b=Math.max(b,z.y);const C=Math.max(x-m,b-_),A=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),M=Math.pow(2,A);return new a.CanonicalTileID(A,Math.floor((m+x)/2*M),Math.floor((_+b)/2*M))}(s),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const t=a.tileTransform(this.tileID,this.map.transform.projection),s=this.coordinates.map(d=>{const m=t.projection.project(d[0],d[1]);return a.getTilePoint(t,m)._round()});return this._boundsArray=new a.StructArrayLayout4i8,this._boundsArray.emplaceBack(s[0].x,s[0].y,0,0),this._boundsArray.emplaceBack(s[1].x,s[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(s[3].x,s[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(s[2].x,s[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,a.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new a.Texture(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const d in this.tiles){const m=this.tiles[d];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const P={vector:class extends a.Evented{constructor(u,t,s,d){if(super(),this.id=u,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(t,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=zt(this._options,this.map._requestManager,(u,t)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new a.ErrorEvent(u)):t&&(a.extend(this,t),t.bounds&&(this.tileBounds=new oi(t.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}setSourceProperty(u){this._tileJSONRequest&&this._tileJSONRequest.cancel(),u();const t=this.map.style._getSourceCaches(this.id);for(const s of t)s.clearTiles();this.load()}setTiles(u){return this.setSourceProperty(()=>{this._options.tiles=u}),this}setUrl(u){return this.setSourceProperty(()=>{this.url=u,this._options.url=u}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(u,t){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(s,a.ResourceType.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:u.isSymbolTile};if(d.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired")u.state==="loading"?u.reloadCallback=t:u.request=u.actor.send("reloadTile",d,m.bind(this));else if(u.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)u.request=u.actor.send("loadTile",d,m.bind(this),void 0,!0);else{const _=a.loadVectorTile.call({deduped:this._deduped},d,(x,b)=>{x||!b?m.call(this,x):(d.data={cacheControl:b.cacheControl,expires:b.expires,rawData:b.rawData.slice(0)},u.actor&&u.actor.send("loadTile",d,m.bind(this),void 0,!0))},!0);u.request={cancel:_}}function m(_,x){return delete u.request,u.aborted?t(null):_&&_.status!==404?t(_):(x&&x.resourceTiming&&(u.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&x&&u.setExpiryData(x),u.loadVectorData(x,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id})}unloadTile(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Gr,"raster-dem":class extends Gr{constructor(u,t,s,d){super(u,t,s,d),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(m,_){m&&(u.state="errored",t(m)),_&&(u.dem=_,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=a.getImage(this.map._requestManager.transformRequest(s,a.ResourceType.Tile),function(m,_,x,b){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(m)u.state="errored",t(m);else if(_){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:x,expires:b});const C=a.window.ImageBitmap&&_ instanceof a.window.ImageBitmap&&(Zr==null&&(Zr=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),Zr),A=1-(_.width-a.prevPowerOfTwo(_.width))/2;A<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const M=C?_:a.exported.getImageData(_,A),z={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:M,encoding:this.encoding,padding:A};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",z,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(u){const t=u.canonical,s=Math.pow(2,t.z),d=(t.x-1+s)%s,m=t.x===0?u.wrap-1:u.wrap,_=(t.x+1+s)%s,x=t.x+1===s?u.wrap+1:u.wrap,b={};return b[new a.OverscaledTileID(u.overscaledZ,m,t.z,d,t.y).key]={backfilled:!1},b[new a.OverscaledTileID(u.overscaledZ,x,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(b[new a.OverscaledTileID(u.overscaledZ,m,t.z,d,t.y-1).key]={backfilled:!1},b[new a.OverscaledTileID(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},b[new a.OverscaledTileID(u.overscaledZ,x,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<s&&(b[new a.OverscaledTileID(u.overscaledZ,m,t.z,d,t.y+1).key]={backfilled:!1},b[new a.OverscaledTileID(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},b[new a.OverscaledTileID(u.overscaledZ,x,t.z,_,t.y+1).key]={backfilled:!1}),b}unloadTile(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded"}},geojson:class extends a.Evented{constructor(u,t,s,d){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(d),this._data=t.data,this._options=a.extend({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:a.EXTENT,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},t),this}getClusterLeaves(u,t,s,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:t,offset:s},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const u=a.extend({},this.workerOptions),t=this._data;typeof t=="string"?(u.request=this.map._requestManager.transformRequest(a.exported.resolveURL(t),a.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(s,d)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new a.ErrorEvent(s));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(m.resourceTiming=d.resourceTiming[this.id]),this.fire(new a.Event("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,t){const s=u.actor?"reloadTile":"loadTile";u.actor=this.actor,u.request=this.actor.send(s,{type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(d,m)=>(delete u.request,u.unloadVectorData(),u.aborted?t(null):d?t(d):(u.loadVectorData(m,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends q{constructor(u,t,s,d){super(u,t,s,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,a.ResourceType.Source).url);a.getVideo(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,a.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(u,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE));for(const s in this.tiles){const d=this.tiles[s];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:q,canvas:class extends q{constructor(u,t,s,d){super(u,t,s,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(_=>typeof _!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context,s=t.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,a.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(t,this.canvas,s.RGBA,{premultiply:!0});for(const d in this.tiles){const m=this.tiles[d];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}}},R=function(u,t,s,d){const m=new P[t.type](u,t,s,d);if(m.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${m.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],m),m};function G(u,t){const s=a.identity([]);return a.scale$1(s,s,[.5*u.width,.5*-u.height,1]),a.translate(s,s,[1,-1,0]),a.multiply(s,s,u.calculateProjMatrix(t.toUnwrapped()))}function H(u,t,s,d,m,_,x,b=!1){const C=u.tilesIn(d,x,b);C.sort(pe);const A=[];for(const z of C)A.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(t,s,u._state,z,m,_,G(u.transform,z.tile.tileID),b)});const M=function(z){const F={},V={};for(const $ of z){const U=$.queryResults,W=$.wrappedTileID,N=V[W]=V[W]||{};for(const X in U){const K=U[X],j=N[X]=N[X]||{},J=F[X]=F[X]||[];for(const ne of K)j[ne.featureIndex]||(j[ne.featureIndex]=!0,J.push(ne))}}return F}(A);for(const z in M)M[z].forEach(F=>{const V=F.feature,$=u.getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=$});return M}function ie(u,t){const s=u.getRenderableIds().map(_=>u.getTileByID(_)),d=[],m={};for(let _=0;_<s.length;_++){const x=s[_],b=x.tileID.canonical.key;m[b]||(m[b]=!0,x.querySourceFeatures(d,t))}return d}function pe(u,t){const s=u.tileID,d=t.tileID;return s.overscaledZ-d.overscaledZ||s.canonical.y-d.canonical.y||s.wrap-d.wrap||s.canonical.x-d.canonical.x}function de(){return Vo.workerClass!=null?new Vo.workerClass:new a.window.Worker(Vo.workerUrl)}const re="mapboxgl_preloaded_worker_pool";class fe{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<fe.workerCount;)this.workers.push(new de);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[re]}numActive(){return Object.keys(this.active).length}}let Ae;function je(){return Ae||(Ae=new fe),Ae}function De(u,t){const s={};for(const d in u)d!=="ref"&&(s[d]=u[d]);return a.refProperties.forEach(d=>{d in t&&(s[d]=t[d])}),s}function et(u){u=u.slice();const t=Object.create(null);for(let s=0;s<u.length;s++)t[u[s].id]=u[s];for(let s=0;s<u.length;s++)"ref"in u[s]&&(u[s]=De(u[s],t[u[s].ref]));return u}fe.workerCount=2;const Ne={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function le(u,t,s){s.push({command:Ne.addSource,args:[u,t[u]]})}function be(u,t,s){t.push({command:Ne.removeSource,args:[u]}),s[u]=!0}function Tt(u,t,s,d){be(u,s,d),le(u,t,s)}function Rt(u,t,s){let d;for(d in u[s])if(u[s].hasOwnProperty(d)&&d!=="data"&&!_e(u[s][d],t[s][d]))return!1;for(d in t[s])if(t[s].hasOwnProperty(d)&&d!=="data"&&!_e(u[s][d],t[s][d]))return!1;return!0}function mt(u,t,s,d,m,_){let x;for(x in t=t||{},u=u||{})u.hasOwnProperty(x)&&(_e(u[x],t[x])||s.push({command:_,args:[d,x,t[x],m]}));for(x in t)t.hasOwnProperty(x)&&!u.hasOwnProperty(x)&&(_e(u[x],t[x])||s.push({command:_,args:[d,x,t[x],m]}))}function St(u){return u.id}function Mt(u,t){return u[t.id]=t,u}class qr{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.clamp(t,0,1);let s=1,d=this._distances[s];const m=t*this.paddedLength+this.padding;for(;d<m&&s<this._distances.length;)d=this._distances[++s];const _=s-1,x=this._distances[_],b=d-x,C=b>0?(m-x)/b:0;return this.points[_].mult(1-C).add(this.points[s].mult(C))}}class Zn{constructor(t,s,d){const m=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(s/d);for(let x=0;x<this.xCellCount*this.yCellCount;x++)m.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,d,m,_){this._forEachCell(s,d,m,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(_)}insertCircle(t,s,d,m){this._forEachCell(s-m,d-m,s+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(d),this.circles.push(m)}_insertBoxCell(t,s,d,m,_,x){this.boxCells[_].push(x)}_insertCircleCell(t,s,d,m,_,x){this.circleCells[_].push(x)}_query(t,s,d,m,_,x){if(d<0||t>this.width||m<0||s>this.height)return!_&&[];const b=[];if(t<=0&&s<=0&&this.width<=d&&this.height<=m){if(_)return!0;for(let C=0;C<this.boxKeys.length;C++)b.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const A=this.circles[3*C],M=this.circles[3*C+1],z=this.circles[3*C+2];b.push({key:this.circleKeys[C],x1:A-z,y1:M-z,x2:A+z,y2:M+z})}return x?b.filter(x):b}return this._forEachCell(t,s,d,m,this._queryCell,b,{hitTest:_,seenUids:{box:{},circle:{}}},x),_?b.length>0:b}_queryCircle(t,s,d,m,_){const x=t-d,b=t+d,C=s-d,A=s+d;if(b<0||x>this.width||A<0||C>this.height)return!m&&[];const M=[];return this._forEachCell(x,C,b,A,this._queryCellCircle,M,{hitTest:m,circle:{x:t,y:s,radius:d},seenUids:{box:{},circle:{}}},_),m?M.length>0:M}query(t,s,d,m,_){return this._query(t,s,d,m,!1,_)}hitTest(t,s,d,m,_){return this._query(t,s,d,m,!0,_)}hitTestCircle(t,s,d,m){return this._queryCircle(t,s,d,!0,m)}_queryCell(t,s,d,m,_,x,b,C){const A=b.seenUids,M=this.boxCells[_];if(M!==null){const F=this.bboxes;for(const V of M)if(!A.box[V]){A.box[V]=!0;const $=4*V;if(t<=F[$+2]&&s<=F[$+3]&&d>=F[$+0]&&m>=F[$+1]&&(!C||C(this.boxKeys[V]))){if(b.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[V],x1:F[$],y1:F[$+1],x2:F[$+2],y2:F[$+3]})}}}const z=this.circleCells[_];if(z!==null){const F=this.circles;for(const V of z)if(!A.circle[V]){A.circle[V]=!0;const $=3*V;if(this._circleAndRectCollide(F[$],F[$+1],F[$+2],t,s,d,m)&&(!C||C(this.circleKeys[V]))){if(b.hitTest)return x.push(!0),!0;{const U=F[$],W=F[$+1],N=F[$+2];x.push({key:this.circleKeys[V],x1:U-N,y1:W-N,x2:U+N,y2:W+N})}}}}}_queryCellCircle(t,s,d,m,_,x,b,C){const A=b.circle,M=b.seenUids,z=this.boxCells[_];if(z!==null){const V=this.bboxes;for(const $ of z)if(!M.box[$]){M.box[$]=!0;const U=4*$;if(this._circleAndRectCollide(A.x,A.y,A.radius,V[U+0],V[U+1],V[U+2],V[U+3])&&(!C||C(this.boxKeys[$])))return x.push(!0),!0}}const F=this.circleCells[_];if(F!==null){const V=this.circles;for(const $ of F)if(!M.circle[$]){M.circle[$]=!0;const U=3*$;if(this._circlesCollide(V[U],V[U+1],V[U+2],A.x,A.y,A.radius)&&(!C||C(this.circleKeys[$])))return x.push(!0),!0}}}_forEachCell(t,s,d,m,_,x,b,C){const A=this._convertToXCellCoord(t),M=this._convertToYCellCoord(s),z=this._convertToXCellCoord(d),F=this._convertToYCellCoord(m);for(let V=A;V<=z;V++)for(let $=M;$<=F;$++)if(_.call(this,t,s,d,m,this.xCellCount*$+V,x,b,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,d,m,_,x){const b=m-t,C=_-s,A=d+x;return A*A>b*b+C*C}_circleAndRectCollide(t,s,d,m,_,x,b){const C=(x-m)/2,A=Math.abs(t-(m+C));if(A>C+d)return!1;const M=(b-_)/2,z=Math.abs(s-(_+M));if(z>M+d)return!1;if(A<=C||z<=M)return!0;const F=A-C,V=z-M;return F*F+V*V<=d*d}}const $e=Math.tan(85*Math.PI/180);function bt(u,t,s,d,m){const _=a.create$1();if(t){const x=ke([],m);_[0]=x[0],_[1]=x[1],_[4]=x[2],_[5]=x[3],s||a.rotateZ(_,_,d.angle)}else a.multiply(_,d.labelPlaneMatrix,u);return _}function vt(u,t,s,d,m){if(t){const _=a.clone$1(u),x=a.identity([]);return x[0]=m[0],x[1]=m[1],x[4]=m[2],x[5]=m[3],a.multiply(_,_,x),s||a.rotateZ(_,_,-d.angle),_}return d.glCoordMatrix}function ci(u,t,s=0){const d=[u.x,u.y,s,1];s?a.transformMat4(d,d,t):wa(d,d,t);const m=d[3];return{point:new a.pointGeometry(d[0]/m,d[1]/m),signedDistanceFromCamera:m}}function Wr(u,t){return Math.min(.5+u/t*.5,1.5)}function wt(u,t){const s=u[0]/u[3],d=u[1]/u[3];return s>=-t[0]&&s<=t[0]&&d>=-t[1]&&d<=t[1]}function va(u,t,s,d,m,_,x,b,C){const A=d?u.textSizeData:u.iconSizeData,M=a.evaluateSizeForZoom(A,s.transform.zoom),z=[256/s.width*2+1,256/s.height*2+1],F=d?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;F.clear();const V=u.lineVertexArray,$=d?u.text.placedSymbolArray:u.icon.placedSymbolArray,U=s.transform.width/s.transform.height;let W=!1;for(let N=0;N<$.length;N++){const X=$.get(N);if(X.writingMode!==a.WritingMode.vertical||W||N!==0&&$.get(N-1).writingMode===a.WritingMode.horizontal||(W=!0),X.hidden||X.writingMode===a.WritingMode.vertical&&!W){Pn(X.numGlyphs,F);continue}W=!1;const K=new a.pointGeometry(X.tileAnchorX,X.tileAnchorY),j=C?C(K):0,J=[K.x,K.y,j],ne=[...J,1];if(a.transformMat4(ne,ne,t),!wt(ne,z)){Pn(X.numGlyphs,F);continue}const ve=Wr(s.transform.cameraToCenterDistance,ne[3]),xe=a.evaluateSizeForFeature(A,M,X),Ee=x?xe/ve:xe*ve,Se=ci(new a.pointGeometry(J[0],J[1]),m,J[2]);if(Se.signedDistanceFromCamera<=0){Pn(X.numGlyphs,F);continue}let Fe={};const Te=x?null:C,Oe=ln(X,Ee,!1,b,t,m,_,u.glyphOffsetArray,V,F,Se.point,K,Fe,U,Te);W=Oe.useVertical,Te&&Oe.needsFlipping&&(Fe={}),(Oe.notEnoughRoom||W||Oe.needsFlipping&&ln(X,Ee,!0,b,t,m,_,u.glyphOffsetArray,V,F,Se.point,K,Fe,U,Te).notEnoughRoom)&&Pn(X.numGlyphs,F)}d?u.text.dynamicLayoutVertexBuffer.updateData(F):u.icon.dynamicLayoutVertexBuffer.updateData(F)}function So(u,t,s,d,m,_,x,b,C,A,M,z,F){const V=b.glyphStartIndex+b.numGlyphs,$=b.lineStartIndex,U=b.lineStartIndex+b.lineLength,W=t.getoffsetX(b.glyphStartIndex),N=t.getoffsetX(V-1),X=_r(u*W,s,d,m,_,x,b.segment,$,U,C,A,M,z,F,!0);if(!X)return null;const K=_r(u*N,s,d,m,_,x,b.segment,$,U,C,A,M,z,F,!0);return K?{first:X,last:K}:null}function Co(u,t,s,d){return u.writingMode===a.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*d?{useVertical:!0}:u.writingMode===a.WritingMode.vertical?t.y<s.y?{needsFlipping:!0}:null:u.flipState!==0&&function(m,_,x){const b=(_.x-m.x)*x;return b===0||Math.abs((_.y-m.y)/b)>$e}(t,s,d)?u.flipState===1?{needsFlipping:!0}:null:t.x>s.x?{needsFlipping:!0}:null}function ln(u,t,s,d,m,_,x,b,C,A,M,z,F,V,$){const U=t/24,W=u.lineOffsetX*U,N=u.lineOffsetY*U;let X;if(u.numGlyphs>1){const K=u.glyphStartIndex+u.numGlyphs,j=u.lineStartIndex,J=u.lineStartIndex+u.lineLength,ne=So(U,b,W,N,s,M,z,u,C,_,F,$,!1);if(!ne)return{notEnoughRoom:!0};const ve=ci(ne.first.point,x).point,xe=ci(ne.last.point,x).point;if(d&&!s){const Ee=Co(u,ve,xe,V);if(u.flipState=Ee&&Ee.needsFlipping?1:2,Ee)return Ee}X=[ne.first];for(let Ee=u.glyphStartIndex+1;Ee<K-1;Ee++)X.push(_r(U*b.getoffsetX(Ee),W,N,s,M,z,u.segment,j,J,C,_,F,$,!1,!1));X.push(ne.last)}else{if(d&&!s){const j=ci(z,m).point,J=u.lineStartIndex+u.segment+1,ne=new a.pointGeometry(C.getx(J),C.gety(J)),ve=ci(ne,m),xe=Co(u,j,ve.signedDistanceFromCamera>0?ve.point:Ju(z,ne,j,1,m,void 0),V);if(u.flipState=xe&&xe.needsFlipping?1:2,xe)return xe}const K=_r(U*b.getoffsetX(u.glyphStartIndex),W,N,s,M,z,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,C,_,F,$,!1,!1);if(!K)return{notEnoughRoom:!0};X=[K]}for(const K of X)a.addDynamicAttributes(A,K.point,K.angle);return{}}function Kt(u,t,s){const d={x:u.x,y:u.y,z:0};if(!s)return ci(d,t,d.z);const m=s(u);return ci(new a.pointGeometry(d.x,d.y),t,d.z+m)}function Ju(u,t,s,d,m,_){const x=Kt(u.add(u.sub(t)._unit()),m,_).point,b=s.sub(x);return s.add(b._mult(d/b.mag()))}function _r(u,t,s,d,m,_,x,b,C,A,M,z,F,V,$){const U=d?u-t:u+t;let W=U>0?1:-1,N=0;d&&(W*=-1,N=Math.PI),W<0&&(N+=Math.PI);let X=W>0?b+x:b+x+1,K=m,j=m,J=0,ne=0;const ve=Math.abs(U),xe=[],Ee=[];let Se=_;const Fe=()=>{const lt=X-W;return J===0?_:new a.pointGeometry(A.getx(lt),A.gety(lt))},Te=()=>Ju(Fe(),Se,j,ve-J+1,M,F);for(;J+ne<=ve;){if(X+=W,X<b||X>=C)return null;if(j=K,xe.push(K),V&&Ee.push(Se||Fe()),K=z[X],K===void 0){Se=new a.pointGeometry(A.getx(X),A.gety(X));const lt=Kt(Se,M,F);K=lt.signedDistanceFromCamera>0?z[X]=lt.point:Te()}else Se=null;J+=ne,ne=j.dist(K)}$&&F&&(Se=Se||new a.pointGeometry(A.getx(X),A.gety(X)),z[X]=K=z[X]===void 0?K:Te(),ne=j.dist(K));const Oe=(ve-J)/ne,ye=K.sub(j),Ue=ye.mult(Oe)._add(j);s&&Ue._add(ye._unit()._perp()._mult(s*W));const Qe=N+Math.atan2(K.y-j.y,K.x-j.x);return xe.push(Ue),V&&(Se=Se||new a.pointGeometry(A.getx(X),A.gety(X)),Ee.push(function(lt,ut,pt){const ft=1-pt;return new a.pointGeometry(lt.x*ft+ut.x*pt,lt.y*ft+ut.y*pt)}(Ee.length>0?Ee[Ee.length-1]:Se,Se,Oe))),{point:Ue,angle:Qe,path:xe,tilePath:Ee}}const ec=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pn(u,t){for(let s=0;s<u;s++){const d=t.length;t.resize(d+4),t.float32.set(ec,3*d)}}function wa(u,t,s){const d=t[0],m=t[1];return u[0]=s[0]*d+s[4]*m+s[12],u[1]=s[1]*d+s[5]*m+s[13],u[3]=s[3]*d+s[7]*m+s[15],u}const Dn=100;class kt{constructor(t,s,d=new Zn(t.width+200,t.height+200,25),m=new Zn(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Dn,this.screenBottomBoundary=t.height+Dn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,d,m,_,x,b){let C=s.projectedAnchorZ;s.elevation&&(C+=s.elevation);const A=this.projectAndGetPerspectiveRatio(x,s.projectedAnchorX,s.projectedAnchorY,C,s.tileID),M=_*A.perspectiveRatio,z=(s.x1*t+d.x-s.padding)*M+A.point.x,F=(s.y1*t+d.y-s.padding)*M+A.point.y,V=(s.x2*t+d.x+s.padding)*M+A.point.x,$=(s.y2*t+d.y+s.padding)*M+A.point.y,U=A.perspectiveRatio<=.55||A.aboveHorizon;return!this.isInsideGrid(z,F,V,$)||!m&&this.grid.hitTest(z,F,V,$,b)||U?{box:[],offscreen:!1}:{box:[z,F,V,$],offscreen:this.isOffscreen(z,F,V,$)}}placeCollisionCircles(t,s,d,m,_,x,b,C,A,M,z,F,V,$){const U=[],W=this.transform.elevation,N=W?Te=>W.getAtTileOffset($,Te.x,Te.y):Te=>0,X=new a.pointGeometry(s.tileAnchorX,s.tileAnchorY),K=N(X),j=this.projectAndGetPerspectiveRatio(x,X.x,X.y,K,$),{perspectiveRatio:J}=j,ne=(M?_/J:_*J)/a.ONE_EM,ve=ci(X,b,K).point,xe=j.signedDistanceFromCamera>0?So(ne,m,s.lineOffsetX*ne,s.lineOffsetY*ne,!1,ve,X,s,d,b,{},W&&!M?N:null,M&&!!W):null;let Ee=!1,Se=!1,Fe=!0;if(xe&&!j.aboveHorizon){const Te=.5*F*J+V,Oe=new a.pointGeometry(-100,-100),ye=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ue=new qr,Qe=xe.first,lt=xe.last;let ut=[];for(let st=Qe.path.length-1;st>=1;st--)ut.push(Qe.path[st]);for(let st=1;st<lt.path.length;st++)ut.push(lt.path[st]);const pt=2.5*Te;if(C){const st=ut.map(W?(_t,Bt)=>{const fi=N(Bt<Qe.path.length-1?Qe.tilePath[Qe.path.length-1-Bt]:lt.tilePath[Bt-Qe.path.length+2]);return ci(_t,C,fi)}:_t=>ci(_t,C));ut=st.some(_t=>_t.signedDistanceFromCamera<=0)?[]:st.map(_t=>_t.point)}let ft=[];if(ut.length>0){const st=ut[0].clone(),_t=ut[0].clone();for(let Bt=1;Bt<ut.length;Bt++)st.x=Math.min(st.x,ut[Bt].x),st.y=Math.min(st.y,ut[Bt].y),_t.x=Math.max(_t.x,ut[Bt].x),_t.y=Math.max(_t.y,ut[Bt].y);ft=st.x>=Oe.x&&_t.x<=ye.x&&st.y>=Oe.y&&_t.y<=ye.y?[ut]:_t.x<Oe.x||st.x>ye.x||_t.y<Oe.y||st.y>ye.y?[]:a.clipLine([ut],Oe.x,Oe.y,ye.x,ye.y)}for(const st of ft){Ue.reset(st,.25*Te);let _t=0;_t=Ue.length<=.5*Te?1:Math.ceil(Ue.paddedLength/pt)+1;for(let Bt=0;Bt<_t;Bt++){const fi=Bt/Math.max(_t-1,1),Ai=Ue.lerp(fi),Fi=Ai.x+Dn,Zi=Ai.y+Dn;U.push(Fi,Zi,Te,0);const mi=Fi-Te,rr=Zi-Te,Wn=Fi+Te,Wt=Zi+Te;if(Fe=Fe&&this.isOffscreen(mi,rr,Wn,Wt),Se=Se||this.isInsideGrid(mi,rr,Wn,Wt),!t&&this.grid.hitTestCircle(Fi,Zi,Te,z)&&(Ee=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Ee}}}}return{circles:!A&&Ee||!Se?[]:U,offscreen:Fe,collisionDetected:Ee}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let d=1/0,m=1/0,_=-1/0,x=-1/0;for(const M of t){const z=new a.pointGeometry(M.x+Dn,M.y+Dn);d=Math.min(d,z.x),m=Math.min(m,z.y),_=Math.max(_,z.x),x=Math.max(x,z.y),s.push(z)}const b=this.grid.query(d,m,_,x).concat(this.ignoredGrid.query(d,m,_,x)),C={},A={};for(const M of b){const z=M.key;if(C[z.bucketInstanceId]===void 0&&(C[z.bucketInstanceId]={}),C[z.bucketInstanceId][z.featureIndex])continue;const F=[new a.pointGeometry(M.x1,M.y1),new a.pointGeometry(M.x2,M.y1),new a.pointGeometry(M.x2,M.y2),new a.pointGeometry(M.x1,M.y2)];a.polygonIntersectsPolygon(s,F)&&(C[z.bucketInstanceId][z.featureIndex]=!0,A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(t,s,d,m,_){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:m,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,d,m,_){const x=s?this.ignoredGrid:this.grid,b={bucketInstanceId:d,featureIndex:m,collisionGroupID:_};for(let C=0;C<t.length;C+=4)x.insertCircle(b,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,s,d,m,_){const x=[s,d,m||0,1];let b=!1;if(m||this.transform.pitch>0){a.transformMat4(x,x,t);let C=!1;this.fogState&&_&&(C=function(A,M,z,F,V,$){const U=$.calculateFogTileMatrix(V),W=[M,z,F];return a.transformMat4$1(W,W,U),on(A,W,$.pitch,$._fov)}(this.fogState,s,d,m||0,_.toUnwrapped(),this.transform)>.9),b=x[2]>x[3]||C}else wa(x,x,t);return{point:new a.pointGeometry((x[0]/x[3]+1)/2*this.transform.width+Dn,(-x[1]/x[3]+1)/2*this.transform.height+Dn),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/x[3]*.5,1.5),signedDistanceFromCamera:x[3],aboveHorizon:b}}isOffscreen(t,s,d,m){return d<Dn||t>=this.screenRightBoundary||m<Dn||s>this.screenBottomBoundary}isInsideGrid(t,s,d,m){return d>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=a.identity([]);return a.translate(t,t,[-100,-100,0]),t}}class ba{constructor(t,s,d,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Xr{constructor(t,s,d,m,_,x=!1){this.text=new ba(t?t.text:null,s,d,_),this.icon=new ba(t?t.icon:null,s,m,_),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Li{constructor(t,s,d,m=!1){this.text=t,this.icon=s,this.skipFade=d,this.clipped=m}}class vn{constructor(){this.invProjMatrix=a.create$1(),this.viewportMatrix=a.create$1(),this.circles=[]}}class Qu{constructor(t,s,d,m,_){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=_}}class Ta{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:d=>d.collisionGroupID===s}}return this.collisionGroups[t]}}function ui(u,t,s,d,m){const{horizontalAlign:_,verticalAlign:x}=a.getAnchorAlignment(u),b=-(_-.5)*t,C=-(x-.5)*s,A=a.evaluateVariableOffset(u,d);return new a.pointGeometry(b+A[0]*m,C+A[1]*m)}function Hr(u,t,s,d,m){const _=new a.pointGeometry(u,t);return s&&_._rotate(d?m:-m),_}class Yr{constructor(t,s,d,m,_){this.transform=t.clone(),this.collisionIndex=new kt(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Ta(d),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,d,m){const _=d.getBucket(s),x=d.latestFeatureIndex;if(!_||!x||s.id!==_.layerIds[0])return;const b=_.layers[0].layout,C=d.collisionBoxArray,A=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),M=d.tileSize/a.EXTENT,z=d.tileID.toUnwrapped(),F=this.transform.calculateProjMatrix(z),V=b.get("text-pitch-alignment")==="map",$=b.get("text-rotation-alignment")==="map";s.compileFilter();const U=s.dynamicFilter(),W=s.dynamicFilterNeedsFeature(),N=this.transform.calculatePixelsToTileUnitsMatrix(d),X=bt(F,V,$,this.transform,N);let K=null;if(V){const ne=vt(F,V,$,this.transform,N);K=a.multiply([],this.transform.labelPlaneMatrix,ne)}let j=null;U&&d.latestFeatureIndex&&(j={unwrappedTileID:z,dynamicFilter:U,dynamicFilterNeedsFeature:W,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new Qu(_.bucketInstanceId,x,_.sourceLayerIndex,_.index,d.tileID);const J={bucket:_,layout:b,posMatrix:F,textLabelPlaneMatrix:X,labelToScreenMatrix:K,clippingData:j,scale:A,textPixelRatio:M,holdingForFade:d.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(m)for(const ne of _.sortKeyRanges){const{sortKey:ve,symbolInstanceStart:xe,symbolInstanceEnd:Ee}=ne;t.push({sortKey:ve,symbolInstanceStart:xe,symbolInstanceEnd:Ee,parameters:J})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:J})}attemptAnchorPlacement(t,s,d,m,_,x,b,C,A,M,z,F,V,$,U,W,N,X){const K=[F.textOffset0,F.textOffset1],j=ui(t,d,m,K,_),J=this.collisionIndex.placeCollisionBox(_,s,Hr(j.x,j.y,x,b,this.transform.angle),z,C,A,M.predicate);if((!W||this.collisionIndex.placeCollisionBox($.getSymbolInstanceIconSize(X,this.transform.zoom,V),W,Hr(j.x,j.y,x,b,this.transform.angle),z,C,A,M.predicate).box.length!==0)&&J.box.length>0){let ne;return this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(ne=this.prevPlacement.variableOffsets[F.crossTileID].anchor),this.variableOffsets[F.crossTileID]={textOffset:K,width:d,height:m,anchor:t,textScale:_,prevAnchor:ne},this.markUsedJustification($,t,F,U),$.allowVerticalPlacement&&(this.markUsedOrientation($,U,F),this.placedOrientations[F.crossTileID]=U),{shift:j,placedGlyphBoxes:J}}}placeLayerBucketPart(t,s,d,m){const{bucket:_,layout:x,posMatrix:b,textLabelPlaneMatrix:C,labelToScreenMatrix:A,clippingData:M,textPixelRatio:z,holdingForFade:F,collisionBoxArray:V,partiallyEvaluatedTextSize:$,partiallyEvaluatedIconSize:U,collisionGroup:W}=t.parameters,N=x.get("text-optional"),X=x.get("icon-optional"),K=x.get("text-allow-overlap"),j=x.get("icon-allow-overlap"),J=x.get("text-rotation-alignment")==="map",ne=x.get("text-pitch-alignment")==="map",ve=x.get("icon-text-fit")!=="none",xe=x.get("symbol-z-order")==="viewport-y",Ee=K&&(j||!_.hasIconData()||X),Se=j&&(K||!_.hasTextData()||N);!_.collisionArrays&&V&&_.deserializeCollisionBoxes(V),d&&m&&_.updateCollisionDebugBuffers(this.transform.zoom,V);const Fe=(Te,Oe,ye)=>{if(M){const Wt={zoom:this.transform.zoom,pitch:this.transform.pitch};let si=null;if(M.dynamicFilterNeedsFeature){const It=this.retainedQueryData[_.bucketInstanceId];si=M.featureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:It.bucketIndex,sourceLayerIndex:It.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,M.dynamicFilter)(Wt,si,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new a.pointGeometry(Te.tileAnchorX,Te.tileAnchorY),this.transform.calculateDistanceTileData(M.unwrappedTileID)))return this.placements[Te.crossTileID]=new Li(!1,!1,!1,!0),void(s[Te.crossTileID]=!0)}if(s[Te.crossTileID])return;if(F)return void(this.placements[Te.crossTileID]=new Li(!1,!1,!1));let Ue=!1,Qe=!1,lt=!0,ut=null,pt={box:null,offscreen:null},ft={box:null,offscreen:null},st=null,_t=null,Bt=null,fi=0,Ai=0,Fi=0;ye.textFeatureIndex?fi=ye.textFeatureIndex:Te.useRuntimeCollisionCircles&&(fi=Te.featureIndex),ye.verticalTextFeatureIndex&&(Ai=ye.verticalTextFeatureIndex);const Zi=Wt=>{Wt.tileID=this.retainedQueryData[_.bucketInstanceId].tileID,(this.transform.elevation||Wt.elevation)&&(Wt.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[_.bucketInstanceId].tileID,Wt.tileAnchorX,Wt.tileAnchorY):0)},mi=ye.textBox;if(mi){Zi(mi);const Wt=It=>{let Ht=a.WritingMode.horizontal;if(_.allowVerticalPlacement&&!It&&this.prevPlacement){const Mi=this.prevPlacement.placedOrientations[Te.crossTileID];Mi&&(this.placedOrientations[Te.crossTileID]=Mi,Ht=Mi,this.markUsedOrientation(_,Ht,Te))}return Ht},si=(It,Ht)=>{if(_.allowVerticalPlacement&&Te.numVerticalGlyphVertices>0&&ye.verticalTextBox){for(const Mi of _.writingModes)if(Mi===a.WritingMode.vertical?(pt=Ht(),ft=pt):pt=It(),pt&&pt.box&&pt.box.length)break}else pt=It()};if(x.get("text-variable-anchor")){let It=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Te.crossTileID]){const Xt=this.prevPlacement.variableOffsets[Te.crossTileID];It.indexOf(Xt.anchor)>0&&(It=It.filter(un=>un!==Xt.anchor),It.unshift(Xt.anchor))}const Ht=(Xt,un,qs)=>{const Ji=_.getSymbolInstanceTextSize($,Te,this.transform.zoom,Oe),Ir=(Xt.x2-Xt.x1)*Ji+2*Xt.padding,jh=(Xt.y2-Xt.y1)*Ji+2*Xt.padding,rl=ve&&!j?un:null;rl&&Zi(rl);let jo={box:[],offscreen:!1};const $h=K?2*It.length:It.length;for(let Ws=0;Ws<$h;++Ws){const ol=this.attemptAnchorPlacement(It[Ws%It.length],Xt,Ir,jh,Ji,J,ne,z,b,W,Ws>=It.length,Te,Oe,_,qs,rl,$,U);if(ol&&(jo=ol.placedGlyphBoxes,jo&&jo.box&&jo.box.length)){Ue=!0,ut=ol.shift;break}}return jo};si(()=>Ht(mi,ye.iconBox,a.WritingMode.horizontal),()=>{const Xt=ye.verticalTextBox;return Xt&&Zi(Xt),_.allowVerticalPlacement&&!(pt&&pt.box&&pt.box.length)&&Te.numVerticalGlyphVertices>0&&Xt?Ht(Xt,ye.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),pt&&(Ue=pt.box,lt=pt.offscreen);const Mi=Wt(pt&&pt.box);if(!Ue&&this.prevPlacement){const Xt=this.prevPlacement.variableOffsets[Te.crossTileID];Xt&&(this.variableOffsets[Te.crossTileID]=Xt,this.markUsedJustification(_,Xt.anchor,Te,Mi))}}else{const It=(Ht,Mi)=>{const Xt=_.getSymbolInstanceTextSize($,Te,this.transform.zoom,Oe),un=this.collisionIndex.placeCollisionBox(Xt,Ht,new a.pointGeometry(0,0),K,z,b,W.predicate);return un&&un.box&&un.box.length&&(this.markUsedOrientation(_,Mi,Te),this.placedOrientations[Te.crossTileID]=Mi),un};si(()=>It(mi,a.WritingMode.horizontal),()=>{const Ht=ye.verticalTextBox;return _.allowVerticalPlacement&&Te.numVerticalGlyphVertices>0&&Ht?(Zi(Ht),It(Ht,a.WritingMode.vertical)):{box:null,offscreen:null}}),Wt(pt&&pt.box&&pt.box.length)}}if(st=pt,Ue=st&&st.box&&st.box.length>0,lt=st&&st.offscreen,Te.useRuntimeCollisionCircles){const Wt=_.text.placedSymbolArray.get(Te.centerJustifiedTextSymbolIndex>=0?Te.centerJustifiedTextSymbolIndex:Te.verticalPlacedTextSymbolIndex),si=a.evaluateSizeForFeature(_.textSizeData,$,Wt),It=x.get("text-padding");_t=this.collisionIndex.placeCollisionCircles(K,Wt,_.lineVertexArray,_.glyphOffsetArray,si,b,C,A,d,ne,W.predicate,Te.collisionCircleDiameter*si/a.ONE_EM,It,this.retainedQueryData[_.bucketInstanceId].tileID),Ue=K||_t.circles.length>0&&!_t.collisionDetected,lt=lt&&_t.offscreen}if(ye.iconFeatureIndex&&(Fi=ye.iconFeatureIndex),ye.iconBox){const Wt=si=>{Zi(si);const It=ve&&ut?Hr(ut.x,ut.y,J,ne,this.transform.angle):new a.pointGeometry(0,0),Ht=_.getSymbolInstanceIconSize(U,this.transform.zoom,Oe);return this.collisionIndex.placeCollisionBox(Ht,si,It,j,z,b,W.predicate)};ft&&ft.box&&ft.box.length&&ye.verticalIconBox?(Bt=Wt(ye.verticalIconBox),Qe=Bt.box.length>0):(Bt=Wt(ye.iconBox),Qe=Bt.box.length>0),lt=lt&&Bt.offscreen}const rr=N||Te.numHorizontalGlyphVertices===0&&Te.numVerticalGlyphVertices===0,Wn=X||Te.numIconVertices===0;if(rr||Wn?Wn?rr||(Qe=Qe&&Ue):Ue=Qe&&Ue:Qe=Ue=Qe&&Ue,Ue&&st&&st.box&&this.collisionIndex.insertCollisionBox(st.box,x.get("text-ignore-placement"),_.bucketInstanceId,ft&&ft.box&&Ai?Ai:fi,W.ID),Qe&&Bt&&this.collisionIndex.insertCollisionBox(Bt.box,x.get("icon-ignore-placement"),_.bucketInstanceId,Fi,W.ID),_t&&(Ue&&this.collisionIndex.insertCollisionCircles(_t.circles,x.get("text-ignore-placement"),_.bucketInstanceId,fi,W.ID),d)){const Wt=_.bucketInstanceId;let si=this.collisionCircleArrays[Wt];si===void 0&&(si=this.collisionCircleArrays[Wt]=new vn);for(let It=0;It<_t.circles.length;It+=4)si.circles.push(_t.circles[It+0]),si.circles.push(_t.circles[It+1]),si.circles.push(_t.circles[It+2]),si.circles.push(_t.collisionDetected?1:0)}this.placements[Te.crossTileID]=new Li(Ue||Ee,Qe||Se,lt||_.justReloaded),s[Te.crossTileID]=!0};if(xe){const Te=_.getSortedSymbolIndexes(this.transform.angle);for(let Oe=Te.length-1;Oe>=0;--Oe){const ye=Te[Oe];Fe(_.symbolInstances.get(ye),ye,_.collisionArrays[ye])}}else for(let Te=t.symbolInstanceStart;Te<t.symbolInstanceEnd;Te++)Fe(_.symbolInstances.get(Te),Te,_.collisionArrays[Te]);if(d&&_.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[_.bucketInstanceId];a.invert(Te.invProjMatrix,b),Te.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(t,s,d,m){let _;_=m===a.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(s)];const x=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const b of x)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=_>=0&&b!==_?0:d.crossTileID)}markUsedOrientation(t,s,d){const m=s===a.WritingMode.horizontal||s===a.WritingMode.horizontalOnly?s:0,_=s===a.WritingMode.vertical?s:0,x=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const b of x)t.text.placedSymbolArray.get(b).placedOrientation=m;d.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let d=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,_=s?s.opacities:{},x=s?s.variableOffsets:{},b=s?s.placedOrientations:{};for(const C in this.placements){const A=this.placements[C],M=_[C];M?(this.opacities[C]=new Xr(M,m,A.text,A.icon,null,A.clipped),d=d||A.text!==M.text.placed||A.icon!==M.icon.placed):(this.opacities[C]=new Xr(null,m,A.text,A.icon,A.skipFade,A.clipped),d=d||A.text||A.icon)}for(const C in _){const A=_[C];if(!this.opacities[C]){const M=new Xr(A,m,!1,!1);M.isHidden()||(this.opacities[C]=M,d=d||A.text.placed||A.icon.placed)}}for(const C in x)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=x[C]);for(const C in b)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=b[C]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const d={};for(const m of s){const _=m.getBucket(t);_&&m.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,d,m.collisionBoxArray)}}updateBucketOpacities(t,s,d){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const m=t.layers[0].layout,_=!!t.layers[0].dynamicFilter(),x=new Xr(null,0,!1,!1,!0),b=m.get("text-allow-overlap"),C=m.get("icon-allow-overlap"),A=m.get("text-variable-anchor"),M=m.get("text-rotation-alignment")==="map",z=m.get("text-pitch-alignment")==="map",F=m.get("icon-text-fit")!=="none",V=new Xr(null,0,b&&(C||!t.hasIconData()||m.get("icon-optional")),C&&(b||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&d&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(d);const $=(U,W,N)=>{for(let X=0;X<W/4;X++)U.opacityVertexArray.emplaceBack(N)};for(let U=0;U<t.symbolInstances.length;U++){const W=t.symbolInstances.get(U),{numHorizontalGlyphVertices:N,numVerticalGlyphVertices:X,crossTileID:K}=W;let j=this.opacities[K];s[K]?j=x:j||(j=V,this.opacities[K]=j),s[K]=!0;const J=W.numIconVertices>0,ne=this.placedOrientations[W.crossTileID],ve=ne===a.WritingMode.vertical,xe=ne===a.WritingMode.horizontal||ne===a.WritingMode.horizontalOnly;if(N>0||X>0){const Ee=ic(j.text);$(t.text,N,ve?Ri:Ee),$(t.text,X,xe?Ri:Ee);const Se=j.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(Oe=>{Oe>=0&&(t.text.placedSymbolArray.get(Oe).hidden=Se||ve?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=Se||xe?1:0);const Fe=this.variableOffsets[W.crossTileID];Fe&&this.markUsedJustification(t,Fe.anchor,W,ne);const Te=this.placedOrientations[W.crossTileID];Te&&(this.markUsedJustification(t,"left",W,Te),this.markUsedOrientation(t,Te,W))}if(J){const Ee=ic(j.icon);W.placedIconSymbolIndex>=0&&($(t.icon,W.numIconVertices,ve?Ri:Ee),t.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=j.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&($(t.icon,W.numVerticalIconVertices,xe?Ri:Ee),t.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=j.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ee=t.collisionArrays[U];if(Ee){let Se=new a.pointGeometry(0,0),Fe=!0;if(Ee.textBox||Ee.verticalTextBox){if(A){const Oe=this.variableOffsets[K];Oe?(Se=ui(Oe.anchor,Oe.width,Oe.height,Oe.textOffset,Oe.textScale),M&&Se._rotate(z?this.transform.angle:-this.transform.angle)):Fe=!1}_&&(Fe=!j.clipped),Ee.textBox&&pi(t.textCollisionBox.collisionVertexArray,j.text.placed,!Fe||ve,Se.x,Se.y),Ee.verticalTextBox&&pi(t.textCollisionBox.collisionVertexArray,j.text.placed,!Fe||xe,Se.x,Se.y)}const Te=Fe&&Boolean(!xe&&Ee.verticalIconBox);Ee.iconBox&&pi(t.iconCollisionBox.collisionVertexArray,j.icon.placed,Te,F?Se.x:0,F?Se.y:0),Ee.verticalIconBox&&pi(t.iconCollisionBox.collisionVertexArray,j.icon.placed,!Te,F?Se.x:0,F?Se.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const U=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=U.invProjMatrix,t.placementViewportMatrix=U.viewportMatrix,t.collisionCircleArray=U.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const d=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function pi(u,t,s,d,m){u.emplaceBack(t?1:0,s?1:0,d||0,m||0),u.emplaceBack(t?1:0,s?1:0,d||0,m||0),u.emplaceBack(t?1:0,s?1:0,d||0,m||0),u.emplaceBack(t?1:0,s?1:0,d||0,m||0)}const tc=Math.pow(2,25),Ln=Math.pow(2,24),Cs=Math.pow(2,17),Ea=Math.pow(2,16),Mp=Math.pow(2,9),gr=Math.pow(2,8),kp=Math.pow(2,1);function ic(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,s=Math.floor(127*u.opacity);return s*tc+t*Ln+s*Cs+t*Ea+s*Mp+t*gr+s*kp+t}const Ri=0;class Sa{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,d,m,_){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(x,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((b,C)=>b.sortKey-C.sortKey));this._currentPartIndex<x.length;){const b=x[this._currentPartIndex];if(s.placeLayerBucketPart(b,this._seenCrossTileIDs,d,b.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class yr{constructor(t,s,d,m,_,x,b,C){this.placement=new Yr(t,_,x,b,C),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,s,d){const m=a.exported.now(),_=()=>{const x=a.exported.now()-m;return!this._forceFullPlacement&&x>2};for(;this._currentPlacementIndex>=0;){const x=s[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=b)&&(!x.maxzoom||x.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Sa(x)),this._inProgressLayer.continuePlacement(d[x.source],this.placement,this._showCollisionBoxes,x,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const nc=512/a.EXTENT/2;class Ca{constructor(t,s,d){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(let m=0;m<s.length;m++){const _=s.get(m),x=_.key;this.indexedSymbolInstances[x]||(this.indexedSymbolInstances[x]=[]),this.indexedSymbolInstances[x].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,t)})}}getScaledCoordinates(t,s){const d=nc/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*a.EXTENT+t.tileAnchorX)*d),y:Math.floor((s.canonical.y*a.EXTENT+t.tileAnchorY)*d)}}findMatches(t,s,d){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let _=0;_<t.length;_++){const x=t.get(_);if(x.crossTileID)continue;const b=this.indexedSymbolInstances[x.key];if(!b)continue;const C=this.getScaledCoordinates(x,s);for(const A of b)if(Math.abs(A.coord.x-C.x)<=m&&Math.abs(A.coord.y-C.y)<=m&&!d[A.crossTileID]){d[A.crossTileID]=!0,x.crossTileID=A.crossTileID;break}}}}class zp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Pp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const d in this.indexes){const m=this.indexes[d],_={};for(const x in m){const b=m[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),_[b.tileID.key]=b}this.indexes[d]=_}this.lng=t}addBucket(t,s,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<s.symbolInstances.length;_++)s.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const x=this.indexes[_];if(Number(_)>t.overscaledZ)for(const b in x){const C=x[b];C.tileID.isChildOf(t)&&C.findMatches(s.symbolInstances,t,m)}else{const b=x[t.scaledTo(Number(_)).key];b&&b.findMatches(s.symbolInstances,t,m)}}for(let _=0;_<s.symbolInstances.length;_++){const x=s.symbolInstances.get(_);x.crossTileID||(x.crossTileID=d.generate(),m[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ca(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const d in s.indexedSymbolInstances)for(const m of s.indexedSymbolInstances[d])delete this.usedCrossTileIDs[t][m.crossTileID]}removeStaleBuckets(t){let s=!1;for(const d in this.indexes){const m=this.indexes[d];for(const _ in m)t[m[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[_]),delete m[_],s=!0)}return s}}class Ia{constructor(){this.layerIndexes={},this.crossTileIDs=new zp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,d){let m=this.layerIndexes[t.id];m===void 0&&(m=this.layerIndexes[t.id]=new Pp);let _=!1;const x={};m.handleWrapJump(d);for(const b of s){const C=b.getBucket(t);C&&t.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(b.tileID,C,this.crossTileIDs)&&(_=!0),x[C.bucketInstanceId]=!0)}return m.removeStaleBuckets(x)&&(_=!0),_}pruneUnusedLayers(t){const s={};t.forEach(d=>{s[d]=!0});for(const d in this.layerIndexes)s[d]||delete this.layerIndexes[d]}}const Aa=(u,t)=>a.emitValidationErrors(u,t&&t.filter(s=>s.identifier!=="source.canvas")),eh=a.pick(Ne,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Dp=a.pick(Ne,["setCenter","setZoom","setBearing","setPitch"]),th=function(){const u={},t=a.spec.$version;for(const s in a.spec.$root){const d=a.spec.$root[s];if(d.required){let m=null;m=s==="version"?t:d.type==="array"?[]:{},m!=null&&(u[s]=m)}}return u}(),Lp={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class wn extends a.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new mn(je(),this),this.imageManager=new dt,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(t._requestManager,s.localFontFamily?a.LocalGlyphMode.all:s.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.lineAtlas=new a.LineAtlas(256,512),this.crossTileSymbolIndex=new Ia,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const d=this;this._rtlTextPluginCallback=wn.registerForPluginStateChange(m=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(_,x)=>{if(a.triggerPluginCompletionEvent(_),x&&x.every(b=>b))for(const b in d._sourceCaches){const C=d._sourceCaches[b],A=C.getSource().type;A!=="vector"&&A!=="geojson"||C.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const _=this.getSource(m.sourceId);if(_&&_.vectorLayerIds)for(const x in this._layers){const b=this._layers[x];b.source===_.id&&this._validateLayer(b)}})}loadURL(t,s={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const d=typeof s.validate=="boolean"?s.validate:!a.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,s.accessToken);const m=this.map._requestManager.transformRequest(t,a.ResourceType.Style);this._request=a.getJSON(m,(_,x)=>{this._request=null,_?this.fire(new a.ErrorEvent(_)):x&&this._load(x,d)})}loadJSON(t,s={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(th,!1)}_updateLayerCount(t,s){const d=s?1:-1;t.is3D()&&(this._num3DLayers+=d),t.type==="circle"&&(this._numCircleLayers+=d),t.type==="symbol"&&(this._numSymbolLayers+=d)}_load(t,s){if(s&&Aa(this,a.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t,this.updateProjection();for(const m in t.sources)this.addSource(m,t.sources[m],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const d=et(this.stylesheet.layers);this._order=d.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of d)m=a.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Yt(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const t=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0));if(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),t){this.map.painter.clearBackgroundTiles();for(const s in this._sourceCaches)this._sourceCaches[s].clearTiles();this.map._update(!0)}}_loadSprite(t){this._spriteRequest=function(s,d,m){let _,x,b;const C=a.exported.devicePixelRatio>1?"@2x":"";let A=a.getJSON(d.transformRequest(d.normalizeSpriteURL(s,C,".json"),a.ResourceType.SpriteJSON),(F,V)=>{A=null,b||(b=F,_=V,z())}),M=a.getImage(d.transformRequest(d.normalizeSpriteURL(s,C,".png"),a.ResourceType.SpriteImage),(F,V)=>{M=null,b||(b=F,x=V,z())});function z(){if(b)m(b);else if(_&&x){const F=a.exported.getImageData(x),V={};for(const $ in _){const{width:U,height:W,x:N,y:X,sdf:K,pixelRatio:j,stretchX:J,stretchY:ne,content:ve}=_[$],xe=new a.RGBAImage({width:U,height:W});a.RGBAImage.copy(F,xe,{x:N,y:X},{x:0,y:0},{width:U,height:W}),V[$]={data:xe,pixelRatio:j,sdf:K,stretchX:J,stretchY:ne,content:ve}}m(null,V)}}return{cancel(){A&&(A.cancel(),A=null),M&&(M.cancel(),M=null)}}}(t,this.map._requestManager,(s,d)=>{if(this._spriteRequest=null,s)this.fire(new a.ErrorEvent(s));else if(d)for(const m in d)this.imageManager.addImage(m,d[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(t){const s=this.getSource(t.source);if(!s)return;const d=t.sourceLayer;d&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(d)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${d}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const s=[];for(const d of t){const m=this._layers[d];m.type!=="custom"&&s.push(m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Lp[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(m.length||_.length)&&this._updateWorkerLayers(m,_);for(const x in this._updatedSources){const b=this._updatedSources[x];b==="reload"?this._reloadSource(x):b==="clear"&&this._clearSource(x)}this._updateTilesForChangedImages();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const d={};for(const m in this._sourceCaches){const _=this._sourceCaches[m];d[m]=_.used,_.used=!1}for(const m of this._order){const _=this._layers[m];if(_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)){const b=this._getLayerSourceCache(_);b&&(b.used=!0)}const x=this.map.painter;if(x){const b=_.getProgramIds();if(!b)continue;const C=_.getProgramConfiguration(t.zoom);for(const A of b)x.useProgram(A,C)}}for(const m in d){const _=this._sourceCaches[m];d[m]!==_.used&&_.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),Aa(this,a.validateStyle(t)))return!1;(t=a.clone$2(t)).layers=et(t.layers);const s=function(m,_){if(!m)return[{command:Ne.setStyle,args:[_]}];let x=[];try{if(!_e(m.version,_.version))return[{command:Ne.setStyle,args:[_]}];_e(m.center,_.center)||x.push({command:Ne.setCenter,args:[_.center]}),_e(m.zoom,_.zoom)||x.push({command:Ne.setZoom,args:[_.zoom]}),_e(m.bearing,_.bearing)||x.push({command:Ne.setBearing,args:[_.bearing]}),_e(m.pitch,_.pitch)||x.push({command:Ne.setPitch,args:[_.pitch]}),_e(m.sprite,_.sprite)||x.push({command:Ne.setSprite,args:[_.sprite]}),_e(m.glyphs,_.glyphs)||x.push({command:Ne.setGlyphs,args:[_.glyphs]}),_e(m.transition,_.transition)||x.push({command:Ne.setTransition,args:[_.transition]}),_e(m.light,_.light)||x.push({command:Ne.setLight,args:[_.light]}),_e(m.fog,_.fog)||x.push({command:Ne.setFog,args:[_.fog]}),_e(m.projection,_.projection)||x.push({command:Ne.setProjection,args:[_.projection]});const b={},C=[];(function(z,F,V,$){let U;for(U in F=F||{},z=z||{})z.hasOwnProperty(U)&&(F.hasOwnProperty(U)||be(U,V,$));for(U in F)F.hasOwnProperty(U)&&(z.hasOwnProperty(U)?_e(z[U],F[U])||(z[U].type==="geojson"&&F[U].type==="geojson"&&Rt(z,F,U)?V.push({command:Ne.setGeoJSONSourceData,args:[U,F[U].data]}):Tt(U,F,V,$)):le(U,F,V))})(m.sources,_.sources,C,b);const A=[];m.layers&&m.layers.forEach(z=>{b[z.source]?x.push({command:Ne.removeLayer,args:[z.id]}):A.push(z)});let M=m.terrain;M&&b[M.source]&&(x.push({command:Ne.setTerrain,args:[void 0]}),M=void 0),x=x.concat(C),_e(M,_.terrain)||x.push({command:Ne.setTerrain,args:[_.terrain]}),function(z,F,V){F=F||[];const $=(z=z||[]).map(St),U=F.map(St),W=z.reduce(Mt,{}),N=F.reduce(Mt,{}),X=$.slice(),K=Object.create(null);let j,J,ne,ve,xe,Ee,Se;for(j=0,J=0;j<$.length;j++)ne=$[j],N.hasOwnProperty(ne)?J++:(V.push({command:Ne.removeLayer,args:[ne]}),X.splice(X.indexOf(ne,J),1));for(j=0,J=0;j<U.length;j++)ne=U[U.length-1-j],X[X.length-1-j]!==ne&&(W.hasOwnProperty(ne)?(V.push({command:Ne.removeLayer,args:[ne]}),X.splice(X.lastIndexOf(ne,X.length-J),1)):J++,Ee=X[X.length-j],V.push({command:Ne.addLayer,args:[N[ne],Ee]}),X.splice(X.length-j,0,ne),K[ne]=!0);for(j=0;j<U.length;j++)if(ne=U[j],ve=W[ne],xe=N[ne],!K[ne]&&!_e(ve,xe))if(_e(ve.source,xe.source)&&_e(ve["source-layer"],xe["source-layer"])&&_e(ve.type,xe.type)){for(Se in mt(ve.layout,xe.layout,V,ne,null,Ne.setLayoutProperty),mt(ve.paint,xe.paint,V,ne,null,Ne.setPaintProperty),_e(ve.filter,xe.filter)||V.push({command:Ne.setFilter,args:[ne,xe.filter]}),_e(ve.minzoom,xe.minzoom)&&_e(ve.maxzoom,xe.maxzoom)||V.push({command:Ne.setLayerZoomRange,args:[ne,xe.minzoom,xe.maxzoom]}),ve)ve.hasOwnProperty(Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?mt(ve[Se],xe[Se],V,ne,Se.slice(6),Ne.setPaintProperty):_e(ve[Se],xe[Se])||V.push({command:Ne.setLayerProperty,args:[ne,Se,xe[Se]]}));for(Se in xe)xe.hasOwnProperty(Se)&&!ve.hasOwnProperty(Se)&&Se!=="layout"&&Se!=="paint"&&Se!=="filter"&&Se!=="metadata"&&Se!=="minzoom"&&Se!=="maxzoom"&&(Se.indexOf("paint.")===0?mt(ve[Se],xe[Se],V,ne,Se.slice(6),Ne.setPaintProperty):_e(ve[Se],xe[Se])||V.push({command:Ne.setLayerProperty,args:[ne,Se,xe[Se]]}))}else V.push({command:Ne.removeLayer,args:[ne]}),Ee=X[X.lastIndexOf(ne)+1],V.push({command:Ne.addLayer,args:[xe,Ee]})}(A,_.layers,x)}catch(b){console.warn("Unable to compute style diff:",b),x=[{command:Ne.setStyle,args:[_]}]}return x}(this.serialize(),t).filter(m=>!(m.command in Dp));if(s.length===0)return!1;const d=s.filter(m=>!(m.command in eh));if(d.length>0)throw new Error(`Unimplemented: ${d.map(m=>m.command).join(", ")}.`);return s.forEach(m=>{m.command!=="setTransition"&&this[m.command].apply(this,m.args)}),this.stylesheet=t,!0}addImage(t,s){if(this.getImage(t))return this.fire(new a.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,s,d={}){if(this._checkLoaded(),this.getSource(t)!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(a.validateStyle.source,`sources.${t}`,s,null,d))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=R(t,s,this.dispatcher,this);m.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:m.serialize(),sourceId:t}));const _=x=>{const b=(x?"symbol:":"other:")+t,C=this._sourceCaches[b]=new a.SourceCache(b,m,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[t]=C,C.style=this,C.onAdd(this.map)};_(!1),s.type!=="vector"&&s.type!=="geojson"||_(!0),m.onAdd&&m.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const s=this.getSource(t);if(s===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const d=this._getSourceCaches(t);for(const m of d)delete this._sourceCaches[m.id],delete this._updatedSources[m.id],m.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles();delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getSource(t).setData(s),this._changed=!0}getSource(t){const s=this._getSourceCache(t);return s&&s.getSource()}addLayer(t,s,d={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${m}" already exists on this map`)));let _;if(t.type==="custom"){if(Aa(this,a.validateCustomStyleLayer(t)))return;_=a.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=a.clone$2(t),t=a.extend(t,{source:m})),this._validate(a.validateStyle.layer,`layers.${m}`,t,{arrayIndex:-1},d))return;_=a.createStyleLayer(t),this._validateLayer(_),_.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}const x=s?this._order.indexOf(s):this._order.length;if(s&&x===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(x,0,m),this._layerOrderChanged=!0,this._layers[m]=_;const b=this._getLayerSourceCache(_);if(this._removedLayers[m]&&_.source&&b&&_.type!=="custom"){const C=this._removedLayers[m];delete this._removedLayers[m],C.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",b.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const d=this._order.indexOf(t);this._order.splice(d,1);const m=s?this._order.indexOf(s):this._order.length;s&&m===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);const d=this._order.indexOf(t);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,d){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===s&&m.maxzoom===d||(s!=null&&(m.minzoom=s),d!=null&&(m.maxzoom=d),this._updateLayer(m)):this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,s,d={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!_e(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.validateStyle.filter,`layers.${m.id}.filter`,s,{layerType:m.type},d)||(m.filter=a.clone$2(s),this._updateLayer(m)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){return a.clone$2(this.getLayer(t).filter)}setLayoutProperty(t,s,d,m={}){this._checkLoaded();const _=this.getLayer(t);_?_e(_.getLayoutProperty(s),d)||(_.setLayoutProperty(s,d,m),this._updateLayer(_)):this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,s){const d=this.getLayer(t);if(d)return d.getLayoutProperty(s);this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,s,d,m={}){this._checkLoaded();const _=this.getLayer(t);_?_e(_.getPaintProperty(s),d)||(_.setPaintProperty(s,d,m)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const d=t.source,m=t.sourceLayer,_=this.getSource(d);if(_===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const x=_.type;if(x==="geojson"&&m)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!m)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const b=this._getSourceCaches(d);for(const C of b)C.setFeatureState(m,t.id,s)}removeFeatureState(t,s){this._checkLoaded();const d=t.source,m=this.getSource(d);if(m===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const _=m.type,x=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!x)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const b=this._getSourceCaches(d);for(const C of b)C.removeFeatureState(x,t.id,s)}getFeatureState(t){this._checkLoaded();const s=t.source,d=t.sourceLayer,m=this.getSource(s);if(m!==void 0){if(m.type!=="vector"||d)return t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(d,t.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const s in this._sourceCaches){const d=this._sourceCaches[s].getSource();t[d.id]||(t[d.id]=d.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0;const s=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&s&&s.getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",s.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=x=>this._layers[x].type==="fill-extrusion",d={},m=[];for(let x=this._order.length-1;x>=0;x--){const b=this._order[x];if(s(b)){d[b]=x;for(const C of t){const A=C[b];if(A)for(const M of A)m.push(M)}}}m.sort((x,b)=>b.intersectionZ-x.intersectionZ);const _=[];for(let x=this._order.length-1;x>=0;x--){const b=this._order[x];if(s(b))for(let C=m.length-1;C>=0;C--){const A=m[C].feature;if(d[A.layer.id]<x)break;_.push(A),m.pop()}else for(const C of t){const A=C[b];if(A)for(const M of A)_.push(M.feature)}}return _}queryRenderedFeatures(t,s,d){s&&s.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const m={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of s.layers){const A=this._layers[C];if(!A)return this.fire(new a.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];m[A.source]=!0}}const _=[];s.availableImages=this._availableImages;const x=s&&s.layers?s.layers.some(C=>{const A=this.getLayer(C);return A&&A.is3D()}):this.has3DLayers(),b=ct.createFromScreenPoints(t,d);for(const C in this._sourceCaches){const A=this._sourceCaches[C].getSource().id;s.layers&&!m[A]||_.push(H(this._sourceCaches[C],this._layers,this._serializedLayers,b,s,d,x,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(C,A,M,z,F,V,$){const U={},W=V.queryRenderedSymbols(z),N=[];for(const X of Object.keys(W).map(Number))N.push($[X]);N.sort(pe);for(const X of N){const K=X.featureIndex.lookupSymbolFeatures(W[X.bucketInstanceId],A,X.bucketIndex,X.sourceLayerIndex,F.filter,F.layers,F.availableImages,C);for(const j in K){const J=U[j]=U[j]||[],ne=K[j];ne.sort((ve,xe)=>{const Ee=X.featureSortOrder;if(Ee){const Se=Ee.indexOf(ve.featureIndex);return Ee.indexOf(xe.featureIndex)-Se}return xe.featureIndex-ve.featureIndex});for(const ve of ne)J.push(ve)}}for(const X in U)U[X].forEach(K=>{const j=K.feature,J=M(C[X]).getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=J});return U}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),b.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,s){s&&s.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const d=this._getSourceCaches(t);let m=[];for(const _ of d)m=m.concat(ie(_,s));return m}addSourceType(t,s,d){return wn.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(wn.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const d=this.light.getLight();let m=!1;for(const x in t)if(!_e(t[x],d[x])){m=!0;break}if(!m)return;const _={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(_)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(t){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(typeof t.source=="object"){const s="terrain-dem-src";this.addSource(s,t.source),t=a.clone$2(t),t=a.extend(t,{source:s})}if(!this._validate(a.validateStyle.terrain,"terrain",t)){if(this.terrain){const s=this.terrain,d=s.get();for(const m in t)if(!_e(t[m],d[m])){s.set(t),this.stylesheet.terrain=t;const _={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(_);break}}else this._createTerrain(t);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(t){const s=this.fog=new sn(t,this.map.transform);this.stylesheet.fog=t;const d={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog,d=s.get();for(const m in t)if(!_e(t[m],d[m])){s.set(t),this.stylesheet.fog=t;const _={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(_);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(d=>this.isLayerDraped(this._layers[d])),s=this._order.filter(d=>!this.isLayerDraped(this._layers[d]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t){const s=this.terrain=new $n(t);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const d={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(d)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_validate(t,s,d,m,_={}){return(!_||_.validate!==!1)&&Aa(this,t.call(a.validateStyle,a.extend({key:s,style:this.serialize(),value:d,styleSpec:a.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const s=this._getSourceCaches(t);for(const d of s)d.clearTiles()}_reloadSource(t){const s=this._getSourceCaches(t);for(const d of s)d.resume(),d.reload()}_updateSources(t){for(const s in this._sourceCaches)this._sourceCaches[s].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,d,m,_=!1){let x=!1,b=!1;const C={};for(const A of this._order){const M=this._layers[A];if(M.type!=="symbol")continue;if(!C[M.source]){const F=this._getLayerSourceCache(M);if(!F)continue;C[M.source]=F.getRenderableIds(!0).map(V=>F.getTileByID(V)).sort((V,$)=>$.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan($.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(M,C[M.source],t.center.lng);x=x||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||d===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),t.zoom))&&(this.pauseablePlacement=new yr(t,this._order,_,s,d,m,this.placement,this.fog&&!this.fog.isSoftDisabled()?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),b=!0),x&&this.pauseablePlacement.placement.setStale()),b||x)for(const A of this._order){const M=this._layers[A];M.type==="symbol"&&this.placement.updateLayerOpacities(M,C[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,d){this.imageManager.getImages(s.icons,d),this._updateTilesForChangedImages();const m=_=>{_&&_.setDependencies(s.tileID.key,s.type,s.icons)};m(this._otherSourceCaches[s.source]),m(this._symbolSourceCaches[s.source])}getGlyphs(t,s,d){this.glyphManager.getGlyphs(s.stacks,d)}getResource(t,s,d){return a.makeRequest(s,d)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}}wn.getSourceType=function(u){return P[u]},wn.setSourceType=function(u,t){P[u]=t},wn.registerForPluginStateChange=a.registerForPluginStateChange;var rc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,oc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Is={},Io={};Is=Ct("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else 
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),Io=Ct(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const xr=Ct(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ao=rc;var Ma={background:Ct(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ct(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ct(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ct("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ct(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));vec3 globePos=a_pos_3+xAxis*extrude.x+yAxis*extrude.y+elevationVector(tilePos)*elevation(tilePos);vec3 mercPos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+xAxis*extrude.x+yAxis*extrude.y;vec3 pos=mix_globe_mercator(globePos,mercPos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ct(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ct("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ct("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ct("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Ct(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ct(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ct(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ct(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ct(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Ct(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Ct(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ct(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ct(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ct(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ct(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Ct(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Ct(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Ct(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Ct(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Ct(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ct(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,oc),skyboxGradient:Ct(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,oc),skyboxCapture:Ct(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ct(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Ct(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:Ct(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying float v_depth;void main() {vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);v_depth=gl_Position.z/gl_Position.w;}")};function Ct(u,t,s){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,_=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x=u.match(m),b=t.match(m),C=rc.match(m);let A=b?b.concat(x):x;s||(Is.staticUniforms&&(A=Is.staticUniforms.concat(A)),Io.staticUniforms&&(A=Io.staticUniforms.concat(A))),A&&(A=A.concat(C));const M={};return{fragmentSource:u=u.replace(d,(z,F,V,$,U)=>(M[U]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${U}
varying ${V} ${$} ${U};
#else
uniform ${V} ${$} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${V} ${$} ${U} = u_${U};
#endif
`)),vertexSource:t=t.replace(d,(z,F,V,$,U)=>{const W=$==="float"?"vec2":"vec4",N=U.match(/color/)?"color":W;return M[U]?F==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${V} ${W} a_${U};
varying ${V} ${$} ${U};
#else
uniform ${V} ${$} u_${U};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${V} ${$} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${N}(a_${U}, u_${U}_t);
#else
    ${V} ${$} ${U} = u_${U};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${V} ${W} a_${U};
#else
uniform ${V} ${$} u_${U};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${V} ${$} ${U} = a_${U};
#else
    ${V} ${$} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${V} ${$} ${U} = unpack_mix_${N}(a_${U}, u_${U}_t);
#else
    ${V} ${$} ${U} = u_${U};
#endif
`}),staticAttributes:_,staticUniforms:A}}class ka{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,d,m,_,x,b,C){this.context=t;let A=this.boundPaintVertexBuffers.length!==m.length;for(let M=0;!A&&M<m.length;M++)this.boundPaintVertexBuffers[M]!==m[M]&&(A=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===d&&!A&&this.boundIndexBuffer===_&&this.boundVertexOffset===x&&this.boundDynamicVertexBuffer===b&&this.boundDynamicVertexBuffer2===C?(t.bindVertexArrayOES.set(this.vao),b&&b.bind(),_&&_.dynamicDraw&&_.bind(),C&&C.bind()):this.freshBind(s,d,m,_,x,b,C)}freshBind(t,s,d,m,_,x,b){let C;const A=t.numAttributes,M=this.context,z=M.gl;if(M.extVertexArrayObject)this.vao&&this.destroy(),this.vao=M.extVertexArrayObject.createVertexArrayOES(),M.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=b;else{C=M.currentNumAttributes||0;for(let F=A;F<C;F++)z.disableVertexAttribArray(F)}s.enableAttributes(z,t);for(const F of d)F.enableAttributes(z,t);x&&x.enableAttributes(z,t),b&&b.enableAttributes(z,t),s.bind(),s.setVertexAttribPointers(z,t,_);for(const F of d)F.bind(),F.setVertexAttribPointers(z,t,_);x&&(x.bind(),x.setVertexAttribPointers(z,t,_)),m&&m.bind(),b&&(b.bind(),b.setVertexAttribPointers(z,t,_)),M.currentNumAttributes=A}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function za(u,t){const s=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new a.MercatorCoordinate(0,d/s).toLngLat().lat,new a.MercatorCoordinate(0,(d+1)/s).toLngLat().lat]}function sc(u,t,s,d,m,_,x){const b=u.context,C=b.gl,A=s.fbo;if(!A)return;u.prepareDrawTile(t);const M=u.useProgram("hillshade");b.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,A.colorAttachment.get());const z=((U,W,N,X)=>{const K=N.paint.get("hillshade-shadow-color"),j=N.paint.get("hillshade-highlight-color"),J=N.paint.get("hillshade-accent-color");let ne=N.paint.get("hillshade-illumination-direction")*(Math.PI/180);N.paint.get("hillshade-illumination-anchor")==="viewport"&&(ne-=U.transform.angle);const ve=!U.options.moving;return{u_matrix:X||U.transform.calculateProjMatrix(W.tileID.toUnwrapped(),ve),u_image:0,u_latrange:za(0,W.tileID),u_light:[N.paint.get("hillshade-exaggeration"),ne],u_shadow:K,u_highlight:j,u_accent:J}})(u,s,d,u.terrain?t.projMatrix:null);u.prepareDrawProgram(b,M,t.toUnwrapped());const{tileBoundsBuffer:F,tileBoundsIndexBuffer:V,tileBoundsSegments:$}=u.getTileBoundsBuffers(s);M.draw(b,C.TRIANGLES,m,_,x,a.CullFaceMode.disabled,z,d.id,F,V,$)}function As(u,t,s){if(!t.needsDEMTextureUpload)return;const d=u.context,m=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(s.stride);const _=s.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new a.Texture(d,_,m.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Ms(u,t,s,d,m,_){const x=u.context,b=x.gl;if(!t.dem)return;const C=t.dem;if(x.activeTexture.set(b.TEXTURE1),As(u,t,C),!t.demTexture)return;t.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const A=C.dim;x.activeTexture.set(b.TEXTURE0);let M=t.fbo;if(!M){const $=new a.Texture(x,{width:A,height:A,data:null},b.RGBA);$.bind(b.LINEAR,b.CLAMP_TO_EDGE),M=t.fbo=x.createFramebuffer(A,A,!0),M.colorAttachment.set($.texture)}x.bindFramebuffer.set(M.framebuffer),x.viewport.set([0,0,A,A]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:F,tileBoundsSegments:V}=u.getMercatorTileBoundsBuffers();u.useProgram("hillshadePrepare").draw(x,b.TRIANGLES,d,m,_,a.CullFaceMode.disabled,(($,U)=>{const W=U.stride,N=a.create$1();return a.ortho(N,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(N,N,[0,-a.EXTENT,0]),{u_matrix:N,u_image:1,u_dimension:[W,W],u_zoom:$.overscaledZ,u_unpack:U.unpackVector}})(t.tileID,C),s.id,z,F,V),t.needsHillshadePrepare=!1}const Pt=(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image0:new a.Uniform1i(u,t.u_image0),u_skirt_height:new a.Uniform1f(u,t.u_skirt_height)}),ks=(u,t)=>({u_matrix:u,u_image0:0,u_skirt_height:t}),Pa=new class{constructor(){this.operations={}}newMorphing(u,t,s,d,m){if(u in this.operations){const _=this.operations[u];_.to.tileID.key!==s.tileID.key&&(_.queued=s)}else this.operations[u]={startTime:d,phase:0,duration:m,from:t,to:s,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const s=this.operations[t];for(s.phase=(u-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},ac={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ih(u,t){const s=1<<u.z;return!t&&(u.x===0||u.x===s-1)||u.y===0||u.y===s-1}const zs=u=>({u_matrix:u});function lc(u,t,s,d,m){if(m>0){const _=a.exported.now(),x=(_-u.timeAdded)/m,b=t?(_-t.timeAdded)/m:-1,C=s.getSource(),A=d.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),M=!t||Math.abs(t.tileID.overscaledZ-A)>Math.abs(u.tileID.overscaledZ-A),z=M&&u.refreshedUponExpiration?1:a.clamp(M?x:1-b,0,1);return u.refreshedUponExpiration&&x>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class Rp extends a.SourceCache{constructor(t){const s=R("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new mn(je(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,d){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,x)=>{if(_[x.key]="",!this._tiles[x.key]){const b=new a.Tile(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom);b.state="loaded",this._tiles[x.key]=b}return _},{});for(const _ in this._tiles)_ in m||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const d=Object.values(s);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class nh extends a.OverscaledTileID{constructor(t,s,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=d}}class cc extends a.Elevation{constructor(t,s){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,m,_]=function(C){const A=new a.StructArrayLayout4i8,M=new a.StructArrayLayout3ui6,z=131;A.reserve(17161),M.reserve(33800);const F=a.EXTENT/128,V=a.EXTENT+F/2,$=V+F;for(let W=-F;W<$;W+=F)for(let N=-F;N<$;N+=F){const X=N<0||N>V||W<0||W>V?24575:0,K=a.clamp(Math.round(N),0,a.EXTENT),j=a.clamp(Math.round(W),0,a.EXTENT);A.emplaceBack(K+X,j,K,j)}const U=(W,N)=>{const X=N*z+W;M.emplaceBack(X+1,X,X+z),M.emplaceBack(X+z,X+z+1,X+1)};for(let W=1;W<129;W++)for(let N=1;N<129;N++)U(N,W);return[0,129].forEach(W=>{for(let N=0;N<130;N++)U(N,W),U(W,N)}),[A,M,32768]}(),x=t.context;this.gridBuffer=x.createVertexBuffer(d,a.boundsAttributes.members),this.gridIndexBuffer=x.createIndexBuffer(m),this.gridSegments=a.SegmentVector.simpleSegment(0,0,d.length,m.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,d.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Rp(s.map),this.orthoMatrix=a.create$1(),a.ortho(this.orthoMatrix,0,a.EXTENT,0,a.EXTENT,0,1);const b=x.gl;this._overlapStencilMode=new a.StencilMode({func:b.GEQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,s,d){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const m=t.terrain.properties;this.sourceCache=t._getSourceCache(m.get("source")),this._exaggeration=m.get("exaggeration");const _=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const x=this.sourceCache.getSource().tileSize/128,b=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(s,x*b,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),s.updateElevation(!d),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||t.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(C=>{const A=s.getTileByID(C).tileID;return A.projMatrix=d.calculateProjMatrix(A.toUnwrapped()),A});(function(C,A){const M=A.transform.pointCoordinate(A.transform.getCameraPoint()),z=new a.pointGeometry(M.x,M.y);C.sort((F,V)=>{if(V.overscaledZ-F.overscaledZ)return V.overscaledZ-F.overscaledZ;const $=new a.pointGeometry(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),U=new a.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),W=z.mult(1<<F.canonical.z);return W.x-=.5,W.y-=.5,W.distSqr($)-W.distSqr(U)})})(m,this.painter),this._previousZoom=d.zoom;const _=this.proxyToSource||{};this.proxyToSource={},m.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const x=this._style._sourceCaches;for(const C in x){const A=x[C];if(!A.used||(A!==this.sourceCache&&(this._findCoveringTileCache[A.id]={}),this._setupProxiedCoordsForOrtho(A,t[C],_),A.usedForTerrain))continue;const M=t[C];A.getSource().reparseOverscaled&&this._assignTerrainTiles(M)}this.proxiedCoords[s.id]=m.map(C=>new nh(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const b={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const A=this.terrainTileForTile[C.key];if(!A)continue;const M=A.tileID.key;M in b||(this._visibleDemTiles.push(A),b[M]=M)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const d=this._findTileCoveringTileID(s,this.sourceCache);d&&(this.terrainTileForTile[s.key]=d)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const d in this.terrainTileForTile){const m=this.terrainTileForTile[d],_=m.dem;!_||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),As(this.painter,m,_))}}_prepareDemTileUniforms(t,s,d,m){if(!s||s.demTexture==null)return!1;const _=t.tileID.canonical,x=Math.pow(2,s.tileID.canonical.z-_.z),b=m||"";return d[`u_dem_tl${b}`]=[_.x*x%1,_.y*x%1],d[`u_dem_scale${b}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let t=0;const s=this._visibleDemTiles.reduce((d,m)=>{if(!m.dem)return d;const _=m.dem.tree.minimums[0];return _>0&&t++,d+_},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const d=this._getLoadedAreaMinimum(),m={width:1,height:1,data:new Uint8Array(a.DEMData.pack(d,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(m,{premultiply:!1}):_=this._emptyDEMTexture=new a.Texture(t,m,s.RGBA,{premultiply:!1}),_}setupElevationDraw(t,s,d){const m=this.painter.context,_=m.gl,x=(b=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(b),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var b;x.u_dem_size=this.sourceCache.getSource().tileSize,x.u_exaggeration=this.exaggeration();let C=null,A=null,M=1;if(d&&d.morphing&&this._useVertexMorphing){const z=d.morphing.srcDemTile,F=d.morphing.dstDemTile;M=d.morphing.phase,z&&F&&(this._prepareDemTileUniforms(t,z,x,"_prev")&&(A=z),this._prepareDemTileUniforms(t,F,x)&&(C=F))}if(A&&C?(m.activeTexture.set(_.TEXTURE2),C.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),m.activeTexture.set(_.TEXTURE4),A.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),x.u_dem_lerp=M):(C=this.terrainTileForTile[t.tileID.key],m.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(t,C,x)?C.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE)),d&&d.useDepthForOcclusion&&(m.activeTexture.set(_.TEXTURE3),this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),x.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),d&&d.useMeterToDem&&C){const z=(1<<C.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=z}d&&d.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),s.setTerrainUniformValues(m,x)}renderToBackBuffer(t){const s=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,s.width,s.height]),this.renderingToTexture=!1,function(m,_,x,b,C){const A=m.context,M=A.gl;let z,F;const V=m.options.showTerrainWireframe?2:0,$=(K,j)=>{if(F===K)return;const J=[ac[K]];j&&J.push(ac[V]),z=m.useProgram("terrainRaster",null,J),F=K},U=m.colorModeForRenderPass(),W=new a.DepthMode(M.LEQUAL,a.DepthMode.ReadWrite,m.depthRangeFor3D);Pa.update(C);const N=m.transform,X=6*Math.pow(1.5,22-N.zoom)*_.exaggeration();(V?[!1,!0]:[!1]).forEach(K=>{F=-1;const j=K?M.LINES:M.TRIANGLES,[J,ne]=K?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(const Ee of b){const Se=x.getTile(Ee),Fe=a.StencilMode.disabled,Te=_.prevTerrainTileForTile[Ee.key],Oe=_.terrainTileForTile[Ee.key];xe=Oe,(ve=Te)!=null&&xe!=null&&ve.hasData()&&xe.hasData()&&ve.demTexture!=null&&xe.demTexture!=null&&ve.tileID.key!==xe.tileID.key&&Pa.newMorphing(Ee.key,Te,Oe,C,250),A.activeTexture.set(M.TEXTURE0),Se.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE);const ye=Pa.getMorphValuesForProxy(Ee.key),Ue=ye?1:0;let Qe;ye&&(Qe={morphing:{srcDemTile:ye.from,dstDemTile:ye.to,phase:a.easeCubicInOut(ye.phase)}});const lt=ks(Ee.projMatrix,ih(Ee.canonical,N.renderWorldCopies)?X/10:X);$(Ue,K),_.setupElevationDraw(Se,z,Qe),m.prepareDrawProgram(A,z,Ee.toUnwrapped()),z.draw(A,j,W,Fe,U,a.CullFaceMode.backCCW,lt,"terrain_raster",_.gridBuffer,J,ne)}var ve,xe})}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,d=this.painter.context,m=this.proxySourceCache,_=this.proxiedCoords[m.id],x=this._drapedRenderBatches.shift(),b=[],C=s.style.order;let A=0;for(const M of _){const z=m.getTileByID(M.proxyTileKey),F=m.proxyCachedFBO[M.key]?m.proxyCachedFBO[M.key][t]:void 0,V=F!==void 0?m.renderCache[F]:this.pool[A++],$=F!==void 0;if(z.texture=V.tex,$&&!V.dirty){b.push(z.tileID);continue}let U;d.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(d.clear({color:a.Color.transparent}),V.dirty=!1);for(let W=x.start;W<=x.end;++W){const N=s.style._layers[C[W]];if(N.isHidden(s.transform.zoom))continue;const X=s.style._getLayerSourceCache(N),K=X?this.proxyToSource[M.key][X.id]:[M];if(!K)continue;const j=K;d.viewport.set([0,0,V.fb.width,V.fb.height]),U!==(X?X.id:null)&&(this._setupStencil(V,K,N,X),U=X?X.id:null),s.renderLayer(s,X,N,j)}this.renderedToTile?(V.dirty=!0,b.push(z.tileID)):$||--A,A===5&&(A=0,this.renderToBackBuffer(b))}return this.renderToBackBuffer(b),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,s.width,s.height]),x.end+1}postRender(){}renderCacheEfficiency(t){const s=t.order.length;if(s===0)return{efficiency:100};let d,m=0,_=0,x=!1;for(let b=0;b<s;++b){const C=t._layers[t.order[b]];this._style.isLayerDraped(C)?(x&&++m,++_):x||(x=!0,d=C.id)}return _===0?{efficiency:100}:{efficiency:100*(1-m/_),firstUndrapedLayer:d}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,d){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const x=_.tileID,b=Math.pow(2,x.overscaledZ),{x:C,y:A}=x.canonical,M=C/b,z=(C+1)/b,F=A/b,V=(A+1)/b;return{minx:M,miny:F,maxx:z,maxy:V,t:_.dem.tree.raycastRoot(M,F,z,V,t,s,d),tile:_}});m.sort((_,x)=>(_.t!==null?_.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const _ of m){if(_.t==null)return null;const x=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,s,d);if(x!=null)return x}return null}_createFBO(){const t=this.painter.context,s=t.gl,d=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const m=new a.Texture(t,{width:d[0],height:d[1],data:null},s.RGBA);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const _=t.createFramebuffer(d[0],d[1],!1);return _.colorAttachment.set(m.texture),_.depthAttachment=new ir(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._layers[t],d=s.isHidden(this.painter.transform.zoom),m=s.getCrossfadeParameters(),_=!!m&&m.t!==1,x=s.hasTransition();return s.type!=="custom"&&!d&&(_||x)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s]._source instanceof Gr){t=!0;break}if(t)for(let s=0;s<this._style.order.length;++s){const d=this._style._layers[this._style.order[s]],m=d.isHidden(this.painter.transform.zoom),_=this._style._getLayerSourceCache(d);if(d.type!=="raster"||m||!_)continue;const x=d.paint.get("raster-fade-duration");for(const b of this.proxyCoords){const C=this.proxyToSource[b.key][_.id];if(C)for(const A of C){const M=lc(_.getTile(A),_.findLoadedParent(A,0),_,this.painter.transform,x);(M.opacity!==1||M.mix!==0)&&this._clearRenderCacheForTile(_.id,A)}}}}_setupDrapedRenderBatches(){const t=this._style.order,s=t.length;if(s===0)return;const d=[];let m,_=0,x=this._style._layers[t[_]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++_<s;)x=this._style._layers[t[_]];for(;_<s;++_){const b=this._style._layers[t[_]];b.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(b)?m===void 0&&(m=_):m!==void 0&&(d.push({start:m,end:_-1}),m=void 0))}m!==void 0&&d.push({start:m,end:_-1}),this._drapedRenderBatches=d}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const x=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let b=0;b<x.length;++b){const C=Object.values(x[b]);s.renderCachePool.push(...C)}}return}this._clearRasterFadeFromRenderCache();const d=this.proxyCoords,m=this._tilesDirty;for(let x=d.length-1;x>=0;x--){const b=d[x];if(s.getTileByID(b.key),s.proxyCachedFBO[b.key]!==void 0){const C=t[b.key],A=this.proxyToSource[b.key];let M=0;for(const z in A){const F=A[z],V=C[z];if(!V||V.length!==F.length||F.some(($,U)=>$!==V[U]||m[z]&&m[z].hasOwnProperty($.key))){M=-1;break}++M}for(const z in s.proxyCachedFBO[b.key])s.renderCache[s.proxyCachedFBO[b.key][z]].dirty=M<0||M!==Object.values(C).length}}const _=[...this._drapedRenderBatches];_.sort((x,b)=>b.end-b.start-(x.end-x.start));for(const x of _)for(const b of d){if(s.proxyCachedFBO[b.key])continue;let C=s.renderCachePool.pop();C===void 0&&s.renderCache.length<50&&(C=s.renderCache.length,s.renderCache.push(this._createFBO())),C!==void 0&&(s.proxyCachedFBO[b.key]={},s.proxyCachedFBO[b.key][x.start]=C,s.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,d,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,x=_.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let b;if(d.isTileClipped())b=s.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);b=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+b>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=b,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(t,s){const d=this.painter,m=this.painter.context,_=m.gl;d._tileClippingMaskIDs={},m.setColorMode(a.ColorMode.disabled),m.setDepthMode(a.DepthMode.disabled);const x=d.useProgram("clippingMask");for(const b of t){const C=d._tileClippingMaskIDs[b.key]=--s;x.draw(m,_.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:_.ALWAYS,mask:0},C,255,_.KEEP,_.KEEP,_.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,zs(b.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const d=[t.x,t.y,1,1];a.transformMat4(d,d,s.pixelMatrixInverse),a.scale$2(d,d,1/d[3]),d[0]/=s.worldSize,d[1]/=s.worldSize;const m=s._camera.position,_=a.mercatorZfromAltitude(1,s.center.lat),x=[m[0],m[1],m[2]/_,0],b=a.subtract([],d.slice(0,3),x);a.normalize(b,b);const C=this.raycast(x,b,this._exaggeration);return C!==null&&C?(a.scaleAndAdd(x,x,b,C),x[3]=x[2],x[2]*=_,x):null}drawDepth(){const t=this.painter,s=t.context,d=this.proxySourceCache,m=Math.ceil(t.width),_=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===_||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const x=s.gl,b=s.createFramebuffer(m,_,!0);s.activeTexture.set(x.TEXTURE0);const C=new a.Texture(s,{width:m,height:_,data:null},x.RGBA);C.bind(x.NEAREST,x.CLAMP_TO_EDGE),b.colorAttachment.set(C.texture);const A=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,m,_);b.depthAttachment.set(A),this._depthFBO=b,this._depthTexture=C}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,m,_]),function(x,b,C,A){const M=x.context,z=M.gl;M.clear({depth:1});const F=x.useProgram("terrainDepth"),V=new a.DepthMode(z.LESS,a.DepthMode.ReadWrite,x.depthRangeFor3D);for(const $ of A){const U=C.getTile($),W=ks($.projMatrix,0);b.setupElevationDraw(U,F),F.draw(M,z.TRIANGLES,V,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,W,"terrain_depth",b.gridBuffer,b.gridIndexBuffer,b.gridNoSkirtSegments)}}(t,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,s,d){if(t.getSource()instanceof q)return this._setupProxiedCoordsForImageSource(t,s,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let b=0;b<_.length;b++){const C=_[b],A=this._findTileCoveringTileID(C,t);if(A){const M=this._createProxiedId(C,A,d[C.key]&&d[C.key][t.id]);m.push(M),this.proxyToSource[C.key][t.id]=[M]}}let x=!1;for(let b=0;b<s.length;b++){const C=t.getTile(s[b]);if(!C||!C.hasData())continue;const A=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(A&&A.tileID.canonical.z!==C.tileID.canonical.z){const M=this.proxyToSource[A.tileID.key][t.id],z=this._createProxiedId(A.tileID,C,d[A.tileID.key]&&d[A.tileID.key][t.id]);M?M.splice(M.length-1,0,z):this.proxyToSource[A.tileID.key][t.id]=[z],m.push(z),x=!0}}this._sourceTilesOverlap[t.id]=x}_setupProxiedCoordsForImageSource(t,s,d){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],_=this.proxyCoords,x=t.getSource(),b=new a.pointGeometry(x.tileID.x,x.tileID.y)._div(1<<x.tileID.z),C=x.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((M,z)=>(M.min.x=Math.min(M.min.x,z.x-b.x),M.min.y=Math.min(M.min.y,z.y-b.y),M.max.x=Math.max(M.max.x,z.x-b.x),M.max.y=Math.max(M.max.y,z.y-b.y),M),{min:new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),A=(M,z)=>{const F=M.wrap+M.canonical.x/(1<<M.canonical.z),V=M.canonical.y/(1<<M.canonical.z),$=a.EXTENT/(1<<M.canonical.z),U=z.wrap+z.canonical.x/(1<<z.canonical.z),W=z.canonical.y/(1<<z.canonical.z);return F+$<U+C.min.x||F>U+C.max.x||V+$<W+C.min.y||V>W+C.max.y};for(let M=0;M<_.length;M++){const z=_[M];for(let F=0;F<s.length;F++){const V=t.getTile(s[F]);if(!V||!V.hasData()||A(z,V.tileID))continue;const $=this._createProxiedId(z,V,d[z.key]&&d[z.key][t.id]),U=this.proxyToSource[z.key][t.id];U?U.push($):this.proxyToSource[z.key][t.id]=[$],m.push($)}}}_createProxiedId(t,s,d){let m=this.orthoMatrix;if(d){const _=d.find(x=>x.key===s.tileID.key);if(_)return _}if(s.tileID.key!==t.key){const _=t.canonical.z-s.tileID.canonical.z;let x,b,C;m=a.create$1();const A=s.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(x=a.EXTENT>>_,b=x*((s.tileID.canonical.x<<_)-t.canonical.x+A),C=x*((s.tileID.canonical.y<<_)-t.canonical.y)):(x=a.EXTENT<<-_,b=a.EXTENT*(s.tileID.canonical.x-(t.canonical.x+A<<-_)),C=a.EXTENT*(s.tileID.canonical.y-(t.canonical.y<<-_))),a.ortho(m,0,x,0,x,0,1),a.translate(m,m,[b,C,0])}return new nh(s.tileID,t.key,m)}_findTileCoveringTileID(t,s){let d=s.getTile(t);if(d&&d.hasData())return d;const m=this._findCoveringTileCache[s.id],_=m[t.key];if(d=_?s.getTileByID(_):null,d&&d.hasData()||_===null)return d;let x=d?d.tileID:t,b=x.overscaledZ;const C=s.getSource().minzoom,A=[];if(!_){const z=s.getSource().maxzoom;if(t.canonical.z>=z){const F=t.canonical.z-z;s.getSource().reparseOverscaled?(b=Math.max(t.canonical.z+2,s.transform.tileZoom),x=new a.OverscaledTileID(b,t.wrap,z,t.canonical.x>>F,t.canonical.y>>F)):F!==0&&(b=z,x=new a.OverscaledTileID(b,t.wrap,z,t.canonical.x>>F,t.canonical.y>>F))}x.key!==t.key&&(A.push(x.key),d=s.getTile(x))}const M=z=>{A.forEach(F=>{m[F]=z}),A.length=0};for(b-=1;b>=C&&(!d||!d.hasData());b--){d&&M(d.tileID.key);const z=x.calculateScaledKey(b);if(d=s.getTileByID(z),d&&d.hasData())break;const F=m[z];if(F===null)break;F===void 0?A.push(z):d=s.getTileByID(F)}return M(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(t){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(s){let d,m,_;const x=new a.StructArrayLayout2ui4,b=131;for(m=1;m<129;m++){for(d=1;d<129;d++)_=m*b+d,x.emplaceBack(_,_+1),x.emplaceBack(_,_+b),x.emplaceBack(_+1,_+b),m===128&&x.emplaceBack(_+b,_+b+1);x.emplaceBack(_+1,_+1+b)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Da(u){const t=[];for(let s=0;s<u.length;s++){if(u[s]===null)continue;const d=u[s].split(" ");t.push(d.pop())}return t}class La{static cacheKey(t,s,d){let m=`${t}${d?d.cacheKey:""}`;for(const _ of s)m+=`/${_}`;return m}constructor(t,s,d,m,_,x){const b=t.gl;this.program=b.createProgram();const C=Da(d.staticAttributes),A=m?m.getBinderAttributes():[],M=C.concat(A),z=d.staticUniforms?Da(d.staticUniforms):[],F=m?m.getBinderUniforms():[],V=z.concat(F),$=[];for(const J of V)$.indexOf(J)<0&&$.push(J);let U=m?m.defines():[];U=U.concat(x.map(J=>`#define ${J}`));const W=U.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ao,xr.fragmentSource,Io.fragmentSource,d.fragmentSource).join(`
`),N=U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ao,xr.vertexSource,Io.vertexSource,Is.vertexSource,d.vertexSource).join(`
`),X=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(X,W),b.compileShader(X),b.attachShader(this.program,X);const K=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(K,N),b.compileShader(K),b.attachShader(this.program,K),this.attributes={};const j={};this.numAttributes=M.length;for(let J=0;J<this.numAttributes;J++)M[J]&&(b.bindAttribLocation(this.program,J,M[J]),this.attributes[M[J]]=J);b.linkProgram(this.program),b.deleteShader(K),b.deleteShader(X);for(let J=0;J<$.length;J++){const ne=$[J];if(ne&&!j[ne]){const ve=b.getUniformLocation(this.program,ne);ve&&(j[ne]=ve)}}this.fixedUniforms=_(t,j),this.binderUniforms=m?m.getUniforms(t,j):[],x.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((J,ne)=>({u_dem:new a.Uniform1i(J,ne.u_dem),u_dem_prev:new a.Uniform1i(J,ne.u_dem_prev),u_dem_unpack:new a.Uniform4f(J,ne.u_dem_unpack),u_dem_tl:new a.Uniform2f(J,ne.u_dem_tl),u_dem_scale:new a.Uniform1f(J,ne.u_dem_scale),u_dem_tl_prev:new a.Uniform2f(J,ne.u_dem_tl_prev),u_dem_scale_prev:new a.Uniform1f(J,ne.u_dem_scale_prev),u_dem_size:new a.Uniform1f(J,ne.u_dem_size),u_dem_lerp:new a.Uniform1f(J,ne.u_dem_lerp),u_exaggeration:new a.Uniform1f(J,ne.u_exaggeration),u_depth:new a.Uniform1i(J,ne.u_depth),u_depth_size_inv:new a.Uniform2f(J,ne.u_depth_size_inv),u_meter_to_dem:new a.Uniform1f(J,ne.u_meter_to_dem),u_label_plane_matrix_inv:new a.UniformMatrix4f(J,ne.u_label_plane_matrix_inv),u_tile_tl_up:new a.Uniform3f(J,ne.u_tile_tl_up),u_tile_tr_up:new a.Uniform3f(J,ne.u_tile_tr_up),u_tile_br_up:new a.Uniform3f(J,ne.u_tile_br_up),u_tile_bl_up:new a.Uniform3f(J,ne.u_tile_bl_up),u_tile_up_scale:new a.Uniform1f(J,ne.u_tile_up_scale)}))(t,j)),x.indexOf("FOG")!==-1&&(this.fogUniforms=((J,ne)=>({u_fog_matrix:new a.UniformMatrix4f(J,ne.u_fog_matrix),u_fog_range:new a.Uniform2f(J,ne.u_fog_range),u_fog_color:new a.Uniform4f(J,ne.u_fog_color),u_fog_horizon_blend:new a.Uniform1f(J,ne.u_fog_horizon_blend),u_fog_temporal_offset:new a.Uniform1f(J,ne.u_fog_temporal_offset)}))(t,j))}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)d[m].set(s[m])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)d[m].location&&d[m].set(s[m])}}draw(t,s,d,m,_,x,b,C,A,M,z,F,V,$,U,W){const N=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(d),t.setStencilMode(m),t.setColorMode(_),t.setCullFace(x);for(const K in this.fixedUniforms)this.fixedUniforms[K].set(b[K]);$&&$.setUniforms(t,this.binderUniforms,F,{zoom:V});const X={[N.LINES]:2,[N.TRIANGLES]:3,[N.LINE_STRIP]:1}[s];for(const K of z.get()){const j=K.vaos||(K.vaos={});(j[C]||(j[C]=new ka)).bind(t,this,A,$?$.getPaintVertexBuffers():[],M,K.vertexOffset,U,W),N.drawElements(s,K.primitiveLength*X,N.UNSIGNED_SHORT,K.primitiveOffset*X*2)}}}function Ra(u,t,s){const d=1/Ve(s,1,t.transform.tileZoom),m=Math.pow(2,s.tileID.overscaledZ),_=s.tileSize*Math.pow(2,t.transform.tileZoom)/m,x=_*(s.tileID.canonical.x+s.tileID.wrap*m),b=_*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[d,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[x>>16,b>>16],u_pixel_coord_lower:[65535&x,65535&b]}}const uc=(u,t,s,d)=>{const m=t.style.light,_=m.properties.get("position"),x=[_.x,_.y,_.z],b=a.create$2();m.properties.get("anchor")==="viewport"&&(a.fromRotation(b,-t.transform.angle),a.transformMat3(x,x,b));const C=m.properties.get("color");return{u_matrix:u,u_lightpos:x,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+s,u_opacity:d}},rh=(u,t,s,d,m,_,x)=>a.extend(uc(u,t,s,d),Ra(_,t,x),{u_height_factor:-Math.pow(2,m.overscaledZ)/x.tileSize/8}),oh=u=>({u_matrix:u}),Mo=(u,t,s,d)=>a.extend(oh(u),Ra(s,t,d)),Ps=(u,t)=>({u_matrix:u,u_world:t}),sh=(u,t,s,d,m)=>a.extend(Mo(u,t,s,d),{u_world:m}),cn=(u,t,s,d)=>{const m=u.transform;let _;return _=d.paint.get("circle-pitch-alignment")==="map"?m.calculatePixelsToTileUnitsMatrix(s):new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]),{u_camera_to_center_distance:m.cameraToCenterDistance,u_matrix:u.translatePosMatrix(t.projMatrix,s,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:_}},hc=u=>{const t=[];return u.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t},Ba=(u,t,s)=>{const d=a.EXTENT/s.tileSize;return{u_matrix:u,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/d,t.pixelsToGLUnits[1]/d]}},Ds=(u,t,s=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:s}),dc=(u,t,s,d)=>({u_matrix:u,u_extrude_scale:Ve(t,1,s),u_intensity:d}),pc=(u,t,s,d,m,_)=>{const x=u.transform,b=x.calculatePixelsToTileUnitsMatrix(t),C={u_matrix:Ua(u,t,s,m),u_pixels_to_tile_units:b,u_device_pixel_ratio:a.exported.devicePixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(fc(s)){const A=Oa(t,u.transform);C.u_texsize=t.lineAtlasTexture.size,C.u_scale=[A,d.fromScale,d.toScale],C.u_mix=d.t}return C},Fa=(u,t,s,d,m)=>{const _=u.transform,x=Oa(t,_);return{u_matrix:Ua(u,t,s,m),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:_.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:a.exported.devicePixelRatio,u_image:0,u_scale:[x,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}};function Oa(u,t){return 1/Ve(u,1,t.tileZoom)}function Ua(u,t,s,d){return u.translatePosMatrix(d||t.tileID.projMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Na=u=>{const t=[];return fc(u)&&t.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT"),t};function fc(u){const t=u.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const ah=(u,t,s,d,m)=>{return{u_matrix:u,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(x=m.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(_=m.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:ko(m.paint.get("raster-hue-rotate"))};var _,x};function ko(u){u*=Math.PI/180;const t=Math.sin(u),s=Math.cos(u);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const lh=(u,t,s,d,m,_,x,b,C,A,M,z,F,V)=>{const $=m.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:$.width/$.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:x,u_coord_matrix:b,u_is_text:+C,u_pitch_with_map:+d,u_texsize:A,u_tile_id:M,u_zoom_transition:z,u_inv_rot_matrix:F,u_merc_center:V,u_texture:0}},ch=(u,t,s,d,m,_,x,b,C,A,M,z,F,V,$)=>{const{cameraToCenterDistance:U,_pitch:W}=m.transform;return a.extend(lh(u,t,s,d,m,_,x,b,C,A,z,F,V,$),{u_gamma_scale:d?U*Math.cos(m.terrain?0:W):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+M})},Bp=(u,t,s,d,m,_,x,b,C,A,M,z,F,V)=>a.extend(ch(u,t,s,d,m,_,x,b,!0,C,!0,M,z,F,V),{u_texsize_icon:A,u_texture_icon:1}),Fp=(u,t,s)=>({u_matrix:u,u_opacity:t,u_color:s}),Op=(u,t,s,d,m,_)=>a.extend(function(x,b,C,A){const M=C.imageManager.getPattern(x.from.toString()),z=C.imageManager.getPattern(x.to.toString()),{width:F,height:V}=C.imageManager.getPixelSize(),$=Math.pow(2,A.tileID.overscaledZ),U=A.tileSize*Math.pow(2,C.transform.tileZoom)/$,W=U*(A.tileID.canonical.x+A.tileID.wrap*$),N=U*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[F,V],u_mix:b.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/Ve(A,1,C.transform.tileZoom),u_pixel_coord_upper:[W>>16,N>>16],u_pixel_coord_lower:[65535&W,65535&N]}}(d,_,s,m),{u_matrix:u,u_opacity:t}),Up={fillExtrusion:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_lightpos:new a.Uniform3f(u,t.u_lightpos),u_lightintensity:new a.Uniform1f(u,t.u_lightintensity),u_lightcolor:new a.Uniform3f(u,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(u,t.u_vertical_gradient),u_opacity:new a.Uniform1f(u,t.u_opacity)}),fillExtrusionPattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_lightpos:new a.Uniform3f(u,t.u_lightpos),u_lightintensity:new a.Uniform1f(u,t.u_lightintensity),u_lightcolor:new a.Uniform3f(u,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(u,t.u_vertical_gradient),u_height_factor:new a.Uniform1f(u,t.u_height_factor),u_image:new a.Uniform1i(u,t.u_image),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade),u_opacity:new a.Uniform1f(u,t.u_opacity)}),fill:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),fillPattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image:new a.Uniform1i(u,t.u_image),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade)}),fillOutline:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_world:new a.Uniform2f(u,t.u_world)}),fillOutlinePattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_world:new a.Uniform2f(u,t.u_world),u_image:new a.Uniform1i(u,t.u_image),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade)}),circle:(u,t)=>({u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_extrude_scale:new a.UniformMatrix2f(u,t.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),collisionBox:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_extrude_scale:new a.Uniform2f(u,t.u_extrude_scale)}),collisionCircle:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_inv_matrix:new a.UniformMatrix4f(u,t.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(u,t.u_viewport_size)}),debug:(u,t)=>({u_color:new a.UniformColor(u,t.u_color),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_overlay:new a.Uniform1i(u,t.u_overlay),u_overlay_scale:new a.Uniform1f(u,t.u_overlay_scale)}),clippingMask:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),heatmap:(u,t)=>({u_extrude_scale:new a.Uniform1f(u,t.u_extrude_scale),u_intensity:new a.Uniform1f(u,t.u_intensity),u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),heatmapTexture:(u,t)=>({u_image:new a.Uniform1i(u,t.u_image),u_color_ramp:new a.Uniform1i(u,t.u_color_ramp),u_opacity:new a.Uniform1f(u,t.u_opacity)}),hillshade:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image:new a.Uniform1i(u,t.u_image),u_latrange:new a.Uniform2f(u,t.u_latrange),u_light:new a.Uniform2f(u,t.u_light),u_shadow:new a.UniformColor(u,t.u_shadow),u_highlight:new a.UniformColor(u,t.u_highlight),u_accent:new a.UniformColor(u,t.u_accent)}),hillshadePrepare:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image:new a.Uniform1i(u,t.u_image),u_dimension:new a.Uniform2f(u,t.u_dimension),u_zoom:new a.Uniform1f(u,t.u_zoom),u_unpack:new a.Uniform4f(u,t.u_unpack)}),line:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_pixels_to_tile_units:new a.UniformMatrix2f(u,t.u_pixels_to_tile_units),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(u,t.u_units_to_pixels),u_dash_image:new a.Uniform1i(u,t.u_dash_image),u_gradient_image:new a.Uniform1i(u,t.u_gradient_image),u_image_height:new a.Uniform1f(u,t.u_image_height),u_texsize:new a.Uniform2f(u,t.u_texsize),u_scale:new a.Uniform3f(u,t.u_scale),u_mix:new a.Uniform1f(u,t.u_mix)}),linePattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixels_to_tile_units:new a.UniformMatrix2f(u,t.u_pixels_to_tile_units),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_image:new a.Uniform1i(u,t.u_image),u_units_to_pixels:new a.Uniform2f(u,t.u_units_to_pixels),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade)}),raster:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_tl_parent:new a.Uniform2f(u,t.u_tl_parent),u_scale_parent:new a.Uniform1f(u,t.u_scale_parent),u_buffer_scale:new a.Uniform1f(u,t.u_buffer_scale),u_fade_t:new a.Uniform1f(u,t.u_fade_t),u_opacity:new a.Uniform1f(u,t.u_opacity),u_image0:new a.Uniform1i(u,t.u_image0),u_image1:new a.Uniform1i(u,t.u_image1),u_brightness_low:new a.Uniform1f(u,t.u_brightness_low),u_brightness_high:new a.Uniform1f(u,t.u_brightness_high),u_saturation_factor:new a.Uniform1f(u,t.u_saturation_factor),u_contrast_factor:new a.Uniform1f(u,t.u_contrast_factor),u_spin_weights:new a.Uniform3f(u,t.u_spin_weights)}),symbolIcon:(u,t)=>({u_is_size_zoom_constant:new a.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(u,t.u_size_t),u_size:new a.Uniform1f(u,t.u_size),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(u,t.u_pitch),u_rotate_symbol:new a.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(u,t.u_fade_change),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new a.Uniform1i(u,t.u_is_text),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_texsize:new a.Uniform2f(u,t.u_texsize),u_tile_id:new a.Uniform3f(u,t.u_tile_id),u_zoom_transition:new a.Uniform1f(u,t.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(u,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(u,t.u_merc_center),u_texture:new a.Uniform1i(u,t.u_texture)}),symbolSDF:(u,t)=>({u_is_size_zoom_constant:new a.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(u,t.u_size_t),u_size:new a.Uniform1f(u,t.u_size),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(u,t.u_pitch),u_rotate_symbol:new a.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(u,t.u_fade_change),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new a.Uniform1i(u,t.u_is_text),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_texsize:new a.Uniform2f(u,t.u_texsize),u_texture:new a.Uniform1i(u,t.u_texture),u_gamma_scale:new a.Uniform1f(u,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_tile_id:new a.Uniform3f(u,t.u_tile_id),u_zoom_transition:new a.Uniform1f(u,t.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(u,t.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(u,t.u_merc_center),u_is_halo:new a.Uniform1i(u,t.u_is_halo)}),symbolTextAndIcon:(u,t)=>({u_is_size_zoom_constant:new a.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(u,t.u_size_t),u_size:new a.Uniform1f(u,t.u_size),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(u,t.u_pitch),u_rotate_symbol:new a.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(u,t.u_fade_change),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new a.Uniform1i(u,t.u_is_text),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_texsize:new a.Uniform2f(u,t.u_texsize),u_texsize_icon:new a.Uniform2f(u,t.u_texsize_icon),u_texture:new a.Uniform1i(u,t.u_texture),u_texture_icon:new a.Uniform1i(u,t.u_texture_icon),u_gamma_scale:new a.Uniform1f(u,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(u,t.u_is_halo)}),background:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_opacity:new a.Uniform1f(u,t.u_opacity),u_color:new a.UniformColor(u,t.u_color)}),backgroundPattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_opacity:new a.Uniform1f(u,t.u_opacity),u_image:new a.Uniform1i(u,t.u_image),u_pattern_tl_a:new a.Uniform2f(u,t.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(u,t.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(u,t.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(u,t.u_pattern_br_b),u_texsize:new a.Uniform2f(u,t.u_texsize),u_mix:new a.Uniform1f(u,t.u_mix),u_pattern_size_a:new a.Uniform2f(u,t.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(u,t.u_pattern_size_b),u_scale_a:new a.Uniform1f(u,t.u_scale_a),u_scale_b:new a.Uniform1f(u,t.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(u,t.u_tile_units_to_pixels)}),terrainRaster:Pt,terrainDepth:Pt,skybox:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_sun_direction:new a.Uniform3f(u,t.u_sun_direction),u_cubemap:new a.Uniform1i(u,t.u_cubemap),u_opacity:new a.Uniform1f(u,t.u_opacity),u_temporal_offset:new a.Uniform1f(u,t.u_temporal_offset)}),skyboxGradient:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_color_ramp:new a.Uniform1i(u,t.u_color_ramp),u_center_direction:new a.Uniform3f(u,t.u_center_direction),u_radius:new a.Uniform1f(u,t.u_radius),u_opacity:new a.Uniform1f(u,t.u_opacity),u_temporal_offset:new a.Uniform1f(u,t.u_temporal_offset)}),skyboxCapture:(u,t)=>({u_matrix_3f:new a.UniformMatrix3f(u,t.u_matrix_3f),u_sun_direction:new a.Uniform3f(u,t.u_sun_direction),u_sun_intensity:new a.Uniform1f(u,t.u_sun_intensity),u_color_tint_r:new a.Uniform4f(u,t.u_color_tint_r),u_color_tint_m:new a.Uniform4f(u,t.u_color_tint_m),u_luminance:new a.Uniform1f(u,t.u_luminance)})};let zo;function Va(u,t,s,d,m,_,x){const b=u.context,C=b.gl,A=u.useProgram("collisionBox"),M=[];let z=0,F=0;for(let K=0;K<d.length;K++){const j=d[K],J=t.getTile(j),ne=J.getBucket(s);if(!ne)continue;let ve=j.projMatrix;m[0]===0&&m[1]===0||(ve=u.translatePosMatrix(j.projMatrix,J,m,_));const xe=x?ne.textCollisionBox:ne.iconCollisionBox,Ee=ne.collisionCircleArray;if(Ee.length>0){const Se=a.create$1(),Fe=ve;a.mul$1(Se,ne.placementInvProjMatrix,u.transform.glCoordMatrix),a.mul$1(Se,Se,ne.placementViewportMatrix),M.push({circleArray:Ee,circleOffset:F,transform:Fe,invTransform:Se}),z+=Ee.length/4,F=z}xe&&(u.terrain&&u.terrain.setupElevationDraw(J,A),A.draw(b,C.LINES,a.DepthMode.disabled,a.StencilMode.disabled,u.colorModeForRenderPass(),a.CullFaceMode.disabled,Ba(ve,u.transform,J),s.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,u.transform.zoom,null,xe.collisionVertexBuffer,xe.collisionVertexBufferExt))}if(!x||!M.length)return;const V=u.useProgram("collisionCircle"),$=new a.StructArrayLayout2f1f2i16;$.resize(4*z),$._trim();let U=0;for(const K of M)for(let j=0;j<K.circleArray.length/4;j++){const J=4*j,ne=K.circleArray[J+0],ve=K.circleArray[J+1],xe=K.circleArray[J+2],Ee=K.circleArray[J+3];$.emplace(U++,ne,ve,xe,Ee,0),$.emplace(U++,ne,ve,xe,Ee,1),$.emplace(U++,ne,ve,xe,Ee,2),$.emplace(U++,ne,ve,xe,Ee,3)}(!zo||zo.length<2*z)&&(zo=function(K){const j=2*K,J=new a.StructArrayLayout3ui6;J.resize(j),J._trim();for(let ne=0;ne<j;ne++){const ve=6*ne;J.uint16[ve+0]=4*ne+0,J.uint16[ve+1]=4*ne+1,J.uint16[ve+2]=4*ne+2,J.uint16[ve+3]=4*ne+2,J.uint16[ve+4]=4*ne+3,J.uint16[ve+5]=4*ne+0}return J}(z));const W=b.createIndexBuffer(zo,!0),N=b.createVertexBuffer($,a.collisionCircleLayout.members,!0);for(const K of M){const j={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(X=u.transform).cameraToCenterDistance,u_viewport_size:[X.width,X.height]};V.draw(b,C.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,u.colorModeForRenderPass(),a.CullFaceMode.disabled,j,s.id,N,W,a.SegmentVector.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,u.transform.zoom,null,null,null)}var X;N.destroy(),W.destroy()}const Kr=a.identity(new Float32Array(16));function uh(u,t,s,d,m,_){const{horizontalAlign:x,verticalAlign:b}=a.getAnchorAlignment(u),C=-(x-.5)*t,A=-(b-.5)*s,M=a.evaluateVariableOffset(u,d);return new a.pointGeometry((C/m+M[0])*_,(A/m+M[1])*_)}function hh(u,t,s,d,m,_,x,b,C,A,M,z){const F=u.text.placedSymbolArray,V=u.text.dynamicLayoutVertexArray,$=u.icon.dynamicLayoutVertexArray,U={};V.clear();for(let W=0;W<F.length;W++){const N=F.get(W),X=u.allowVerticalPlacement&&!N.placedOrientation,K=N.hidden||!N.crossTileID||X?null:d[N.crossTileID];if(K){const j=new a.pointGeometry(N.tileAnchorX,N.tileAnchorY),J=z(j),ne=ci(j,s?b:x,J),ve=Wr(_.cameraToCenterDistance,ne.signedDistanceFromCamera);let xe=m.evaluateSizeForFeature(u.textSizeData,A,N)*ve/a.ONE_EM;s&&(xe*=u.tilePixelRatio/C);const{width:Ee,height:Se,anchor:Fe,textOffset:Te,textScale:Oe}=K,ye=uh(Fe,Ee,Se,Te,Oe,xe),Ue=s?ci(j.add(ye),x,J).point:ne.point.add(t?ye.rotate(-_.angle):ye),Qe=u.allowVerticalPlacement&&N.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let lt=0;lt<N.numGlyphs;lt++)a.addDynamicAttributes(V,Ue,Qe);M&&N.associatedIconIndex>=0&&(U[N.associatedIconIndex]={shiftedAnchor:Ue,angle:Qe})}else Pn(N.numGlyphs,V)}if(M){$.clear();const W=u.icon.placedSymbolArray;for(let N=0;N<W.length;N++){const X=W.get(N);if(X.hidden)Pn(X.numGlyphs,$);else{const K=U[N];if(K)for(let j=0;j<X.numGlyphs;j++)a.addDynamicAttributes($,K.shiftedAnchor,K.angle);else Pn(X.numGlyphs,$)}}u.icon.dynamicLayoutVertexBuffer.updateData($)}u.text.dynamicLayoutVertexBuffer.updateData(V)}function mc(u,t,s){return s.iconsInText&&t?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function vr(u,t,s,d,m,_,x,b,C,A,M,z){const F=u.context,V=F.gl,$=u.transform,U=b==="map",W=C==="map",N=U&&s.layout.get("symbol-placement")!=="point",X=U&&!W&&!N,K=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let j=!1;const J=u.depthModeForSublayer(0,a.DepthMode.ReadOnly),ne=[0,0],ve=s.layout.get("text-variable-anchor"),xe=[],Ee=[];u.terrain&&W&&Ee.push("PITCH_WITH_MAP_TERRAIN"),N&&Ee.push("PROJECTED_POS_ON_VIEWPORT");for(const Se of d){const Fe=t.getTile(Se),Te=Fe.getBucket(s);if(!Te)continue;const Oe=m?Te.text:Te.icon;if(!Oe||!Oe.segments.get().length)continue;const ye=Oe.programConfigurations.get(s.id),Ue=m||Te.sdfIcons,Qe=m?Te.textSizeData:Te.iconSizeData,lt=W||$.pitch!==0,ut=u.useProgram(mc(Ue,m,Te),ye,Ee),pt=a.evaluateSizeForZoom(Qe,$.zoom),ft=[Se.canonical.x,Se.canonical.y,1<<Se.canonical.z];let st,_t,Bt,fi,Ai=[0,0],Fi=null;if(m){if(_t=Fe.glyphAtlasTexture,Bt=V.LINEAR,st=Fe.glyphAtlasTexture.size,Te.iconsInText){Ai=Fe.imageAtlasTexture.size,Fi=Fe.imageAtlasTexture;const Ji=Qe.kind==="composite"||Qe.kind==="camera";fi=lt||u.options.rotating||u.options.zooming||Ji?V.LINEAR:V.NEAREST}}else{const Ji=s.layout.get("icon-size").constantOr(0)!==1||Te.iconsNeedLinear;_t=Fe.imageAtlasTexture,Bt=Ue||u.options.rotating||u.options.zooming||Ji||lt?V.LINEAR:V.NEAREST,st=Fe.imageAtlasTexture.size}const Zi=u.transform.calculatePixelsToTileUnitsMatrix(Fe),mi=bt(Se.projMatrix,W,U,u.transform,Zi),rr=u.terrain&&W&&N?a.invert(new Float32Array(16),mi):Kr,Wn=vt(Se.projMatrix,W,U,u.transform,Zi),Wt=ve&&Te.hasTextData(),si=s.layout.get("icon-text-fit")!=="none"&&Wt&&Te.hasIconData();if(N){const Ji=$.elevation;va(Te,Se.projMatrix,u,m,mi,Wn,W,A,Ji?Ir=>Ji.getAtTileOffset(Se,Ir.x,Ir.y):null)}const It=u.translatePosMatrix(Se.projMatrix,Fe,_,x),Ht=N||m&&ve||si?Kr:mi,Mi=u.translatePosMatrix(Wn,Fe,_,x,!0),Xt=Ue&&s.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let un;un=Ue?Te.iconsInText?Bp(Qe.kind,pt,X,W,u,It,Ht,Mi,st,Ai,ft,0,u.identityMat,ne):ch(Qe.kind,pt,X,W,u,It,Ht,Mi,m,st,!0,ft,0,u.identityMat,ne):lh(Qe.kind,pt,X,W,u,It,Ht,Mi,m,st,ft,0,u.identityMat,ne);const qs={program:ut,buffers:Oe,uniformValues:un,atlasTexture:_t,atlasTextureIcon:Fi,atlasInterpolation:Bt,atlasInterpolationIcon:fi,isSDF:Ue,hasHalo:Xt,tile:Fe,labelPlaneMatrixInv:rr};if(K&&Te.canOverlap){j=!0;const Ji=Oe.segments.get();for(const Ir of Ji)xe.push({segments:new a.SegmentVector([Ir]),sortKey:Ir.sortKey,state:qs})}else xe.push({segments:Oe.segments,sortKey:0,state:qs})}j&&xe.sort((Se,Fe)=>Se.sortKey-Fe.sortKey);for(const Se of xe){const Fe=Se.state;if(u.terrain&&u.terrain.setupElevationDraw(Fe.tile,Fe.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:Fe.labelPlaneMatrixInv}),F.activeTexture.set(V.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,V.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(F.activeTexture.set(V.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),Fe.isSDF){const Te=Fe.uniformValues;Fe.hasHalo&&(Te.u_is_halo=1,_c(Fe.buffers,Se.segments,s,u,Fe.program,J,M,z,Te)),Te.u_is_halo=0}_c(Fe.buffers,Se.segments,s,u,Fe.program,J,M,z,Fe.uniformValues)}}function _c(u,t,s,d,m,_,x,b,C){const A=d.context;m.draw(A,A.gl.TRIANGLES,_,x,b,a.CullFaceMode.disabled,C,s.id,u.layoutVertexBuffer,u.indexBuffer,t,s.paint,d.transform.zoom,u.programConfigurations.get(s.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function Jr(u,t,s,d,m,_,x){const b=u.context.gl,C=s.paint.get("fill-pattern"),A=C&&C.constantOr(1),M=s.getCrossfadeParameters();let z,F,V,$,U;x?(F=A&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=b.LINES):(F=A?"fillPattern":"fill",z=b.TRIANGLES);for(const W of d){const N=t.getTile(W);if(A&&!N.patternsLoaded())continue;const X=N.getBucket(s);if(!X)continue;u.prepareDrawTile(W);const K=X.programConfigurations.get(s.id),j=u.useProgram(F,K);A&&(u.context.activeTexture.set(b.TEXTURE0),N.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),K.updatePaintBuffers(M));const J=C.constantOr(null);if(J&&N.imageAtlas){const ve=N.imageAtlas,xe=ve.patternPositions[J.to.toString()],Ee=ve.patternPositions[J.from.toString()];xe&&Ee&&K.setConstantPatternPositions(xe,Ee)}const ne=u.translatePosMatrix(W.projMatrix,N,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(x){$=X.indexBuffer2,U=X.segments2;const ve=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[b.drawingBufferWidth,b.drawingBufferHeight];V=F==="fillOutlinePattern"&&A?sh(ne,u,M,N,ve):Ps(ne,ve)}else $=X.indexBuffer,U=X.segments,V=A?Mo(ne,u,M,N):oh(ne);u.prepareDrawProgram(u.context,j,W.toUnwrapped()),j.draw(u.context,z,m,u.stencilModeForClipping(W),_,a.CullFaceMode.disabled,V,s.id,X.layoutVertexBuffer,$,U,s.paint,u.transform.zoom,K)}}function wr(u,t,s,d,m,_,x){const b=u.context,C=b.gl,A=s.paint.get("fill-extrusion-pattern"),M=A.constantOr(1),z=s.getCrossfadeParameters(),F=s.paint.get("fill-extrusion-opacity");for(const V of d){const $=t.getTile(V),U=$.getBucket(s);if(!U)continue;const W=U.programConfigurations.get(s.id),N=u.useProgram(M?"fillExtrusionPattern":"fillExtrusion",W);if(u.terrain){const ne=u.terrain;if(!U.enableTerrain)continue;if(ne.setupElevationDraw($,N,{useMeterToDem:!0}),dh(b,t,V,U,s,ne),!U.centroidVertexBuffer){const ve=N.attributes.a_centroid_pos;ve!==void 0&&C.vertexAttrib2f(ve,0,0)}}M&&(u.context.activeTexture.set(C.TEXTURE0),$.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),W.updatePaintBuffers(z));const X=A.constantOr(null);if(X&&$.imageAtlas){const ne=$.imageAtlas,ve=ne.patternPositions[X.to.toString()],xe=ne.patternPositions[X.from.toString()];ve&&xe&&W.setConstantPatternPositions(ve,xe)}const K=u.translatePosMatrix(V.projMatrix,$,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),j=s.paint.get("fill-extrusion-vertical-gradient"),J=M?rh(K,u,j,F,V,z,$):uc(K,u,j,F);u.prepareDrawProgram(b,N,V.toUnwrapped()),N.draw(b,b.gl.TRIANGLES,m,_,x,a.CullFaceMode.backCCW,J,s.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,s.paint,u.transform.zoom,W,u.terrain?U.centroidVertexBuffer:null)}}function dh(u,t,s,d,m,_){const x=[N=>{let X=N.canonical.x-1,K=N.wrap;return X<0&&(X=(1<<N.canonical.z)-1,K--),new a.OverscaledTileID(N.overscaledZ,K,N.canonical.z,X,N.canonical.y)},N=>{let X=N.canonical.x+1,K=N.wrap;return X===1<<N.canonical.z&&(X=0,K++),new a.OverscaledTileID(N.overscaledZ,K,N.canonical.z,X,N.canonical.y)},N=>new a.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,(N.canonical.y===0?1<<N.canonical.z:N.canonical.y)-1),N=>new a.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y===(1<<N.canonical.z)-1?0:N.canonical.y+1)],b=N=>{const X=t.getSource().maxzoom,K=ve=>{const xe=t.getTileByID(ve);if(xe&&xe.hasData())return xe.getBucket(m)};let j,J,ne;return(N.overscaledZ===N.canonical.z||N.overscaledZ>=X)&&(j=K(N.key)),N.overscaledZ>=X&&(J=K(N.calculateScaledKey(N.overscaledZ+1))),N.overscaledZ>X&&(ne=K(N.calculateScaledKey(N.overscaledZ-1))),j||J||ne},C=[0,0,0],A=(N,X)=>(C[0]=Math.min(N.min.y,X.min.y),C[1]=Math.max(N.max.y,X.max.y),C[2]=a.EXTENT-X.min.x>N.max.x?X.min.x-a.EXTENT:N.max.x,C),M=(N,X)=>(C[0]=Math.min(N.min.x,X.min.x),C[1]=Math.max(N.max.x,X.max.x),C[2]=a.EXTENT-X.min.y>N.max.y?X.min.y-a.EXTENT:N.max.y,C),z=[(N,X)=>A(N,X),(N,X)=>A(X,N),(N,X)=>M(N,X),(N,X)=>M(X,N)],F=new a.pointGeometry(0,0);let V,$,U;const W=(N,X,K,j,J)=>{const ne=[[j?K:N,j?N:K,0],[j?K:X,j?X:K,0]],ve=J<0?a.EXTENT+J:J,xe=[j?ve:(N+X)/2,j?(N+X)/2:ve,0];return K===0&&J<0||K!==0&&J>0?_.getForTilePoints(U,[xe],!0,$):ne.push(xe),_.getForTilePoints(s,ne,!0,V),Math.max(ne[0][2],ne[1][2],xe[2])/_.exaggeration()};for(let N=0;N<4;N++){const X=d.borders[N];if(X.length===0&&(d.borderDone[N]=!0),d.borderDone[N])continue;const K=U=x[N](s),j=b(K);if(!j||!j.enableTerrain||($=_.findDEMTileFor(K),!$||!$.dem))continue;if(!V){const xe=_.findDEMTileFor(s);if(!xe||!xe.dem)return;V=xe}const J=(N<2?1:5)-N,ne=j.borders[J];let ve=0;for(let xe=0;xe<X.length;xe++){const Ee=d.featuresOnBorder[X[xe]],Se=Ee.borders[N];let Fe;for(;ve<ne.length&&(Fe=j.featuresOnBorder[ne[ve]],!(Fe.borders[J][1]>Se[0]+3));)j.borderDone[J]||j.encodeCentroid(void 0,Fe,!1),ve++;if(Fe&&ve<ne.length){const Te=ve;let Oe=0;for(;!(Fe.borders[J][0]>Se[1]-3)&&(Oe++,++ve!==ne.length);)Fe=j.featuresOnBorder[ne[ve]];if(Fe=j.featuresOnBorder[ne[Te]],Ee.intersectsCount()>1||Fe.intersectsCount()>1||Oe!==1){Oe!==1&&(ve=Te),d.encodeCentroid(void 0,Ee,!1),j.borderDone[J]||j.encodeCentroid(void 0,Fe,!1);continue}const ye=z[N](Ee,Fe),Ue=N%2?a.EXTENT-1:0;F.x=W(ye[0],Math.min(a.EXTENT-1,ye[1]),Ue,N<2,ye[2]),F.y=0,d.encodeCentroid(F,Ee,!1),j.borderDone[J]||j.encodeCentroid(F,Fe,!1)}else d.encodeCentroid(void 0,Ee,!1)}d.borderDone[N]=d.needsCentroidUpdate=!0,j.borderDone[J]||(j.borderDone[J]=j.needsCentroidUpdate=!0)}(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(u)}const gc=new a.Color(1,0,0,1),Dt=new a.Color(0,1,0,1),ja=new a.Color(0,0,1,1),Np=new a.Color(1,0,1,1),ph=new a.Color(0,1,1,1);function Po(u,t,s,d){$a(u,0,t+s/2,u.transform.width,s,d)}function fh(u,t,s,d){$a(u,t-s/2,0,s,u.transform.height,d)}function $a(u,t,s,d,m,_){const x=u.context,b=x.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*a.exported.devicePixelRatio,s*a.exported.devicePixelRatio,d*a.exported.devicePixelRatio,m*a.exported.devicePixelRatio),x.clear({color:_}),b.disable(b.SCISSOR_TEST)}function mh(u,t,s){const d=u.context,m=d.gl,_=s.projMatrix,x=u.useProgram("debug"),b=t.getTileByID(s.key);u.terrain&&u.terrain.setupElevationDraw(b,x);const C=a.DepthMode.disabled,A=a.StencilMode.disabled,M=u.colorModeForRenderPass(),z="$debug";d.activeTexture.set(m.TEXTURE0),u.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),b._makeDebugTileBoundsBuffers(u.context,u.transform.projection);const F=b._tileDebugBuffer||u.debugBuffer,V=b._tileDebugIndexBuffer||u.debugIndexBuffer,$=b._tileDebugSegments||u.debugSegments;x.draw(d,m.LINE_STRIP,C,A,M,a.CullFaceMode.disabled,Ds(_,a.Color.red),z,F,V,$);const U=b.latestRawTileData,W=Math.floor((U&&U.byteLength||0)/1024),N=t.getTile(s).tileSize,X=512/Math.min(N,512)*(s.overscaledZ/u.transform.zoom)*.5;let K=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(K+=` => ${s.overscaledZ}`),function(j,J){j.initDebugOverlayCanvas();const ne=j.debugOverlayCanvas,ve=j.context.gl,xe=j.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,ne.width,ne.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(J,5,5),xe.strokeText(J,5,5),j.debugOverlayTexture.update(ne),j.debugOverlayTexture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE)}(u,`${K} ${W}kb`),x.draw(d,m.TRIANGLES,C,A,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,Ds(_,a.Color.transparent,X),z,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments)}const Vp=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:yc}=Vp;function Rn(u,t,s,d){u.emplaceBack(t,s,d)}class Do{constructor(t){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,Rn(this.vertexArray,-1,-1,1),Rn(this.vertexArray,1,-1,1),Rn(this.vertexArray,-1,1,1),Rn(this.vertexArray,1,1,1),Rn(this.vertexArray,-1,-1,-1),Rn(this.vertexArray,1,-1,-1),Rn(this.vertexArray,-1,1,-1),Rn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,yc),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function br(u,t,s,d,m,_){const x=u.gl,b=t.paint.get("sky-atmosphere-color"),C=t.paint.get("sky-atmosphere-halo-color"),A=t.paint.get("sky-atmosphere-sun-intensity"),M=((z,F,V,$,U)=>({u_matrix_3f:z,u_sun_direction:F,u_sun_intensity:V,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(a.fromMat4([],d),m,A,b,C);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),s.draw(u,x.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,M,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Ga={symbol:function(u,t,s,d,m){if(u.renderPass!=="translucent")return;const _=a.StencilMode.disabled,x=u.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(b,C,A,M,z,F,V){const $=C.transform,U=z==="map",W=F==="map";for(const N of b){const X=M.getTile(N),K=X.getBucket(A);if(!K||!K.text||!K.text.segments.get().length)continue;const j=a.evaluateSizeForZoom(K.textSizeData,$.zoom),J=C.transform.calculatePixelsToTileUnitsMatrix(X),ne=bt(N.projMatrix,W,U,C.transform,J),ve=A.layout.get("icon-text-fit")!=="none"&&K.hasIconData();if(j){const xe=Math.pow(2,$.zoom-X.tileID.overscaledZ),Ee=$.elevation;hh(K,U,W,V,a.symbolSize,$,ne,N.projMatrix,xe,j,ve,Ee?Se=>Ee.getAtTileOffset(N,Se.x,Se.y):Se=>0)}}}(d,u,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m),s.paint.get("icon-opacity").constantOr(1)!==0&&vr(u,t,s,d,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),_,x),s.paint.get("text-opacity").constantOr(1)!==0&&vr(u,t,s,d,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),_,x),t.map.showCollisionBoxes&&(Va(u,t,s,d,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Va(u,t,s,d,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,s,d){if(u.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),_=s.paint.get("circle-stroke-width"),x=s.paint.get("circle-stroke-opacity"),b=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(m.constantOr(1)===0&&(_.constantOr(1)===0||x.constantOr(1)===0))return;const C=u.context,A=C.gl,M=u.depthModeForSublayer(0,a.DepthMode.ReadOnly),z=a.StencilMode.disabled,F=u.colorModeForRenderPass(),V=[];for(let $=0;$<d.length;$++){const U=d[$],W=t.getTile(U),N=W.getBucket(s);if(!N)continue;const X=N.programConfigurations.get(s.id),K=hc(s),j={programConfiguration:X,program:u.useProgram("circle",X,K),layoutVertexBuffer:N.layoutVertexBuffer,indexBuffer:N.indexBuffer,uniformValues:cn(u,U,W,s),tile:W};if(b){const J=N.segments.get();for(const ne of J)V.push({segments:new a.SegmentVector([ne]),sortKey:ne.sortKey,state:j})}else V.push({segments:N.segments,sortKey:0,state:j})}b&&V.sort(($,U)=>$.sortKey-U.sortKey);for(const $ of V){const{programConfiguration:U,program:W,layoutVertexBuffer:N,indexBuffer:X,uniformValues:K,tile:j}=$.state,J=$.segments;u.terrain&&u.terrain.setupElevationDraw(j,W,{useDepthForOcclusion:!0}),u.prepareDrawProgram(C,W,j.tileID.toUnwrapped()),W.draw(C,A.TRIANGLES,M,z,F,a.CullFaceMode.disabled,K,s.id,N,X,J,s.paint,u.transform.zoom,U)}},heatmap:function(u,t,s,d){if(s.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const m=u.context,_=m.gl,x=a.StencilMode.disabled,b=new a.ColorMode([_.ONE,_.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(C,A,M){const z=C.gl;C.activeTexture.set(z.TEXTURE1),C.viewport.set([0,0,A.width/4,A.height/4]);let F=M.heatmapFbo;if(F)z.bindTexture(z.TEXTURE_2D,F.colorAttachment.get()),C.bindFramebuffer.set(F.framebuffer);else{const V=z.createTexture();z.bindTexture(z.TEXTURE_2D,V),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.LINEAR),F=M.heatmapFbo=C.createFramebuffer(A.width/4,A.height/4,!1),function($,U,W,N){const X=$.gl;X.texImage2D(X.TEXTURE_2D,0,X.RGBA,U.width/4,U.height/4,0,X.RGBA,$.extRenderToTextureHalfFloat?$.extTextureHalfFloat.HALF_FLOAT_OES:X.UNSIGNED_BYTE,null),N.colorAttachment.set(W)}(C,A,V,F)}})(m,u,s),m.clear({color:a.Color.transparent});for(let C=0;C<d.length;C++){const A=d[C];if(t.hasRenderableParent(A))continue;const M=t.getTile(A),z=M.getBucket(s);if(!z)continue;const F=z.programConfigurations.get(s.id),V=u.useProgram("heatmap",F),{zoom:$}=u.transform;u.terrain&&u.terrain.setupElevationDraw(M,V),u.prepareDrawProgram(m,V,A.toUnwrapped()),V.draw(m,_.TRIANGLES,a.DepthMode.disabled,x,b,a.CullFaceMode.disabled,dc(A.projMatrix,M,$,s.paint.get("heatmap-intensity")),s.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,s.paint,u.transform.zoom,F)}m.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(m,_){const x=m.context,b=x.gl,C=_.heatmapFbo;if(!C)return;x.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,C.colorAttachment.get()),x.activeTexture.set(b.TEXTURE1);let A=_.colorRampTexture;A||(A=_.colorRampTexture=new a.Texture(x,_.colorRamp,b.RGBA)),A.bind(b.LINEAR,b.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(x,b.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,m.colorModeForRenderPass(),a.CullFaceMode.disabled,((M,z,F,V)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,_),_.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,_.paint,m.transform.zoom)}(u,s))},line:function(u,t,s,d){if(u.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),_=s.paint.get("line-width");if(m.constantOr(1)===0||_.constantOr(1)===0)return;const x=u.depthModeForSublayer(0,a.DepthMode.ReadOnly),b=u.colorModeForRenderPass(),C=s.paint.get("line-dasharray"),A=C.constantOr(1),M=s.layout.get("line-cap"),z=s.paint.get("line-pattern"),F=z.constantOr(1),V=s.paint.get("line-gradient"),$=s.getCrossfadeParameters(),U=F?"linePattern":"line",W=u.context,N=W.gl;for(const X of d){const K=t.getTile(X);if(F&&!K.patternsLoaded())continue;const j=K.getBucket(s);if(!j)continue;u.prepareDrawTile(X);const J=j.programConfigurations.get(s.id),ne=Na(s),ve=u.useProgram(U,J,ne),xe=z.constantOr(null);if(xe&&K.imageAtlas){const Oe=K.imageAtlas,ye=Oe.patternPositions[xe.to.toString()],Ue=Oe.patternPositions[xe.from.toString()];ye&&Ue&&J.setConstantPatternPositions(ye,Ue)}const Ee=C.constantOr(null),Se=M.constantOr(null);if(!F&&Ee&&Se&&K.lineAtlas){const Oe=K.lineAtlas,ye=Oe.getDash(Ee.to,Se),Ue=Oe.getDash(Ee.from,Se);ye&&Ue&&J.setConstantPatternPositions(ye,Ue)}const Fe=u.terrain?X.projMatrix:null,Te=F?Fa(u,K,s,$,Fe):pc(u,K,s,$,Fe,j.lineClipsArray.length);if(V){const Oe=j.gradients[s.id];let ye=Oe.texture;if(s.gradientVersion!==Oe.version){let Ue=256;if(s.stepInterpolant){const Qe=t.getSource().maxzoom,lt=X.canonical.z===Qe?Math.ceil(1<<u.transform.maxZoom-X.canonical.z):1;Ue=a.clamp(a.nextPowerOfTwo(j.maxLineLength/a.EXTENT*1024*lt),256,W.maxTextureSize)}Oe.gradient=a.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Ue,image:Oe.gradient||void 0,clips:j.lineClipsArray}),Oe.texture?Oe.texture.update(Oe.gradient):Oe.texture=new a.Texture(W,Oe.gradient,N.RGBA),Oe.version=s.gradientVersion,ye=Oe.texture}W.activeTexture.set(N.TEXTURE1),ye.bind(s.stepInterpolant?N.NEAREST:N.LINEAR,N.CLAMP_TO_EDGE)}A&&(W.activeTexture.set(N.TEXTURE0),K.lineAtlasTexture.bind(N.LINEAR,N.REPEAT),J.updatePaintBuffers($)),F&&(W.activeTexture.set(N.TEXTURE0),K.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),J.updatePaintBuffers($)),u.prepareDrawProgram(W,ve,X.toUnwrapped()),ve.draw(W,N.TRIANGLES,x,u.stencilModeForClipping(X),b,a.CullFaceMode.disabled,Te,s.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,s.paint,u.transform.zoom,J,j.layoutVertexBuffer2)}},fill:function(u,t,s,d){const m=s.paint.get("fill-color"),_=s.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const x=u.colorModeForRenderPass(),b=s.paint.get("fill-pattern"),C=u.opaquePassEnabledForLayer()&&!b.constantOr(1)&&m.constantOr(a.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===C){const A=u.depthModeForSublayer(1,u.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);Jr(u,t,s,d,A,x,!1)}if(u.renderPass==="translucent"&&s.paint.get("fill-antialias")){const A=u.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);Jr(u,t,s,d,A,x,!0)}},"fill-extrusion":function(u,t,s,d){const m=s.paint.get("fill-extrusion-opacity");if(m!==0&&u.renderPass==="translucent"){const _=new a.DepthMode(u.context.gl.LEQUAL,a.DepthMode.ReadWrite,u.depthRangeFor3D);if(m!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))wr(u,t,s,d,_,a.StencilMode.disabled,a.ColorMode.disabled),wr(u,t,s,d,_,u.stencilModeFor3D(),u.colorModeForRenderPass());else{const x=u.colorModeForRenderPass();wr(u,t,s,d,_,a.StencilMode.disabled,x)}}},hillshade:function(u,t,s,d){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent")return;const m=u.context,_=u.depthModeForSublayer(0,a.DepthMode.ReadOnly),x=u.colorModeForRenderPass(),b=u.terrain&&u.terrain.renderingToTexture,[C,A]=u.renderPass!=="translucent"||b?[{},d]:u.stencilConfigForOverlap(d);for(const M of A){const z=t.getTile(M);if(z.needsHillshadePrepare&&u.renderPass==="offscreen")Ms(u,z,s,_,a.StencilMode.disabled,x);else if(u.renderPass==="translucent"){const F=b&&u.terrain?u.terrain.stencilModeForRTTOverlap(M):C[M.overscaledZ];sc(u,M,z,s,_,F,x)}}m.viewport.set([0,0,u.width,u.height])},raster:function(u,t,s,d,m,_){if(u.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!d.length)return;const x=u.context,b=x.gl,C=t.getSource(),A=u.useProgram("raster"),M=u.colorModeForRenderPass(),z=u.terrain&&u.terrain.renderingToTexture,[F,V]=C instanceof q||z?[{},d]:u.stencilConfigForOverlap(d),$=V[V.length-1].overscaledZ,U=!u.options.moving;for(const W of V){const N=z?a.DepthMode.disabled:u.depthModeForSublayer(W.overscaledZ-$,s.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,b.LESS),X=W.toUnwrapped(),K=t.getTile(W);if(z&&(!K||!K.hasData()))continue;const j=z?W.projMatrix:u.transform.calculateProjMatrix(X,U),J=u.terrain&&z?u.terrain.stencilModeForRTTOverlap(W):F[W.overscaledZ],ne=_?0:s.paint.get("raster-fade-duration");K.registerFadeDuration(ne);const ve=t.findLoadedParent(W,0),xe=lc(K,ve,t,u.transform,ne);let Ee,Se;u.terrain&&u.terrain.prepareDrawTile(W);const Fe=s.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;x.activeTexture.set(b.TEXTURE0),K.texture.bind(Fe,b.CLAMP_TO_EDGE),x.activeTexture.set(b.TEXTURE1),ve?(ve.texture.bind(Fe,b.CLAMP_TO_EDGE),Ee=Math.pow(2,ve.tileID.overscaledZ-K.tileID.overscaledZ),Se=[K.tileID.canonical.x*Ee%1,K.tileID.canonical.y*Ee%1]):K.texture.bind(Fe,b.CLAMP_TO_EDGE);const Te=ah(j,Se||[0,0],Ee||1,xe,s);if(u.prepareDrawProgram(x,A,X),C instanceof q)A.draw(x,b.TRIANGLES,N,a.StencilMode.disabled,M,a.CullFaceMode.disabled,Te,s.id,C.boundsBuffer,u.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:Oe,tileBoundsIndexBuffer:ye,tileBoundsSegments:Ue}=u.getTileBoundsBuffers(K);A.draw(x,b.TRIANGLES,N,J,M,a.CullFaceMode.disabled,Te,s.id,Oe,ye,Ue)}}},background:function(u,t,s,d){const m=s.paint.get("background-color"),_=s.paint.get("background-opacity");if(_===0)return;const x=u.context,b=x.gl,C=u.transform,A=C.tileSize,M=s.paint.get("background-pattern");if(u.isPatternMissing(M))return;const z=!M&&m.a===1&&_===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==z)return;const F=a.StencilMode.disabled,V=u.depthModeForSublayer(0,z==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),$=u.colorModeForRenderPass(),U=u.useProgram(M?"backgroundPattern":"background");let W,N=d;N||(W=u.getBackgroundTiles(),N=Object.values(W).map(K=>K.tileID)),M&&(x.activeTexture.set(b.TEXTURE0),u.imageManager.bind(u.context));const X=s.getCrossfadeParameters();for(const K of N){const j=K.toUnwrapped(),J=d?K.projMatrix:u.transform.calculateProjMatrix(j);u.prepareDrawTile(K);const ne=t?t.getTile(K):W?W[K.key]:new a.Tile(K,A,C.zoom,u),ve=M?Op(J,_,u,M,{tileID:K,tileSize:A},X):Fp(J,_,m);u.prepareDrawProgram(x,U,j);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Ee,tileBoundsSegments:Se}=u.getTileBoundsBuffers(ne);U.draw(x,b.TRIANGLES,V,F,$,a.CullFaceMode.disabled,ve,s.id,xe,Ee,Se)}},sky:function(u,t,s){const d=u.transform,m=d.projection.name==="mercator"?1:a.smoothstep(7,8,d.zoom),_=s.paint.get("sky-opacity")*m;if(_===0)return;const x=u.context,b=s.paint.get("sky-type"),C=new a.DepthMode(x.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),A=u.frameCounter/1e3%1;b==="atmosphere"?u.renderPass==="offscreen"?s.needsSkyboxCapture(u)&&(function(M,z,F,V){const $=M.context,U=$.gl;let W=z.skyboxFbo;if(!W){W=z.skyboxFbo=$.createFramebuffer(32,32,!1),z.skyboxGeometry=new Do($),z.skyboxTexture=$.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,z.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let j=0;j<6;++j)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}$.bindFramebuffer.set(W.framebuffer),$.viewport.set([0,0,32,32]);const N=z.getCenter(M,!0),X=M.useProgram("skyboxCapture"),K=new Float64Array(16);a.identity(K),a.rotateY(K,K,.5*-Math.PI),br($,z,X,K,N,0),a.identity(K),a.rotateY(K,K,.5*Math.PI),br($,z,X,K,N,1),a.identity(K),a.rotateX(K,K,.5*-Math.PI),br($,z,X,K,N,2),a.identity(K),a.rotateX(K,K,.5*Math.PI),br($,z,X,K,N,3),a.identity(K),br($,z,X,K,N,4),a.identity(K),a.rotateY(K,K,Math.PI),br($,z,X,K,N,5),$.viewport.set([0,0,M.width,M.height])}(u,s),s.markSkyboxValid(u)):u.renderPass==="sky"&&function(M,z,F,V,$){const U=M.context,W=U.gl,N=M.transform,X=M.useProgram("skybox");U.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,z.skyboxTexture);const K=((j,J,ne,ve,xe)=>({u_matrix:j,u_sun_direction:J,u_cubemap:0,u_opacity:ve,u_temporal_offset:xe}))(N.skyboxMatrix,z.getCenter(M,!1),0,V,$);M.prepareDrawProgram(U,X),X.draw(U,W.TRIANGLES,F,a.StencilMode.disabled,M.colorModeForRenderPass(),a.CullFaceMode.backCW,K,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(u,s,C,_,A):b==="gradient"&&u.renderPass==="sky"&&function(M,z,F,V,$){const U=M.context,W=U.gl,N=M.transform,X=M.useProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Do(U)),U.activeTexture.set(W.TEXTURE0);let K=z.colorRampTexture;K||(K=z.colorRampTexture=new a.Texture(U,z.colorRamp,W.RGBA)),K.bind(W.LINEAR,W.CLAMP_TO_EDGE);const j=((J,ne,ve,xe,Ee)=>({u_matrix:J,u_color_ramp:0,u_center_direction:ne,u_radius:a.degToRad(ve),u_opacity:xe,u_temporal_offset:Ee}))(N.skyboxMatrix,z.getCenter(M,!1),z.paint.get("sky-gradient-radius"),V,$);M.prepareDrawProgram(U,X),X.draw(U,W.TRIANGLES,F,a.StencilMode.disabled,M.colorModeForRenderPass(),a.CullFaceMode.backCW,j,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(u,s,C,_,A)},debug:function(u,t,s){for(let d=0;d<s.length;d++)mh(u,t,s[d])},custom:function(u,t,s){const d=u.context,m=s.implementation;if(u.transform.projection.name==="mercator"){if(u.renderPass==="offscreen"){const _=m.prerender;_&&(u.setCustomLayerDefaults(),d.setColorMode(u.colorModeForRenderPass()),_.call(m,d.gl,u.transform.customLayerMatrix()),d.setDirty(),u.setBaseState())}else if(u.renderPass==="translucent"){u.setCustomLayerDefaults(),d.setColorMode(u.colorModeForRenderPass()),d.setStencilMode(a.StencilMode.disabled);const _=m.renderingMode==="3d"?new a.DepthMode(u.context.gl.LEQUAL,a.DepthMode.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,a.DepthMode.ReadOnly);d.setDepthMode(_),m.render(d.gl,u.transform.customLayerMatrix()),d.setDirty(),u.setBaseState(),d.bindFramebuffer.set(null)}}else a.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.")}};class _h{constructor(t,s){this.context=new Ss(t),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ia,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,s){const d=!!t&&!!t.terrain&&this.transform.projection.name==="mercator";if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new cc(this,t));const m=this._terrain;this.transform.elevation=d?m:null,m.update(t,this.transform,s)}_updateFog(t){const s=t.fog;if(!s||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,m]=s.getFovAdjustedRange(this.transform._fov);if(d>m)return void(this.transform.fogCullDistSq=null);const _=d+.78*(m-d);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,s){if(this.width=t*a.exported.devicePixelRatio,this.height=s*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._layers[d].resize()}setup(){const t=this.context,s=new a.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(a.EXTENT,0),s.emplaceBack(0,a.EXTENT),s.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const d=new a.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(a.EXTENT,0),d.emplaceBack(0,a.EXTENT),d.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=t.createVertexBuffer(d,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const m=new a.StructArrayLayout2i4;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const _=new a.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(a.EXTENT,0,a.EXTENT,0),_.emplaceBack(0,a.EXTENT,0,a.EXTENT),_.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(_,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const x=new a.StructArrayLayout3ui6;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const b=new a.StructArrayLayout1ui2;for(const A of[0,1,3,2,0])b.emplaceBack(A);this.debugIndexBuffer=t.createIndexBuffer(b),this.emptyTexture=new a.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA),this.identityMat=a.create$1();const C=this.context.gl;this.stencilClearMode=new a.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(a.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(t,s.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,zs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s,d){if(!(s&&this.currentStencilSource!==s.id&&t.isTileClipped()&&d&&d.length))return;this.currentStencilSource=s.id;const m=this.context,_=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(a.ColorMode.disabled),m.setDepthMode(a.DepthMode.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of d){const C=s.getTile(b),A=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,{tileBoundsBuffer:M,tileBoundsIndexBuffer:z,tileBoundsSegments:F}=this.getTileBoundsBuffers(C);x.draw(m,_.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:_.ALWAYS,mask:0},A,255,_.KEEP,_.KEEP,_.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,zs(b.projMatrix),"$clipping",M,z,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new a.StencilMode({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new a.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,d=t.sort((x,b)=>b.overscaledZ-x.overscaledZ),m=d[d.length-1].overscaledZ,_=d[0].overscaledZ-m+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const x={};for(let b=0;b<_;b++)x[b+m]=new a.StencilMode({func:s.GEQUAL,mask:255},b+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=_,[x,d]}return[{[m]:a.StencilMode.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const s=1/8;return new a.ColorMode([t.CONSTANT_COLOR,t.ONE],new a.Color(s,s,s,0),[!0,!0,!0,!0])}return this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(t,s,d){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new a.DepthMode(d||this.context.gl.LEQUAL,s,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const d=this.style.order,m=this.style._sourceCaches;for(const A in m){const M=m[A];M.used&&M.prepare(this.context)}const _={},x={},b={};for(const A in m){const M=m[A];_[A]=M.getVisibleCoordinates(),x[A]=_[A].slice().reverse(),b[A]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<d.length;A++)if(this.style._layers[d[A]].is3D()){this.opaquePassCutoff=A;break}if(this.terrain&&(this.terrain.updateTileBinding(b),this.opaquePassCutoff=0),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const A of d){const M=this.style._layers[A],z=t._getLayerSourceCache(M);if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const F=z?x[z.id]:void 0;(M.type==="custom"||M.isSky()||F&&F.length)&&this.renderLayer(this,z,M,F)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let C=a.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(C=this.style.fog.properties.get("color")),this.context.clear({color:s.showOverdrawInspector?a.Color.black:C,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[d[this.currentLayer]],M=t._getLayerSourceCache(A);if(A.isSky())continue;const z=M?x[M.id]:void 0;this._renderTileClippingMasks(A,M,z),this.renderLayer(this,M,A,z)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const A=this.style._layers[d[this.currentLayer]],M=t._getLayerSourceCache(A);A.isSky()&&this.renderLayer(this,M,A,M?x[M.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;){const A=this.style._layers[d[this.currentLayer]],M=t._getLayerSourceCache(A);if(A.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(A)){if(A.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=M?(A.type==="symbol"?b:x)[M.id]:void 0;this._renderTileClippingMasks(A,M,M?_[M.id]:void 0),this.renderLayer(this,M,A,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let A=null;a.values(this.style._layers).forEach(M=>{const z=t._getLayerSourceCache(M);z&&!M.isHidden(this.transform.zoom)&&(!A||A.getSource().maxzoom<z.getSource().maxzoom)&&(A=z)}),A&&this.options.showTileBoundaries&&Ga.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const M=A.transform.padding;Po(A,A.transform.height-(M.top||0),3,gc),Po(A,M.bottom||0,3,Dt),fh(A,M.left||0,3,ja),fh(A,A.transform.width-(M.right||0),3,Np);const z=A.transform.centerPoint;(function(F,V,$,U){$a(F,V-1,$-10,2,20,U),$a(F,V-10,$-1,20,2,U)})(A,z.x,A.transform.height-z.y,ph)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%a.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,s,d,m){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||m&&m.length)&&(this.id=d.id,this.gpuTimingStart(d),Ga[d.type](t,s,d,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let d=this.gpuTimers[t.id];d||(d=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),d.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,d.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const s={};for(const d in t){const m=t[d],_=this.context.extTimerQuery,x=_.getQueryObjectEXT(m.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(m.query),s[d]=x}return s}translatePosMatrix(t,s,d,m,_){if(!d[0]&&!d[1])return t;const x=_?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(x){const A=Math.sin(x),M=Math.cos(x);d=[d[0]*M-d[1]*A,d[0]*A+d[1]*M]}const b=[_?d[0]:Ve(s,d[0],this.transform.zoom),_?d[1]:Ve(s,d[1],this.transform.zoom),0],C=new Float32Array(16);return a.translate(C,t,b),C}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),d=this.imageManager.getPattern(t.to.toString());return!s||!d}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,s=this.style&&this.style.fog,d=[];return this.terrain&&!this.terrain.renderingToTexture&&d.push("TERRAIN"),s&&!t&&s.getOpacity(this.transform.pitch)!==0&&d.push("FOG"),t&&d.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&d.push("OVERDRAW_INSPECTOR"),d}useProgram(t,s,d){this.cache=this.cache||{};const m=d||[],_=this.currentGlobalDefines().concat(m),x=La.cacheKey(t,_,s);return this.cache[x]||(this.cache[x]=new La(this.context,t,Ma[t],s,Up[t],_)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(t){this.terrain&&this.terrain.prepareDrawTile(t)}prepareDrawProgram(t,s,d){if(this.terrain&&this.terrain.renderingToTexture)return;const m=this.style.fog;if(m){const _=m.getOpacity(this.transform.pitch);_!==0&&s.setFogUniformValues(t,((x,b,C,A)=>{const M=b.properties.get("color"),z=x.frameCounter/1e3%1,F=[M.r/M.a,M.g/M.a,M.b/M.a,A];return{u_fog_matrix:C?x.transform.calculateFogTileMatrix(C):x.identityMat,u_fog_range:b.getFovAdjustedRange(x.transform._fov),u_fog_color:F,u_fog_horizon_blend:b.properties.get("horizon-blend"),u_fog_temporal_offset:z}})(this,m,d,_))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const m of d)s[m.key]=t[m.key]||new a.Tile(m,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}}class Lo{constructor(t=0,s=0,d=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=d,this.right=m}interpolate(t,s,d){return s.top!=null&&t.top!=null&&(this.top=a.number(t.top,s.top,d)),s.bottom!=null&&t.bottom!=null&&(this.bottom=a.number(t.bottom,s.bottom,d)),s.left!=null&&t.left!=null&&(this.left=a.number(t.left,s.left,d)),s.right!=null&&t.right!=null&&(this.right=a.number(t.right,s.right,d)),this}getCenter(t,s){const d=a.clamp((this.left+t-this.right)/2,0,t),m=a.clamp((this.top+s-this.bottom)/2,0,s);return new a.pointGeometry(d,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Lo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Tr(u,t){return[u[4*t],u[4*t+1],u[4*t+2],u[4*t+3]]}function bn(u,t,s){u[4*t+0]=s[0],u[4*t+1]=s[1],u[4*t+2]=s[2],u[4*t+3]=s[3]}function Za(u,t){const s=Tr(u,3);a.fromQuat(u,t),bn(u,3,s)}function xc(u,t){bn(u,3,[t[0],t[1],t[2],1])}function qa(u,t){const s=a.identity$1([]);return a.rotateZ$1(s,s,-t),a.rotateX$1(s,s,-u),s}function Er(u,t){const s=[u[0],u[1],0],d=[t[0],t[1],0];if(a.length(s)>=1e-15){const x=a.normalize([],s);a.scale(d,x,a.dot(d,x)),t[0]=d[0],t[1]=d[1]}const m=a.cross([],t,u);if(a.len(m)<1e-15)return null;const _=Math.atan2(-m[1],m[0]);return qa(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),_)}class vc{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){this._position=this._renderWorldCopies?function(s){if(!s)return;const d=Array.isArray(s)?new a.MercatorCoordinate(s[0],s[1],s[2]):s;return d.x=a.wrap(d.x,0,1),d}(t):t}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const d=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(t)):0,m=this.position,_=a.MercatorCoordinate.fromLngLat(t,d),x=[_.x-m.x,_.y-m.y,_.z-m.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=Er(x,s)}setPitchBearing(t,s){this.orientation=qa(a.degToRad(t),a.degToRad(-s))}}class Ro{constructor(t,s){this._transform=a.identity([]),this._orientation=a.identity$1([]),s&&(this._orientation=s,Za(this._transform,this._orientation)),t&&xc(this._transform,t)}get mercatorPosition(){const t=this.position;return new a.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=Tr(this._transform,3);return[t[0],t[1],t[2]]}set position(t){xc(this._transform,t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,Za(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=qa(t,s),Za(this._transform,this._orientation)}forward(){const t=Tr(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=Tr(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=Tr(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const d=new Float64Array(16);return a.invert(d,this.getWorldToCamera(t,s)),d}getWorldToCameraPosition(t,s,d){const m=this.position;a.scale(m,m,-t);const _=new Float64Array(16);return a.fromScaling(_,[d,d,d]),a.translate(_,_,m),_[10]*=s,_}getWorldToCamera(t,s){const d=new Float64Array(16),m=new Float64Array(4),_=this.position;return a.conjugate(m,this._orientation),a.scale(_,_,-t),a.fromQuat(d,m),a.translate(d,d,_),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=s,d[9]*=s,d[10]*=s,d[11]*=s,d}getCameraToClipPerspective(t,s,d,m){const _=new Float64Array(16);return a.perspective(_,t,s,d,m),_}getDistanceToElevation(t){const s=t===0?0:a.mercatorZfromAltitude(t,this.position[1]),d=this.forward();return(s-this.position[2])/d[2]}clone(){return new Ro([...this.position],[...this.orientation])}}function Wa(u,t){const s=wc(u),d=function(_,x,b,C,A){const M=new a.LngLat(b.lng-180*Qr,b.lat),z=new a.LngLat(b.lng+180*Qr,b.lat),F=_.project(M.lng,M.lat),V=_.project(z.lng,z.lat),$=-Math.atan2(V.y-F.y,V.x-F.x),U=a.MercatorCoordinate.fromLngLat(b);U.y=a.clamp(U.y,-.999975,.999975);const W=U.toLngLat(),N=_.project(W.lng,W.lat),X=a.MercatorCoordinate.fromLngLat(W);X.x+=Qr;const K=X.toLngLat(),j=_.project(K.lng,K.lat),J=gh(j.x-N.x,j.y-N.y,$),ne=a.MercatorCoordinate.fromLngLat(W);ne.y+=Qr;const ve=ne.toLngLat(),xe=_.project(ve.lng,ve.lat),Ee=gh(xe.x-N.x,xe.y-N.y,$),Se=Math.abs(J.x)/Math.abs(Ee.y),Fe=a.identity([]);a.rotateZ(Fe,Fe,-$*(1-(A?0:C)));const Te=a.identity([]);return a.scale$1(Te,Te,[1,1-(1-Se)*C,1]),Te[4]=-Ee.x/Ee.y*C,a.rotateZ(Te,Te,$),a.multiply(Te,Fe,Te),Te}(u.projection,0,u.center,s,t),m=Ls(u);return a.scale$1(d,d,[m,m,1]),d}function Ls(u){const t=u.projection,s=wc(u),d=eo(t,u.center),m=eo(t,a.LngLat.convert(t.center));return Math.pow(2,d*s+(1-s)*m)}function wc(u){const t=u.projection.range;if(!t)return 0;const s=Math.max(u.width,u.height),d=Math.log(s/1024)/Math.LN2;return a.smoothstep(t[0]+d,t[1]+d,u.zoom)}const Qr=1/4e4;function eo(u,t){const s=a.clamp(t.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),d=new a.LngLat(t.lng-180*Qr,s),m=new a.LngLat(t.lng+180*Qr,s),_=u.project(d.lng,s),x=u.project(m.lng,s),b=a.MercatorCoordinate.fromLngLat(d),C=a.MercatorCoordinate.fromLngLat(m),A=x.x-_.x,M=x.y-_.y,z=C.x-b.x,F=C.y-b.y,V=Math.sqrt((z*z+F*F)/(A*A+M*M));return Math.log(V)/Math.LN2}function gh(u,t,s){const d=Math.cos(s),m=Math.sin(s);return{x:u*d-t*m,y:u*m+t*d}}class bc{constructor(t,s,d,m,_){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=d==null?0:d,this._maxPitch=m==null?60:m,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Lo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ro,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const t=new bc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.setMaxBounds(this.getMaxBounds()),t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._cameraZoom=this._cameraZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.setProjection(this.getProjection()),t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,t?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(t){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),t&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(t){t==null&&(t={name:"mercator"}),this.projectionOptions=t;const s=this.projection?this.getProjection():void 0;return this.projection=a.getProjection(t),!_e(s,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.wrap===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;var d;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(d=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d),function(m,_,x){var b=_[0],C=_[1],A=_[2],M=_[3],z=Math.sin(x),F=Math.cos(x);m[0]=b*F+A*z,m[1]=C*F+M*z,m[2]=b*-z+A*F,m[3]=C*-z+M*F}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=a.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return t===-1?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}_updateCameraOnTerrain(){const t=this.cameraToCenterDistance/this.worldSize,s=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(s+t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let m=0,_=0;for(let x=0;x<s.length;x++){const b=new a.pointGeometry(s[x][0]*this.width,d+s[x][1]*(this.height-d)),C=t.pointCoordinate(b);if(!C)continue;const A=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);m+=C[3]*A,_+=A}return _===0?NaN:m/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const t=this._cameraZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=a.mercatorZfromAltitude(s,this.center.lat),m=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),x=Math.max(m-d,_);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const m=a.length(a.sub([],this._camera.position,d));return a.clamp(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!a.exactEquals(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];a.exactEquals$1(d,this._camera.position)||(this._setCameraPosition(d),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new vc;return s.position=new a.MercatorCoordinate(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!a.length$1(t))return!1;a.normalize$1(t,t);const s=a.transformQuat([],[0,0,-1],t),d=a.transformQuat([],[0,-1,0],t);if(d[2]<0)return!1;const m=Er(s,d);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=a.clamp(t[2],m/d,m/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,d){this._unmodified=!1,this._edgeInsets.interpolate(t,s,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new a.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new a.pointGeometry(0,0)),m=this.pointCoordinate(new a.pointGeometry(this.width,0)),_=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),x=this.pointCoordinate(new a.pointGeometry(0,this.height)),b=Math.floor(Math.min(d.x,m.x,_.x,x.x)),C=Math.floor(Math.max(d.x,m.x,_.x,x.x)),A=1;for(let M=b-A;M<=C+A;M++)M!==0&&s.push(new a.UnwrappedTileID(M,t))}return s}coveringTiles(t){let s=this.coveringZoomLevel(t);const d=s,m=this.elevation&&!t.isTerrainDEM,_=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const x=this.locationCoordinate(this.center),b=1<<s,C=[b*x.x,b*x.y,0],A=at.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s),M=this.pointCoordinate(this.getCameraPoint()),z=b*a.mercatorZfromAltitude(1,this.center.lat),F=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),V=[b*M.x,b*M.y,F],$=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),U=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&_?s:0,W=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,N=t.isTerrainDEM?-W:this._elevation?this._elevation.getMinElevationBelowMSL():0,X=Ls(this),K=ye=>{const Ue=1/4e4,Qe=new a.MercatorCoordinate(ye.x+Ue,ye.y,ye.z),lt=new a.MercatorCoordinate(ye.x,ye.y+Ue,ye.z),ut=ye.toLngLat(),pt=Qe.toLngLat(),ft=lt.toLngLat(),st=this.locationCoordinate(ut),_t=this.locationCoordinate(pt),Bt=this.locationCoordinate(ft),fi=Math.hypot(_t.x-st.x,_t.y-st.y),Ai=Math.hypot(Bt.x-st.x,Bt.y-st.y);return Math.sqrt(fi*Ai)*X/Ue},j=(ye,Ue,Qe,lt,ut,pt)=>{const ft=a.tileTransform({z:ye,x:Ue,y:Qe},this.projection);return new Xe([(lt+ft.x/ft.scale)*b,b*(ft.y/ft.scale),ut],[(lt+ft.x2/ft.scale)*b,b*(ft.y2/ft.scale),pt])},J=ye=>({aabb:j(0,0,0,ye,N,W),zoom:0,x:0,y:0,wrap:ye,fullyVisible:!1}),ne=[];let ve=[];const xe=s,Ee=t.reparseOverscaled?d:s,Se=ye=>{if(!this._elevation||!ye.tileID)return;const Ue=this._elevation.getMinMaxForTile(ye.tileID),Qe=ye.aabb;Ue?(Qe.min[2]=Ue.min,Qe.max[2]=Ue.max,Qe.center[2]=(Qe.min[2]+Qe.max[2])/2):(ye.shouldSplit=Oe(ye),ye.shouldSplit||(Qe.min[2]=Qe.max[2]=Qe.center[2]=this._centerAltitude))},Fe=ye=>ye*ye,Te=Fe((F-this._centerAltitude)*z),Oe=ye=>{if(ye.zoom<U)return!0;if(ye.zoom===xe)return!1;if(ye.shouldSplit!=null)return ye.shouldSplit;const Ue=ye.aabb.distanceX(V),Qe=ye.aabb.distanceY(V);let lt=Te;m&&(lt=Fe(ye.aabb.distanceZ(V)*z));let ut=1;if(!_&&d<=5){const ft=Math.pow(2,ye.zoom),st=K(new a.MercatorCoordinate((ye.x+.5)/ft,(ye.y+.5)/ft));ut=st>.85?1:st}const pt=Ue*Ue+Qe*Qe+lt;return pt<Fe((1<<xe-ye.zoom)*$*ut*((ft,st)=>{if(st*Fe(.707)<ft)return 1;const _t=Math.sqrt(st/ft);return _t/(1.4144271570014144+(Math.pow(1.1,_t-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(lt,Te),pt))};if(this.renderWorldCopies)for(let ye=1;ye<=3;ye++)ne.push(J(-ye)),ne.push(J(ye));for(ne.push(J(0));ne.length>0;){const ye=ne.pop(),Ue=ye.x,Qe=ye.y;let lt=ye.fullyVisible;if(!lt){const ut=ye.aabb.intersects(A);if(ut===0)continue;lt=ut===2}if(ye.zoom!==xe&&Oe(ye))for(let ut=0;ut<4;ut++){const pt=(Ue<<1)+ut%2,ft=(Qe<<1)+(ut>>1),st={aabb:this.projection.name==="mercator"?ye.aabb.quadrant(ut):j(ye.zoom+1,pt,ft,ye.wrap,0,0),zoom:ye.zoom+1,x:pt,y:ft,wrap:ye.wrap,fullyVisible:lt,tileID:void 0,shouldSplit:void 0};m&&(st.tileID=new a.OverscaledTileID(ye.zoom+1===xe?Ee:ye.zoom+1,ye.wrap,ye.zoom+1,pt,ft),Se(st)),ne.push(st)}else{const ut=ye.zoom===xe?Ee:ye.zoom;if(t.minzoom&&t.minzoom>ut)continue;const pt=C[0]-(.5+Ue+(ye.wrap<<ye.zoom))*(1<<s-ye.zoom),ft=C[1]-.5-Qe,st=ye.tileID?ye.tileID:new a.OverscaledTileID(ut,ye.wrap,ye.zoom,Ue,Qe);ve.push({tileID:st,distanceSq:pt*pt+ft*ft})}}if(this.fogCullDistSq){const ye=this.fogCullDistSq,Ue=this.horizonLineFromTop();ve=ve.filter(Qe=>{const lt=[0,0,0,1],ut=[a.EXTENT,a.EXTENT,0,1],pt=this.calculateFogTileMatrix(Qe.tileID.toUnwrapped());a.transformMat4(lt,lt,pt),a.transformMat4(ut,ut,pt);const ft=a.getAABBPointSquareDist(lt,ut);if(ft===0)return!0;let st=!1;const _t=this._elevation;if(_t&&ft>ye&&Ue!==0){const Bt=this.calculateProjMatrix(Qe.tileID.toUnwrapped());let fi;t.isTerrainDEM||(fi=_t.getMinMaxForTile(Qe.tileID)),fi||(fi={min:N,max:W});const Ai=a.furthestTileCorner(this.rotation),Fi=[Ai[0]*a.EXTENT,Ai[1]*a.EXTENT,fi.max];a.transformMat4$1(Fi,Fi,Bt),st=(1-Fi[1])*this.height*.5<Ue}return ft<ye||st})}return ve.sort((ye,Ue)=>ye.distanceSq-Ue.distanceSq).map(ye=>ye.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=a.clamp(t.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),d=this.projection.project(t.lng,s);return new a.pointGeometry(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,s){const d=this.pointCoordinate(s),m=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(t);this.setLocation(new a.MercatorCoordinate(_.x-(d.x-m.x),_.y-(d.y-m.y)))}setLocation(t){this.center=this.coordinateLocation(t),this.renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this._coordinatePoint(this.locationCoordinate(t),!1)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,s){const d=s?a.mercatorZfromAltitude(s,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new a.MercatorCoordinate(m.x,m.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const d=s!=null?s:this._centerAltitude,m=[t.x,t.y,0,1],_=[t.x,t.y,1,1];a.transformMat4(m,m,this.pixelMatrixInverse),a.transformMat4(_,_,this.pixelMatrixInverse);const x=_[3];a.scale$2(m,m,1/m[3]),a.scale$2(_,_,1/x);const b=m[2],C=_[2];return{p0:m,p1:_,t:b===C?0:(d-b)/(C-b)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return a.transformMat4(s,s,this.pixelMatrixInverse),a.transformMat4(d,d,this.pixelMatrixInverse),a.scale$2(s,s,1/s[3]),a.scale$2(d,d,1/d[3]),s[2]=a.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,d[2]=a.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,a.scale$2(s,s,1/this.worldSize),a.scale$2(d,d,1/this.worldSize),new Pe([s[0],s[1],s[2]],a.normalize([],a.sub([],d,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:d,t:m}=t,_=a.mercatorZfromAltitude(s[2],this._center.lat),x=a.mercatorZfromAltitude(d[2],this._center.lat);return new a.MercatorCoordinate(a.number(s[0],d[0],m)/this.worldSize,a.number(s[1],d[1],m)/this.worldSize,a.number(_,x,m))}pointCoordinate(t,s=this._centerAltitude){const d=this.horizonLineFromTop(!1),m=new a.pointGeometry(t.x,Math.max(d,t.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(m,s))}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const s=this.elevation;let d=this.elevation.pointCoordinate(t);if(d)return new a.MercatorCoordinate(d[0],d[1],d[2]);let m=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t);const x=.02*_,b=t.clone();for(let C=0;C<10&&_-m>x;C++){b.y=a.number(m,_,.66);const A=s.pointCoordinate(b);A?(_=b.y,d=A):m=b.y}return d?new a.MercatorCoordinate(d[0],d[1],d[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const s=this.horizonLineFromTop();return t.y<s}}_coordinatePoint(t,s){const d=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return a.transformMat4(m,m,this.pixelMatrix),m[3]>0?new a.pointGeometry(m[0]/m[3],m[1]/m[3]):new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,s){const d=new a.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),m=new a.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),_=new a.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),x=new a.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let b=this.pointCoordinate(d,t),C=this.pointCoordinate(m,t);const A=this.pointCoordinate(_,s),M=this.pointCoordinate(x,s),z=(F,V)=>(V.y-F.y)/(V.x-F.x);return b.y>1&&C.y>=0?b=new a.MercatorCoordinate((1-M.y)/z(M,b)+M.x,1):b.y<0&&C.y<=1&&(b=new a.MercatorCoordinate(-M.y/z(M,b)+M.x,0)),C.y>1&&b.y>=0?C=new a.MercatorCoordinate((1-A.y)/z(A,C)+A.x,1):C.y<0&&b.y<=1&&(C=new a.MercatorCoordinate(-A.y/z(A,C)+A.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(b)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(A))}_getBounds3D(){const t=this.elevation,s=t.visibleDemTiles.reduce((d,m)=>{if(m.dem){const _=m.dem.tree;d.min=Math.min(d.min,_.minimums[0]),d.max=Math.max(d.max,_.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBounds(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,d=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){let d,m,_;const x=t.canonical,b=a.identity(new Float64Array(16));if(this.projection.name==="mercator")d=s/this.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*t.wrap)*d,_=x.y*d;else{const C=a.tileTransform(x,this.projection);d=1,m=C.x+t.wrap*C.scale,_=C.y,a.scale$1(b,b,[d/C.scale,d/C.scale,this.pixelsPerMeter/this.worldSize])}return a.translate(b,b,[m,_,0]),a.scale$1(b,b,[d/a.EXTENT,d/a.EXTENT,1]),b}calculateDistanceTileData(t){const s=t.key,d=this._distanceTileDataCache;if(d[s])return d[s];const m=t.canonical,_=1/this.height,x=this.cameraWorldSize/this.zoomScale(m.z),b=(m.x+Math.pow(2,m.z)*t.wrap)*x,C=m.y*x,A=this.point,M=this.angle,z=Math.sin(-M),F=-Math.cos(-M);return d[s]={bearing:[z,F],center:[(A.x-b)*_,(A.y-C)*_],scale:x/a.EXTENT*_},d[s]}calculateFogTileMatrix(t){const s=t.key,d=this._fogTileMatrixCache;if(d[s])return d[s];const m=this.calculatePosMatrix(t,this.cameraWorldSize);return a.multiply(m,this.worldToFogMatrix,m),d[s]=new Float32Array(m),d[s]}calculateProjMatrix(t,s=!1){const d=t.key,m=s?this._alignedProjMatrixCache:this._projMatrixCache;if(m[d])return m[d];const _=this.calculatePosMatrix(t,this.worldSize);return a.multiply(_,this.projection.name==="mercator"?s?this.alignedProjMatrix:this.projMatrix:this.mercatorMatrix,_),m[d]=new Float32Array(_),m[d]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[s])return d[s];const m=function(_,x){const{scale:b}=_.tileTransform,C=b*a.EXTENT/(_.tileSize*Math.pow(2,x.zoom-_.tileID.overscaledZ+_.tileID.canonical.z));return A=new Float32Array(4),F=(M=x.inverseAdjustmentMatrix)[1],V=M[2],$=M[3],W=(z=[C,C])[1],A[0]=M[0]*(U=z[0]),A[1]=F*U,A[2]=V*W,A[3]=$*W,A;var A,M,z,F,V,$,U,W}(t,this);return d[s]=m,d[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const s=this._camera.position,d=this._camera.forward();if(s[2]<=0||d[2]>=0)return;const m=a.mercatorZfromAltitude(1,this._center.lat);s[2]/=m,d[2]/=m,a.normalize(d,d);const _=t.raycast(s,d,t.exaggeration());if(_){const x=a.scaleAndAdd([],s,d,_),b=new a.MercatorCoordinate(x[0],x[1],a.mercatorZfromAltitude(x[2],a.latFromMercatorY(x[1]))),C=this._camera.position,A=b.z+a.length([b.x-C[0],b.y-C[1],b.z-C[2]]);this._cameraZoom=this._zoomFromMercatorZ(A),this._centerAltitude=b.toAltitude(),this._center=this.coordinateLocation(b),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const s=t.getAtPointOrZero(this._camera.mercatorPosition),d=this._minimumHeightOverTerrain()*Math.cos(a.degToRad(this._maxPitch)),m=a.mercatorZfromAltitude(s,this._center.lat),_=this._camera.position[2]-m;if(_<d){const x=this.locationCoordinate(this._center,this._centerAltitude),b=this._camera.mercatorPosition,C=[x.x-b.x,x.y-b.y,x.z-b.z],A=a.length(C);C[2]-=d-_;const M=a.length(C);if(M===0)return;a.scale(C,C,A/M),this._camera.position=[x.x-C[0],x.y-C[1],x.z-C[2]],this._camera.orientation=Er(C,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.name!=="mercator"){const z=this.center;return z.lat=a.clamp(z.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(z.lng=a.clamp(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}const t=this._unmodified,{x:s,y:d}=this.point;let m=0,_=s,x=d;const b=this.width/2,C=this.height/2,A=this.worldMinY*this.scale,M=this.worldMaxY*this.scale;if(d-C<A&&(x=A+C),d+C>M&&(x=M-C),M-A<this.height&&(m=Math.max(m,this.height/(M-A)),x=(M+A)/2),this.maxBounds||!this.renderWorldCopies){const z=this.worldMinX*this.scale,F=this.worldMaxX*this.scale,V=this.worldSize/2-(z+F)/2;_=(s+V+this.worldSize)%this.worldSize-V,_-b<z&&(_=z+b),_+b>F&&(_=F-b),F-z<this.width&&(m=Math.max(m,this.width/(F-z)),_=(F+z)/2)}_===s&&x===d||(this.center=this.unproject(new a.pointGeometry(_,x))),m&&(this.zoom+=this.scaleZoom(m)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const s=this.pixelsPerMeter;this._updateCameraState();const d=Math.PI/2+this._pitch,m=this.fovAboveCenter,_=this.elevation?this.elevation.getMinElevationBelowMSL()*s:0,x=(this._camera.position[2]*this.worldSize-_)/Math.cos(this._pitch),b=Math.sin(m)*x/Math.sin(a.clamp(Math.PI-d-m,.01,Math.PI-.01)),C=this.point,A=C.x,M=C.y,z=Math.cos(Math.PI/2-this._pitch)*b+x,F=Math.min(1.01*z,x*(1/this._horizonShift)),V=this.height/50,$=this._camera.getWorldToCamera(this.worldSize,s),U=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,V,F);U[8]=2*-t.x/this.width,U[9]=2*t.y/this.height;let W=a.mul$1([],U,$);if(this.projection.name!=="mercator"){const Fe=this.locationCoordinate(this.center),Te=a.identity([]);a.translate(Te,Te,[Fe.x*this.worldSize,Fe.y*this.worldSize,0]),a.multiply(Te,Te,Wa(this)),a.translate(Te,Te,[-Fe.x*this.worldSize,-Fe.y*this.worldSize,0]),a.multiply(W,W,Te),this.inverseAdjustmentMatrix=function(Oe){const ye=Wa(Oe,!0);return ke([],[ye[0],ye[1],ye[4],ye[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale$1([],W,[this.worldSize,this.worldSize,this.worldSize/s]),this.projMatrix=W,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const N=new Float32Array(16);a.identity(N),a.scale$1(N,N,[1,-1,1]),a.rotateX(N,N,this._pitch),a.rotateZ(N,N,this.angle);const X=a.perspective(new Float32Array(16),this._fov,this.width/this.height,V,F),K=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;X[8]=2*-t.x/this.width,X[9]=2*(t.y+K)/this.height,this.skyboxMatrix=a.multiply(N,X,N);const j=this.width%2/2,J=this.height%2/2,ne=Math.cos(this.angle),ve=Math.sin(this.angle),xe=A-Math.round(A)+ne*j+ve*J,Ee=M-Math.round(M)+ne*J+ve*j,Se=new Float64Array(W);if(a.translate(Se,Se,[xe>.5?xe-1:xe,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=Se,W=a.create$1(),a.scale$1(W,W,[this.width/2,-this.height/2,1]),a.translate(W,W,[1,-1,0]),this.labelPlaneMatrix=W,W=a.create$1(),a.scale$1(W,W,[1,-1,1]),a.translate(W,W,[-1,-1,0]),a.scale$1(W,W,[2/this.width,2/this.height,1]),this.glCoordMatrix=W,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},W=a.invert(new Float64Array(16),this.pixelMatrix),!W)throw new Error("failed to invert matrix");this.pixelMatrixInverse=W,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,s=this.cameraPixelsPerMeter,d=this._camera.position,m=1/this.height,_=[t,t,s];a.scale(_,_,m),a.scale(d,d,-1),a.multiply$1(d,d,_);const x=a.create$1();a.translate(x,x,d),a.scale$1(x,x,_),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,m)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const t=this._camera.forward(),s=this.cameraToCenterDistance,d=this.point,m=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-a.mercatorZfromAltitude(this._centerAltitude,this.center.lat),_=this.cameraToCenterDistance/m;this._camera.position=[d.x/this.worldSize-t[0]*s/_,d.y/this.worldSize-t[1]*s/_,a.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-t[2]*s/_]}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=t[2];let m=1;d>0&&(m=Math.min((s-this._camera.position[2])/d,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,t,m),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:d,bearing:m}=this._camera.getPitchBearing(),_=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat),x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),b=Math.max((t[2]-_)/Math.cos(d),x),C=this._zoomFromMercatorZ(b);a.scaleAndAdd(t,t,s,b),this._pitch=a.clamp(d,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(m,-Math.PI,Math.PI),this._setZoom(a.clamp(C,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new a.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||this.projection.name!=="mercator"&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(t,s){const d=Math.min(t.x,s.x),m=Math.max(t.x,s.x),_=Math.min(t.y,s.y),x=Math.max(t.y,s.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const b=[new a.pointGeometry(d,_),new a.pointGeometry(m,x),new a.pointGeometry(d,x),new a.pointGeometry(m,_)],C=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(const M of b){const z=this.pointRayIntersection(M);if(z.t<0)return!0;const F=this.rayIntersectionCoordinate(z);if(F.x<C||F.y<0||F.x>A||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.pointGeometry(0,0),new a.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,s){const d=a.length(a.sub([],this._camera.position,t)),m=this._zoomFromMercatorZ(d)+s;return d-this._mercatorZfromZoom(m)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,t))}}function Tc(u,t){let s=!1,d=null;const m=()=>{d=null,s&&(u(),d=setTimeout(m,t),s=!1)};return()=>(s=!0,d||m(),d)}class Xa{constructor(t){this._hashName=t&&encodeURIComponent(t),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Tc(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,a.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return a.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,m),x=Math.round(s.lng*_)/_,b=Math.round(s.lat*_)/_,C=this._map.getBearing(),A=this._map.getPitch();let M="";if(M+=t?`/${x}/${b}/${d}`:`${d}/${b}/${x}`,(C||A)&&(M+="/"+Math.round(10*C)/10),A&&(M+=`/${Math.round(A)}`),this._hashName){const z=this._hashName;let F=!1;const V=a.window.location.hash.slice(1).split("&").map($=>{const U=$.split("=")[0];return U===z?(F=!0,`${U}=${M}`):$}).filter($=>$);return F||V.push(`${z}=${M}`),`#${V.join("&")}`}return`#${M}`}_getCurrentHash(){const t=a.window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(s=d)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:s,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,t)}}const Bo={linearity:.3,easing:a.bezier(0,0,.3,1)},yh=a.extend({deceleration:2500,maxSpeed:1400},Bo),xh=a.extend({deceleration:20,maxSpeed:1400},Bo),Ha=a.extend({deceleration:1e3,maxSpeed:360},Bo),Ec=a.extend({deceleration:1e3,maxSpeed:90},Bo);class vh{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=a.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)s.zoom+=_.zoomDelta||0,s.bearing+=_.bearingDelta||0,s.pitch+=_.pitchDelta||0,_.panDelta&&s.pan._add(_.panDelta),_.around&&(s.around=_.around),_.pinchAround&&(s.pinchAround=_.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const _=Bs(s.pan.mag(),d,a.extend({},yh,t||{}));m.offset=s.pan.mult(_.amount/s.pan.mag()),m.center=this._map.transform.center,Rs(m,_)}if(s.zoom){const _=Bs(s.zoom,d,xh);m.zoom=this._map.transform.zoom+_.amount,Rs(m,_)}if(s.bearing){const _=Bs(s.bearing,d,Ha);m.bearing=this._map.transform.bearing+a.clamp(_.amount,-179,179),Rs(m,_)}if(s.pitch){const _=Bs(s.pitch,d,Ec);m.pitch=this._map.transform.pitch+_.amount,Rs(m,_)}if(m.zoom||m.bearing){const _=s.pinchAround===void 0?s.around:s.pinchAround;m.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),a.extend(m,{noMoveStart:!0})}}function Rs(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function Bs(u,t,s){const{maxSpeed:d,linearity:m,deceleration:_}=s,x=a.clamp(u*m/(t/1e3),-d,d),b=Math.abs(x)/(_*m);return{easing:s.easing,duration:1e3*b,amount:x*(b/2)}}class Ki extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,d,m={}){const _=oe.mousePos(s.getCanvasContainer(),d),x=s.unproject(_);super(t,a.extend({point:_,lngLat:x,originalEvent:d},m)),this._defaultPrevented=!1,this.target=s}}class Fs extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,d){const m=t==="touchend"?d.changedTouches:d.touches,_=oe.touchPos(s.getCanvasContainer(),m),x=_.map(C=>s.unproject(C)),b=_.reduce((C,A,M,z)=>C.add(A.div(z.length)),new a.pointGeometry(0,0));super(t,{points:_,point:b,lngLats:x,lngLat:s.unproject(b),originalEvent:d}),this._defaultPrevented=!1}}class Fo extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,d){super(t,{originalEvent:d}),this._defaultPrevented=!1}}class wh{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Fo(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Ki(t.type,this._map,t))}mouseup(t){this._map.fire(new Ki(t.type,this._map,t))}preclick(t){const s=a.extend({},t);s.type="preclick",this._map.fire(new Ki(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Ki(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Ki(t.type,this._map,t))}mouseover(t){this._map.fire(new Ki(t.type,this._map,t))}mouseout(t){this._map.fire(new Ki(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Fs(t.type,this._map,t))}touchmove(t){this._map.fire(new Fs(t.type,this._map,t))}touchend(t){this._map.fire(new Fs(t.type,this._map,t))}touchcancel(t){this._map.fire(new Fs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bh{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ki(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ki("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Ki(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Th{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(oe.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const d=s;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=d,this._box||(this._box=oe.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(m.x,d.x),x=Math.max(m.x,d.x),b=Math.min(m.y,d.y),C=Math.max(m.y,d.y);this._map._requestDomTask(()=>{this._box&&(oe.setTransform(this._box,`translate(${_}px,${b}px)`),this._box.style.width=x-_+"px",this._box.style.height=C-b+"px")})}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const d=this._startPos,m=s;if(this.reset(),oe.suppressClick(),d.x!==m.x||d.y!==m.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(d,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(oe.remove(this._box),this._box=null),oe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new a.Event(t,{originalEvent:s}))}}function Ya(u,t){const s={};for(let d=0;d<u.length;d++)s[u[d].identifier]=t[d];return s}class Eh{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const _=new a.pointGeometry(0,0);for(const x of m)_._add(x);return _.div(m.length)}(s),this.touches=Ya(d,s)))}touchmove(t,s,d){if(this.aborted||!this.centroid)return;const m=Ya(d,s);for(const _ in this.touches){const x=this.touches[_],b=m[_];(!b||b.dist(x)>30)&&(this.aborted=!0)}}touchend(t,s,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Ka{constructor(t){this.singleTap=new Eh(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,d){this.singleTap.touchstart(t,s,d)}touchmove(t,s,d){this.singleTap.touchmove(t,s,d)}touchend(t,s,d){const m=this.singleTap.touchend(t,s,d);if(m){const _=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(m)<30;if(_&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Bi{constructor(){this._zoomIn=new Ka({numTouches:1,numTaps:2}),this._zoomOut=new Ka({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,d){this._zoomIn.touchstart(t,s,d),this._zoomOut.touchstart(t,s,d)}touchmove(t,s,d){this._zoomIn.touchmove(t,s,d),this._zoomOut.touchmove(t,s,d)}touchend(t,s,d){const m=this._zoomIn.touchend(t,s,d),_=this._zoomOut.touchend(t,s,d);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(m)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const jp={0:1,2:2};class Bn{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const d=oe.mouseButton(t);this._correctButton(t,d)&&(this._lastPoint=s,this._eventButton=d)}mousemoveWindow(t,s){const d=this._lastPoint;if(d){if(t.preventDefault(),function(m,_){const x=jp[_];return m.buttons===void 0||(m.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(d,s)}}mouseupWindow(t){this._lastPoint&&oe.mouseButton(t)===this._eventButton&&(this._moved&&oe.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sh extends Bn{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class nr extends Bn{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const d=.8*(s.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){t.preventDefault()}}class to extends Bn{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const d=-.5*(s.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){t.preventDefault()}}class $p{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(t,s,d){return this._calculateTransform(t,s,d)}touchmove(t,s,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,s,d)}}touchend(t,s,d){this._calculateTransform(t,s,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,d){d.length>0&&(this._active=!0);const m=Ya(d,s),_=new a.pointGeometry(0,0),x=new a.pointGeometry(0,0);let b=0;for(const A in m){const M=m[A],z=this._touches[A];z&&(_._add(M),x._add(M.sub(z)),b++,m[A]=M)}if(this._touches=m,b<this._minTouches||!x.mag())return;const C=x.div(b);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(b),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=oe.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Sc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,s,d){return{}}touchstart(t,s,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,d){if(!this._firstTwoTouches)return;t.preventDefault();const[m,_]=this._firstTwoTouches,x=Ja(d,s,m),b=Ja(d,s,_);if(!x||!b)return;const C=this._aroundCenter?null:x.add(b).div(2);return this._move([x,b],C,t)}touchend(t,s,d){if(!this._firstTwoTouches)return;const[m,_]=this._firstTwoTouches,x=Ja(d,s,m),b=Ja(d,s,_);x&&b||(this._active&&oe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ja(u,t,s){for(let d=0;d<u.length;d++)if(u[d].identifier===s)return t[d]}function Ch(u,t){return Math.log(u/t)/Math.LN2}class Ih extends Sc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ch(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ch(this._distance,d),pinchAround:s}}}function Oo(u,t){return 180*u.angleWith(t)/Math.PI}class qn extends Sc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const d=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Oo(this._vector,d),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,d=Oo(t,this._startVector);return Math.abs(d)<s}}function Qa(u){return Math.abs(u.y)>Math.abs(u.x)}class Ah extends Sc{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,Qa(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,d){const m=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&d.touches.length<3)&&(this._valid=this.gestureBeginsVertically(m,_,d.timeStamp),this._valid))return this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+_.y)/2*-.5}}gestureBeginsVertically(t,s,d){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,_=s.mag()>=2;if(!m&&!_)return;if(!m||!_)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const x=t.y>0==s.y>0;return Qa(t)&&Qa(s)&&x}}const Os={panStep:100,bearingStep:15,pitchStep:10};class Je{constructor(){const t=Os;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,d=0,m=0,_=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:b=>{const C=b.getZoom();b.easeTo({duration:300,easeId:"keyboardHandler",easing:Mh,zoom:s?Math.round(C)+s*(t.shiftKey?2:1):C,bearing:b.getBearing()+d*this._bearingStep,pitch:b.getPitch()+m*this._pitchStep,offset:[-_*this._panStep,-x*this._panStep],center:b.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mh(u){return u*(2-u)}const Cc=4.000244140625;class Us{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=a.exported.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,s!==0&&s%Cc==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=oe.mousePos(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,s=()=>t._terrainEnabled()?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Cc?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&A!==0&&(A=1/A);const M=s(),z=Math.pow(2,M),F=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(F*A))),this._type==="wheel"&&(this._startZoom=s(),this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,_=this._easing;let x,b=!1;if(this._type==="wheel"&&m&&_){const C=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),A=_(C);x=a.number(m,d,A),C<1?this._frameId||(this._frameId=!0):b=!0}else x=d,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!b,zoomDelta:x-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=a.ease;if(this._prevEase){const d=this._prevEase,m=(a.exported.now()-d.start)/d.duration,_=d.easing(m+.01)-d.easing(m),x=.27/Math.sqrt(_*_+1e-4)*.01,b=Math.sqrt(.0729-x*x);s=a.bezier(x,b,.25,1)}return this._prevEase={start:a.exported.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=oe.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!a.window.document.fullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Ns{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class kh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zh{constructor(){this._tap=new Ka({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,s,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=s[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,s,d))}touchmove(t,s,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=s[0],_=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,s,d)}touchend(t,s,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,s,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ph{constructor(t,s,d){this._el=t,this._mousePan=s,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Dh{constructor(t,s,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Lh{constructor(t,s,d,m){this._el=t,this._touchZoom=s,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Vs=u=>u.zoom||u.drag||u.pitch||u.rotate;class Rh extends a.Event{}class el{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const d=a.sub([],s,t);this.radius=a.length(d[2]<0?a.div([],d,this.constants):[d[0],d[1],0])}projectRay(t){a.div(t,t,this.constants),a.normalize(t,t),a.mul$2(t,t,this.constants);const s=a.scale([],t,this.radius);if(s[2]>0){const d=a.scale([],[0,0,1],a.dot(s,[0,0,1])),m=a.scale([],a.normalize([],[s[0],s[1],0]),this.radius),_=a.add([],s,a.scale([],a.sub([],a.add([],m,d),s),2));s[0]=_[0],s[1]=_[1]}return s}}function Uo(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class tl{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vh(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new el,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),a.bindAll(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[m,_,x]of this._listeners)oe.addEventListener(m,_,m===a.window.document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,s,d]of this._listeners)oe.removeEventListener(t,s,t===a.window.document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(t){const s=this._map,d=s.getCanvasContainer();this._add("mapEvent",new wh(s,t));const m=s.boxZoom=new Th(s,t);this._add("boxZoom",m);const _=new Bi,x=new kh;s.doubleClickZoom=new Ns(x,_),this._add("tapZoom",_),this._add("clickZoom",x);const b=new zh;this._add("tapDragZoom",b);const C=s.touchPitch=new Ah(s);this._add("touchPitch",C);const A=new nr(t),M=new to(t);s.dragRotate=new Dh(t,A,M),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]);const z=new Sh(t),F=new $p(s,t);s.dragPan=new Ph(d,z,F),this._add("mousePan",z),this._add("touchPan",F,["touchZoom","touchRotate"]);const V=new qn,$=new Ih;s.touchZoomRotate=new Lh(d,$,V,b),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new bh(s));const U=s.scrollZoom=new Us(s,this);this._add("scrollZoom",U,["mousePan"]);const W=s.keyboard=new Je;this._add("keyboard",W);for(const N of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[N]&&s[N].enable(t[N])}_add(t,s,d){this._handlers.push({handlerName:t,handler:s,allowed:d}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Vs(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,s,d){for(const m in t)if(m!==d&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const d of t)this._el.contains(d.target)&&s.push(d);return s}handleEvent(t,s){this._updatingCamera=!0;const d=t.type==="renderFrame",m=d?void 0:t,_={needsRenderFrame:!1},x={},b={},C=t.touches?this._getMapTouches(t.touches):void 0,A=C?oe.touchPos(this._el,C):d?void 0:oe.mousePos(this._el,t);for(const{handlerName:F,handler:V,allowed:$}of this._handlers){if(!V.isEnabled())continue;let U;this._blockedByActive(b,$,F)?V.reset():V[s||t.type]&&(U=V[s||t.type](t,A,C),this.mergeHandlerResult(_,x,U,F,m),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||V.isActive())&&(b[F]=V)}const M={};for(const F in this._previousActiveHandlers)b[F]||(M[F]=m);this._previousActiveHandlers=b,(Object.keys(M).length||Uo(_))&&(this._changes.push([_,x,M]),this._triggerRenderFrame()),(Object.keys(b).length||Uo(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=_;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(t,s,d,m,_){if(!d)return;a.extend(t,d);const x={handlerName:m,originalEvent:d.originalEvent||_};d.zoomDelta!==void 0&&(s.zoom=x),d.panDelta!==void 0&&(s.drag=x),d.pitchDelta!==void 0&&(s.pitch=x),d.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const t={},s={},d={};for(const[m,_,x]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new a.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),a.extend(s,_),a.extend(d,x);this._updateMapTransform(t,s,d),this._changes=[]}_updateMapTransform(t,s,d){const m=this._map,_=m.transform,x=X=>[X.x,X.y,X.z];if((X=>{const K=this._eventsInProgress.drag;return K&&!this._handlersById[K.handlerName].isActive()})()&&!Uo(t)){const X=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",X!==_.zoom&&this._map._update(!0)}if(!Uo(t))return this._fireEvents(s,d,!0);let{panDelta:b,zoomDelta:C,bearingDelta:A,pitchDelta:M,around:z,aroundCoord:F,pinchAround:V}=t;V!==void 0&&(z=V),(X=>s.drag&&!this._eventsInProgress.drag)()&&z&&(this._dragOrigin=x(_.pointCoordinate3D(z)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",m._stop(!0),z=z||m.transform.centerPoint,A&&(_.bearing+=A),M&&(_.pitch+=M),_._updateCameraState();const $=[0,0,0];if(b){const X=_.screenPointToMercatorRay(z),K=_.screenPointToMercatorRay(z.sub(b)),j=this._trackingEllipsoid.projectRay(X.dir),J=this._trackingEllipsoid.projectRay(K.dir);$[0]=J[0]-j[0],$[1]=J[1]-j[1]}const U=_.zoom,W=[0,0,0];if(C){const X=x(F||_.pointCoordinate3D(z)),K={dir:a.normalize([],a.sub([],X,_._camera.position))},j=_.screenPointToMercatorRay(_.centerPoint);if(K.dir[2]<0){const J=a.altitudeFromMercatorZ(X[2],X[1]),ne=_.rayIntersectionCoordinate(_.pointRayIntersection(_.centerPoint,J)),ve=_.zoomDeltaToMovement(x(ne),C)*(j.dir[2]/K.dir[2]);a.scale(W,K.dir,ve)}else if(_._terrainEnabled()){const J=_.zoomDeltaToMovement(X,C);a.scale(W,K.dir,J)}}const N=a.add($,$,W);_._translateCameraConstrained(N),C&&Math.abs(_.zoom-U)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,d,!0)}_fireEvents(t,s,d){const m=Vs(this._eventsInProgress),_=Vs(t),x={};for(const M in t){const{originalEvent:z}=t[M];this._eventsInProgress[M]||(x[`${M}start`]=z),this._eventsInProgress[M]=t[M]}!m&&_&&this._fireEvent("movestart",_.originalEvent);for(const M in x)this._fireEvent(M,x[M]);_&&this._fireEvent("move",_.originalEvent);for(const M in t){const{originalEvent:z}=t[M];this._fireEvent(M,z)}const b={};let C;for(const M in this._eventsInProgress){const{handlerName:z,originalEvent:F}=this._eventsInProgress[M];this._handlersById[z].isActive()||(delete this._eventsInProgress[M],C=s[z]||F,b[`${M}end`]=C)}for(const M in b)this._fireEvent(M,b[M]);const A=Vs(this._eventsInProgress);if(d&&(m||_)&&!A){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;M?(z(M.bearing||this._map.getBearing())&&(M.bearing=0),this._map.easeTo(M,{originalEvent:C})):(this._map.fire(new a.Event("moveend",{originalEvent:C})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new a.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Rh("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ic="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Bh extends a.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,d){return t=a.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,a.extend({offset:t},s),d)}panTo(t,s,d){return this.easeTo(a.extend({center:t},s),d)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,d){return this.easeTo(a.extend({zoom:t},s),d)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,d){return this.easeTo(a.extend({bearing:t},s),d)}resetNorth(t,s){return this.rotateTo(0,a.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=a.LngLatBounds.convert(t);const d=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),d,s)}_extendCameraOptions(t){const s={top:0,bottom:0,right:0,left:0};if(typeof(t=a.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const d=t.padding;t.padding={top:d,bottom:d,right:d,left:d}}return t.padding=a.extend(s,t.padding),t}_cameraForBoxAndBearing(t,s,d,m){const _=this._extendCameraOptions(m),x=this.transform,b=x.padding,C=x.project(a.LngLat.convert(t)),A=x.project(a.LngLat.convert(s)),M=C.rotate(-a.degToRad(d)),z=A.rotate(-a.degToRad(d)),F=new a.pointGeometry(Math.max(M.x,z.x),Math.max(M.y,z.y)),V=new a.pointGeometry(Math.min(M.x,z.x),Math.min(M.y,z.y)),$=F.sub(V),U=(x.width-(b.left+b.right+_.padding.left+_.padding.right))/$.x,W=(x.height-(b.top+b.bottom+_.padding.top+_.padding.bottom))/$.y;if(W<0||U<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const N=Math.min(x.scaleZoom(x.scale*Math.min(U,W)),_.maxZoom),X=typeof _.offset.x=="number"?new a.pointGeometry(_.offset.x,_.offset.y):a.pointGeometry.convert(_.offset),K=new a.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(d*Math.PI/180),j=X.add(K).mult(x.scale/x.zoomScale(N));return{center:x.unproject(C.add(A).div(2).sub(j)),zoom:N,bearing:d}}_cameraForBox(t,s,d,m,_){const x=this._extendCameraOptions(_);d=d||0,m=m||0,t=a.LngLat.convert(t),s=a.LngLat.convert(s);const b=this.transform.clone();b.padding=x.padding;const C=this.getFreeCameraOptions(),A=new a.LngLat(.5*(t.lng+s.lng),.5*(t.lat+s.lat)),M=.5*(d+m);if(b._camera.position[2]<a.mercatorZfromAltitude(M,A.lat))return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");C.lookAtPoint(A),b.setFreeCameraOptions(C);const z=a.MercatorCoordinate.fromLngLat(t),F=a.MercatorCoordinate.fromLngLat(s),V=b.pointRayIntersection(b.centerPoint,M),$=[(U=b.rayIntersectionCoordinate(V)).x,U.y,U.z];var U;const W=b.screenPointToMercatorRay(b.centerPoint);let N,X=0;do{const K=Math.floor(b.zoom),j=1<<K,J=Math.min(j*z.x,j*F.x),ne=Math.min(j*z.y,j*F.y),ve=Math.max(j*z.x,j*F.x),xe=Math.max(j*z.y,j*F.y),Ee=new Xe([J,ne,d],[ve,xe,m]),Se=at.fromInvProjectionMatrix(b.invProjMatrix,b.worldSize,K);if(Ee.intersects(Se)!==2){N&&(b._camera.position=a.scaleAndAdd([],b._camera.position,W.dir,-N),b._updateStateFromCamera());break}const Fe=a.sub([],b._camera.position,$);N=.5*a.length(Fe),b._camera.position=a.scaleAndAdd([],b._camera.position,W.dir,N);try{b._updateStateFromCamera()}catch{return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++X<10);return{center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}}fitBounds(t,s,d){return this._fitInternal(this.cameraForBounds(t,s),s,d)}_raycastElevationBox(t,s){const d=this.transform.elevation;if(!d)return;const m=new a.pointGeometry(t.x,s.y),_=new a.pointGeometry(s.x,t.y),x=d.pointCoordinate(t);if(!x)return;const b=d.pointCoordinate(s);if(!b)return;const C=d.pointCoordinate(m);if(!C)return;const A=d.pointCoordinate(_);if(!A)return;const M=new a.MercatorCoordinate(x[0],x[1]).toLngLat(),z=new a.MercatorCoordinate(b[0],b[1]).toLngLat(),F=new a.MercatorCoordinate(C[0],C[1]).toLngLat(),V=new a.MercatorCoordinate(A[0],A[1]).toLngLat(),$=Math.min(M.lng,Math.min(z.lng,Math.min(F.lng,V.lng))),U=Math.min(M.lat,Math.min(z.lat,Math.min(F.lat,V.lat))),W=Math.max(M.lng,Math.max(z.lng,Math.max(F.lng,V.lng))),N=Math.max(M.lat,Math.max(z.lat,Math.max(F.lat,V.lat))),X=Math.min(x[3],Math.min(b[3],Math.min(C[3],A[3]))),K=Math.max(x[3],Math.max(b[3],Math.max(C[3],A[3])));return{minLngLat:new a.LngLat($,U),maxLngLat:new a.LngLat(W,N),minAltitude:X,maxAltitude:K}}fitScreenCoordinates(t,s,d,m,_){let x,b,C,A;const M=a.pointGeometry.convert(t),z=a.pointGeometry.convert(s),F=this._raycastElevationBox(M,z);if(F)x=F.minLngLat,b=F.maxLngLat,C=F.minAltitude,A=F.maxAltitude;else{if(this.transform.anyCornerOffEdge(M,z))return this;x=this.transform.pointLocation(M),b=this.transform.pointLocation(z)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(t)),this.transform.pointLocation(a.pointGeometry.convert(s)),d,m):this._cameraForBox(x,b,C,A,m),m,_)}_fitInternal(t,s,d){return t?(delete(s=a.extend(t,s)).padding,s.linear?this.easeTo(s,d):this.flyTo(s,d)):this}jumpTo(t,s){this.stop();const d=this.transform;let m=!1,_=!1,x=!1;return"zoom"in t&&d.zoom!==+t.zoom&&(m=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=a.LngLat.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(_=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(x=!0,d.pitch=+t.pitch),t.padding==null||d.isPaddingEqual(t.padding)||(d.padding=t.padding),this.fire(new a.Event("movestart",s)).fire(new a.Event("move",s)),m&&this.fire(new a.Event("zoomstart",s)).fire(new a.Event("zoom",s)).fire(new a.Event("zoomend",s)),_&&this.fire(new a.Event("rotatestart",s)).fire(new a.Event("rotate",s)).fire(new a.Event("rotateend",s)),x&&this.fire(new a.Event("pitchstart",s)).fire(new a.Event("pitch",s)).fire(new a.Event("pitchend",s)),this.fire(new a.Event("moveend",s))}getFreeCameraOptions(){return this.transform.projection.name!=="mercator"&&a.warnOnce(Ic),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const d=this.transform;if(d.projection.name!=="mercator")return void a.warnOnce(Ic);this.stop();const m=d.zoom,_=d.pitch,x=d.bearing;d.setFreeCameraOptions(t);const b=m!==d.zoom,C=_!==d.pitch,A=x!==d.bearing;return this.fire(new a.Event("movestart",s)).fire(new a.Event("move",s)),b&&this.fire(new a.Event("zoomstart",s)).fire(new a.Event("zoom",s)).fire(new a.Event("zoomend",s)),A&&this.fire(new a.Event("rotatestart",s)).fire(new a.Event("rotate",s)).fire(new a.Event("rotateend",s)),C&&this.fire(new a.Event("pitchstart",s)).fire(new a.Event("pitch",s)).fire(new a.Event("pitchend",s)),this.fire(new a.Event("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=a.extend({offset:[0,0],duration:500,easing:a.ease},t)).animate===!1||!t.essential&&a.exported.prefersReducedMotion)&&(t.duration=0);const d=this.transform,m=this.getZoom(),_=this.getBearing(),x=this.getPitch(),b=this.getPadding(),C="zoom"in t?+t.zoom:m,A="bearing"in t?this._normalizeBearing(t.bearing,_):_,M="pitch"in t?+t.pitch:x,z="padding"in t?t.padding:d.padding,F=a.pointGeometry.convert(t.offset);let V=d.centerPoint.add(F);const $=d.pointLocation(V),U=a.LngLat.convert(t.center||$);this._normalizeCenter(U);const W=d.project($),N=d.project(U).sub(W),X=d.zoomScale(C-m);let K,j;t.around&&(K=a.LngLat.convert(t.around),j=d.locationPoint(K));const J={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||C!==m,this._rotating=this._rotating||_!==A,this._pitching=this._pitching||M!==x,this._padding=!d.isPaddingEqual(z),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,J),this._ease(ne=>{if(this._zooming&&(d.zoom=a.number(m,C,ne)),this._rotating&&(d.bearing=a.number(_,A,ne)),this._pitching&&(d.pitch=a.number(x,M,ne)),this._padding&&(d.interpolatePadding(b,z,ne),V=d.centerPoint.add(F)),K)d.setLocationAtPoint(K,j);else{const ve=d.zoomScale(d.zoom-m),xe=C>m?Math.min(2,X):Math.max(.5,X),Ee=Math.pow(xe,1-ne),Se=d.unproject(W.add(N.mult(ne*Ee)).mult(ve));d.setLocationAtPoint(d.renderWorldCopies?Se.wrap():Se,V)}this._fireMoveEvents(s)},ne=>{d.recenterOnTerrain(),this._afterEase(s,ne)},t),this}_prepareEase(t,s,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||d.moving||this.fire(new a.Event("movestart",t)),this._zooming&&!d.zooming&&this.fire(new a.Event("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new a.Event("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new a.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new a.Event("move",t)),this._zooming&&this.fire(new a.Event("zoom",t)),this._rotating&&this.fire(new a.Event("rotate",t)),this._pitching&&this.fire(new a.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.transform.cameraElevationReference="ground";const d=this._zooming,m=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new a.Event("zoomend",t)),m&&this.fire(new a.Event("rotateend",t)),_&&this.fire(new a.Event("pitchend",t)),this.fire(new a.Event("moveend",t))}flyTo(t,s){if(!t.essential&&a.exported.prefersReducedMotion){const Ue=a.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ue,s)}this.stop(),t=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},t);const d=this.transform,m=this.getZoom(),_=this.getBearing(),x=this.getPitch(),b=this.getPadding(),C="zoom"in t?a.clamp(+t.zoom,d.minZoom,d.maxZoom):m,A="bearing"in t?this._normalizeBearing(t.bearing,_):_,M="pitch"in t?+t.pitch:x,z="padding"in t?t.padding:d.padding,F=d.zoomScale(C-m),V=a.pointGeometry.convert(t.offset);let $=d.centerPoint.add(V);const U=d.pointLocation($),W=a.LngLat.convert(t.center||U);this._normalizeCenter(W);const N=d.project(U),X=d.project(W).sub(N);let K=t.curve;const j=Math.max(d.width,d.height),J=j/F,ne=X.mag();if("minZoom"in t){const Ue=a.clamp(Math.min(t.minZoom,m,C),d.minZoom,d.maxZoom),Qe=j/d.zoomScale(Ue-m);K=Math.sqrt(Qe/ne*2)}const ve=K*K;function xe(Ue){const Qe=(J*J-j*j+(Ue?-1:1)*ve*ve*ne*ne)/(2*(Ue?J:j)*ve*ne);return Math.log(Math.sqrt(Qe*Qe+1)-Qe)}function Ee(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function Se(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}const Fe=xe(0);let Te=function(Ue){return Se(Fe)/Se(Fe+K*Ue)},Oe=function(Ue){return j*((Se(Fe)*(Ee(Qe=Fe+K*Ue)/Se(Qe))-Ee(Fe))/ve)/ne;var Qe},ye=(xe(1)-Fe)/K;if(Math.abs(ne)<1e-6||!isFinite(ye)){if(Math.abs(j-J)<1e-6)return this.easeTo(t,s);const Ue=J<j?-1:1;ye=Math.abs(Math.log(J/j))/K,Oe=function(){return 0},Te=function(Qe){return Math.exp(Ue*K*Qe)}}return t.duration="duration"in t?+t.duration:1e3*ye/("screenSpeed"in t?+t.screenSpeed/K:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=_!==A,this._pitching=M!==x,this._padding=!d.isPaddingEqual(z),this._prepareEase(s,!1),this._ease(Ue=>{const Qe=Ue*ye,lt=1/Te(Qe);d.zoom=Ue===1?C:m+d.scaleZoom(lt),this._rotating&&(d.bearing=a.number(_,A,Ue)),this._pitching&&(d.pitch=a.number(x,M,Ue)),this._padding&&(d.interpolatePadding(b,z,Ue),$=d.centerPoint.add(V));const ut=Ue===1?W:d.unproject(N.add(X.mult(Oe(Qe))).mult(lt));d.setLocationAtPoint(d.renderWorldCopies?ut.wrap():ut,$),d._updateCenterElevation(),this._fireMoveEvents(s)},()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,s)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,s,d){d.animate===!1||d.duration===0?(t(1),s()):(this._easeStart=a.exported.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=a.wrap(t,-180,180);const d=Math.abs(t-s);return Math.abs(t-360-s)<d&&(t-=360),Math.abs(t+360-s)<d&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.maxBounds)return;const d=t.lng-s.center.lng;t.lng+=d>180?-360:d<-180?360:0}}class Ac{constructor(t={}){this.options=t,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact;return this._map=t,this._container=oe.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=oe.create("button","mapboxgl-ctrl-attrib-button",this._container),oe.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=oe.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){oe.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const d=this._map._getUIString(`AttributionControl.${s}`);t.setAttribute("aria-label",d),t.firstElementChild&&t.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(t){const d=s.reduce((m,_,x)=>(_.value&&(m+=`${_.key}=${_.value}${x<s.length-1?"&":""}`),m),"?");t.href=`${a.config.FEEDBACK_URL}/${d}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._sourceCaches;for(const m in s){const _=s[m];if(_.used){const x=_.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort((m,_)=>m.length-_.length),t=t.filter((m,_)=>{for(let x=_+1;x<t.length;x++)if(t[x].indexOf(m)>=0)return!1;return!0});const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Mc{constructor(){a.bindAll(["_updateLogo"],this),a.bindAll(["_updateCompact"],this)}onAdd(t){this._map=t,this._container=oe.create("div","mapboxgl-ctrl");const s=oe.create("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){oe.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const d=t[s].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class kc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,d=s?this._queue.concat(s):this._queue;for(const m of d)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const d of s)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function zc(u,t,s){if(u=new a.LngLat(u.lng,u.lat),t){const d=new a.LngLat(u.lng-360,u.lat),m=new a.LngLat(u.lng+360,u.lat),_=360*Math.ceil(Math.abs(u.lng-s.center.lng)/360),x=s.locationPoint(u).distSqr(t),b=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint(d).distSqr(t)<x&&(b||Math.abs(d.lng-s.center.lng)<_)?u=d:s.locationPoint(m).distSqr(t)<x&&(b||Math.abs(m.lng-s.center.lng)<_)&&(u=m)}for(;Math.abs(u.lng-s.center.lng)>180;){const d=s.locationPoint(u);if(d.x>=0&&d.y>=0&&d.x<=s.width&&d.y<=s.height)break;u.lng>s.center.lng?u.lng-=360:u.lng+=360}return u}const il={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class js extends a.Evented{constructor(t,s){if(super(),(t instanceof a.window.HTMLElement||s)&&(t=a.extend({element:t},s)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=a.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=oe.create("div"),this._element.setAttribute("aria-label","Map marker");const m=oe.createNS("http://www.w3.org/2000/svg","svg"),_=41,x=27;m.setAttributeNS(null,"display","block"),m.setAttributeNS(null,"height",`${_}px`),m.setAttributeNS(null,"width",`${x}px`),m.setAttributeNS(null,"viewBox",`0 0 ${x} ${_}`);const b=oe.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const C=oe.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const A=oe.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(3.0, 29.0)"),A.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const K of M){const j=oe.createNS("http://www.w3.org/2000/svg","ellipse");j.setAttributeNS(null,"opacity","0.04"),j.setAttributeNS(null,"cx","10.5"),j.setAttributeNS(null,"cy","5.80029008"),j.setAttributeNS(null,"rx",K.rx),j.setAttributeNS(null,"ry",K.ry),A.appendChild(j)}const z=oe.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const F=oe.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(F);const V=oe.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"opacity","0.25"),V.setAttributeNS(null,"fill","#000000");const $=oe.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),V.appendChild($);const U=oe.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(6.0, 7.0)"),U.setAttributeNS(null,"fill","#FFFFFF");const W=oe.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const N=oe.createNS("http://www.w3.org/2000/svg","circle");N.setAttributeNS(null,"fill","#000000"),N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"cx","5.5"),N.setAttributeNS(null,"cy","5.5"),N.setAttributeNS(null,"r","5.4999962");const X=oe.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#FFFFFF"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962"),W.appendChild(N),W.appendChild(X),C.appendChild(A),C.appendChild(z),C.appendChild(V),C.appendChild(U),C.appendChild(W),m.appendChild(C),m.setAttributeNS(null,"height",_*this._scale+"px"),m.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(m),this._offset=a.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const d=this._element.classList;for(const m in il)d.remove(`mapboxgl-marker-anchor-${m}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),oe.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const s=38.1,d=13.5,m=Math.sqrt(Math.pow(d,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-s],"bottom-left":[m,-1*(s-d+m)],"bottom-right":[-m,-1*(s-d+m)],left:[d,-1*(s-d)],right:[-d,-1*(s-d)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,d=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,d=this._element;this._popup&&(s===d||d.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const t=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(t))return void this._clearFadeTimer();const s=this._map.unproject(t);let d=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const _=this._map.getFreeCameraOptions();if(_.position){const x=_.position.toLngLat();d=x.distanceTo(s)<.9*x.distanceTo(this._lngLat)}}const m=(1-this._map._queryFogOpacity(s))*(d?.2:1);this._element.style.opacity=`${m}`,this._popup&&this._popup._setOpacity(`${m}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(t){const s=this._map.transform;return!!t&&t.x>=0&&t.x<s.width&&t.y>=0&&t.y<s.height}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=zc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?d="rotateX(0deg)":this._pitchAlignment==="map"&&(d=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&oe.setTransform(this._element,`${il[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${s}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const t=this._map.transform,s=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&s._rotate(t.angle),this._pitchAlignment==="map"&&(s.y*=Math.cos(t._pitch)),s}getOffset(){return this._offset}setOffset(t){return this._offset=a.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Fh{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=a.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,d){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+d}}const Oh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:$s,HTMLElement:Uh,ImageBitmap:Sr}=a.window,Nh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Gs(u){u.parentNode&&u.parentNode.removeChild(u)}const Vh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Pc{constructor(t,s,d=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new nr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new to({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),oe.addEventListener(s,"mousedown",this.mousedown),oe.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),oe.addEventListener(s,"touchmove",this.touchmove),oe.addEventListener(s,"touchend",this.touchend),oe.addEventListener(s,"touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),oe.disableDrag()}move(t,s){const d=this.map,m=this.mouseRotate.mousemoveWindow(t,s);if(m&&m.bearingDelta&&d.setBearing(d.getBearing()+m.bearingDelta),this.mousePitch){const _=this.mousePitch.mousemoveWindow(t,s);_&&_.pitchDelta&&d.setPitch(d.getPitch()+_.pitchDelta)}}off(){const t=this.element;oe.removeEventListener(t,"mousedown",this.mousedown),oe.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),oe.removeEventListener(t,"touchmove",this.touchmove),oe.removeEventListener(t,"touchend",this.touchend),oe.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){oe.enableDrag(),oe.removeEventListener(a.window,"mousemove",this.mousemove),oe.removeEventListener(a.window,"mouseup",this.mouseup)}mousedown(t){this.down(a.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),oe.mousePos(this.element,t)),oe.addEventListener(a.window,"mousemove",this.mousemove),oe.addEventListener(a.window,"mouseup",this.mouseup)}mousemove(t){this.move(t,oe.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=oe.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=oe.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Dc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Cr,nl=0,Zs=!1;const Lc={maxWidth:100,unit:"metric"};function Rc(u,t,s){const d=s&&s.maxWidth||100,m=u._container.getBoundingClientRect().height/2,_=u.unproject([0,m]),x=u.unproject([d,m]),b=_.distanceTo(x);if(s&&s.unit==="imperial"){const C=3.2808*b;C>5280?No(t,d,C/5280,u._getUIString("ScaleControl.Miles"),u):No(t,d,C,u._getUIString("ScaleControl.Feet"),u)}else s&&s.unit==="nautical"?No(t,d,b/1852,u._getUIString("ScaleControl.NauticalMiles"),u):b>=1e3?No(t,d,b/1e3,u._getUIString("ScaleControl.Kilometers"),u):No(t,d,b,u._getUIString("ScaleControl.Meters"),u)}function No(u,t,s,d,m){const _=function(b){const C=Math.pow(10,`${Math.floor(b)}`.length-1);let A=b/C;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(M){const z=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*z)/z}(A),C*A}(s),x=_/s;m._requestDomTask(()=>{u.style.width=t*x+"px",u.innerHTML=`${_}&nbsp;${d}`})}const Gp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Vo={version:a.version,supported:Q,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Bh{constructor(u){if((u=a.extend({},Nh,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new bc(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._optimizeForTerrain=u.optimizeForTerrain,this._renderTaskQueue=new kc,this._domRenderTaskQueue=new kc,this._controls=[],this._markers=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Oh,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Fh(0),this._requestManager=new a.RequestManager(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,typeof u.container=="string"){if(this._container=a.window.document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof Uh))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new tl(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,u.style&&this.setStyle(u.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this._hash=u.hash&&new Xa(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,a.extend({},u.fitBoundsOptions,{duration:0})))),this.resize(),u.attributionControl&&this.addControl(new Ac({customAttribution:u.customAttribution})),this._logoControl=new Mc,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new a.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new a.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=u.onAdd(this);this._controls.push(u);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(s,d.firstChild):d.appendChild(s),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){const[t,s]=this._containerDimensions();if(t===this.transform.width&&s===this.transform.height)return this;this._resizeCanvas(t,s),this.transform.resize(t,s),this.painter.resize(Math.ceil(t),Math.ceil(s));const d=!this._moving;return d&&this.fire(new a.Event("movestart",u)).fire(new a.Event("move",u)),this.fire(new a.Event("resize",u)),d&&this.fire(new a.Event("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(a.LngLatBounds.convert(u)),this._update()}setMinZoom(u){if((u=u==null?-2:u)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u==null?22:u)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u==null?0:u)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u==null?85:u)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}getProjection(){return this.transform.getProjection()}setProjection(u){this._lazyInitEmptyStyle(),typeof u=="string"&&(u={name:u}),this._runtimeProjection=u,this.style.updateProjection()}project(u){return this.transform.locationPoint3D(a.LngLat.convert(u))}unproject(u){return this.transform.pointLocation3D(a.pointGeometry.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(u,t,s){if(u==="mouseenter"||u==="mouseover"){let d=!1;const m=x=>{const b=t.filter(A=>this.getLayer(A)),C=b.length?this.queryRenderedFeatures(x.point,{layers:b}):[];C.length?d||(d=!0,s.call(this,new Ki(u,this,x.originalEvent,{features:C}))):d=!1},_=()=>{d=!1};return{layers:new Set(t),listener:s,delegates:{mousemove:m,mouseout:_}}}if(u==="mouseleave"||u==="mouseout"){let d=!1;const m=x=>{const b=t.filter(C=>this.getLayer(C));(b.length?this.queryRenderedFeatures(x.point,{layers:b}):[]).length?d=!0:d&&(d=!1,s.call(this,new Ki(u,this,x.originalEvent)))},_=x=>{d&&(d=!1,s.call(this,new Ki(u,this,x.originalEvent)))};return{layers:new Set(t),listener:s,delegates:{mousemove:m,mouseout:_}}}{const d=m=>{const _=t.filter(b=>this.getLayer(b)),x=_.length?this.queryRenderedFeatures(m.point,{layers:_}):[];x.length&&(m.features=x,s.call(this,m),delete m.features)};return{layers:new Set(t),listener:s,delegates:{[u]:d}}}}on(u,t,s){if(s===void 0)return super.on(u,t);Array.isArray(t)||(t=[t]);const d=this._createDelegatedListener(u,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(d);for(const m in d.delegates)this.on(m,d.delegates[m]);return this}once(u,t,s){if(s===void 0)return super.once(u,t);Array.isArray(t)||(t=[t]);const d=this._createDelegatedListener(u,t,s);for(const m in d.delegates)this.once(m,d.delegates[m]);return this}off(u,t,s){if(s===void 0)return super.off(u,t);t=new Set(Array.isArray(t)?t:[t]);const d=(_,x)=>{if(_.size!==x.size)return!1;for(const b of _)if(!x.has(b))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[u]:void 0;return m&&(_=>{for(let x=0;x<_.length;x++){const b=_[x];if(b.listener===s&&d(b.layers,t)){for(const C in b.delegates)this.off(C,b.delegates[C]);return _.splice(x,1),this}}})(m),this}queryRenderedFeatures(u,t){return this.style?(t!==void 0||u===void 0||u instanceof a.pointGeometry||Array.isArray(u)||(t=u,u=void 0),this.style.queryRenderedFeatures(u=u||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(u,t){return this.style.querySourceFeatures(u,t)}queryTerrainElevation(u,t){const s=this.transform.elevation;return s?(t=a.extend({},{exaggerated:!0},t),s.getAtPoint(a.MercatorCoordinate.fromLngLat(u),null,t.exaggerated)):null}setStyle(u,t){return(t=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&u?(this._diffStyle(u,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),u&&(this.style=new wn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new wn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,t){if(typeof u=="string"){const s=this._requestManager.normalizeStyleURL(u),d=this._requestManager.transformRequest(s,a.ResourceType.Style);a.getJSON(d,(m,_)=>{m?this.fire(new a.ErrorEvent(m)):_&&this._updateDiff(_,t)})}else typeof u=="object"&&this._updateDiff(u,t)}_updateDiff(u,t){try{this.style.setState(u)&&this._update(!0)}catch(s){a.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(u,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(u,t){return this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)}isSourceLoaded(u){const t=this.style&&this.style._getSourceCaches(u);if(t.length!==0)return t.every(s=>s.loaded());this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${u}'`)))}areTilesLoaded(){const u=this.style&&this.style._sourceCaches;for(const t in u){const s=u[t]._tiles;for(const d in s){const m=s[d];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(u,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,s)}removeSource(u){return this.style.removeSource(u),this._updateTerrain(),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,t,{pixelRatio:s=1,sdf:d=!1,stretchX:m,stretchY:_,content:x}={}){if(this._lazyInitEmptyStyle(),t instanceof $s||Sr&&t instanceof Sr){const{width:b,height:C,data:A}=a.exported.getImageData(t);this.style.addImage(u,{data:new a.RGBAImage({width:b,height:C},A),pixelRatio:s,stretchX:m,stretchY:_,content:x,sdf:d,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:b,height:C,data:A}=t,M=t;this.style.addImage(u,{data:new a.RGBAImage({width:b,height:C},new Uint8Array(A)),pixelRatio:s,stretchX:m,stretchY:_,content:x,sdf:d,version:0,userImage:M}),M.onAdd&&M.onAdd(this,u)}}}updateImage(u,t){const s=this.style.getImage(u);if(!s)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=t instanceof $s||Sr&&t instanceof Sr?a.exported.getImageData(t):t,{width:m,height:_,data:x}=d;return m===void 0||_===void 0?this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):m!==s.data.width||_!==s.data.height?this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(s.data.replace(x,!(t instanceof $s||Sr&&t instanceof Sr)),void this.style.updateImage(u,s))}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){a.getImage(this._requestManager.transformRequest(u,a.ResourceType.Image),(s,d)=>{t(s,d instanceof $s?a.exported.getImageData(d):d)})}listImages(){return this.style.listImages()}addLayer(u,t){return this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)}moveLayer(u,t){return this.style.moveLayer(u,t),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}setLayerZoomRange(u,t,s){return this.style.setLayerZoomRange(u,t,s),this._update(!0)}setFilter(u,t,s={}){return this.style.setFilter(u,t,s),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,t,s,d={}){return this.style.setPaintProperty(u,t,s,d),this._update(!0)}getPaintProperty(u,t){return this.style.getPaintProperty(u,t)}setLayoutProperty(u,t,s,d={}){return this.style.setLayoutProperty(u,t,s,d),this._update(!0)}getLayoutProperty(u,t){return this.style.getLayoutProperty(u,t)}setLight(u,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(u){return this._lazyInitEmptyStyle(),this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(u),this.transform):0}setFeatureState(u,t){return this.style.setFeatureState(u,t),this._update()}removeFeatureState(u,t){return this.style.removeFeatureState(u,t),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}_containerDimensions(){let u=0,t=0;return this._container&&(u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300),[u,t]}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=oe.create("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=oe.create("div","mapboxgl-canvas-container",u);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=oe.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1]);const d=this._controlContainer=oe.create("div","mapboxgl-control-container",u),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{m[_]=oe.create("div",`mapboxgl-ctrl-${_}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const s=a.exported.devicePixelRatio||1;this._canvas.width=s*Math.ceil(u),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_setupPainter(){const u=a.extend({},Q.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",u)||this._canvas.getContext("experimental-webgl",u);t?(a.storeAuthState(t,!0),this.painter=new _h(t,this.transform),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(t)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;const s=this.painter.context.extTimerQuery,d=a.exported.now();this.listens("gpu-timing-frame")&&(t=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,t));let m=this._updateAverageElevation(d);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;let _=!1;const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,A=this.transform.pitch,M=a.exported.now();this.style.zoomHistory.update(C,M);const z=new a.EvaluationParameters(C,{now:M,fadeDuration:x,pitch:A,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),F=z.crossFadingFactor();F===1&&F===this._crossFadingFactor||(_=!0,this._crossFadingFactor=F),this.style.update(z)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const C=a.exported.now()-d;s.endQueryEXT(s.TIME_ELAPSED_EXT,t),setTimeout(()=>{const A=s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(t),this.fire(new a.Event("gpu-timing-frame",{cpuTime:C,gpuTime:A}))},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const A=this.painter.queryGpuTimers(C);this.fire(new a.Event("gpu-timing-layer",{layerTimes:A}))},50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty||m;if(b||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(m=this._updateAverageElevation(d,!0)),m)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const A=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:A})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const u of this._markers)u._update()}_updateAverageElevation(u,t=!1){const s=d=>(this.transform.averageElevation=d,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);if((t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const d=this.transform.averageElevation;let m=this.transform.sampleAverageElevation();isNaN(m)?m=0:this._averageElevationLastSampledAt=u;const _=Math.abs(d-m);if(_>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(m),s(m);this._averageElevation.easeTo(m,u,300)}else if(_>1e-4)return this._averageElevation.jumpTo(m),s(m)}return!!this._averageElevation.isEasing(u)&&s(this._averageElevation.getValue(u))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===a.AUTH_ERR_MSG||u.status===401)){const t=this.painter.context.gl;a.storeAuthState(t,!1),this._logoControl instanceof Mc&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,d=s.createFramebuffer();function m(_){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,_,0);const x=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,x),x}return s.bindFramebuffer(s.FRAMEBUFFER,d),this._canvasPixelComparison(m(u),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(u,t,s){let d=s[1]-s[0];const m=u.length/4;for(let _=0;_<t.length;_++){const x=t[_];let b=0;for(let C=0;C<x.length;C+=4)x[C]===u[C]&&x[C+1]===u[C+1]&&x[C+2]===u[C+2]&&x[C+3]===u[C+3]&&(b+=1);d+=(s[_+2]-s[_+1])*(1-b/m)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.clearWorkerCaches(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1));const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),Gs(this._canvasContainer),Gs(this._controlContainer),Gs(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=a.exported.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}_setCacheLimits(u,t){a.setCacheLimits(u,t)}get version(){return a.version}},NavigationControl:class{constructor(u){this.options=a.extend({},Vh,u),this._container=oe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),oe.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),oe.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=oe.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const u=this._map.getZoom(),t=u===this._map.getMaxZoom(),s=u===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const u=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=u)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){oe.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,t){const s=oe.create("button",u,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(u,t){const s=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",s),u.firstElementChild&&u.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends a.Evented{constructor(u){super(),this.options=a.extend({},Dc,u),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Tc(this._updateMarkerRotation,20)}onAdd(u){var t;return this._map=u,this._container=oe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Cr!==void 0?t(Cr):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(s=>{Cr=s.state!=="denied",t(Cr)}):(Cr=!!a.window.navigator.geolocation,t(Cr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),oe.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,nl=0,Zs=!1}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),s=u.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",u)),this._finish()}}_updateCamera(u){const t=new a.LngLat(u.coords.longitude,u.coords.latitude),s=u.coords.accuracy,d=this._map.getBearing(),m=a.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new a.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map._container.getBoundingClientRect().height/2,t=this._map.unproject([0,u]),s=this._map.unproject([100,u]),d=t.distanceTo(s)/100,m=Math.ceil(2*this._accuracy/d);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&Zs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=oe.create("button","mapboxgl-ctrl-geolocate",this._container),oe.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",u===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=oe.create("div","mapboxgl-user-location"),this._dotElement.appendChild(oe.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(oe.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new js({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=oe.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new js({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":nl--,Zs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),nl++,nl>1?(u={maximumAge:6e5,timeout:0},Zs=!0):(u=this.options.positionOptions,Zs=!1),this._geolocationWatchID=a.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else a.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ac,ScaleControl:class{constructor(u){this.options=a.extend({},Lc,u),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Rc(this._map,this._container,this.options)}onAdd(u){return this._map=u,this._container=oe.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){oe.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(u){this.options.unit=u,Rc(this._map,this._container,this.options)}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof a.window.HTMLElement?this._container=u.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=oe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){oe.remove(this._controlContainer),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=oe.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);oe.create("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden",!0),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(u){super(),this.options=a.extend(Object.create(Gp),u),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&oe.remove(this._content),this._container&&(oe.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=a.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(a.window.document.createTextNode(u))}setHTML(u){const t=a.window.document.createDocumentFragment(),s=a.window.document.createElement("body");let d;for(s.innerHTML=u;d=s.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=oe.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._container&&this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._container&&this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._container&&this._updateClassList(),t}_createCloseButton(){this.options.closeButton&&(this._closeButton=oe.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(u){this._update(u.point)}_onMouseMove(u){this._update(u.point)}_onDrag(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._pos,s=this._container.offsetWidth,d=this._container.offsetHeight;let m;return m=t.y+u.bottom.y<d?["top"]:t.y>this._map.transform.height-d?["bottom"]:[],t.x<s/2?m.push("left"):t.x>this._map.transform.width-s/2&&m.push("right"),m.length===0?"bottom":m.join("-")}_updateClassList(){const u=[...this._classList];u.push("mapboxgl-popup"),this._anchor&&u.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&u.push("mapboxgl-popup-track-pointer"),this._container.className=u.join(" ")}_update(u){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=oe.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=oe.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=zc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||u){const t=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat),s=function(_){if(_||(_=new a.pointGeometry(0,0)),typeof _=="number"){const x=Math.round(Math.sqrt(.5*Math.pow(_,2)));return{center:new a.pointGeometry(0,0),top:new a.pointGeometry(0,_),"top-left":new a.pointGeometry(x,x),"top-right":new a.pointGeometry(-x,x),bottom:new a.pointGeometry(0,-_),"bottom-left":new a.pointGeometry(x,-x),"bottom-right":new a.pointGeometry(-x,-x),left:new a.pointGeometry(_,0),right:new a.pointGeometry(-_,0)}}if(_ instanceof a.pointGeometry||Array.isArray(_)){const x=a.pointGeometry.convert(_);return{center:x,top:x,"top-left":x,"top-right":x,bottom:x,"bottom-left":x,"bottom-right":x,left:x,right:x}}return{center:a.pointGeometry.convert(_.center||[0,0]),top:a.pointGeometry.convert(_.top||[0,0]),"top-left":a.pointGeometry.convert(_["top-left"]||[0,0]),"top-right":a.pointGeometry.convert(_["top-right"]||[0,0]),bottom:a.pointGeometry.convert(_.bottom||[0,0]),"bottom-left":a.pointGeometry.convert(_["bottom-left"]||[0,0]),"bottom-right":a.pointGeometry.convert(_["bottom-right"]||[0,0]),left:a.pointGeometry.convert(_.left||[0,0]),right:a.pointGeometry.convert(_.right||[0,0])}}(this.options.offset),d=this._anchor=this._getAnchor(s),m=t.add(s[d]).round();this._map._requestDomTask(()=>{this._container&&d&&oe.setTransform(this._container,`${il[d]} translate(${m.x}px,${m.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Zp);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._content&&(this._content.style.opacity=u),this._tip&&(this._tip.style.opacity=u)}},Marker:js,Style:wn,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:vc,Evented:a.Evented,config:a.config,prewarm:function(){je().acquire(re)},clearPrewarmedResources:function(){const u=Ae;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(re),Ae=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(u){a.config.ACCESS_TOKEN=u},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(u){a.config.API_URL=u},get workerCount(){return fe.workerCount},set workerCount(u){fe.workerCount=u},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){a.config.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){a.clearTileCache(u)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return Vo});var B=E;return B})})(r1);var FT=r1.exports,kT={exports:{}},Ku={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zT=bd.exports,s1=60103;Ku.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var a1=Symbol.for;s1=a1("react.element"),Ku.Fragment=a1("react.fragment")}var PT=zT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,DT=Object.prototype.hasOwnProperty,LT={key:!0,ref:!0,__self:!0,__source:!0};function l1(o,l,f){var v,E={},k=null,B=null;f!==void 0&&(k=""+f),l.key!==void 0&&(k=""+l.key),l.ref!==void 0&&(B=l.ref);for(v in l)DT.call(l,v)&&!LT.hasOwnProperty(v)&&(E[v]=l[v]);if(o&&o.defaultProps)for(v in l=o.defaultProps,l)E[v]===void 0&&(E[v]=l[v]);return{$$typeof:s1,type:o,key:k,ref:B,props:E,_owner:PT.current}}Ku.jsx=l1;Ku.jsxs=l1;kT.exports=Ku;export{BT as R,RT as a,kT as j,FT as m,bd as r};
